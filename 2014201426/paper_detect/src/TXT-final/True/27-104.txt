 
this paper presents a theoretical framework for mapping from structure to function in engineering domains. we argue that a generative approach grounded in qualitative process theory produces useful functional explanations. these explanations are articulate  in that they enable the user to explore their theoretical justifications and 
perform counterfactual reasoning. these explanations stem from a teleological representation based on goals  plans  roles  and views. we show that an ontology based on aggregated processes facilitates the recognition of recurring thermodynamic structures. we describe an implementation of this theory  a system called c a r n o t that explains steady-flow thermodynamic cycles ranging in complexity from four to 1 components. 
1 introduction 
thermodynamic cycles  e.g.  power plants  refrigerators  form an important class of artifacts. devices based on them are complex and costly to operate  which provides several motivations for reasoning about them. engineers and students need to verify that their designs will behave as desired  and plant operators need to generate and test hypotheses concerning system functions from schematics. 
   each of these cases calls for reasoning about function given a structural description. this paper describes a theory of structure-to-function mapping that supports these tasks in the domain of thermodynamic cycles. we have implemented this theory in a system called carnot that takes as input a schematic depicting the structural configuration of a system such as a refrigerator and produces a description of the system's function  at both global and local levels. 
   dekleer  was the first to investigate the mapping from structure to function. he proposed  for the domain of electronic circuits  a methodology using qualitative physics to map from structure  what the artifact is  to behavior  what the artifact does  and a separate  teleological reasoning process to map from behavior to function  what the artifact is for . thus the behaviors of a working turbine include expansion of the working fluid  cooling of the fluid and creation of shaft work. its function  however  may be either to produce work or to cool the working fluid  and is contingent on the context in which it is embedded. 
   despite the relatively greater constraints on the function of thermodynamic systems  we encountered significant ambiguities in mapping from the structure of thermodynamic cycles to their function. this paper describes how our theory resolves these ambiguities to produce teleological construals of a schematic. section 1 presents an overview of the domain  section 1 discusses our theory  section 1 describes our representations  section 1 outlines the algorithm  and section 1 presents in detail one example and summarizes some of the more interesting results from other cycles carnot currently solves. we conclude with a discussion of related and future work. 
1 domain overview 
artifacts incorporating thermodynamic cycles are pervasive. virtually all electrical power generated today relies on a thermodynamic cycle in which massive boilers generate steam to turn turbines that drive generators. refrigerators rely on essentially the same cycle  albeit running in reverse and supplied with a different working fluid that enables their operation at safer pressures. automobile and jet engines operate in a so-called  open  cycle that takes in air from  and expels exhaust gases to the environment  yet they may be analyzed as cycles by treating the atmosphere as a single reservoir of air. industry relies on thermodynamic cycles for power  for liquefying gases  e.g.  natural gas  nitrogen  oxygen   and for process steam. 
1 	a simple heat engine 
the defining characteristic of a thermodynamic cycle is that it operates between two reservoirs of different temperatures  typically by passing a working fluid through a system of pipes and components. figure 1 shows a simple cycle. 
   this basic cycle  with some modifications to increase efficiency  is commonly used to generate electricity. heat energy obtained from combustion or nuclear reaction converts the working fluid into vapor in the boiler. this vapor then expands in the turbine  causing its blades to rotate  producing work. the condenser returns the working fluid to 
	everett 	1 


its original state by ejecting heat to the environment. the pump ensures a steady supply of working fluid to the boiler and maintains the system's direction of flow. 
   despite the fact that the constituent devices of this and other thermodynamic systems are complex artifacts designed to accomplish specific functions  we have found significant ambiguities in mapping from structure to function in this domain. for example  a turbine may function as either a work-producer or a cooler  and in cryogenic cycles the latter is the desired function. reaching human-like conclusions with little information despite such ambiguity has been the primary motivation for the development of our theory and the design of carnot's representations and algorithms. 
1 teleological theory 
the goal of this research is to automate the process of making functional inferences from structural information. to gauge our success  we need criteria for what constitutes a good functional explanation. we define such an explanation to be one that: 
  generates internally consistent construals 
  takes into account all available information 
  relates each device to at least one design goal 
  provides a certainty metric for each inference 
  enables counterfactual reasoning 
  grounds explanations in a qualitative theory of behavior 
   the value of functional explanations lies in the inferences that they sanction. a template-based approach could produce canned descriptions in great detail. however  such explanations would be unable to respond to user queries. a student might not understand a particular statement  and should therefore be able to backtrack through the inferential chain connecting that statement to domain theory givens. 
   to achieve such generativity  we minimize the size of knowledge fragments and rely on inference to assemble explanations. this avoids the redundant encoding of information endemic to tempi ate-matching approaches and enables the explanation of novel cycles. modularizing the representation also facilitates the task of maintaining a knowledgebase large enough to support a practical teleological reasoner. although our representation is primarily qualitative  it also supports the use of quantitative information for mak-
ing more precise functional inferences. 
finally  to prevent explosive inferencing  carnot adopts 
1 	qualitative reasoning and diagnosis 
what de kleer  1  calls the teleological perspective  in that we assume by default that each device contributes to the function of the system. this enables us to avoid extensive simulation because we assume that components operate within their normal parametric ranges. 
1 knowledge 	representations 
perusal of thermodynamic texts and reference materials reveals no universal standards for schematics  although informal conventions do exist  e.g.  turbines are generally depicted as trapezoids with vertical parallels . we use the schematic representation we designed for cyclepad  forbus & whalley  1   a system that enables students to design and experiment with thermodynamic cycles. 
   this representation reflects certain pedagogical considerations. to encourage students to consider modeling issues  only basic devices are explicitly represented. for example  there is no separate icon for a jet-ejector  a pump utilizing a high-velocity jet  because a mixer can function in this capacity. devices are also constrained to a particular number of directional fluid ports by which they connect to other devices. although in reality a turbine may have a large number of ports for bleeding steam  students must represent such turbines as sets of turbine stages connected by splitters. 
¡¡¡¡carnot's functional descriptions are composed of plans and roles. plans summarize common structural configurations that have particular functional import. roles specify which behavior of a particular component is its intended function. intermediate view and process constructs enable the instantiation of the proper plans and roles. views describe possible behaviors of particular devices  while processes ground explanations in a qualitative model of thermodynamics and provide a useful definition of locality. figure 1 provides an overview of these representations. arrows indicate constraining relationships. for example  the topology of the schematic determines which processes  roles  and views are instantiated. in the following description of these constructs  we will make reference to the cycle depicted in figure 1. this cycle generates shaft-work by running steam through the five turbines across the top of the diagram. because its efficiency is directly related to the average tem-
carnot's representations 


perature at which heat is added  some of the steam is bled from the turbine  via the four splitters  and used to preheat the feedwater flowing to the boiler. 
1 	goals 
the rational designer premise enables us to restrict our consideration to the set of goals that a rational agent would choose to pursue in the context of a design task. of this set  we believe that three possible goals in particular provide a thorough characterization of the teleology of a system:  1  achieving a change of state in the environment   1  doing so with a minimal input of energy  and  1  preserving the integrity of the system. in the case of a heat engine  the first goal is to convert heat energy into shaft-work  whereas in the case of a refrigerator it is to move heat from one location to another. the second goal arises from the assumption that the designer is under tight economic constraints. finally  because systems that achieve the first two goals also create potentially damaging conditions  some devices may be present solely to prevent the occurrence of such states. for example  in figure 1 pump-1 acts to prevent the working fluid from vaporizing in the two heat-exchangers downstream of it  because most pumps cannot pump mixtures of liquid and gas. should pump-1 receive such a mixture  it would cease to supply water to the boiler  which would then fail. 
1 	v i e w s 
views are device-specific behavioral descriptions. for example  views for a pump include  i  default   1  coasting   1  cavitating  and  1  losing. by default  carnot considers pumps to compress liquids  compressors compress gasses   so the default view sanctions inferences that input and output stuffs are liquid and that the input pressure is less than that of the output. views thus propagate phase information  but they also serve to prevent devices known to be behaving abnormally from informing process and plan inferences. 
1 	roles 
roles are the functional counterpart of views. for example  the potential roles of a pump include  1  flow-producer and  1  flash-preventer. the behavior of a default-view pump is to compress liquid; its function is to produce a flow. the difference is a presumption that this flow is essential to achieving one or more of the three design goals. a view is insufficient to support this presumption  because it is possible that the actual function is to act as a work-sink. 
   although roles are device-specific  they generally require consideration of the structural context for a device  and thus more reasoning. unlike views  roles are not always mutually exclusive; indeed  achieving multiple functions via a single device is often desirable from a design standpoint  for potential cost-savings and/or efficiency improvements. 
1 	processes 
processes are central to thermodynamics; the components of a particular cycle exist solely to create and control them. moreover  processes often span several devices  which may or may not be immediately adjacent. reifying such processes provides carnot with a powerful definition of locality  as we shall see below. 
   there are three types of process:  1  local   1  boundary  and  1  aggregate. devices create one or more local processes across their fluid-paths. for example  a pump creates a local fluid-flow process from its inlet to its outlet. 
   we adopt the thermodynamic convention of establishing control volumes around systems and subsystems of interest. control volumes require an accounting of all mass and energy crossing their boundaries. carnot explicitly notes all 
	everett 	1 

rankine cycle plan 
  vaporize working fluid at constant pressure 
  create a constant-entropy resisted expansion to produce shaft work 
  fully condense working fluid at constant pressure 
  pump liquid working-fluid at constant entropy to maintain flow direction 
figure 1 
boundary-crossing processes. for example  the heat-flow to a boiler must cross the system boundary  so all heaters give rise to boundary heat-flow processes. 
   aggregate processes provide a flexible means for matching canonical plans to cycles  because they capture critical aspects of a system without being overly sensitive to its particular topology. for example  figure 1 shows the aggregate pumping  heating  and expansion processes that arise from the three pumps  five heaters  mixer-1 is an open heatexchanger  as we will see below  and five turbines. this cycle is therefore identical to the simple cycle of figure 1 when we consider it in terms of aggregate processes. 
1 	plans 
certain thermodynamic configurations recur so often that their idealized abstractions have been reified. for example  most electrical power generating systems use some variant of the rankine cycle  around which a working fluid is vaporized and condensed. we refer to such named configurations as plans because they are in effect well-known strategies for the realization of design goals. figure 1 shows the content of our representation of the rankine cycle plan. other common plans include the cannot cycle  a theoretical ideal  and the brayton cycle  used for jet engines. 
   idealization simplifies analyses by assuming certain state parameters remain constant across the plan's processes. the ideal rankine cycle is comprised of constant-pressure 
 isobaric  heating and cooling processes and constant-entropy  isentropic  expansion and compression processes. 
   carnot distinguishes truly ideal from stepwise-ideal processes. the latter occur when the creation of two processes is interleaved. for example  the pumps and heaters of figure 1 are interleaved  obviously preventing the aggregate heating process from occurring at constant pressure. however  if each constituent local process is ideal  then carnot labels the aggregate as stepwise-ideal. this distinction enables carnot to differentiate practical from ideal cycles. an ideal cycle maximizes efficiency even at the cost of failing to preserve system integrity. such cycles are useful for pedagogical reasons and as benchmarks for assessing the efficiency of practical cycles. 
   carnot*s plans vary in generality. the most general are the heat-engine and refrigerator plans  which have no idealprocess requirements. the more information carnot is given  the more specific the plans instantiated. c a r n o t includes likely plans in the final description with a caveat that their antecedents must be true. carnot also recognizes inter-cycle plans  such as cascade-cycles and use-workinternally. in cascaded systems one cycle uses the heat ejected by the other  while in systems that combine heatengine and refrigerator cycles  the heat-engine's work drives the refrigerator. 
1 carnot's algorithm 
c a r n o t uses a logic-based truth maintenance system 
 forbus & de kleer  1  coupled to a pattern -directed rule engine. carnot's knowledge base is encoded as a set of rules. the underlying tms caches the resulting chains of inference  enabling c a r n o t to perform counterfactual reasoning and to construct causal explanations on demand. 
   carnot alternates between propagating local inferences and global processing based on these inferences. figure 1 summarizes the algorithm. carnot first instantiates mod-
els for each device it finds in the input cycle  ensuring that at least one view is active for each device. it then topologically parses the cycle into fluid loops and searches for a globally consistent functional labeling of each device. carnot then decides which of the fluid loops are thermodynamically meaningful subcycles  and infers the function of each subcycle. finally  carnot creates aggregate process assertions and uses them to infer the presence of plans. the following explains the algorithm in greater detail. 
1 	instantiating 	domain 	knowledge 
carnot first instantiates a set of device models that describe the structure of the input system and result in the instantiation of views. in some cases there isn't enough initial information for a particular device to have an active view. for these devices carnot instantiates the most specific view consistent with the known information. 
   for example  a heater default view makes no commitment about the phase of the stuff at inlet or outlet. however  if carnot detects only compressors  which can only compress gasses   it will assume a gas-heater view  which 

implies that the phase of the stuffs at inlet and outlet is gas. 
1 	identifying 	topological 	structures 
carnot next parses the cycle topologically into floops  short for  fluid loops  . these are directed cycles in which neither arcs nor vertices are duplicated. carnot breaks floops immediately upstream of the first compressing device to be found after the last expansion device. it does so because the working fluid is closest to ambient conditions here. automobile engines  which operate in a so-called  open  cycle  break the cycle at this point  taking in working fluid  i.e.  air  immediately prior to compressing it  and exhausting it immediately after the power stroke. 
   floops do not necessarily correspond to meaningful substructures in the input cycle  but merely represent routes that a piece of working fluid could traverse during the steady-state operation of the cycle. there are five floops in figure 1  corresponding to the outermost loop  and only subcycle  and the routes originating at the four splitters. carnot generates a hypothesis concerning the function of each floop  which is potentially a heat-engine  a refrigerator  or an artifact of the cycle's topology. 
   a mixer can act as either a simple route-joiner  a heatexchanger  if its two inputs are of different temperature  or a pump  if its two inputs are of different pressure . a splitter may either act as a route-divider or a flash-chamber  in which the working fluid evaporates  the gas leaving by one exit and the remaining liquid by the other. 
   this functional ambiguity means that valid subcycles may lack apparent pumps  expansion devices  heaters or coolers. to identify such floops  carnot uses the constraints shown in figure 1 to conduct a dependency-directed search for a consistent set of views of each floop's devices. these constraints follow from the rational-designer premise; there is no thermodynamic ally sound reason to immediately undo a change. for this search  carnot generates sets of potential roles for each mixer and splitter on the floop  ordered such that any solutions that allow the default mixing and splitting roles of those devices will be found first. 
   on completion of the search  carnot generates a refrigerator  heat-engine  or topological-artifact hypothesis based on either the order of devices in the floop or the presence of devices which could accomplish the essential compression  heating  expansion  and cooling processes. device order  although more persuasive evidence than mere presence  is not a certain predictor of floop type. carnot therefore asserts hypothesis statements that contain the inferred floop type  the justification for the inference  ordered or allpresent  and the set of role assumptions required for that floop type to pertain. carnot postpones committing to a hypothesis  however  because this requires non-local reasoning and can be made with greater certainty later. 
this search procedure only resolves situations in which a 
functional labeling constraints 
processes are considered neighbors if they are consecutive on a particular route or if they are connected by one or more splitting and/or mixing processes. 
heating and cooling processes cannot be neighbors. 
expansion and compression processes cannot be neighbors. 

device must play a certain role. however  mixer-1 in figure 1 need not play a heat-exchanger role. carnot resolves the roles of such devices via qualitative inference. 
1 	resolving 	roles 	via 	qualitative inference 
roles depend on the context in which the device is embedded. for the jet-ejector and open heat-exchanger roles  this context is limited to the state of the mixer's inputs; a temperature difference across the inputs indicates an open heatexchanger  while a pressure difference implies a jet-ejector. when carnot instantiates its knowledge of mixers  it also expresses interest in finding inequalities in either pressure or temperature across the mixer's inputs. 
   once carnot has identified the system's floops  the information necessary to find these inequalities  should it exist  will be present in the database. at this point  carnot attempts to assert an inequality statement for the identified stuff parameters via transitive reasoning. for example  in the cycle fragment of figure 1 shown in figure 1 the fact that the mixer is an open heat-exchanger can be qualitatively deduced. the transitivity reasoning proceeds as follows: 
1. no temperature drop across a default-view splitter gives t a  = t b  = t x . 
1. temperature drop across a default-view turbine gives t b    t c . 
1. no temperature drop across a default-view splitter gives t c  = t d . 
1. t d    t y  because perfect heat transfer in the default-view heat-exchanger would make t d  = t y . 
1. by transitivity  t y    t c  and thus t y    t b . 
1. because t x  = t b   we can deduce that t y    t x   thus satisfying the conditions for an open heatexchanger. 
1 	identifying subcycles and paths 
carnot now attempts to re-parse the input system into a set of mutually exclusive and collectively exhaustive subcycles and paths  the latter starting at splitters and ending at mixers. however  carnot relaxes this  no-gaps/nooverlaps  constraint when a hypothesized heat-engine shares structure with a hypothesized refrigerator  because sharedstructure is a known plan for achieving the goals of maximizing efficiency and ensuring reliability. 
carnot uses these heuristics to identify subcycles: 
1. should a floop exactly subsume two or more floops  consider only the subsumed floops. 
1. floops that have no structure in common with other 

figure 1 
	everett 	1 

rules for composing aggregate processes 
  heating processes 
- may have an arbitrary number of intervening pumping  mixing  and splitting processes 
- last local heating process must be downstream of last local pumping process 
- no intervening cooling  expansion  or throttling processes 
  cooling processes 
- may have an arbitrary number of intervening mixing  splitting  and expansion processes 
- no intervening heating processes 
  compression processes 
- may have an arbitrary number of intervening heating  mixing  and cooling processes 
- first local compression process must be upstream of the first heating process 
- no intervening expansion processes 
  expansion processes 
- may have any number of intervening heating  cooling  splitting  and mixing processes 
- last local expansion process must be downstream of last heating process 
- no intervening throttling or compression process 
figure 1 
floops are considered subcycles  as are lone heatengine and refrigerator floops. 
1. of a set of floops sharing structure  choose the puta tive heat engine with the greatest number of worksources  or choose the putative refrigerator with the greatest number of heaters  i.e.  refrigerator coils . 
   carnot now accepts or rejects the type hypothesis foi each subcycle. if all the views required for the hypothesis tc hold are true  then carnot simply records the relevant type statement. if a single view is false  carnot rejects the hypothesis. when one or more view statements are un known  carnot assumes in turn that each unknown is true and looks for any resulting contradictions in its knowledge of the system. should such a contradiction occur  carnot retracts the view and asserts that both the view and the hy-

pothesized type cannot mutually pertain. otherwise  carnot accepts the hypothesis. 
1 	aggregating processes and inferring plans 
the set of active views determines what processes are considered to be active. for example  a boiling process is only active if its associated heater is viewed as a boiling-heater. 
   as mentioned above  aggregate processes arise when two or more devices operate to produce a single effect. carnot aggregates local processes according to the set of heuristics shown in figure 1  which are based on the rational-designer premise; there is no physical law enforcing these constraints  but violating them would serve no thermodynamic purpose  and in fact be at odds with one or more of the three teleological goals carnot imputes to an input system. 
   the assertion of plans is a local propagation based on the current set of active aggregate processes and other information cached in the database. figure 1 shows the rules that instantiate an ideal rankine cycle plan. 
1 examples 
we present here carnot' s explanation  translated from the predicate calculus  of the cycle in figure 1  and conclude this section with a brief description of other examples. 
  the system is a heat engine. given stepwise isentropic expansion in the turbines and stepwise isobaric heating in the heaters  a practical rankine cycle  because it is a vapor power cycle. it is a vapor power cycle because it fully condenses its working fluid. 
  turbines 1 create the resisted expansion process of the system. heaters hx-1  mlxer-1  hx-1  hx-1 and boiler create the heating process. pumps 1 create the compression process. condenser creates the cooling process. 
  m i x e r - 1 is an open heat-exchanger because the fluid from splitter spl-1 has a higher temperature than the fluid from hx-1. this is done to achieve the design 

1 	qualitative reasoning and diagnosis 

goal of maintain-system-integrity  because an open heat-exchanger removes contaminants from the working fluid. 
  pumps pump-1 and pump-1 may act to prevent the working fluid from flashing. this would achieve the design goal of maintain-system-integrity  because flashing would cause downstream pumps to cavitate  cavitation would cause the pump's fluid-flow-rate to decrease  and a decrease in fluid-flow to the boiler would cause the boiler to melt.  this inference is uncertain because it is based solely on the cycle's topology; pump-1 and pump-1 have both heaters and pumps downstream of them  so it is possible that the removal of either pump would enable a downstream heater to cause the fluid to flash into vapor. given numeric information  carnot determines whether this would actually occur . 
  heaters hx-1  mlxer-1  hx-1 and hx-1 preheat the working fluid. this achieves the design goal of 
maximize-system-efficiency  because a rankine cycle's efficiency is directly related to the average temperature of heat addition. 
   other cycles that carnot explains include the simple heat engine of figure 1  a simple refrigerator  a subcooling refrigerator  a heat-driven refrigerator utilizing either a turbine and compressor or a jet-ejector  a heat-driven air-

conditioning system  an intercooled gas-turbine  and a combined gas-turbine/vapor-power cycle in which the latter utilizes the waste heat of the former to increase efficiency. each of these cycles presents a particular challenge to achieving a consistent mapping. for example  both heat-driven refrigerator systems consist of two subcycies  a heat-engine and a refrigerator  that share structure  a common condenser . carnot correctly identifies the two subcycies and infers that the shared structure is a plan to achieve the goal maximizesystem-efficiency by reducing complexity and cost. in the heat-driven air-conditioning system  there are three mixers  one of which acts as a jet-ejector  and three splitters  one of which acts as a flash-chamber. carnot correctly identifies both of these roles. finally  in the combined cycle  carnot identifies both subcycies as power cycles and correctly infers that the vapor cycle is present to achieve the goal of maximize-system-efficiency. 
1 related work 
chandrasekaran has developed a theory of functional reasoning that is consistent with the work presented here. he has proposed that teleological knowledge be encoded in causal process descriptions  cpds  that are represented as directed graphs whose arcs are causal links  e.g.  chandrasekaran  1 . carnot's knowledge base is organized along similar lines  although we prefer not to encode the causal links explicitly  and instead allow the inference engine to instantiate them as they become relevant  via the view and role mechanisms. 
   vescovi  lwasaki  fikes  and chandrasekaran have proposed a modeling language  cfrl  for integrating qualitative and functional reasoning  vescovi et al  1 . cfrl composes a qualitative model from model fragments and then attempts to fit a causal story  encoded in cpds  to a particular trajectory through the qualitative state space. because thermodynamic cycle analysis is steady-state  we have been able to avoid the complexities arising from such explicit temporal reasoning. 
   franke has proposed a rigorous language for teleological description  ted   franke  1  that may in the future provide us with useful formalisms as we extend carnot. he approaches the issue of teleology from the designer's point of view  while carnot attempts to infer the intentions of the designer after the fact  given only the artifact. 
   narayanan  suwa and motoda have described a system that predicts the operation of simple mechanical devices given a labeled schematic  narayanan et al.  1 . their system also produces explanations but focuses more on visual reasoning  whereas carnot's input is construed as a set of devices in a particular structural configuration. 
1 conclusion 
we have described a set of teleological representations consisting of goals  plans  roles  and views that enable the production of functional explanations of complex thermodynamic cycles grounded in a qualitative domain theory. we have also shown that aggregate processes provide a powerful heuristic for recognizing cycles despite structural variations. 
   we believe the generativity of our approach will enable it to scale up to explain any thermodynamically valid system. carnot now explains all eight of the steady-flow cycles contained in an introductory text  whalley  1   and 1 of the 1 cycles in a more comprehensive text  van wylen & sonntag  1 . explaining non- steady -flow systems  such as otto and diesel cycles is our next goal. we believe that some improvements to the algorithm combined with roughly a one-third increase in carnot's current rulebase  which now contains about 1 rules  will enable the explanation of the thirty-five cycles contained in analysis of engineering cycles  heywood  1   considered to be the definitive text on thermodynamic cycles.1 
   as an initial test of its capabilities  we plan to incorporate carnot into the coaching module of a thermodynamics tutoring system. we also intend to test the applicability of this theory to other domains  such as hydraulics. 
acknowledgments 
this work has been supported by the computer science division of the office of naval research. 
