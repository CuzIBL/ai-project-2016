 
this paper presents a novel approach to nonlinear black-box system identification which combines qualitative reasoning  qr  methods with fuzzy logic systems. such a method aims at building a good initialization of a fuzzy identifier  so that it will converge to the inputoutput relation which captures the nonlinear dynamics of the system. fuzzy inference procedures should be initialized with a rule-base predefined by the human expert: when such a base is not available or poorly defined  the inference procedure becomes extremely inefficient. our method aims at solving the problem of the construction of a meaningful rulebase: fuzzy rules are automatically generated by encoding the knowledge of the system dynamics described by the outcomes of its qualitative simulation. both efficiency and robustness of the method are demonstrated by its application to the identification of the kinetics of thiamine  vitamin b1  and its phosphoesters in the cells of the intestine tissue. 
1 	introduction 
the problem we address here is how qr techniques can be used to improve the performance of non-parametric approaches to nonlinear black-box system identification  s1 . recently  due to the paucity of directly applicable results  nonlinear s1 has received more and more attention in the control community with a consequent development of a number of new approaches capable to describe the nonlinear dynamics of a real system from input-output data. neural networks  multi-variate splines and fuzzy logic systems are the most known approximation schemes used for learning an input-output relation from data  jang  1; khannah  1; wang  1 . although these approaches are successfully applied to a variety of domains  they are affected by two main drawbacks: first  the model identification procedure usually requires a large amount of data and is often extremely inefficient; second  the identification result  a nonlinear function  does not capture any structural knowledge. with the goal to overcome these drawbacks  we propose a novel method which combines the qualitative and non-parametric modeling frameworks. therefore  such a method is applicable whenever the incompleteness of the available structural knowledge of the system under study is not so strong as to prevent from formulating a qualitative model of its dynamics through qualitative differential equations  qde   kuipers  1 . 
　we believe that the efficiency and robustness of nonlinear black-box si methods may improve only if they incorporate and exploit all available knowledge of the system  namely the structural and human knowledge  and the experimental one. qualitative models and linguistic rules represent properly the structural and human expert knowledge  respectively. as qualitative modeling formalism we have chosen qsim  kuipers  1  because of both its expressive power to represent qde and its reasonable predictive capacity. as nonlinear identifiers we have chosen fuzzy logic systems since various classes of fuzzy systems  fs  can be proved to have the universal approximation property  wang  1 . a clear advantage of using fs's deals with their capability to incorporate in the same framework both linguistic descriptions of the unknown system dynamics  in the form of if-then rules  and experimental data. moreover  the meaning of their parameters is linked to the input-output data. fuzzy inference procedures are initialized with a rule-base which defines the structure of the input-output relation where parameters occur. when such a base is not available or poorly defined  also the fuzzy inference procedures may become extremely inefficient as the inference structure has to be determined using only numerical evidence. the method we propose aims at solving the central problem of the construction of a meaningful rule-base: fuzzy rules  fr  are automatically generated by encoding the knowledge of the system dynamics captured by its qualitative simulated behaviors. 
such a method  which we label fs-qm  may be applied to a number of different domains. as a benchmark we have considered problems from the medical domain. in this paper we discuss the application of fs-qm for the identification of the kinetics of thiamine  vitamin b   and its phosphoesters in the cells of the intestine tissue. 
bellazzi  guglielmann  and iron 	1 
1 fuzzy system identification 
fuzzy systems possess good properties as approximators of continuous functions  wang  1  and have been successfully applied in the identification and control of non linear systems  barada and singh  1 . herein  we use in fs-qm  the description of the system dynamics is performed through rules that give the next value 
fs's to approximate continuous functions from the value of an output variable y defined on is 
 1  inferred by using a fuzzy rule base  frb  with n input 
	where k is a discrete time index  	is 
 variables 	defined 	on 	such that the measurement error and y -  has the same meaning as it is well known  the approximation properties of 	of equation  1 . since the model  1  is nonlinear in the the fs depend on the choice of the operators that define: model parameters  it is necessary to resort to nonlin- the fuzzification of frb antecedents  or inputs   that 	ear identification techniques to estimate the vector transforms a reaj number 	into a fuzzy set with 	within the fs-qm framework a number of approaches 
membership function defined over 	may be considered. herein  the fs is represented as 
- the fuzzy inference engine  fie   that maps the fuzzy a feedforward neural network  as described in  wang  sets in u into fuzzy sets in v through the frb; 
　　　　　　　　　　　　　　　　　　　　　　　　　1   and the identification of is performed by using - the defuzzification of frb consequent  or output   that of the system output as a function of the values of the current inputs and output   . then  the output behavior can be described with a non-linear autoregressive exogenous input model  narx  of the kind: 

transforms into a real number the output of the applica-
tion of the fie. 
　in this paper we have exploited the singleton fuzzifier  the product-inference rule  wang  1  and the center average defuzzifier  mamdani  1 . through these 
choices  it is possible to write the resulting fs in functional form as: 
 1  
m represents the number of fr's  while is the membership function associated with the linguistic variable of  that appears in the j-th rule  and  is the point in v where the correspondent membership function reaches its maximum value. 
　in the following  we will exploit the class of fs with gaussian membership functions  so that: 

such a choice allows us to interpret the nonlinear function approximation problem with fs as the process of identifying the vector of parameters  of a known nonlinear function from a set of data. moreover  the fs defined by the equation  1  holds the universal approximation property  wang  1 . the function 

　numeric values  which express the prior knowledge included in the system  and which provide for an initial guess of the system dynamics  are assigned to the parameter vector  in the construction phase of the fs. given a set of experimental data  the estimate of  is then refined through optimization procedures. 
1 	qualitative reasoning and diagnosis 
the back-propagation  bp  technique. such a technique 
allows us to estimate all the fs parameters through an 
iterative search in the solution space by employing a gradient descent search. if not properly initialized  such a search procedure may be either trapped at a local minimum or converge very slowly: fs-qm provides for a significant initialization of bp algorithm  with a consequent fast convergence to the global minimum. 
1 the fs-qm method 
fuzzy set theory and qr techniques share the motivation of facing too complex or ill-defined physical systems to be analyzed through conventional techniques. then  the idea of unifying both frameworks with the goal of producing effective solutions to an extended range of application problems is a matter of course  shen and leitch  1; vescovi and trave-massuyes  1 . such works aim at developing qualitative simulation techniques which are enriched by a fuzzy description of quantities and functional relations. 
　our method  fs-qm  is grounded on the intuition that analogies between elements of the qsim and fuzzy formalisms can be highlighted  fig. 1 . 
　　at a first level  namely the modeling one  given a physical system s characterized by  state variables  the quantity space li associated with the variable xi may find its semantic correspondence with the set of the linguistic values defined over the universe of discourse . the set   
where is the cardinality of contains all significant distinct qualitative magnitude values  qmag  of whereas the linguistic values associated with are represented by fuzzy sets characterized by the membership functions 
at a second level  more related to the simulated system behavior  the qualitative system dynamics  which is described by the simulated qualitative behaviors  qb   may find its correspondence in fuzzy rule-bases. each qb is defined by a sequence of qualitative states of the system  where | is a m-tuple of the qualitative values  given the input 


figure 1: analogies between the qsim and fs formalisms. bi-directional arrows indicate a semantic correspondence  whereas the other ones have the usual meaning. 
and output variables  all their possible dynamics are extracted from the behavior tree  suitably manipulated  and automatically mapped into rule sets where the input and output variables are  respectively  the antecedents and consequent in the if-then rules. 
remark 1. let us observe that we map a quantity space  which is a set made up of landmarks and intervals  into fuzzy sets: then  apparently  we map a non-uniform set into a uniform one. landmarks are symbolic names denoting particular real numbers that separate qualitatively distinct regions. however  in many applications  and in particular the medical domain we are interested in  a landmark value may not have a crisp representation but  in its turn  be defined by an interval with  soft  boundaries: as a matter of fact  we consider this case  and then we map a set made up of intervals into fuzzy sets. 
　the overall system identification procedure proceeds in three main phases: 
　qsim model formulation and simulation  and definition of the fuzzy elements. the prior structural knowledge of 
the system at study must be organized so that its behavioral model can be defined. more precisely  the variables of interest and the network of interactions between them  along with their mathematical descriptions  must be specified: variables are described by their respective quantity spaces  whereas their interactions by a set of qualitative constraints which include both functional dependencies and equations governing the system dynamics. then  an initial state of the system  which may describe a perturbation on it  has to be provided to simulate its behavior. an attainable envisionment  which does not generate any new landmarks  is performed to produce in one run all possible behaviors that could follow from the given possibly incomplete specification  and shows us the entire range of possible system dynamics at once. the idea underlying the mapping of a qb into a set of pr's exploits the semantic correspondence between the elements of quantity spaces and linguistic values defined through fuzzy membership functions . then  the fuzzy quantity spaces of the input-output variables  i.e the lin-
guistic variables associated with the quantity spaces of the input-output variables  and their corresponding have to be defined. such definitions are suggested by the expert knowledge. 
　construction of the fs. the prior knowledge of the dynamics of the system captured by the qb's derived at phase 1 together with the fuzzy quantity spaces are exploited to generate automatically a base of fr's whose antecedents and consequent are the input and output variables used to quantitatively identify the dynamics of the system. the. choice of the fie  the fuzzification and defuzzification methods  complete the definition of the fs. 
identification of the fs from the experimental data. 
the generated rules  interpreted in accordance with the fir selected at the previous phase  initialize an optimization procedure for the identification of the parameters in the fs  which learns from the available experimental data an accurate input-output relation. 
	1 	construction of the fs 
given n input variables   n  m   and the output variable y  a qb is automatically mapped into a frb in the following steps of the method: 
1. from the time set t  draw out whose elements are the significant time-instants of both  and y are the sets of distinguished timepoints of and y  respectively ; 
1. from   where k is the cardinality of t: 
1.  where k may be either a time-point or a time-interval  repeat: 

 d  consider the linguistic values  and therefore the 
	ated with 	respec-
tively; 
 e  generate a linguistic rule where  are the antecedents  y the consequent  and then the correspondent fr where are the fuzzy sets. 
remark 1. the number of rules generated in correspondence with each qb is not greater than the cardinality of t. identical rules may happen to be generated as variables may have the same qmag either at different 
	bellazzi  guglielmann  and ironi 	1 

time-points or time-intervals: in such a case we group the equivalent rules and keep only one of them as representative of an input-output relation. qualitative values of the variables of interest which differ only in the value of the output variable are likely generated. then  it is probable that some conflict rules  i.e. rules which have the same antecedents but a different consequent are produced. we store such rules and leave the conflicts be 
resolved in accordance with the degree of rule calculated on the data pairs  wang  1 . 
remark 1. the entire range of possible system dynamics is captured by the whole tree of behaviors. such a tree  as it includes all logically possible outcomes of the given qualitative information  may contain ambiguous results and may be quite large to be efficiently explored. such ambiguities  as well as the dimension of the behavior tree  may be significantly reduced by additional knowledge  which is not explicitely expressed in the model. moreover  let us remark that many behaviors in the tree may not present any difference as far as the input-output variables are concerned. then  behavior aggregation procedures  which aim at taking the significant distinctions out of the tree  have to be performed to cope with the problem of an efficient generation of a complete and meaningful fuzzy rule base. whenever reasonable physical assumptions allow us to define equivalent behavior classes  the portion of tree considered is further reduced by keeping one representative for each class. in the extreme case  where all spurious behaviors are not filtered  the performance of fs-qm may get close to that one of a pure black-box fs initialized with the same number of rules. 
　given the behavior tree  the algorithm for the generation of the frb which describes the overall system dynamics is performed as follows: 
1. selection of an individual behavior; 
1. generation of the frb which corresponds to each individual behavior; 
1. union of all the frb's generated at step 1  and filtering of the equivalent rules. 
1 	an application of the fs~qm method 
we consider the problem of describing the kinetics of 
thiamine  vitamin b   and its phosphoesters in the cells of the intestine tissue of rats  which are known to have human-like thiamine metabolism. thiamine is transported in the extracellular fluids in two different chemical forms  simple thiamine  th  and thiamine mono-phosphate  thmp   and is transformed within the cells through an enzyme-mediated chemical reaction in a higher energy form that is used in the carbohydrates metabolism. the chemical reaction is nonlinear  and modeling through ordinary differential equations is hampered by identification problems. by using fs-qm we build an approximator of the system dynamics  that can be of crucial help in describing syndromes with thiamine deficiency  like severe liver diseases. 
1 	qualitative reasoning and diagnosis 

figure 1: compartmental model of the thiamine kinetics in the intestine tissue. 
　a compartmental model of the thiamine kinetics in the intestine tissue is shown in fig. 1  rindi et a/.  1 . 
the variables  and  represent the amount of th and thmp in the plasma  respectively. th is directly transformed into the thiamine pyro-phosphate  thpp . thmp is firstly transformed into 1%  and then from th to thpp. finally  thpp is dephosphorilated to thmp. 
the flow variables   chem-
ical reactions  express nonlinear saturable relationships between quantities entering and leaving a compartment. the data set available for the identification of the approximator is quite rich as we have data on each state variable of the model in fig. 1. we can completely express the thiamine intracellular kinetics by subdividing the overall identification phase into the identification of three approximators as follows: 
 1  
 1  
in the following we will describe in detail how the approximator of thpp  1  has been derived. 
　the th - thpp pathway can be modeled through a single qde. the chemical reactions from th to thpp and from thpp to thmp are denoted by  and 
 respectively. th acts as input to the sub-
system considered. the qualitative model is described by: 
		 1  
where: 
1. th is a triangular shaped function of time  which represents the input signal. its quantity space is defined as   where th* is the saturation threshold of fi th . 
1. thpp has quantity space 	  where 
thpp* is the saturation threshold of 
1. both are represented in qsjm by the functional constraint . from the physiology  we know that 
　since the data used for the system identification come from experiments with tracers  the initial value of the variables involved in the simulation is set to 1. the simulation of the qsim model produces a tree of 1 quiescent 

figure 1: qualitative simulation results of the th thpp pathway model: each column reports the plot of a representative behavior of th and thpp. 
behaviors: 1 of them are filtered out as physiologically inconsistent with the hypothesis   thpp* . 
among the remaining behaviors  four of them  fig. 1  are representative of all the possible behaviors of th and thpp. the complete frb automatically derived from the qualitative behaviors identifies the number m of fuzzy rules as equal to 1. 
1 	results 
a simulator of the intracellular thiamine kinetics has been achieved through two phases: an identification phase  in which the parameters of the derived fs are refined by using bp algorithm on a first set of data  and a forecasting phase  in which the identified fs has been used as simulator  and its results are matched for validation against a new data set. 
　the data used for identification come from an experiment on a group of rats whose intestine tissue was analyzed after an intravenous bolus of of thiazole-
thiamine  with a radioactivity of 1 for a period of 1 h  sampled with irregular time intervals. 
　the performance of the approximator  obtained by using fs-qm has been compared with that one identified by using only the data  denoted by fs-bb   as proposed by wang  wang  1 . the comparison has been performed through the calculation  in both  and norms  of the absolute errors between the data and the calculated values. 
　if the number of bp loops  nl  is kept low   we get absolutely better results of the fs-qm over fsbb both in the identification and forecasting phase. for a greater number of loops  both methods show similar performance  fig. 1 : for   the errors calcu-
lated go to zero in both cases with a slight difference in convergence velocity. 
　in spite of the comparable identification performance  in the forecasting phase  performs quite well  whereas the approximator obtained by fs-bb is not able to reproduce the data of thpp measured in different experimental settings. this is not surprising and may be explained by two occurrences: the data are noisy  and 

figure 1: identification phase - comparison of the results obtained with 1 loops of bp by applying both fs-qm and fs-bb on the experimental data set. 
the number of samples is smaller than the number of parameters to be identified. this means that fs-bb  which relies only on data  is more likely driven to learn also the noise. fig. 1 and fig. 1 compare the results obtained by both methods when applied to simulate the kinetics of thpp in response to two different input values for th  which correspond to the values of th injected on two groups of diabetic rats  one of them under therapy. as it is highlighted by the plot comparison  the performance of the fs-qm approximator is good  while the fs-bb approximator does not reproduce at all the dynamics of thpp. 

figure 1: forecasting phase - comparison of the two approximators obtained with 1 loops of bp in forecasting the dynamics of thpp in diabetic rats. 
1 	open problems and conclusion 
the application of fs-qm to simulate the dynamics of nonlinear systems has given good results which confirm its validity in terms of efficiency and robustness. however  several problems are still open. first of all  the method requires for a better mathematical formalization which defines its range of validity and applicability. important issues which need a thorough study are listed 
	bellazzi  guguelmann  and ironi 	1 


figure 1: forecasting phase - comparison of the two approximators obtained with 1 loops of bp in forecasting the dynamics of thpp in diabetic rats under therapy. 
below: 
membership functions - the choice of the membership functions is a crucial step of both the design and the identification of a fs. gaussian membership functions 
 g-mf's  guarantee the universal approximation properties  wang  1   and are functions of only two param-
eters  mean and variance . moreover  g-mf's provide for good generalization properties as they ensure completeness   even when the fuzzy rule base spans only a subset of the cartesian products of the input space. on the other hand  g-mf's are symmetric and with a maximum value located in a single point: this means that some desirable properties  such as different shapes of the  associated with either a landmark or an interval  cannot be represented. in order to preserve the advantages coming from g-mf's but to improve the capability of expressing prior knowledge  in the future we will investigate the use of pseudo-trapezoidal functions  zeng and singh  1 . 
time - the major problem deals with the definition of the mapping of the sampling time set into the qualitative time set  i.e. of the mapping of the measurement grid into the  event  one. this is feasible only if the experiment has been designed so that the data set is informative enough to produce the system dynamics. such an issue would be facilitated if semi-quantitative information on qualitative times would be available. 
hybrid models - the more complete is the a-priori knowledge exploited in modeling  the closer to the solution is the initial guess generated  with a consequent improved efficiency of fs-qm. a semi-quantitative formulation and simulation of the model  kuipers  1; shen and leitch  1  is hence preferable. unfortunately  the quantitative information may be insufficient for a semi-quantitative formulation with the mentioned approaches. therefore  methods for dealing with hybrid models  where different knowledge sources can coexist would be the ideal way to get as much information as possible from the prior knowledge. 
1 	qualitative reasoning and diagnosis 
other identification procedures - an interesting strategy to be investigated consists in fixing the parameters t and  of the vector  so that only the parameters are estimated from the data. since the equation  1  is linear in the parameters   it is possible to resort to efficient linear methods  such as ordinary least squares. this choice allows us to preserve the structure of the fs initialized on the basis of the a-priori knowledge represented by the qualitative model  but could prevent from identifying a really  good  approximation of the unknown function. therefore  possible optimal solutions could be given by two-step identification procedures. 
