 
oriented patterns  such as those produced by propagation  accretion    r deformation  ore common in nature and therefore an important class for visual analysis. our approach to understanding such patterns is to decompose them into two parts: a flow field  describing the direction of anisotropy  and the residual pattern obtained by describing the image in a coordinate system built  from the flow field. we develop a method for the local estimation of anisotropy and a method for combining the estimates to construct a flow coordinate system. several examples of the use of these methods are presented. these included the use of the  low coordinates to provide preferred directions for edge detection  detection of anomalies  fitting simple models to the straightened pattern  and detecting singularities in the flow field. 
	i 	i n t r o d u c t i o n 
　a central focus in recent computational vision has been the decomposition of the original intensity image into intrinsic images  horn 1  barrow & tenenbaum  1; marr  1   representing such properties as depth  reflectance  and illuminance. these intrinsic properties are believed to be more meaningful than image intensity because they describe basic independent constituents of the image formation process. thus  for example  in separating shape from illumination  we can recognize an invaxiance of shape regardless of changing illumination. 
　the advantages of decomposing what we see into its more-orless independent parts extends beyond the image formation process to the shapes and patterns on which that process operates. for instance  decomposing a bent rod into a straight rod and a bending transformation reveals the similarity between a bent rod and one that hasn't been bent  or some other solid that's been bent the same way  barr  1 . 
　just as we need to understand the image-forming process to decompose an image into intrinsic images  we need to understand the processes that generate patterns to decompose them into their intrinsic parts. but  whde there is only one imageforming process  a staggering variety of processes shape and color the world around us. our only hope of dealing with this complexity is to begin with some basic pattern classes that recur in nature  and understand how to decompose and describe them. 
　one such class are oriented patterns  notably those produced by propagation  accretion  or deformation. to understand an oriented pattern we must be able to say  l  what is propagating  accreting  or deforming  and  1  which way and how much. more precisely  we must estimate everywhere the direction and magnitude of anistropy  which we will call the flow field   and describe the residual pattern  independent of that field. why this decomposition leads to simpler  more regular descriptions is best illustrated by example: 
  a typical oriented pattern created by propagation is the streaked trail left by a paint brush dipped in variegated paint. the flow field describes the trajectory of the brush  the residual pattern depending only on the distribution of paint on the brush. 
  accretion typically results in laminar structures  such as wood grain. here  the flow field gives isochrones  the moving accretion boundary   and the residual pattern describes the change in color or brightness of the accreting material over time. 
  if an isotropic body is deformed  the flow field principally describes the bending and stretching it has undergone  while the residual pattern describes the undeformed body. 
in all these cases  separate descriptions of the flow field and the residual pattern are appropriate because they describe different processes. the path of propagation for many physical processes is controlled by very different mechanisms than control the coloration of the trail left behind. similarly  the mechanisms which control the shape of an accretion boundary are frequently unrelated to the processes controlling the color of the accreted material. finally  the forces which deform a piece of material are often completely unrelated to the process which created the piece of material in the first place by separately describing these processes  we can create descriptions of the whole which are often simpler than is possible without the separation because each of the pieces may have different regularities. 
　orientation selective mechanisms have been extensively stud ied by physiologists since ilubel and wiesel's  1  discovery of orientation selective cells in mammalian visual cortex  see schiller et. al.  1  for a comprehensive example . there has also been considerable interest among psychologists in the perception of oriented patterns  particularly dot patterns  glass  1 . only recently have the computational issues involved received attention. stevens  1  examined the groupmg of tokens in glass patterns based on orientation. while successful with glass patterns  his methods were never extended to natural imagery. zucker  1  investigated the estimation of orientation by combining the outputs of linear operators. zucker's estimation method for what he calls  type ii  patterns  while differing in many respects  is quite close in spirit to our own. 
　little progress has been made in using local orientation estimates to interpret patterns  perhaps because reliable estimates have proved difficult to obtain. the key difference between our work and earlier efforts lies in our use of the flow field to build a natural coordinate system for analyzing the pattern. 
　the remainder of the paper covers the computation of the flow field by local estimation of orientation  the construction of a coordinate system using the flow field  and some examples of analysis and description using flow coordinates. 
　in section 1 we develop an estimator for the local flow direction  that direction in which intensity tends to vary most slowly 
　
m. kass and a. witkin 1 
due to an underlying anisotropic process. the estimator  based on the direction of least spatial variance in the output of an oriented filter  is computed as follows: after initial filtering  the intensity gradient is measured at each point in the image. the gradient angle  1  is then doubled  by treating the gradient vectors as complex numbers and squaring them  to map directions differing by π into a single direction. the transformed vectors are then summed over a weighted neighborhood around the point of interest. the angle of the summed vector is halved  undoing the previous transformation. this gives an estimate for the direction of greatest variance  which is then rotated by π/1 to yield the flow direction. 
　in section 1  we describe the construction and use of coordinate systems based on the result of local estimation. integral curves in the flow field are computed numerically  by following the estimated vectors from point to point. a coordinate system is constructed in which the integral curves are parameter lines. transforming the image into these  flow coordinates  straightens the pattern  removing the effects of changing orientation. we present several examples of analysis and description of the flow field and the straightened pattern. 
	i i 	flow c o m p u t a t i o n 
　for intensity patterns created by anisotropic processes such as propagation  accretion  or deformation  variation in the flow direction is much slower than variation in the perpendicular direction. anisotropy in such patterns will be evident in the local power spectrum. the high frequency energy will tend to cluster along the line in the fourier domain perpendicular to the flow orientation. 
　a simple way to detect this clustering is to sum the energy in an appropriate region of the power spectrum and examine how the sum is affected by rotations. this can be done by examining the energy in the output of an appropriate orientation-selective linear filter. the orientation at which the energy is maximal can be expected to be perpendicular to the flow orientation. 
　selection of the filter involves a number of tradeoffs. very low spatial frequencies are affected more strongly by illumination effects than surface coloration  so they are inappropriate for measuring textural anisotropy. very high spatial frequencies are sensitive to noise and aliasing effects so they too are inappropriate. hence some type of roughly bandpass filtering is required. the orientation specificity of the filter is also quite important if the filter is too orientation-specific then a large spatial neighborhood will be required in order to make a reliable measurement of the energy. conversely  if the filter responds over a wide range of orientations then it will be difficult to localize the orientation very accurately. thus there is a trade-off between angular- and spatial- resolution. 
the filter is bandpass with passband determined by and a1in our experience  ratios of the sigmas in the range of 1 to 1 work well. the orientation specificity or tuning curve is provided by the cosine dependence of the filter on 1. this appears to strike a reasonable balance between angular- and spatial- resolutions for the range of patterns we have examined. the filter's power spectrum is shown in figure 1 
　the cosine orientation tuning-curve of the filter has some unusually good properties for computing the filter output at different orientations. the impulse response s xyy  of the filter 
　
1 m. kass and a. witkin 

　one might be tempted to believe that smoothing the gradient vectors g x y  would be nearly as good a measure of anisotropy as smoothing the rotated squared gradient vectors j x y . this is emphatically not the case consider an intensity ridge such as / x y  = exp - x1 . the gradient vectors on the left halfplane all point to the right and the gradient vectors on the right half-plane all point to the left. adding them together results in cancellation. by contrast  if they are first rotated to form the j vectors  they reinforce. the types of oriented patterns we are concerned with often have nearly symmetric distributions of gradient directions around the axis of anisotropy. in such patterns  if the gradients are added together directly  the cancellation is so severe that the result often has little relation to the direction of anisotropy. thus the difference between rotating the gradient vectors or leaving them be is often the difference between being able or unable to detect the anisotropy. note also that smoothing the image first and then computing the gradients is exactly the same as computing the gradients and then smoothing. it will not avoid the difficulties of cancellation. 
c. coherence 
　in addition to finding the direction of anisotropy  it is important to determine how strong an anisotropy there is. if the orientation of the local j vectors are nearly uniformly distributed between 1 and 1Π  then the orientation of slight anisotropy is not very meaningful. conversely  if all the j vectors arc pointing the same way then the indication of anisotropy is quite strong and Φ is very meaningful. a simple way of measuring the strength of the peak in the distribution of j vectors is to look at the ratio x x y  = |w *jl/w * ijl which we will call the coherence of the flow pattern. if the j vectors are close to uniformly distributed  then the ratio will be nearly zero. if the ./ vectors all point the same way  the ratio will be one. in between  the ratio will increase as the peak gets narrower. 
d. summary 
　the computation of the flow direction and local coherence can be summarized as follows. first the image / z  y  is 

figure 1: an image of wood grain with its flow field. estimated flow directions are given by the black needles. the length of the needle encodes coherence. notice that coherence is low within the knot at the center. 


an example of this computation applied to a picture of a piece of wood is shown in figure 1. the flow direction Φ x y  + 1r 1 is displayed by the orientation of small needles superimposed on the image. the lengths of the needles is proportional to the coherence x x y . note that the pattern is strongly oriented except near the knot in the middle. 
　
m. kass and a. witkin 1 
e. relation to prior work 
　
　the flow computation just described bears an interesting relation to an early proposal of david marr that information about local distributions of oriented edge elements be included in the primal sketch  marr 1 . if this proposal is combined with his later work with hildreth on edge detection  marr & hildreth  1  it results in a special case of the above computation. marr and hildreth define edges as zero-crossings in the laplacian of the gaussian smoothed image. the natural combination of marr's proposal with this definition of edge elements calls for examining the local density of zero crossings as a function of orientation. for stationary zero-mean gaussian processes the square of the oriented zero-crossing density is approximately   see appendix b . thus in the special case where the point spread function of the filter is  our computation can be viewed as computing the direction of minimal edge density in the marr-hildreth theory. 
　zucker's work on flow  zucker 1  is also related to a special case of the above computation. for biological reasons  he prefers to use oriented second derivatives of gaussians as the initial filters. these have . instead of looking at the variance of the filter outputs as the orientation is changed  he combines the outputs in a biologically motivated relaxation process. although quite different in detail  the computation described here has much in common with his technique. 
	i l l 	flow coordinates. 
　the orientation field is an abstraction from the anisotropic pattern that defines it. we can  for example  get the same spiral field from a pattern composed of bands  irregular streaks  dot pairs  etc. in addition to measuring the orientation field  it is useful to be able to produce a description of the underlying pattern independent of the changing direction of anisotropy. such a description would make it possible to recognize  for example  that two very different orientation fields are defined by the same kind of bands or streaks. 
　a powerful way to remove the effects of changing orientation is to literally  straighten  the image  subjecting it to a deformation that maps the flow lines into straight  parallel lines in a canonical  e.g. horizontal  orientation. performing this deformation is equivalent to viewing the image in a coordinate system  u v   with u = u x y  and v = v x y  that everywhere satisfies 
		 1  
equation 1 does not determine a unique coordinate system. 
an additional constraint may be imposed by choosing lines of constant v orthogonal to those of constant u  i.e  
		 1  
which has the desirable effect of avoiding the introduction of spurious shear in the deformation. 
　even with equation 1  an additional constraint is needed  because we are free to specify arbitrary scaling functions for the u and v axes. in the spirit of equation 1  we want to choose these functions to avoid the introduction of spurious stretch or dilation. although difficult to do globally  one might minize total stretch   we will usually want to construct a fairly local coordinate frame around some point of interest. for this purpose  it suffices to take that point as the origin  scaling the axes u - 1 and v = 1 to preserve arc-length along them. 
　intuitively  the flow field describes the way the pattern is bent  and viewing the image in these flow coordinates straightens the figure 1: a flow coordinate grid obtained for the image of figure 1. 
pattern out. figure 1 shows the flow coordinate grid for the wood-grain image from figure 1. the grid lines were computed by taking steps of fixed length in the direction  cosΦ  sinΦ  or   - sin Φcos Φ  for lines across and along the direction of flow respectively  using bilinear interpolation on the orientation field. since Φ is always computed between 1 and 1r  we must assume that there are no spurious discontinuities in direction to track smoothly. 
　for many purposes it is unnecessary to compute the deformed image explicitly  but doing so vividly illustrates the flow coordinates' ability to simplify the pattern. figure 1 shows the deformation from image coordinates to flow coordinates in several stages. as the grain lines straighten the knot shrinks and finally vanishes. the deformed images were anti-aliased using texturemap techniques  williams  1  the deformed linage shows  to a reasonable approximation  what the grain would have looked like had it not been subjected to the deforming influence of the knot. 
　thus far  we have separated the image into a flow field  and a pattern derived by viewing the image in flow coordinates. we argued earlier that the advantage of this decomposition  like the decomposition of an image into intrinsic images  is that the components are liable to be simpler and more closely tied to independent parts of the pattern-generating process than is the original image. to exploit the decomposition  we need ways of analyzing  describing  and comparing both the flow field and the straight ened pattern. these are difficult problems. in the remainder of this section  we present several examples illustrating the utility of the decomposition. 
a. 	a coordinate frame for edge detection. 
　oriented measurements have been widely used in edge detection. for example marr & poggio  1  employed directional second derivative operators  whose zero-crossings were taken to denote rapid intensity changes. due to the difficulty in selecting an orientation  marr & hildreth  1 later abandoned this scheme  in favor of zero-crossings of the laplacian  a nondirectional operator. 
　the flow field provides two meaningful directions along and across the direction of flow - in which to look for edges within an oriented pattern. zero-crossings in the second directional derivative in the direction of Φ  against the grain  should highlight edges that contribute to defining the flow field  while zero-
　

figure 1: deformation  in stages  from image coordinates to flow coordinates. upper left: the original image; lower left  upper right: two intermediate stages  in which the grain's curvature has diminshed  and the knot compressed; lower right  the image as seen in flow coordinates: the grain lines are straight and the knot has vanished  showing approximately what the grain would have looked like had 
　
it not been deformed by the intrusion of the knot. 
crossings in the second derivative perpendicular to Φ  with the grain  should highlight anomalous elements or terminations. the sum of these two derivatives is the laplacian. 
　the two directional derivatives of the wood grain image are shown  with the laplacian  in figure 1. indeed  the derivative against the grain captures all the elements comprising the grain pattern  while the derivative with the grain does not appear meaningful. the laplacian confuses these very different signals by adding them together. 
　the derivative along the grain can also be meaningful  where anomalous elements are present. in addition to being perceptually salient  such anomalies are often physically significant  with origins such as cracks  intrusions  or occlusions  that are distinct from those of the main pattern. in man-made structures  anamolies are often important because they indicate some variety of flaw. 
　figure 1 shows a pattern of aligned elements  straw  with some anomalous elements. the directional second derivatives along and across the flow direction are shown  together with their sum  which is just the laplacian.  differentiating along the grain highlights anomalous elements  attenuating the rest  thus finding the  needles  in the haystack.  differentiating across the grain supresses the anomalies. the laplacian shows both. 
　a related demonstration is shown in figure 1  in which the anomalous elements have actually been removed by directional median filtering in the flow direction. 
b. 	singularities. 
　we have shown several ways in which viewing an oriented pattern in flow coordinates facilitates analysis and description of the pattern. describing and anlyzing the flow field itself is the other side of the coin. the topology of a flow field  as of any vector field  is determined by the structure of itss singularities  those points at which the field vanishes. identifying and describing singularities is therefore basic to describing the flow field. the singularities provide the framework around which metric  properties  such as curvature  may be described. singularities arc also perceptually salient  see figure 1.  
　a robust basis for identifying singularities is the index or winding number  spivak  1.  suppose we follow a closed curve on a vector field. as we traverse the circuit  the vector rotates continuously  returning to its original orientation when the circuit is completed. the index or winding number of the curve is the number of revolutions made by the vector in traversing the curve. the index of a point is the index of a small circle as we shrink it around the point: 

to compute the winding number numerically  we divide the flow field into suitably small rectangles  summing the rotation of Φ around each rectangle. as in computing the flow lines  we assume 
　
m. kass and a. witkin 1 

figure 1: using flow coordinates for edge detection upper left: 1nd directional derivative across the how direction. upper right: 1nd directional derivative along the flow direction. the first of these highhghts the oriented structure  the second supresses it. lower left: 
　
the sum of the directional derivatives is the laplacian. 
that Φ has no spurious discontinuities. where the result is nonzero  the rectangle surrounds a singularity. figure 1 shows an example of the detection of singularities using winding number  for a fingerprint. we are currently working on classifying the singularities  and using them to describe the topology of the flow field. 
	i v 	conclusion 
　we addressed the problem of analyzing oriented patterns by decomposing them into a flow field  describing the direction of anisotropy  and describing the pattern independent of changing flow direction. 
　a specific computation for estimating the flow direction was proposed the computation can be viewed as a  finding the direction of maximal variance in the output of a linear filter  b  combining gradient directions locally  or c  finding the direction of maximal edge density. the computation has been applied to a number of natural and man-made patterns with consistent success. 
　the flow field was then used to form a coordinate system in which to view the pattern. two orthogonal familes of curves- along and across the direction of flow form the coordinate system's parameter lines. viewing the pattern in these flow coordinates amounts to deforming the pattern so that the flow lines become parallel straight lines. this deformation produces a pattern that is simpler  more regular  and therefore more amenable to analysis and description than the original one. 
　several examples of the use of this decomposition were presented. these included the use of the flow coordinates to provide preferred directions for edge detection  detection of anomalies  fitting simple models to the straightened pattern  and detecting singularities in the flow field. 
　our ongoing work focuses on the analysis of patterns with multiple axes of anisotropy  statistical modeling and resynthesis of straightened patterns  and richer description of the structure of the flow field. 

　

figure 1:  finding the needle in the haystack.  in this straw pattern  directional derivatives across the flow direction show elements aligned with the pattern  upper right.  those along the flow direction show anomalous elements  lower right.  the laplacian  lower left  shows both. 

figure 1: left: the straw picture from figure 1. right: the anomalous elements have been removed by directional median filtering in the flow direction.  following a suggestion by richard szeliski.  
　
m. kass and a. witkin 1 

figure 1: a spiral glass pattern and its flow lines. the pattern is perceptually dominated by the singularity at the center. since the flow field vanishes at a singularity  the flow lines obtained by integrating the flow field tend to become ill behaved as they approach one. 
if the integrals are computed locally with the windowing function w  then we have the following estimate for zero crossing density: 
if w is radially symmetric  w * b1 will not depend on 1 so the maximum zero-crossing density will occur at the maximum of w * b1. by assumption  the mean of the process is zero  so w * b1 is the variance of dx * r1. thus  for stationary zeromean gaussian processes  if s - dx  a1  v  1 . 
