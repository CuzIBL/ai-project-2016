
we study the decision problems facing agents in repeated matching environments with learning  or two-sided bandit problems  and examine the dating market  in which men and women repeatedly go out on dates and learn about each other  as an example. we consider three natural matching mechanisms and empirically examine properties of these mechanisms  focusing on the asymptotic stability of the resulting matchings when the agents use a simple learning rule coupled with an -greedy exploration policy. matchings tend to be more stable when agents are patient in two different ways - if they are more likely to explore early or if they are more optimistic. however  the two forms of patience do not interact well in terms of increasing the probability of stable outcomes. we also define a notion of regret for the two-sided problem and study the distribution of regrets under the different matching mechanisms.
1 introduction
this paper analyzes the learning and decision problems of agents in a model of one-to-one two-sided matching  focusing on the role of the matching mechanism and the explorationexploitation tradeoff. we consider a repeated game in which agents gain an uncertain payoff from being matched with a particular person on the other side of the market in each time period. a natural example of such a situation is the dating market  in which men and women repeatedly go out on dates and learn about each other. another example is a spot labor market  in which employers and employees are matched for particular job contracts. a matching mechanism is used to pair the agents. for example  we can consider a mechanism in which all the women decide which man to  ask out   and then each man selects a woman from his set of offers  with the rejected women left unmatched for that period.
　standard models of matching in economics  roth and sotomayor  1  almost always assume that each agent knows his or her preferences over the individuals on the other side of the market. this assumption is too restrictive for many markets  including the market for romantic partnerships. our model is driven by the need to relax this assumption. the existing literature on two-sided search with nontransferable utility  for example  burdett and wright  1   assumes matching is exogenous and random. our problem is more deeply related to bandit problems  berry and fristedt  1   in which an agent must choose which arm of an n-armed bandit to pull in order to maximize long-term expected reward  taking into account the tradeoff between exploring  that is learning more about the reward distribution for each arm  and exploiting  pulling the arm with the maximum expected reward. however  in our model the arms themselves have agency - they can decide whether to be pulled or not  or whom to be pulled by  and they themselves receive rewards based on who the puller is. this motivates our formulation of the problem as a  two-sided  bandit problem.
　in principle  we would like to examine the equilibrium behavior of agents in two-sided bandit problems. however  perfect bayesian equilibria of the game we formulate are prohibitively hard to compute. because of this difficulty  the approach we use is closely related to the theory of learning in games  fudenberg and levine  1   which considers more generally how individual learning rules affect outcomes in games and whether agents reach static equilibria.
　in this paper we formally define the two-sided bandit problem and describe three important matching mechanisms. we define regret as the difference between the actual reward received and the reward under the stable matching  i.e. a matching such that there is no pair that would rather be with each other than with whom they are matched. we experimentally analyze the asymptotic stability and regret properties when agents use -greedy learning algorithms adapted to the different matching mechanisms.
　the gale-shapley mechanism  gale and shapley  1   which yields stability when information is complete and preferences are truthfully revealed  converges quickly to stable matchings  whereas mechanisms that are more realistic for the dating example  in which women make single offers to the men  do not always converge to stable matchings. asymptotically stable matches are more likely when agents explore more early on. they are also more likely when agents are optimistic  again  early on  - that is  they assume a higher probability of their offer being accepted or an offer being made to them than is justified by the past empirical frequencies of these events. however  increased optimism does not interact well with increased exploration in terms of stability; the probability of stability is actually higher for lower exploration probabilities when optimism is greater.
1 the model
there are m men and w women  who interact for t time periods.  is the value of woman j to man i  and is the value of man j to woman i. these values are constant through time. in each period  men and women are matched to each other through a matching mechanism. a matching is a pairing between men and women in which each woman is paired with one or zero men and each man is paired with one or zero women. formally  a matching mechanism is a mapping from agents' actions to a matching. if man i is matched with woman j in period t  he receives  and she receives. if unmatched  individual i receives some constant value ki.
　for our empirical analysis we put some structure on the reward processes and the matching mechanism. first  we make the strong assumption of sex-wide homogeneity of preferences. that is  every man is equally  good  for each woman and vice versa - there are no idiosyncratic preferences and there are no couples who  get along  better than others. formally  and. we also assume that people dislike being single: 
 i z （ {m w}  and that the noise terms  are independently and identically distributed.1 extensions to more general preferences are straightforward.1
　we consider three matching mechanisms. without loss of generality  we assume that women always ask men out.
gale-shapley matching each agent submits a list of preferences and a centralized matching procedure produces a matching based on these lists. the gale-shapley algorithm  gale and shapley  1  guarantees a matching that is stable under the submitted preferences. the manoptimal variant yields the stable matching that is optimal for men  and the woman-optimal variant the stable matching that is optimal for women. we use the womanoptimal variant.
simultaneous offers each woman independently chooses one man to make an offer to. each man selects one of the offers he receives. women who are rejected are unmatched for the period  as are the men who receive no offers.
sequential offers each woman independently chooses one man to make an offer to. the offers are randomly ordered and men must decide on these  exploding  offers without knowing what other offers are coming. men see all the offers they receive  including ones that arrive after they accept. if an offer is rejected the woman making the offer is unmatched in that period. a man is unmatched if he rejects all offers he receives.
　intuitively  it is useful to think of the simultaneous choice mechanism as capturing a situation in which women ask men out over e-mail and each man can review all his offers before making a decision  while the sequential choice mechanism captures the situation where women ask men out over the telephone. we are particularly interested in these two matching mechanisms because they are more plausible descriptions of reality than a centralized matchmaker and do not require agents to reveal their preferences to a third party.
1 the decision and learning problems
we first describe the decision problems agents face at each time step if they want to optimize their myopic reward in that time step. after this we discuss the exploration-exploitation issues under the different matching mechanisms and describe specific forms of the -greedy algorithm.
{m w}
　let qij denote man  woman  i's estimate of the value of going out with woman  man  denote woman i's estimate of the probability that man j will go out with her if she asks him out anddenote man i's estimate of the probability that woman j will ask him out under the sequential choice mechanism.
1 women's decision problem
under gale-shapley matching  women's action space is the set of rankings of men. under the other two mechanisms  a woman chooses which man to make an offer to. she must base her decision on any prior beliefs and the history of rewards she has received in the past. she has to take into account both the expected value of going on a date with each man and  for the non-gale-shapley mechanisms  the probability that he will accept her offer.
　under the woman-optimal variant of the gale-shapley mechanism  the dominant myopic strategy  and thus the greedy action  is for woman i to rank the men according to the expected value of going out with each of them  qwij. for the other two mechanisms  the greedy action is to ask out man j = argmaxj pwijqwij .
1 arms with agency: men's decision problem
the action space of men  the arms of the bandit  may be constrained by women's actions. the decision problem faced by a man depends on the matching mechanism used. under the woman-optimal gale-shapley mechanism  men may have an incentive to misrepresent their preferences  but since the sex-wide homogeneity of preferences ensures a unique stable matching  roth and sotomayor  1   this is less likely to be a problem.1 so  the greedy action for man i under galeshapley is to rank women based on their qij's.
　with the simultaneous choice mechanism  in each time period a man receives a list of women who have made him an offer. he must decide which one to accept. this is a bandit problem with a different subset of the arms available at each time period. the greedy action is to accept the woman j = argmaxj qmij.
　under the sequential choice mechanism  a man might receive multiple offers within a time period  and each time he receives an offer he has to decide immediately whether to accept or reject it  and he may not renege on an accepted offer. the information set he has is the list of women who have asked him out so far. for each woman who has not asked him out  it could either be that she chose not to make him an offer  or that her turn in the ordering has not arrived yet. we can formulate the man's value function heuristically. let i be the index of the man  let s be the set of women who have asked him out so far  and let h be the woman currently asking him out  h （ s .
v  s h  = max{qmih 
x
pr k next woman to ask i out v  s “ {k} k }
k/（s
　the base cases are v  w h  = qwih where w is the set of all women. the greedy action is to accept an offer when
qmih   x pr k next woman to ask i out v  s “ {k} k 
k/（s
the relevant probabilities are:
pr k next woman to ask i out  =
	   	   
	1	m	m
　where s1 = w s. this is a variant of the classic secretary problem  gilbert and mosteller  1 . we are not sure at the moment if this particular form can be simplified to yield a closed form solution for the value or decision function.
1 the exploration-exploitation tradeoff
women and men both have to consider the explorationexploitation tradeoff  summarized in  sutton and barto  1  . exploitation means maximizing expected reward in the current period  also called the greedy choice   and is solved as above. exploration happens when an agent does not select the greedy action  but instead selects an action that has lower expected value in the current period in order to learn more and increase future rewards.
　the one-sided version of the exploration-exploitation problem is central to n-armed bandit problems  berry and fristedt  1; gittins and jones  1  inter alia . an n-armed bandit is defined by random variables xi t where 1 ＋ i ＋ n is the index of the arm of the bandit  and xi t specifies the payoff received from pulling arm i at time t. the distribution of some or all of the xi t is unknown so there is value to exploring. the agent pulls the arms sequentially and wishes to maximize the discounted sum of payoffs. in our model  if there is a single woman and n men  the woman faces a standard n-armed bandit problem.
　one of the simplest techniques used for bandit problems is the so-called -greedy algorithm. this algorithm selects the arm with highest expected value with probability and otherwise selects a random arm. although simple  the algorithm is very successful in most empirical problems  and we therefore use it in our experiments. we have also experimented with alternatives like softmax-action selection with boltzmann distributions  sutton and barto  1; luce  1  and the exp1 algorithm  auer et al.  1 . these do not improve upon the empirical performance of greedy in our simulations.
　under each matching mechanism the exploratory action is to randomly select an action  other than the greedy one  from the available action space. since the value of exploration decreases as learning progresses  we let  decay exponentially over time which also ensures that the matchings converge.
　at this stage we cannot solve for the perfect bayesian equilibrium set. we believe  however  that if the agents are sufficiently patient and the horizon is sufficiently long  the matchings will converge to stability on the equilibrium path. solving for the equilibrium set would enable us to explicitly characterize the differences between equilibrium behavior and behavior under the -greedy algorithm.
　the two-sided nature of the learning problem leads to nonstationarities. under the sequential and simultaneous mechanisms  women need to consider the reward of asking out a particular man  not the reward of going out with him. the reward of asking out a particular man depends on the probability that he will accept the offer. thus  the reward distribution changes based on what the men are learning  introducing an externality to the search process. the same applies to men under the sequential mechanism since the probability that a particular woman will ask a man out changes over time. this is a
　problem of coordinated learning that is related to the literature on learning in games  fudenberg and levine  1  and to reinforcement learning of nonstationary distributions in multiagent environments  bowling and veloso  1 . some recent work by auer et al. on  adversarial  bandit problems  which makes no distributional assumptions in deriving regret bounds  is relevant in this context  auer et al.  1 .
　since the underlying vij's are constant we define qij as person i's sample mean of the payoff of going out with person j. in order to deal with the nonstationarity of pij's  on the other hand  we use a fixed learning rate for updating the probabilities which allows agents to forget the past more quickly: pij t  =  1   η pij t   1  + ηi offer made / accepted 
　where η is a constant and i is an indicator function indicating whether a man accepted an offer  for the woman's update  applied only if woman i made an offer to man j at time t  or whether a woman made an offer to a man  for the man's update  applied at each time period t .
1 empirical results
 our simulations involve a market with 1 women and 1 men. the agents use η of 1 for updating their probability estimates and the probability of exploration evolves with time as . agents have true values
. we
assume ki = 1  i. the noise signals  are i.i.d. and

figure 1: probability of a stable  asymptotic  matching as a function of initial value of 
drawn from a normal distribution with mean 1. unless otherwise specified  the standard deviation of the noise distribution is 1. reported results are averages from 1 simulations  each lasting a total of 1 time steps. initial values of qij are sampled from a uniform  1  distribution and initial values of pij are sampled from a uniform  1  distribution.
　our experiments show that settings in which agents are matched using the gale-shapley mechanism always result in asymptotically stable matchings  even for very small initial values of  such as 1. after a period of exploration  where the agents match up with many different partners and learn their preferences  agents start pairing up regularly with just one partner  and this is always the agent with the same ranking on the other side. this indicates that agents are generally successful at learning their preferences. interestingly  even if only one side explores  that is  either men or women always pick the greedy action   populations almost always converge to stable matchings  with a slight decline in the probability of stability when only men explore  under the woman-optimal matching algorithm  women's rankings can have a greater effect on the matching than men's rankings .
　the probabilities of convergence under the simultaneous and sequential choice mechanisms are significantly lower  although they increase with larger initial values of . we can see this behavior in figure 1  which also reveals that the probability of convergence to a stable matching is much higher with the simultaneous choice mechanism. table 1 shows these probabilities as well as the score  which is a measure of how large the deviation from the stable matching is. if men and women are indexed in order of their true value ranking  the score for a matching is defined as partner i | where partner i  is the true value ranking of the man woman i is matched with  and w is the set of all women.
　it is also interesting to look at who benefits from the instabilities. in order to do this  we define a notion of regret for an agent as the  per unit time  difference between the reward under the stable matching and the actual reward received  a negative value of regret indicates that the agent did better than
idsimultaneous regretsequential regretwoman'sman'swoman'sman's1.1.1.1.111-111.1.1-1-11.1-1-1-11-1-1-1-1table 1: distribution of regret under simultaneous choice   and sequential choice    mechanisms

figure 1: a  phase transition : men and women are ranked from 1  highest  to 1  lowest  with -1 representing the unmatched state. the graph shows the transition to a situation where the second highest ranked man ends up paired with the lowest ranked woman
 s he would have done under the stable matching . this definition is unambiguous with sex-wide homogeneity of preferences since there is only one stable matching  but could be problematic in other contexts  when there may be multiple stable matchings. in such cases it might make sense to analyze individual agent performance in terms of the difference between average achieved reward and expected reward under one of the stable matchings depending on context.
　in the case of sex-wide homogeneity of preferences we of course expect that regret will be greater for more desirable agents since they have more to lose when their value is not known. table 1 shows the distribution of regrets for simultaneous and sequential choice. the regrets are averaged over the last 1 periods of the simulation. under simultaneous choice  the worst woman benefits at the expense of all other women while the worst two men benefit at the expense of the top three. under sequential choice  other agents benefit at the expense of the best ones. further research is needed to better understand this apparent difference in the distribution of regrets under the two mechanisms.
　figure 1 shows interesting dynamic behavior in one particular simulation where the second best man ends up with the worst woman. the graph shows which man is matched with which woman at each time period. the lines represent the men  and the numbers on the y axis represent the women. the value -1 represents the state of being unmatched in that period for a man. the men and women are ranked from 1  best  to 1  worst . initially  the second best man is paired with the best woman so he keeps rejecting offers from all the
simultaneous choicesequential choicegale-shapleypr  stability scorepr  stability scorepr  stability score.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1table 1: convergence to stability as a function of 


table 1: convergence to stability as a function of σ with simultaneous choice and initial
other women. these women thus learn that he is extremely particular about whom he dates and there is no point in asking him out. when the best woman finally learns that she can get a better man this triggers a chain of events in which all the men sequentially move to the woman ranked one higher than the one they were seeing. however  all the women have such a low opinion of the second best man that he ends up getting matched with the very worst woman. the matching shown at the end of the graph is the final asymptotic matching in this simulation. note that the gender asymmetry  women ask men out  precludes this from happening to a woman.
　finally  we analyze how the noise distribution affects the probability of stability. we expect that there will be less convergence to stability when the signals are less precise. we ran experiments in which the standard deviation of the noise distribution was changed while holding other factors constant. we used an initial and the same underlying values as above. table 1 shows the results using the simultaneous choice mechanism. we vary the standard deviation from one half of the distance between the two adjacent true values  1  to twice that distance  1   and the probability of stability falls by less than 1%. this suggests that the instabilities arise mostly from the structure of the problem and the nonstationarity of probability estimates rather than from the noise in the signals of value.
1 optimism and exploration
the insight that instabilities arise mostly from the structure of the problem suggests an alternative method for engineering asymptotic stability into the system. suppose agents are initially optimistic and their level of optimism declines over time. this is another form of patience - a willingness to wait for the best - and it should lead to more stable outcomes.
　optimism can be represented by a systematic overestimation of the probability that your offer will be accepted or that

figure 1: the mechanism of stability with optimism: agents keep trying better ranked agents on the other side until they finally  fall  to their own level
an offer will be made to you. we explore this empirically with the sequential choice mechanism. instead of using the learned values of pij as previously defined  agents instead use an optimistic version. at time t  both men and women use the optimistic probability estimate:
p1ij = αt +  1   αt pij
in decision making  the actual pij is maintained and updated as before . αt should decline with time. in our simulations α1 = 1 αt = 1  where t is the length of the simulation  and α declines linearly with t. there are no other changes to any of the decision-making or learning procedures.
　figure 1 shows the process by which agents converge to asymptotic matchings  in this case a stable one  with the optimistic estimates. the structure of the graph is the same as that in figure 1. essentially  each agent keeps trying for the best agent  s he can match with until the optimism parameter has declined sufficiently so  s he  falls  to the equivalently ranked agent on the other side of the market. figure 1 shows that agents are considerably more likely to converge asymptotically to stable matchings using this algorithm for any value of the initial exploration probability. of course  this convergence comes at the expense of utility achieved in the period before the agents settle down.

figure 1: probability of convergence to stability for different initial values of epsilon with all agents using the optimistic algorithm versus all agents using the realistic algorithm
　the surprising feature in figure 1 is that stable matchings are more likely with smaller initial exploration probabilities. the v-shape of the graph shows that the probability of stability declines with increasing exploration up to an initial  value of 1  before starting to increase again  in contrast to the monotonically increasing probability of stability without optimism. this can be explained in terms of the fact that a small level of exploration is sufficient for agents to learn their preferences. beyond that  additional exploration becomes counterproductive because the probability estimates at the key stages become less reliable.
1 conclusions and future work
we have defined two-sided bandit problems  a new class of problems in multi-agent learning and described the properties of three important matching mechanisms with -greedy learning rules. two-sided bandit problems are of great relevance for social science in general and the search for marriage partners in particular. the social norms governing exploration before marriage have been changing rapidly over the last few decades and until now we have had no formal structure within which to study the sources and consequences of these changes. our model is also more generally applicable to two-sided markets in which agents have to learn about each other.
　this paper only scratches the surface of a large and potentially fruitful set of theoretical and empirical questions. we are exploring learning algorithms that would allow agents to perform well1 across a broad range of environments without having to make assumptions about the decision-making algorithms or learning processes of other agents. another direction of research is to explicitly characterize equilibria in simpler settings. we are also interested in more complex versions of the problem that allow for a greater diversity of preferences and a larger number of agents.
acknowledgements
we would like to thank david laibson  sayan mukherjee  tommy poggio  al roth and the referees for useful comments. sd acknowledges grants to cbcl from merrilllynch  the national science foundation  the center for e-
business at mit  the eastman kodak company  honda r&d co  and siemens corporate research  inc. ek acknowledges support from the national science foundation graduate research fellowship  the national institute on aging  grant # t1-ag1   the institute for humane studies  and the chiles foundation.
references
 auer et al.  1  p. auer  n. cesa-bianchi  y. freund  and r. e. schapire. the nonstochastic multiarmed bandit problem. siam journal on computing  1 :1  1.
 berry and fristedt  1  d. a. berry and b. fristedt. bandit problems: sequential allocation of experiments. monographs on statistics and applied probability. chapman and hall  london  uk  1.
 bowling and veloso  1  m. bowling and m. m. veloso. multiagent learning using a variable learning rate. artificial intelligence  1-1  1.
 burdett and wright  1  k. burdett and r. wright. twosided search with nontransferable utility. review of economic dynamics  1-1  1.
 fudenberg and levine  1  d. fudenberg and d. levine. the theory of learning in games. mit press  cambridge  ma  1.
 gale and shapley  1  d. gale and l. s. shapley. college admissions and the stability of marriage. the american mathematical monthly  1 :1  1.
 gilbert and mosteller  1  j. gilbert and f. mosteller. recognizing the maximum of a sequence. journal of the american statistical association  1-1  1.
 gittins and jones  1  j. c. gittins and d. m. jones. a dynamic allocation index for the sequential design of experiments. in j. gani  k. sakadi  and i. vinczo  editors  progress in statistics  pages 1. north holland  amsterdam  1.
 luce  1  d. luce. invidual choice behavior. wiley  new york  1.
 roth and sotomayor  1  a. e. roth and m. sotomayor. two-sided matching: a study in game-theoretic modeling and analysis. econometric society monograph series. cambridge university press  cambridge  uk  1.
 sutton and barto  1  r. s. sutton and a. g. barto. reinforcement learning: an introduction. mit press  cambridge  ma  1.
1 another plausible and interesting structure to consider is pairwise homogeneity of p