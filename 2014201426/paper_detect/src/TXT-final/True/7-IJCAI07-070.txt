
most existing sketch understanding systems require a closed domain to achieve recognition. this paper describes an incremental learning technique for opendomain recognition. our system builds generalizations for categories of objects based upon previous sketches of those objects and uses those generalizations to classify new sketches. we represent sketches qualitatively because we believe qualitative information provides a level of description that abstracts away details that distract from classification  such as exact dimensions. bayesian reasoning is used in building representations to deal with the inherent uncertainty in perception. qualitative representations are compared using sme  a computational model of analogy and similarity that is supported by psychological evidence  including studies of perceptual similarity. we use seql to produce generalizations based on the common structure found by sme in different sketches of the same object. we report on the results of testing the system on a corpus of sketches of everyday objects  drawn by ten different people.
1 introduction
the problem of sketch recognition has received much attention in recent years because sketching provides a convenient and natural interface for transferring information from a person to a computer. this problem can be extremely difficult because everyone sketches differently and a single person will often sketch the same thing in a different way each time. the key is to identify the properties that remain constant across each sketch of a given object. in order to deal with this quandary  many programs use a narrow domain containing a small set of possible sketch objects  e.g.  circuit diagrams: liwicki and knipping  1; simple symbols:
anderson et al.  1; architectural objects: park and kwon  1 . thus  the programmers can examine the domain ahead of time and either hand-code the classifiers themselves or train the classifiers on a large body of data  1 images for liwicki and knipping  . even systems designed to work in multiple domains require a certain amount of preprogramming for each particular domain  alvarado et al.  1 . while these types of systems have certainly proven useful  they limit the communication between the person and the computer. only information based in domains that the programmers expect the system to work in can be transmitted.
　　we believe the key to recognition in the absence of domain expectations is efficient  on-line learning. this means that while a user works with the system  it should be learning from the sketches the user produces  so that when the user sketches an object that has been sketched in the past  it will recognize that object. such a system has a couple of key requirements. firstly  there must be a simple way for the user to tell the system what a sketched object is supposed to be. secondly  an algorithm that can learn a new category based on only a few examples is required. this is difficult if one is relying on quantitative information about lengths and angles because this information can vary significantly from one sketch to another. therefore  we believe qualitative sketch representations are necessary.
　　several efforts have examined building qualitative representations of images  although few have dealt with raw  user-drawn sketches. museros and escrig  worked on comparing closed shapes. their representations contained descriptions of basic features of the curves and angles in the shapes. they were able to compare two shapes and determine whether one was a rotation of the other.
　　ferguson and forbus'  georep generated qualitative representations based on a line-drawing program that allowed users to make perfect lines and curves. georep applied a low-level relational describer to each drawing to find domain-independent qualitative information  such as relative orientation of and connections between lines. georep also used high-level relational describers to extract domain-dependent information from the low-level description. it was used for recognizing objects in particular domains and identifying axes of symmetry.
　　veselova and davis  built a system that produced a qualitative representation of hand-drawn sketches. their representational vocabulary overlapped somewhat with ferguson and forbus'. their system used several cognitively motivated grouping rules to determine the relative weights of different facts in the representation. the system was designed to produce representations for classification  although the learning and classification stages have not  to the best of our knowledge  been integrated.
　　we believe the three systems described above provide evidence for the effectiveness of using qualitative information to represent and compare sketches. however  these systems lack the ability to learn robust categories of sketches based on multiple examples. here  we describe our system  which we believe takes a step towards accomplishing this goal. we begin with the sketching environment in which our system operates. next  we give a brief overview of the applications we use for comparing sketches and constructing generalizations. we then describe how our system decomposes rough sketches into perceptual elements and how those elements are represented using a qualitative vocabulary. finally  we discuss the results from an experiment designed to test our system and consider areas for future work.
1 the sketching environment
our system uses sketches drawn in skea  the sketching knowledge entry associate. skea is an open-domain sketch understanding system  forbus et al.  1 . it is able to reason about user-drawn sketches without any domain expectations of what a user is likely to sketch because it is not dependent on sketch recognition. rather  it is based on the idea that when people communicate through sketching  their communication is a multi-modal process. people verbally describe what they are sketching as they create it. similarly  skea allows users to label each glyph  or object in a sketch  with categories from its knowledge base. skea computes a number of spatial relations between glyphs in a sketch  and it uses this information along with its knowledge about the categories of the glyphs to reason about a sketch  or to compare two sketches.
　　while humans do often describe what they are sketching  they also expect others to recognize some objects without having to be told what they are. thus  it is not surprising that skea's requirement that every glyph be labeled can become onerous at times  especially if the user is performing a task that requires the same objects to be sketched and labeled many times. this concern leads to the question of whether some type of sketch recognition can be added to skea without sacrificing domain independence.
　　our approach to domain-independent recognition is based on incremental learning. when a user begins using skea to perform some task  skea should have no expectations about what the user will sketch. however  over time  if the user sketches the same object more than once  skea ought to learn to recognize that object. thus  the fourth time the user draws  say  a building  skea could generate a guess as to what that object is most likely to be. if that guess is wrong  the user can perform the usual glyph labeling task to correct it  just as a person would correct another person who misunderstood part of a sketch. we see any sketching session as an opportunity for skea to learn to recognize objects in parallel with the user's sketching of those objects.
　　in order for skea to learn to recognize objects  three other components are required: a system for building representations of sketched objects  a system for learning perceptual categories of objects  and a system for comparing a new object's representation to the category representations in order to classify it. we will describe the comparison and learning components in the next section.
1 comparisons and generalization
we compare representations using the structure-mapping engine  sme   falkenhainer et al.  1 . sme is a computational model of similarity and analogy based on gentner's  structure-mapping theory. according to structure-mapping  humans draw analogies between two cases by aligning their common structure. each case's representation contains entities  attributes of entities  and relations. structure is based on the connections between elements in the representation. a simple relation between two entities has a small amount of structure  whereas a more complex relation between other relations has a deeper structure.
　　sme takes as input two cases: a base and a target. it finds possible correspondences between entities  attributes  and relations in the two cases. it combines consistent correspondences to produce mappings between the cases. sme attempts to find mappings which maximize systematicity  the amount of structural depth in the correspondences.
　　our system learns categories of objects using seql  kuehne et al.  1; halstead and forbus  1   a model of generalization built on sme. seql is based on the theory that people form a representation of a category by abstracting out the common structure in all the exemplars of that category. seql uses sme to compare new cases to the known generalizations. if a new case aligns with a sufficient amount of the structure in one of the generalizations  the case is added to that generalization. seql associates probabilities with each expression in a generalization  representing the proportion of the instances of that generalization that include that particular expression. when a new case is added to the generalization  if its structure does not align with an expression in the generalization  that expression's probability is decremented.
　　seql is capable of quickly learning new generalizations. even a generalization based on a pair of exemplars may be sufficient for classifying new cases. each additional exemplar further refines the generalization.
1 perceptual elements
our system decomposes a sketch into a set of primitive perceptual elements. there are two types of primitive elements: segments and the endpoints of segments. these elements align with elements of the raw primal sketch in marr's  theory of vision. segments may be straight or curved. endpoints may be classified as corners  meaning there is a corner between two segments; connections  meaning they connect two collinear segments; or terminations  meaning the endpoint does not connect to another segment. once the primitive elements are found  they can be grouped to form more complex elements  creating an element hierarchy. so far  there is only one level to the hierarchy. segments and their terminations can be grouped to form edges. while there are rules for grouping edges  there are currently no explicit structures for more complex perceptual elements.
　　our system begins with the raw output from skea  consisting of a list of polylines. each polyline is a list of points corresponding to a line drawn by the user. the system does not assume that the endpoints of polylines match endpoints of edges in the shape. rather  it begins by joining together polylines with adjacent endpoints  provided there is no third adjacent polyline to create ambiguity.
　　the system then searches for discontinuities in the slope of each polyline  representing potential corners. discontinuities are a key concept at every level in marr's  model  and they provide vital information about the location of segment endpoints. in our system  evidence for a discontinuity includes both changes in the overall orientation and high values for the derivative of the slope of the curve  as calculated by lowe . polylines are divided into segments which are linked by endpoints anywhere there is a sufficiently salient discontinuity.
　　the system also finds potential corners and connections between segments from separate polylines whose endpoints are not adjacent. two segments may have a corner between them if extending the lines beyond their endpoints would result in an intersection at some point in space. they may have a connection between them if they are collinear.
　　once the system has located endpoints and gathered evidence  the endpoints must be classified. previous systems have used bayesian networks  bnets  to deal with uncertainty in perception  bokor and ferguson  1; alvarado and davis 1 . we utilize bnets which use the evidence gathered about an endpoint to classify it as a corner  connection  or termination
　　after endpoints have been classified  segments can be grouped together to form edges. edges consist of maximal lists of unambiguously connected segments. segments are unambiguously connected if there is an endpoint between them that has been classified as a connection and if the connected endpoints of the two segments are not linked by connections or corners to any other segments. the threshold for connection detection is lowered if the segments to be grouped form a compatible curve.
　　edges inherit connection information from the segments upon which they are built. thus  edges whose segments were connected will themselves be connected. this connection information is used by the system to group edges into connected edge groups  lists of sequentially connected edges. a cyclic edge group is a connected edge group in which the first and the last edge are connected. these edge groups represent closed shapes in the sketch. for example  a square would be a cyclic edge group containing four edges. once the edges and edge groups have been computed  the system uses this information to build a qualitative representation of the sketch.
1 qualitative representation
an appropriate representational vocabulary is crucial for any kind of comparison between sketches. if the vocabulary fails to capture the key properties of each sketch  there will be no way to determine whether two sketches are similar. our qualitative vocabulary draws on the work of ferguson and forbus   museros and escrig   and veselova and davis .
　　the terms in our vocabulary can be divided into three types: attributes  pairwise relations  and anchoring relations. attributes convey information about a single edge in the sketch. pairwise relations describe a relationship between two edges. because these first two types of terms can apply to only one or two entities in the representation  they contain relatively little structural depth. sme uses structure to match two representations  so it is difficult to find corresponding entities using only these predicates  particularly when there is a large number of them in each representation. thus  anchoring relations are necessary. anchoring relations  which convey information that we believe is particularly salient in the match  refer to more than two edges  and contain greater structural complexity. because of sme's systematicity bias  they are generally the first relations sme matches up. thus  they anchor the rest of the mapping.
　　attributes describe an edge's type. an edge can be classified as straight  curved  or elliptical  where an elliptical edge is a curved edge that closes on itself  such as a circle. in addition  straight edges that align with the x or y axes are assigned the horizontal or vertical attributes.
　　pairwise relations describe the relative position  left-of or above   relative length  same-length or longer-than   or relative orientation  parallel or perpendicular  of pairs of edges. one major concern with pairwise relations is determining the pairs of edges for which relations will be asserted. asserting relations between every pair of edges in a sketch results in an overly complex representation with a large number of redundant or irrelevant facts. we follow veselova and davis  in only asserting pairwise relations between adjacent edges. we further limit the relative length relations between straight edges by only asserting relative length for pairs of edges that are parallel or perpendicular.
　　connections between edges  and particularly corners between edges  connections that occur at the edges' endpoints   are key to recovering the spatial structure of most shapes. we use a general connected relation any time two edges are connected to allow connections of different types to potentially align. however  we also classify the connections into three types: corner  connects-to  where one edge's endpoint touches the middle of another edge   and intersection  when two edges meet between both their endpoints . we also use cyclic edge groups to compute the convexity of any corners that make up part of a closed shape.
　　we assert two types of anchoring relations. firstly  we use the cyclic edge groups to find any three-sided or foursided closed shapes  i.e.  triangles or quadrilaterals. these shapes are important because they often make up the surfaces of three-dimensional objects  and because there is evidence that humans identify basic shapes early on in perceptual processing  ferguson and forbus  1 .
　　secondly  we assert junction relations for points in a sketch where exactly three edges meet. clowes  demonstrated that junctions between edges provide useful information for recovering shape information from line drawings. we classify junctions into three types described by clowes: arrow junctions  fork junctions  and tee junctions  as well as a fourth  other type. we also assert positional relations between junctions.
1 organization of facts
unfortunately  we found that when complex shapes were analyzed  the representations based on the vocabulary described above became unmanageably large  1+ facts . consequently we limit the number of facts that are allowed in a representation. we order the facts in our representation according to a ranking system. once facts have been appropriately ordered  we can cut off the list of facts in a representation at different points depending on how large we want to allow the representations to grow.
　　facts are ranked based on both the qualitative term and the edges being described. among qualitative terms  anchoring relations are ranked above other relations due to their importance in the mapping. among edges  the highest ranking is given to external edges  those that reach the outer bounds of the entire sketch. these edges are considered the most important because the outer edges of an image convey vital information about the shape which the image represents  hoffman and richards  1 . the lowest ranking is given to purely internal edges  those that are not part of any connected edge group containing an external edge. presently we do not assert relations between internal edges.
1 experiment
we evaluated our system by testing its ability to build generalizations of sketches of 1 everyday objects: a house  a fireplace  a brick  a cup  an oven  a cylinder  a refrigerator  and a bucket. the objects were selected from sun up to sun down  buckley  1   which uses simple drawings in teaching about solar energy. 1 subjects were instructed to sketch each object using the drawings from the book as guides. the drawings were provided so that the general features and orientations of the sketches would be similar. however  subjects were told that they needed only sketch those parts of the object that they believed were necessary for a person to recognize it. on examining the sketches drawn by subjects  we found significant cross-subject differences in the sketches  although most of the sketches of each object shared a core set of similarities  see figure 1 .
　　subjects sketched the objects in skea. of the 1 subjects  1 had previous experience working with skea. after subjects sketched the objects  each object was labeled by the experimenter using skea's interface.
　　we chose to throw out one subject's set of sketches because the subject failed to follow the instructions. the remaining 1 sketches were used to test the system. in each test run  generalizations for the 1 objects were built based on sketches by a subset of the 1 users  the training set . although seql can determine generalizations automatically  our system forced seql to build exactly one generalization from the training sketches of each object.

figure 1. examples of sketches drawn by subjects
　　after the generalizations were built  they were used to classify the objects in the sketches by a subset of the remaining users  the test set . a given object was classified by comparing its representation to each of the 1 generalizations and returning the generalization with the strongest match. the strength of a match was calculated based on coverage. after sme was used to identify the common structure in a generalization  the base  and a new instance  the target   the base or target coverage could be calculated by determining the percentage of expressions in the base or target that were a part of the common structure. for example  if every expression in the base matched something in the target  the match would have 1% base coverage. we found that both base and target coverage provided useful information about the strength of a match. therefore  the system calculates the match's strength by taking the average of the two.
　　we validated our results by averaging the scores over 1 test runs. in each run  the sketches were randomly divided into training and test sets. because we were unsure how limiting the number of facts in a representation would affect the results  we ran the test with four different limits on the number of facts. in addition  because we were interested in the incremental effect of adding more cases to a generalization  we ran the test multiple times with different training set sizes. we varied the training set size from two to six cases  while keeping the test set size constant at three.

figure 1. cylinders  buckets  and cups drawn by subjects
　　preliminary tests indicated that many of the classification mistakes made by the system involved a failure to distinguish between the three cylindrical objects: cylinders  buckets  and cups. this is hardly surprising  as these three objects have similar shapes  with nearly as much variation within category as across categories  see figure 1 . therefore  we used two criteria in reporting our results. according to the strong criterion  only an exact match between an object's actual type and its classified type was considered a correct classification. according to the weak criterion  a classification in which the two types did not match was still considered correct when both were cylindrical types.

figure 1. results when the fact limit is varied
1 results
the results achieved when the limit on the number of facts in each representation was varied are found in figure 1. these results were based on a training set size of 1. the best results were achieved with a limit of 1 facts. with this limit  the strong criterion was met 1% of the time  and the weak criterion was met 1% of the time. note that chance performance with the strong and weak criteria would be 1% and 1%  respectively. a t-test was used to look for statistical differences in the results. we found that the increase in performance when the number of facts went from 1 to 1 was statistically significant  p   .1  for both the strong and weak criteria. there were no significant differences between the results for 1  1  and 1 facts.
　　the results for different training set sizes  shown in figure 1  were collected with a fact limit of 1 facts. the results for both the strong and weak criteria consistently improved as the training set size increased. with only two cases in each generalization  the results were 1% and 1% for the strong and weak criteria. with six cases in each generalization  the results were 1% and 1%. while there was a clear overall improvement  the differences between adjacent pairs of results were generally small. increasing the training set size from 1 to 1 resulted in significant performance improvements with both the strong and weak criteria  p   .1   but no other differences between adjacent pairs were statistically significant.

figure 1. results when the training set size is varied
1 discussion
we believe we have demonstrated the effectiveness of our system in learning to classify sketches of simple  everyday objects. while the number of types of objects for classification was not large  the objects varied significantly in terms of shape and complexity. most importantly  the system worked with no prior knowledge of the object classes for which it learned generalizations. based on only two sample objects for each type  it was able to build generalizations that were sufficiently robust to classify new objects into one of eight categories 1% of the time  and into one of six categories 1% of the time. as expected  classification became more accurate as the number of sketches in the training set increased  suggesting that each additional sample allowed the generalizations to be refined and improved. the relatively narrow range of improvement is most likely due to a ceiling effect: the system achieved near-optimal performance with generalizations based on two examples  so there was not a great deal of room for improvement.
　　we were concerned that limiting the number of facts that could be included in a representation might hamper performance. however  we found no significant differences between performance with 1  1  or 1 facts. this result suggests that  given our ordering of the facts  the first 1 or 1 facts were sufficient for recovering the shape of the sketch. of course  one would expect the necessary number of facts to vary depending on the complexity of the shape being represented. however  given the range of the shapes used for this experiment  with the number of facts for a shape ranging from 1 to over 1  we believe the results support 1 being a good general cutoff for the current qualitative representation scheme.
　　one assumption our system makes that limits our ability to generalize from these results is that relations between interior edges are not needed. if the system is to be able to learn to distinguish between more similar objects  it may be necessary to include these relations in the representations.
　　one limitation of our experiment is that subjects were given a guiding illustration of each object  rather than drawing objects from their own imagination. however  we believe the results represent an important step towards solving the problem of sketch perception. to the best of our knowledge  no other recognition system has been tested on crosssubject sketches of the complexity and variability used in this experiment.
1 future work
our system currently assumes that each new sketch must match one of the previously learned generalizations. this will not always be the case. the ability to recognize that a new object is novel instead of forcing it into a category would be useful. this recognition could be based on a threshold for structural evaluation scores in the sme matches between new cases and previous generalizations.
　　thus far we have only shown that our system works in an experimental setting. in the future  we plan to incorporate the system with skea so that it will be running in the background while users are sketching. the interaction between the user  the system  and skea will create an environment in which we believe open-domain sketch recognition will become a possibility.
acknowledgments
this research was supported by a grant from the computer science division of the office of naval research.
