 
most case-based reasoning systems have used a single  best  or  most similar  case as the basis for a solution. for many problems  however  there is no single exact solution. rather  there is a range of acceptable answers. we use cases not only as a basis for a solution  but also to indicate the boundaries within which a solution can be found. we solve problems by choosing some point within those boundaries. in this paper  i discuss this use of cases with illustrations from chiron  a system t have implemented in the domain of personal income tax planning. 
1 	introduction 
most case-based reasoning  cbr  systems to date have used a single  best  or  most similar  case as the basis for a solution. for many problems  however  there is no single exact solution. rather  there is a range of acceptable answers. we use cases not only as a basis for a solution  but also to indicate the boundaries within which a solution can be found. we solve problems by choosing some point within those boundaries. 
for example  suppose you want to sell your house. 
two similar houses have been sold recently in the same neighborhood  one for $1 and one for $1. you can estimate that your house will sell for between $1 and $1. or suppose you want to make chili for dinner. you have made the recipe with one tablespoon of chili powder and with three  and while you prefer the latter  both were acceptable. you can add the chili powder without measuring it precisely  as long as you stay within these limits. 
모'this work has benefited from the comments of eugene charniak  tom dean  jim hendler  leslie kaelbling  robert mccartney  leora morgenstern  edwina rissland  
david skalak  and the members of the plus group at the university of maryland. it was supported in part by grants from onr  n1-j-1i-1   nsf pyi award  iri-
1  to thomas dean  afosr and arpa  f1-c-1   onr  n1-j-1   arpa order 1  nsf and arpa  iri-1   ibm  1  1  1  1   and by nsf  iri-1 . 
1 	case based reasoning 
모in this paper  i discuss this use of cases in the legal domain. in law  the reported cases are nearly always boundary cases in some respect; central cases are easy  so they are usually not taken to court. 
모specifically  i focus on the way in which cases indicate the boundaries of the possible interpretation of statutes. statutes are rules that have been created formally  by legislation. they are published by the government and often by private companies as well. for example  consider 뫫1 a  of the internal revenue code  governing the tax treatment of income from the sale of a personal residence  given in figure 1. the internal revenue code is the most important statute for united states tax planning. it contains approximately 1 sections. 
모detailed as the internal revenue code is  it still contains phrases that are not defined within the statute  for example  the phrase  principal residence  in 뫫 1. to qualify for the benefit of 뫫1  a taxpayer must show  among other things  that he bought and sold properties which belong to this category. these phrases are partially  but not completely  defined by commonsense knowledge about the meaning of the words used and by examples. 
what makes reasoning about these phrases difficult 
- and interesting is that defining them is not just a matter of inferring defining characteristics from a set of examples. generally speaking  there is no set of essential characteristics shared by all positive instances of the statutory predicate. some examples are typical  and others are more or less similar to them along various dimensions. as a result  classifying a particular object as an instance or noninstance of one of these categories is not always a simple task. 
모planners using such open-textured rules need some way of determining whether their plans satisfy the rules. this issue arises throughout legal reasoning  not just in tax. indeed  it is part of a general natural language problem. many ordinary categories  such as  tiger  or  cup   are surprisingly difficult to define. this indeterminacy has been studied in linguistics and philosophy  where it is labelled open texture  waismann  1; hart  1 . any planning rule expressed in natural language  such as  be careful    never get involved in a land war in asia   or  buy low  sell high   suffers from the same problem. 
in any domain  open-textured rules can be partially 뫫1. rollover of gain on sale of principal residence.  a  nonrecognition of gain.-if property  in this section called  old residence   used by the taxpayer as his principal residence is sold by him and  within a period beginning 1 years before the date of such sale and ending 1 years after such date  property  in this section called  new residence   is purchased and used by the taxpayer as his principal residence  gain  if any  from such sale shall be recognized only to the extent that the taxpayer's adjusted sales price  as defined in subsection  b   of the old residence exceeds the taxpayer's cost of purchasing the new residence. 
figure 1: 뫫1 a  of the internal revenue code. 
defined by examples. the legal domain has the advantage that examples are recorded and published. each court case is an example - an application of the law to a particular set of facts. facts and results are recorded by the courts in  opinions  and published  both by the government and by private companies. thousands of examples are readily available in any law library. 
모the open-textured nature of legal rules enables them to cover a range of possibilities  without specifying them in complete detail. for example  a house can be your principal residence whether you've lived there for one year or fifty  whether it has one bedroom or a hundred  and so forth. 
모the fact that terms like  principal residence  are underspecified also means that the courts can respond to changing circumstances. for example  they can interpret  principal residence  to cover cooperatives and condominiums  even if those forms of ownership did not exist at the time the statute was passed. similarly  the first amendment protection of freedom of speech can be extended to cover television and radio  as well as newspapers. 
모because the system is flexible  it is also uncertain. in law  unlike domains such as chess  it is impossible to prove a plan correct. this uncertainty is not due to lack of factual information  we can assume complete knowledge of the facts ; but to the underspecified nature of the rules. 
모planners need some ability to predict how the law will be applied. this is supplied by the doctrine of precedent  which provides that  unless there is some strong reason to do otherwise  courts must follow their own previous decisions. similar cases must be decided similarly. 
모suppose you want to take advantage of one of these open-textured rules. say for example that you want to sell your house and obtain the benefits of 뫫 1 a . you will consider your situation in relation to past cases under this provision and try to construct a plan for selling your house that is supported by previous successful cases. because the courts are bound by precedent  if your case is similar to or stronger than past successful cases  it will be decided the same way. if it is weaker than past successful cases  you might still win  but this is an adversarial domain. to avoid challenge by the government  you will try to stay within the boundaries indicated by those cases. 
모at least  that is what you will do if you are a typical conservative tax planner. if you are a little more aggressive  and the successful cases indicate a trend  you may go beyond them in the same direction. for example  if you have a successful case where someone sold a house they only lived in for a year  you may try selling your house after six months. in other words  you will extrapolate from the cases in your casebase  rather than interpolating between them.1 
모1 have implemented this approach in chiron  a system that constructs plans in the domain of personal income tax planning  sanders  1 . in section 1 of this paper  i give an overview of the system; in section 1  1 describe the representation it uses for rules  cases  and other knowledge; in section 1  i give a brief example; in section 1 i discuss related work; and in section 1  i summarize the results of this paper. 
모1 overview of chiron 
in order to reason about open-textured rules and cases  
chiron combines hierarchical and case-based planners in a hybrid system. the hierarchical planner  adapted from a version of nonlin implemented at the university of maryland  ghosh et ai  1   calls the case-based module for guidance in choosing rules to use in refining its plans and refining the open-textured predicates that remain when the rules run out. the case-based planner uses the hierarchical planner to help with indexing  controlling adaptations  and combining plans. 
모because law is an adversarial domain  it is useful to have a safe interpretation of the rules  what tax planners refer to as a  safe harbor plan.  if this plan is executed  it will probably be safe from challenge by the government; the more a plan differs from it  the more likely it is to be challenged  and to lose . accordingly  chiron associates a prototype  safe-harbor plan  with each of the hierarchical planner's strategies. 
모chiron uses cases to indicate how much a plan can differ from the prototype. it starts by instantiating the prototype and adapting it only as much as necessary to fit the facts of the current situation. some adaptations consist simply of adding a fact to the prototype; others involve varying the parameters of a given fact. any fact in one of the previous cases can potentially be added to the prototype to make a new plan. similarly  facts can be subtracted from the prototype  and parameters can be varied  as suggested by the cases in the casebase. if the resulting plan is weaker than any of the previous successful cases along some dimension  the system rejects it  unless there is a trend towards weakening cases along that dimension.1 
모the prototype  cases  and adaptations define a space of possible plans for satisfying a rule. in general  the system generates plans that fall between the prototype and previous successful cases of a given strategy. within 
모1 like the other examples in this paper  this one is strictly hypothetical  and not to be relied upon as tax advice. 
모1 for this purpose  a  trend  is defined simply as two cases  one decided earlier than the other  where both decided in favor of the taxpayer  both were weaker than the prototype along a given dimension  and the second was weaker than the first. 
	sanders 	1 
모

1 	chiron's knowledge representation 
chiron's knowledge base includes representations of the internal revenue code and approximately twenty-four cases under various provisions of that statute. it also includes safe harbor plans  or prototypes  that satisfy the rules; a representation of the relationship between the rules  prototypes  and cases; and finally  a representation of the input description of the taxpayer's goals and current situation. 
모chiron has a number of tax-reduction strategies  including  for example  selling a house and buying another to get the 뫫1 rollover  making a charitable donation  and selling a house and taking the 뫫1 exclusion. these strategies can generally be used either individually or in combination. all of these strategies and all of their possible combinations are candidate plans. each strategy corresponds to a leaf node in the hierarchical planner's plan hierarchy  a portion of which is given in figure 1. 
모the rules in the hierarchy are based on statutory provisions: to reduce your taxes  you can reduce your taxable income or find credits; to reduce your taxable income  you can attribute your income to someone else  exclude it  defer it to a later year  or deduct expenses; and so forth. each leaf node  or strategy  corresponds to some open-textured portion of the rules. associated with each leaf node  there is a prototype  a set of deformations  or ways in which the prototype can be adapted  and a set of past cases in which the taxpayer attempted  successfully or unsuccessfully  to satisfy the given rule. cases are represented using a structure that has fields for the name  the official legal citation   short-name  an abbreviated form of the citation for use in text   court  date  facts  strategies involved  and holdings of the case  as well as various indices. information about which features strengthen or weaken a case with regard to a par-
1 	case based reasoning 
ticular strategy is stored separately. 
모the facts of both previous cases and the current situation are represented as lists of propositions  including for each case a precise representation of the facts as given in the official reports for that case and in addition  abstractions from those facts that seem useful  based on the reasoning in each case  other cases  or general domain knowledge. representing this knowledge required features such as space  time  action  permission  obligation  knowledge  belief  and intention  as other researchers in this domain have noted  cuthill and mccartney  1; mccarty  1b . particularly characteristic of united 
states income tax law are transactions: sales  gifts  loans  and other transfers of money or property. in addition  unpredictable idiosyncratic details occur in each new case  such as the fact that the kitchen in a house has a tile floor  or the taxpayer is a war veteran  or the taxpayer has two children  one of whom is ten years old. to represent these facts as accurately as possible  it is necessary to have a representation language that is both flexible and extensible. i chose an extension of the temporal logic developed by shoham in  shoham  1   modified to incorporate the modal operators  know    believe    want   or  goal    and  obligated.  this language is influenced by mcdermott's temporal logic and also by the work of mccarty in representing legal concepts  especially  mccarty  1b . 
모part of the representation of one of chlron's cases is given in figure 1; for the full representation of this case and the original text of the case  see  sanders  1 . 
모associated with each strategy is a prototype. a prototype is represented using the same structure as a case  but with a conservative  safe set of facts  very likely to satisfy the open-textured provisions setting forth that strategy. the prototypes' facts are derived from general domain knowledge  including the commonsense meaning of statutory phrases  treatises  and the cases themselves. in any law case  there are some easy questions that are not at issue  and these questions provide some information about the prototypical case. the prototypes' facts are templates  or lists of generalized fact patterns  in-
stantiated for each situation in which chiron attempts to use them. similarly  in a treatise or regulation  a lawyer would find a generalized plan  with the details of particular cases to be filled in by the lawyer. 
모the relationship between the prototypes and cases is captured in the system's adaptation knowledge. associated with each predicate in chlron's vocabulary is a corn pare-function  which determines whether two facts with that predicate are comparable  matching  or one stronger than the other  with respect to a particular strategy. some facts  where present  are known to strengthen or weaken the taxpayer's case. in some cases  there is domain knowledge concerning how a fact can be made stronger or weaker. where known  this information is also associated with the predicates. a plan can be adapted by changing any of its facts into a stronger or weaker fact or by adding or subtracting facts. 
1 	example 
chiron solves a cluster of problems having to do with 
모
buying  selling  renting  and owning residential housing. many of the provisions of the united states internal revenue code affect these transactions  directly or indirectly. in addition to the general provisions governing sale of capital assets  payment of interest on loans  and so forth  there are special benefits for residential housing. for example  under certain circumstances  the gain from the sale of an individual's principal residence can be deferred or completely excluded from taxation. 뫫뫫1  1. 
모chiron's examples have been chosen in part because they are simple; most tax planners would agree on at least the obvious solutions. in addition  they illustrate problems such as timing and satisfaction of opentextured rules that are typical of the domain. finally  since they all involve transfers of residential housing  the commonsense knowledge that must be formalized to handle them involves the same cluster of concepts. 
모consider a straightforward example: the taxpayer  whose name is greenlee  wants to sell a house. she has owned the house  identified by the token 1-eleventhstreet  since october 1  1  and has occupied the house during that entire period. she is now fifty-two years old. chiron takes as input the internal representation of these facts. 
모next  chiron determines that the current situation involves one type of transaction: a sale of real property in return for some other unspecified type of property. chiron then retrieves the cases in its casebase that also involved a sale of real property. there are four  welch v. commissioner  t.c.m.  p-h  1  1   trisko 
v. commissioner  1 t.c. 1  1   sayre v. united states  1 f.supp. 1  s.d.w.va. 1   and hughston v. commissioner  t.c.m.  p-h  1  1 . 
	sanders 	1 
part of the representation of hughston is shown above in figure 1. 
모these cases suggest three strategies: a 뫫1 exclusion  which permits a taxpayer who is over 1 years old to sell his or her principal residence and exclude part of the gain from tax  if he or she meets certain tests; a rollover  where the taxpayer sells one principal residence and buys another; and a like-kind exchange  where the taxpayer exchanges one piece of property for another similar one. 
모chiron now attempts to construct a plan for each of these strategies in the current situation  starting with the like-kind exchange. it rejects this strategy on the grounds that there is no support for the plan along the dimension  duration-of-occupancy.  the taxpayer has been living in her house for many years. the properties involved in a like-kind exchange must be  held for productive use in a trade or business or for investment....  뫫1. personal use of of the property weakens the taxpayer's case  and there are no cases in chiron's casebase with this weakness  so the system rejects the plan. similarly  it rejects the 뫫1 exclusion  because the statute sets a minimum age of 1 for taking advantage of the provision  the taxpayer is only 1  and there is no case support for a lower age. 
모with regard to the rollover  however  the taxpayer is in a strong position. her case is no weaker  and in some respects stronger  than the prototype for this strategy. as a result  the system suggests the following plan. the taxpayer is advised to live in the house until the date of sale  sell it and buy another on the same date  and occupy the new house immediately. in addition  the taxpayer should have only one residence at the time of sale. this is a very conservative plan  but it can be executed by the taxpayer  given the simple facts of our example  from a tax point of view  at least; the realities of the housing market may make selling more difficult . 
모in support of the plan  the system notes its similarities with the prototype. as in the prototype  greenlee has bought and occupied a house  and she will  if she executes this plan  sell a house that she has been occupying until the date of sale. in both the prototype and the current situation  the taxpayer has one residence at the time of sale. and she has been living in her house longer than the minimal amount of time required by the prototype. finally  the system notes  the time elapsed between the sale of one house and purchase of another  if greenlee follows the plan  will be shorter than that required by the prototype. 
모next  the system prints out a response for the government. it cannot find any weaknesses in the plan  which is indeed quite standard   but it does find a case  welch v. commissioner  in which the taxpayer lost even though in some respects  the taxpayer's plan was even stronger than the prototype. 
모in welch  the system points out  the government won even though the taxpayer had occupied his first residence for seven years  longer than the prototype requires  bought a new piece of property only ten months and 1 days after the sale of his old residence  and occupied the new property a year  eight months  and two days after the sale  both less than the two-year interval allowed by 
1 	case based reasoning 
the prototype. 
모since the government has cited a new case in response  the taxpayer offers a rebuttal. the best rebuttal here would be that welch was decided under an old version of the statute. in the time period covered by this case  the statutory time limit was eighteen months. because the taxpayer's house was not completed within the time limit  he was unable to occupy it until two months afterwards. the prototype case  on the other hand  is within the current statutory time limit. 
모chiron has no means of reasoning about the dynamic nature of statutes  however  so it must look for other distinctions. in addition to some minor differences between the transactions involved in the two cases  the system notes that the current plan is stronger than welch along exactly the dimensions that the government had cited in comparing welch to the prototype: greenlee has lived in her house longer than the taxpayer in welch lived in his  and  if she executes the plan  she will buy and occupy a new house sooner than the taxpayer in welch did. thus  even though the system assumes all its cases are decided under the same version of the statute  it provides strong support for the right conclusion in this case. 
모the system has now considered all the strategies recommended by the case-guided search mechanism and recommended one of them. it reminds the user which strategy was successful  and offers the user a chance to consider other possibilities. from here on  the user can request any strategy or combination of strategies he or she would like the system to consider; requests will be processed in a similar manner. 
1 	related work 
most cbr systems have used a single  best  or  most similar  case as the basis for a solution  see  e.g.   hammond  1; koton  1; sycara  1; kolodner  1  . some systems can adapt and combine pieces of several old cases to solve a problem  sec  e.g.   alterrnan  1; branting  1; redmond  1; zito-wolf and alterrnan  1; mccartney  1; kettler  1    but few have attempted to place the current situation in the context of a group of past cases. 
모the cbr systems that place the current situation in the context of a group of past cases have done so in order to reason about open-textured legal concepts. gardner's program retrieves multiple cases and uses them to determine whether in a given situation a contract has been formed  gardner  1 . both hypo and cabaret also retrieve multiple cases. their case representation is more detailed than gardner's and incorporate dimensions  so that cases can be compared with each other and with the current situation. these comparisons are used as a basis for generating arguments for and against the satisfaction of open-textured concepts  again in a given situation  ashley  1; rissland and skalak  1 . 
모besides using multiple cases  other solutions to the problem of reasoning about open-textured rules have included prototypes  bareiss  1; mccarty  1; 1a ; annotating rules with arguments for and against their application in borderline cases  bench-capon and sergot  1; sergot ei a/.  1 ; and the single  best match  from a set of cases with a rich  detailed semanticnet representation  branting  1 . 
모chiron is the first case-based planner to reason about its plans in the context of a group of previous cases. its solution builds on previous approaches to reasoning about open-textured rules  combining prototypes  cases  dimensions  and arguments for and against the application of the rules. prototypes are particularly useful in a planning system where  unlike legal analysis systems  the facts are not yet known. accordingly  chiron uses prototypes and deformations  or adaptations  corresponding to its open-textured rules. in order to limit the extent to which prototypes can be adapted  it uses cases. each rule corresponds to a prototype and a set of cases in which that rule is interpreted. the cases are related to the prototype  and to each other  by the possible adaptations. in addition  chiron compares the current plan to cases interpreting the same rule in order to generate arguments for and against the plan's success. the system's detailed representation language for the facts of cases supports detailed comparisons and adaptations. none of the previous systems combines all of these features. 
1 	conclusions 
most case-based reasoning systems have used a single  best  or  most similar  case as the basis for a solution. for many problems  however  there is no single exact solution. rather  there is a range of acceptable answers. we use cases not only as a basis for a solution  but also to indicate the boundaries within which a solution can be found. we solve problems by choosing some point within those boundaries. some case-based legal analysis systems have used the technique of placing the current situation within the context of a set of past cases  but it has not been used in a problem-solving system. 
모in this paper  i discuss this use of cases with illustrations from chiron  a system 1 have implemented in the domain of personal income tax planning. chiron uses a prototype  or safe harbor plan  representations of actual legal cases  and hypo-like dimensions to define a space of possible plans and constructs plans to fit within that space. this solution is especially well-suited to adversarial domains  where varying too far from the prototype may cause a plan to be challenged. the basic idea of planning within boundaries could also be translated into a domain without explicit adversaries  such as cooking. 
