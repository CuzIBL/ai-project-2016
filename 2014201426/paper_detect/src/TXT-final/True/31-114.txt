 
diagrammatic reasoning is a type of reasoning in which the primary means of inference is direct manipulation and inspection of a diagram. diagrammatic reasoning is prevalent in human problem solving behavior  especially for problems involving spatial relations among physical objects. our research examines the relationship between diagrammatic and symbolic reasoning in a computational framework. we have built a system  called redraw  that emulates the human capability for reasoning with pictures in civil engineering. the class of structural analysis problems chosen provides a realistic domain whose solution process requires domain-specific knowledge as well as pictorial reasoning skills. we hypothesize that diagrammatic representations provide an environment where inferences about the physical results of proposed structural configurations can take place in a more intuitive manner than that possible through purely symbolic representations. 
1 	introduction 
humans often use diagrams to facilitate problem solving. in many types of problems  including but not limited to problems involving behaviors of physical objects  drawing a diagram is a crucial step in the solution process. a drawing can reveal important information that may not be explicit in a written description  and can help one gain insights into the nature of the problem. though such use of diagrams is an integral part of human problem solving behavior  it has not received nearly as much attention in ai as symbolic reasoning has. 
　one important advantage of diagrammatic representation is that it makes explicit the spatial relations that might require extensive search and numerous inference steps to discover using a symbolic representation. larkin and simon have shown that  even when the information contents of symbolic and diagrammatic representations are equivalent  a diagrammatic representation can offer computational advantage in problems where spatial relations play a prominent role  larkin and simon  1   since humans reason with so much apparent ease in some problems  a program that could reason directly with a diagrammatic representation would be more understandable to the user than a program that reasons exclusively with a purely symbolic representation. in addition  a 
　diagrammatic reasoning program could offer insight into the relation between diagrammatic and symbolic reasoning  and may also be useful in imparting visualization skills to students of various engineering disciplines where such facility is crucial. 
　in this paper  we present our work aimed towards understanding the role of diagrammatic reasoning in problem solving. the problem we chose for studying diagrammatic reasoning is that of determining the deflection shape of a building frame structure under load. we have constructed a computer program called re-
draw  reasoning with drawings  that solves this problem qualitatively using a diagram in a way similar to human engineers. 
1 	roles of diagrams in problem solving 
some research has been done on the roles that diagrammatic reasoning play in human problem solving. novak and bulko  novak and bulko  1  have asserted that a diagram and its annotations serve as a short-term memory device in the problem solving process. such a device allows temporarily-needed information to be retrieved later in the same manner that writing down intermediate results in multiplication problems frees the person to perform further calculations. they also postulate that a diagram may act as a substrate or concept anchor that allows the new part of a problem to be described relative to another well-understood problem. larkin and simon discuss extensively the advantages of diagrams for facilitating inference about topological or geometric relations  larkin and simon  1 . chandrasekaran and narayanan  chandrasekaran and narayanan  1   novak and bulko  novak and bulko  1   and borning  borning  1  have also pointed out the usefulness of diagrams to human problem solvers as a device to aid in visualization   gedanken experiments  or prediction. finally  novak and bulko  novak and bulko  1   and koedinger  koendinger  1  have explored the idea that diagrams may sometimes be used not primarily for making base-level inference  but rather to help in the selection of an appropriate method to solve a problem; that 
	tessler  iwasaki  and law 	1 

is  as an  aid in the organization of cognitive activity  
 chandrasekaran et a/.  1   
   a salient feature of diagrammatic reasoning in many situations is its qualitativeness. people reason with diagrams to get rough  qualitative answers. though they must resort to formal  mathematical techniques for a more precise  quantitative answer  qualitative techniques are extremely useful in gaining valuable insight into the range of possible solutions. an initial qualitative understanding thus obtained can guide later analysis for more detailed answers. in the context of structural analysis  knowing the qualitative deflected shape allows one to identify critical features of the shape. one can then set up relevant equations in order to obtain more precise information such as actual magnitudes of forces and displacements at specific points of interest. 
   how do diagrams actually help civil engineers make qualitative inferences  from studying textbooks on elementary structural analysis  such as  brohn  1   which aim to develop a intuitive understanding of the response of the structure under a load  we find that diagrams fulfill many of the same roles mentioned above. first  diagrams are used as  a visual language of structural behavior that can be understood with the minimum of textual comments   brohn  1 . the language allows engineers to express explicitly the constraints or physical laws that are relevant at each part of the proposed structure  in such a way that the constraints and some of the consequences are immediately apparent without further reasoning. secondly  the diagram serves as a place holder or short-term memory device by allowing engineers to sketch out the result of one deformation and then go back to see if there is a further effect or interaction that needs to be addressed. finally  visual inspection of diagrams guides engineers in choosing the next step  resulting in a more efficient problem solving process than it would be otherwise. redraw uses diagrams in all these capacities in the context of determining the deformation shape of frame structures. 
1 	deflection shape problem 
determining the qualitative deflected shape of a frame structure under load is a crucial step in analyzing the behavior of a structure. figure 1 shows the reasoning steps an engineer may go through using a diagram. she first makes a simple  1-d drawing of the shape of the given frame structure  figure 1 a  . given a load on the structure  she modifies the shape of the structural member under the load  b . she inspects the modified shape to identify the places where constraints for equilibrium of the structure are violated. those constraint violations are corrected by modifying the shape of connected structural members  propagating deflection to other parts of the structure  c . this process is repeated until all the constraints are satisfied  d - f . the drawing thus produced  f  shows the final deflected shape of the frame under the given load. 
　given a diagram of a frame structure and a load  redraw produces an underlying symbolic representation in order to facilitate reasoning about engineering concepts. then the program will use its structural engineering knowledge to propagate constraints on the diagram 
1 	knowledge representation 

of the structure and will inspect and modify this picture until a final shape is produced that represents a stable deflected structure under the given load. 
　as with the qualitative nature of human visual reasoning  the reasoning carried out by redraw is also qualitative. the answer it produces is a picture of a deflected shape. although the resulting picture is qualitatively consonant with the problem solution  it is not  nor does it need to be  mathematically accurate. in fact  the magnitude of deflections in redraw's diagrams is much larger than actual magnitudes. this over-emphasis is done intentionally  since the deflections in actual structures would be too small to see in a simple diagram  and since people almost always exaggerate features of interest when they draw this type of diagrams. 
　redraw solves this type of deflected shape problem by directly manipulating a representation of the shape in a similar manner to that shown above. although the problem could be solved by setting up equations  visualization is the indispensable first step that provides an engineer with intuitive understanding of the behavior of the structure and enables her to recognize a good strategy for further analysis. 
   before describing how redraw analyzes structures  we explain the reasons for choosing this problem. an advantage of this domain for studying the role of visual reasoning in problem solving is the fact that it is rich with domain-specific knowledge that has significant implications on how the diagram is manipulated and interpreted. a number of researchers have studied pictorial reasoning in geometry  where pictures are abstract diagrams and do not represent anything in the real world  koedinger and anderson  1; lindsay  1; mcdougal  1 . in geometry  the only property one reasons about is the geometric property. there are no other types of information  apart from that represented in the diagram  that one must take into account when manipulating and inspecting the diagram. 
　in contrast  pictures used for reasoning in engineering design are not simply abstract geometric shapes but represent things in the real world. furthermore  how a picture is interpreted and manipulated depends substantially on what it is meant to represent. for example  a line in our domain represents a beam or a column 

changing the curvature of a line would change the interpretation of the diagram. in a circuit diagram  on the other hand  one could change the length or curvature of the line representing an electrical connection without affecting its interpretation. for the goal of gaining an insight into the role of visual reasoning in problem solving and its relation to symbolic reasoning  it is important for us to work with a problem requiring a wealth of domain knowledge that has significant influence on the way diagrams are used and interpreted. 
1 	system architecture 
from examining the way deflection shape problems are solved by humans  it is apparent that solving this type of problems requires not only an ability to manipulate and inspect diagrams but also substantial structural engineering knowledge. knowledge about the properties of various types of joints and supports is necessary to identify constraints on the shape for the structure to be in equilibrium. while such knowledge is best represented and manipulated symbolically  information about shapes is best represented as a picture. many types of modification and inspection of the shape are also more easily carried out with a picture. 
　the requirement for both pictorial and non-pictorial representation and reasoning suggests a layered architecture. thus  redraw includes both a symbolic reasoning component  called the structure layer  and a diagrammatic reasoning component  called the diagram layer. figure 1 shows the two-layered architecture schematically. the structure layer contains the knowledge base of structural engineering knowledge about various types of structural members  joints  supports  and the constraints they impose on the structure. it also includes a rule-based inference mechanism to make use of the knowledge. the diagram layer includes an internal representation of the two-dimensional shape of the frame structure as well as a set of operators to manipulate and inspect the shape. 
　the structure layer contains a symbolic representation of domain-specific knowledge. it represents nonvisual information  such as types of joints and equilibrium conditions  as well as heuristic knowledge for controlling the structural analysis process. 
　the diagram layer represents a diagram of the twodimensional shape of a structure. it has operators that  directly act on this representation to allow inspection as well as transformation of the shape. 'these operators correspond to the manipulation and inspection operations people perform frequently and easily with diagrams while solving deflected-shape problems. 
　the internal representation of a diagram is a combination of a bitmap whose elements correspond to each  point  in a picture  and a more symbolic representation where each line is represented by a set of coordinate points. 
　the relations among the diagrammatic objects are quite straightforward. the objects relate to each other in qualitative spatial terms such as connected-to  left  right  above and below. moreover  only those primitive geometric properties  such as whether the angle between two lines them is acute  obtuse or right angle  that are 

easily identified by visual inspection are explicitly represented. 
　there is a close link between the two layers. the system relates the representation of a particular beam in the structure layer to a spline in the diagram layer  and the concept of deflection of a beam to an operation on a spline to transform its shape. likewise  the system is able to identify features of a line  e.g. direction of bending  existence of an inflection point  and to communicate these features to the structure layer. 
　communication between the two layers takes place by sending commands and posting constraints by the structure layer  which is carried out or checked by the diagram layer. there is a translator to mediate the communication. when the structure layer posts a constraint or a command  the translator translates it into a call to a diagram layer operator that can directly act on the representation of the diagram to manipulate or inspect it. the result is again translated back to concepts that the structure layer understands. 
　redraw has successfully analyzed six of the 1 basic deflected shape problems described by allen  allen  1 . an informal evaluation by a civil engineer shows that the program reflects the qualitative reasoning process used in analyzing frame structures  and that it would be useful in helping students and novice engineers learn to solve problems of this type. 
1 	example 
this section describes redraw's problem solving process with the example in figure 1  which is the same problem as the one shown in figure 1. 
given the frame structure of figure 1 a  and load  
load1  	the structure layer  sl  sends a command  
 deflect beam1 in the same direction as the load   which the translator  tr  translates into an operation  bend beam1.pic1 in the negative direction of the ycoordinate.  carrying out this operation will result in the shape shown in figure 1 b . sl infers that since 
     1  x.pic is a reference to the dl object that represents the shape of the sl object  x. 
	tessler  iwasaki  and law 	1 

joints is a rigid joint  beamz and column1 must remain perpendicular to each other at joint1. sl issues a query to test this constraint. the query is translated into  get the angle between beam1pic and column1.pic  at the ends connected by joint1.pic for the diagram layer  dl. the answer  the actual angle between the two lines  is communicated to sl as the answer that the constraint is not satisfied. sl now issues a command to satisfy this constraint while keeping beam1 fixed  which is translated into  make the angle between beam1.pic and column1.pic at joint1.pic 1 degrees without modifying beam1.pic  for dl. carrying out the operation will result in the shape shown in figure 1 c . communication will continue in this manner until all the constraints are satisfied. 
1 	discussion 
the design of redraw is greatly influenced by the ideas of kosslyn  kosslyn  1   and chandrasekaran & narayanan  chandrasekaran and narayanan  1  regarding human cognitive architectures  in which they argue that some types of reasoning are tightly coupled with perception. this idea of  perceptually grounded reasoning  is reflected in the architecture of redraw  which consists of symbolic and diagrammatic layers that are closely coupled. 
　the problem solving approach of redraw is designed to mimic the qualitative structural analysis method of human engineers. from the user's point of view  the design of the program allows one to concentrate on qualitative features of the structure  without requiring the specification of details. the diagrammatic components of the system facilitate the visualization of the particular deformation problem and its likely range of solutions. to aid in this visualization  the diagram layer operators include a  write-over  ability; that is  after a shape transformation  dotted lines show the original structure  just as a person draws a deformation right over the original line rather than create a separate new drawing. displaying the shapes before and after each deformation step allows him to visually inspect and verify the inference process that was used in the shape transformation. 
　since redraw follows a very informal analysis method  it does not work well when the structure becomes more complicated. its most critical shortcoming is that it does not reason explicitly about forces and bending moments underlying the heuristics for determining how the deformation should propagate. as a result  when there are ambiguities due to multiple constraints being applicable to propagate deformation  it cannot resolve the ambiguity or even reason about the real cause of such ambiguity. furthermore  because there is no explicit reasoning about forces and moments  one cannot proceed directly from the informal analysis to a more formal analysis  which would require reasoning about those concepts. to address these shortcomings  we undertook a second implementation of redraw  which is discussed in the following section. 
1 	knowledge representation 
1 	redraw-ii 
redraw-ii solves the same type of structural analysis problems as redraw  employing a more formal analysis technique involving explicit reasoning about force equilibrium  moment equilibrium and the shape  which the structural engineer must consider simultaneously in order to determine the final deflected shape. redrawii draws and manipulates three different diagrams  a force diagram  a bending moment diagram  and a deflected shape diagram  to reason about the subproblems and display the results. 
	because 	of 	the 	more 	formal 	analysis 	method 
redraw-ii employs  redraw-ii's problem solving capability is more general and also more easily extensible than that of the first implementation. however  with respect to diagrammatic reasoning  redraw-ii relies more on symbolic reasoning to solve problems ihan redraw did. in redraw-ii  the diagrammatic information is used more for control purposes than for actually solving a problem  especially for computing the forces and the bending moments. for example  forces are computed by rules in a few of the simplest cases  and by setting up and solving equations for the rest. for a given force  there are a large number of equations that can potentially produce an answer since one can formulate force and moment equilibrium equations for any subpart of the structure containing the location of the force. redraw-ii has heuristics that use diagrammatic information  such as the position of a load on tinstructure or the deformation of a particular member  to determine what equation is most likely to produce an answer for a particular force given the available information. 
1 	d o m a i n - d e p e n d e n c e o f t h e d i a g r a m layer 
in implementing redraw and redraw-ii  we initially intended all the diagrammatic operators  such as bend  rotate and smooth  to be domain- and taskindependent. however  it has become clear that while some operators are domain-independent  others are quite domain- and task-specific. for example  the implementation of the  bend  operator reflects the assumptions implicit in the domain and the task that the curvature of the bent line is large enough so that it can be clearly seen  but not so large that the structural member would appear to be broken. 
　also  the inspection operators we have chosen to implement reflect the nature of the problem and of the domain knowledge we used. for example  most of the constraints in the structure layer are local constraints that apply to a single structural member or a set of members that are connected by a single joint. thus  the inspection operators we have implemented are only those that detect local features of the diagram. in structural analysis. some global features such as symmetry are very useful  though we did not implement the operators for them. a more general-purpose diagrammatic reasoning layer will require a larger set of operators  which must be parameterized to work in a variety of situations. the set must include operators for inspecting and manipulating both local and global features of a diagram and must cover 


figure 1: illustration of the inter-layer communication of redraw for the example problem shown in figure 1. 
	tessler  iwasaki  and law 	1 

the types of operations humans perform frequently and easily with diagrams of many different types. 
1 	related work 
we have previously built a program called qstruc to solve the same deflected shape problem described in this paper  but using a traditional  symbolic ai approach  fruchter et a/.  1 . there is no explicit representation of the shape of a structure in the program. the shape is implicitly represented by the existence of such physical processes as bending  and the qualitative values  positive  negative  zero or unknown  of such parameters as displacements. both redraw and redraw-ii solve problems more efficiently than qstruc. their efficiency is due to the fact that diagrams allow the systems to focus the solution process much better than qstruc  which blindly sets up all applicable equilibrium equations and tries to solve them. our informal evaluation 
of the systems also shows that redraw programs are much more instructive in helping the user to gain intuitive understanding of the physical phenomenon. 
   one of the first pieces of work that took the diagram as an integral part of understanding and solving a physical problem is novak's work on physics problem solving. his system  isaac  solved problems in elementary dynamics novak  1 . isaac read a problem stated in english  generated an internal geometric model of the situation  set up mathematical equations  and solved them to produce an answer. it also drew a diagram to represent the given situation based on the geometric model. though isaac did not actually use the diagram for problem solving  it used it to demonstrate its understanding of the problem to the user. 
   in chandrasekaran and narayanan's work on commonsense visual reasoning  chandrasekaran and narayanan  1   they proposed a visual modalityspecific architecture  using a visual representation scheme  consisting of symbolic representations of the purely visual aspects  shape  color  size  spatial relations  of a given situation at multiple levels of resolution. the visual representation is linked to an underlying analogical representation of a picture so that visual operations performed on the analogical representation are immediately reflected on the visual representation and vice versa. chandrasekaran and narayanan's objective was  to propose a cognitive architecture underlying visual perception and mental imagery that explains analog mental imagery as well as symbolic visual representations   chandrasekaran and narayanan  1 . 
   among the researchers of qualitative physics  forbus was the first one to note the importance of diagrams in solving spatial problems. in his work on qualitative kinematics  he proposed the m d / p v model for representing spatial information  forbus  1; forbus et a/.  1 . his m d / p v model consists of the metric diagram  which contains enough quantitative information to compute geometric features necessary for reasoning  as well as a place vocabulary  which is a set of relations that are appropriate for qualitatively representing  and solving  the particular problem at hand. though  on the surface  our two-layered architecture with the diagram and structure layers seems very similar to the md/pv 
1 	knowledge representation 
model  there are important differences. on one hand  forbus' metric diagram is intended to represent quantitative information of a physical  spatial  situation  and the place vocabulary is a qualitative abstraction of the information in the metric diagram. on the other hand  our diagram layer is intended to represent diagrams used by people for solving problems. whatever physical interpretation that the diagram may have is bestowed upon it by the translator  which relates diagrams to the concepts in the problem domain. the information in the structure layer is not an abstraction of the diagram  but is the conceptual knowledge of the domain of structural analysis required to solve the deflection problems. this difference probably reflects the difference in focus: the main focus of our work is on the use of diagrams as essential medium of problem solving while forbus' focus seems to be on solving qualitative kinematics problems. whether this difference will result in diiferent  degrees of re-usability of the architectures  e.g. relative ease of reusing the problem solving architectures  especially the metric diagram and the diagram layer  for other domains  remains to be seen. 
   the work by decuyper and his colleagues decuyper cl a/.  1   as well as an earlier piece of work by gardin and meltzer  gardin and meltzcr  1   both take a very different approach to reasoning about liquid from those based on symbolic qualitative reasoning. instead of representing a body of liquid or a solid object as one entity as is usually done in symbolic reasoning systems  they represent both types of things as a one- or twodimensional collection of particles. each particle represents a small piece of liquid or solid stuff. they use a two-dimensional array to represent the position of each piece  and simulate the movement of each piece to predict the behavior of the collection. for simulation of the movement  decuyper et al. apply physics laws to each cell  while gardin and meltzer use local rules  which gov* ern the exchange of messages between neighboring particles. by changing the rules restricting the permissible angle between particles  gardin and meltzer can also simulate the behavior of solid objects  such as rods and rings  of different flexibility. as with forbus' metric diagram  their analogical representation is not intended u  be a representation of a diagram but a representation of a model  composed of particles  of a physical situation. their approaches seem promising  especially for reasoning about highly deformable objects. for such problems  relatively simple diagrams such as those used by redraw may not be be very useful  and those that do reflect the situation fairly accurately may be difficult to draw or to manipulate. 
1 	summary and conclusion 
we have described our research on understanding the role of visual reasoning in a concrete problem-solving context. we have built prototype programs that reason qualitatively using diagrams in the same way that people do. our decision to work with the deflection of shape problem in the domain of civil engineering was based on two considerations: first  since we had already built a system to solve the deflection problem using a traditional symbolic approach  we could directly compare the diagrammatic and symbolic reasoning approaches; and secondly  this was a knowledge-rich  real-world domain  which would allow us to study the role of diagrammatic reasoning in solving problems that required both types of reasoning. 
   in addition to examining the role of diagrammatic reasoning in problem solving  we are considering the generality of our work and its extendibility to other areas of technical design such as in architecture and mechanical engineering. larkin and simon  larkin and simon  1  showed that even with a symbolic representation  problem solving efficiency in some cases can be greatly improved by organizing the information in a way that reflects the physical structure of the object represented. by developing a strong understanding of the role that visual reasoning plays in the overall problem-solving process  we hope to construct a general tool that can be used to build diagrammatic reasoning systems in many other problem domains. 
acknowledgments 
this research was supported by the center for integrated 
facility engineering of stanford university as well as by the national science foundation  nsf grant no. iri1. 
