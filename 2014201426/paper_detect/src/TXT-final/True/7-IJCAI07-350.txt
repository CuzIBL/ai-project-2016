
this paper presents a methodology for integrating features within the occupancy grid  og  framework. the og maps provide a dense representation of the environment. in particular they give information for every range measurement projected onto a grid. however independence assumptions between cells during updates as well as not considering sonar models lead to inconsistent maps  which may also lead the robot to take some decisions which may be unsafe or which may introduce an unnecessary overhead of run-time collision avoidance behaviors. feature based maps provide more consistent representation by implicitly considering correlation between cells. but they are sparse due to sparseness of features in a typical environment. this paper provides a method for integrating feature based representations within the standard bayesian framework of og and provides a dense  more accurate and safe representation than standard og methods.
1	introduction
this paper provides a framework by which any number of environment features can be integrated within the og paradigm. og methods provide dense maps but the veracity of these maps is questionable under the duress of sensor noise especially with sonar. for example figure 1 shows a rectangular environment with the corresponding og map overlaid. large deviations from the ground truth are seen essentially because of specular reflection when the conical beam of the sonar is not normal to the surface that it is impinging. it is obvious from figure 1 that some walls have been destroyed by the og map and shown as empty space. a decision taken by the robot based on this map may be prone to danger or at least run time collision avoidance overhead will be increased.

we are thankful to ms. shweta kumari for her help in different phases of completion of this work.﹛﹛there have been two broad methods of overcoming these problems. within the grid-based mapping paradigm  howard and others  howard and kitchen  1  introduced the notion of response grids to alleviate some of the problems due to sonar characteristics. here a grid was updated with a response value if it gave a response in atleast one of the n considered directions. in  thrun 1  a method of finding maximal likelihood maps based on forward sensor models was presented. other authors bypass the og framework to represent sonar data in terms of features. some of the prominent methods include  leonard and whyte 1 . in these methods features in the workspace such as edges and corners are identified from a circular scan of the environment by initially identifying regions of constant depths  rcd . in  strachniss and burgard 1  coverage maps were presented as alternatives to traditional og maps  elfes 1 . though not primarily from the point of view of alleviating sonar noise the method of giving coverage values to cells instead of the traditional occupancy/non occupancy values could mitigate some of the challenges posed by sonar data.

figure 1: a rectangular room with its corresponding og map overlaid based on two scans at places marked s1 and s1. large errors are seen from the ground truth value.
﹛﹛in this paper we present a novel method of integrating features within an og framework and show performance gain of this method  in terms of accuracy and safeness  over the traditional og paradigm in number of runs. as far as
our knowledge goes we have not come across a similar method in literature. hybrid maps  nieto et. al  1  offer a method for integrating features into og but do not make use of the probabilistic framework of og. moreover the method makes use of image data rather than sonar and is disparate from this effort of tackling sonar challenges. the other novelties of this method include its providing a convenient framework of integrating several features within the bayesian update scheme of og. thereby it combines the elegance and ease of og updates with the consistency of feature based mapping. dense og maps that are not subject to sonar errors find several utilities for autonomous navigation using inexpensive sensors.
1	methodology
1	categorizing rcd
consider a sensor moving on a circle of radius r centered at o'  the robot's center. let successive measurement be at an angular spacing of . then the measurement of a plane surface that returns back would have theoretically a difference of dt  r  1-cos . the difference dt between two consecutive scan locations s1 and s1 is shown in figure 1a. the assumption is that as long as a part of the conical wavefront of the transducer hit the surface normally  it is returned back to the transducer. this assumption is along the lines reported in  leonand and whyte 1 . for a corner the difference theoretically would be higher and also varies for every scan  since the corner reflection is returned to the transducer from a single point than from a surface  leonard & whyte  1 . in experiments dt = 1 cm was sufficient to detect wall rcd's from all other readings.

figure 1a: the difference dt
between two successive figure 1b: the minimum scans at s1 and s1  centered number n for a valid at o for a rcd rcd.versus distance
﹛a minimum number n of such successive range measurements z= {z1  z1  ...  zn} that satisfies the threshold criteria is classified as a wall rcd. a plot of this minimum number versus mean distance of the candidate rcd points is shown in fig. 1b. our algorithm extracts only wall rcd's from any circular scan.
1	existence of a wall  computing p we 
the existence of a wall is synonymous with existence of the wall rcd described above. the probability of existence of a wall  p   we   is hence either 1 or 1.
1	existence of a corner  computing p ce 
the probability of existence of a corner is obtained as follows. wall rcds are parameterized as straight lines. the point of intersection of any pair of such lines is computed and denoted as ip in figure 1b. let dc be distance of the closest range measurement z projected on the plane from ip. let distance d1 and d1 be the distances from the corner point to the closest end points of the wall obtained so far.
the probability that a corner exist is given by
p   ce = p              d1   p d1   p dc   1
﹛﹛in other words we say a corner exists if a measurement is obtained that is close enough to nearest end point of the two walls and close enough to the point of intersection of the two walls. based on empirical results we found that above classification scheme never wrongly asserts the existence of a corner when there is none. it asserts the existence of a corner to an accuracy of 1 in 1 if there is actually one. figure 1a shows graph of p d1  versus d1 while 1b shows how d1  d1 and dc are computed. similar graphs are used for computing p d1  and p dc .
1	associating measurement to a wall
here we compute the probability that a measurement z is due to an existing wall  denoted by p z =w /we . given a set of walls w1  w1 ... w and a measurement z  we find the perpendicular distance from z projected on the plane to all the walls. if the perpendicular distance does not intersect the wall segment we then consider the distance to the nearest endpoint of the wall segment. denoting this distance as dw we compute the probability that the measurement z is due to an existing wall as
p z =w /we =    e  1dw考1    	1    1 .
	 	 	1羽考
	 	 
figure 1 shows how dw is computed for two range measurements z1  z1. for z1 the distance to the wall w1 is computed as the perpendicular distance dw1 to the wall and for z1 the dw1 is the distance to the nearest endpoint on w1.
note that  p z =w /we  is computed for a given measurement over all existing walls.
1	associating measurement to corner
here the probability that the measurement is due to an existing corner  p zt = c / ce   is computed. let cr be an existing corner. let pt be the range measurement projected onto the plane. consider a cone of beamwidth  whose central axis connects cr with the robot's position r. if pt lies with this cone then p zt = c / ce  is computed as
p z =cce =   e  1d考corcor1    	1    1
        	    1羽考cor   t
figure 1a	figure 1b	figure 1	figure 1
figure 1a: p   d1 versus d1. similar functions are used for computing p   d1 and p   dc . figure. 1b: figure shows how d1  d1 and dc are measured. the point of intersection of the extended wall segments is denoted as ip  dc is the distance to the point closest to ip. figure 1: shows how distances dw1 and dw1 are measured to two walls based on two measurements z1  z1 centered at s. figure. 1 shows the computation of dcor given a corner cr and a point pt due to a measurement made from swhere dcor is the distance	from pt	to cr  考cor is fixed	at
1cm based on experiments performed. figure 1 shows pt   cr and the computation of dcor.
1	associating measurement to others 
it is p zt = o / oe .note that p oe    the existence of other features  is always 1 in the sense there always is  in the environment  things other than walls and corners. this could be also empty space. since p oe  is always 1 we have :
p zt = o = p zt = o /oe = p zt =w   p zt = c     1 .
here p zt =w  and p zt = c  are given by
p zt =w = p zt =w /we    p zt =we       1 p zt = c = p zt = c / ce    p zt = ce       1
since  1  and  1  are already probability functions in that their values are in  1  it is easy to rewrite  1  as p zt = o   = 1  p zt = c   1  p zt =w      ... 1
1	integration into the og framework
the standard og framework computes the occupancy and non occupancy of relevant cells  each denoted by gxy   under usual independence assumption between cells  given measurements {zt+1  zt }  the most recent being zt+1 as
pgxy / zt  zt+1 = p z t+1 /gxy  z t    p gxy zt      1 .
p zt+1 / zt
we	denote p gxy / zt   in	 1 	as p   	.	under	usual
markovian assumptions p zt+1 / gxy   zt   becomes p zt+1 gxy   and further application of bayes rule on
p z + g  reduces  1  to
p      xy / zt       1 .
here  is a normalization constant which gets cancelled out during analogous computed of p gxyt+1 ; the non occupancy
of cells gxy and subsequent normalization.
﹛﹛in the current paradigm we integrate the existential probabilities of features and the association probabilities of measurements to features by modifying p    in  1  as
p    p gxy / zt =w p zt =w +
p gxy / zt = c p zt = c + p gxy / zt = o   p zt = o       1
note that by this modification the basic recursive nature of  1  is still preserved and can be repeated over any sequence of measurements. however  1  has subtly removed the independence assumption between cells since p zt =w  and p zt = c  do take into consideration the closeness of measurements to features. unlike og paradigm  cells are not always updated where measurements are made but on cells where the features associated with the measurements are most likely. this is elaborated in the following sections.
1 compute p gxy / zt =w 
let pt be the projection of measurement zt. a cone of beam width 1 whose central axis connects the robot's current position to pt is considered. the end point of the conical front is projected onto the associated wall. in figure 1 the end points of the conical front  pc1 and pc1 are projected onto the wall at pw1 and pw1. the extension of pc1 to the wall meets at pwe . the probability function are framed in a manner such that cells on the line from pw1 to pw1 are high in occupancy  from pw1 to pwe are left unupdated  unknown  and remaining cells in the triangle s pw1 pwe are high in unoccupancy probabilities. the probability functions themselves are not shown for conciseness.
are projected on the
extended wall at pw1 and pw1. pc1 extends to pwe on the wall. figure 1: cr is the corner feature. points pt and pc1 get projected on wall w1 at pcr1 and pcr1  while spc1 meets w1 at pce1.
1	computing p gxy / zt = cr  :
the conical front is formed by pc1  pt and pc1 in figure 1. the corner is denoted by cr. w1 and w1 denote the two walls. pc1 and pt are projected onto w1 at pcr1 and pcr1 .
the segment spc1 and spc1 intersect the walls at pce1 and pce1. the cells on the line from cr to pcr1 are updated to probabilities that are high in occupancy. the cells between pcr1 and pce1 and between cr and pce1 are not updated. the remaining cells in the area enclosed by quadrilateral spce1crpce1 are updated so that their non-occupancy probability is high.
1 computing p gxy / zt = o :
this is the routine og update for all cells within the conical front of the sonar  elfes 1 thrun 1 . when zt is associated with a feature  p zt = o  tends to zero and the contribution of p gxy / zt =o  in  1  is negligible. when
p zt = o  is dominant the update of cell probabilities is delayed by one or more time instants. this delay helps to ascertain more certainly if there are no features around the cells corresponding to zt . there can arise four situations:
 i  if a feature is formed in the immediate instants around cells corresponding to the previous reading zt it gets associated with the features and updated as mentioned in previous sections.  ii  if features are formed but they are hiding the cells of zt   zt will be considered as outlier and cells beyond the feature up to zt are left as unknown.  iii  if in next few instants zt cannot be associated with any feature though there are some features found in a wider conical neighborhood of that direction  then  only nonoccupancy will be updated up to a safe line  which is the line joining the ends of those neighbors' features  as shown encircled in figure 1. strict space limits prevent further elaboration.  iv  otherwise routine og update takes place. this delayed update takes care of several inconsistencies  by suspending the og behavior for sometime and by detecting outliers/noisy readings  that otherwise occur when a reading

figures 1a and 1b: overlapping rcds get associated as in 1a.
﹛non overlapping rcds as in 1b are retained as such corresponding to a feature is updated in the standard og sense.
1	associating rcd's:
every new 1 scan results in new rcd's as well as rcd's that need to be associated with previous ones. two rcd's are associated if their line segment  walls  fitted on them intersect at angles less than 1 degrees. in such a case the wall that was obtained at closer range from the robot is taken as the feature and points on the other wall are associated with this one and updated as mentioned before. rcd's that are separated by some spacing between them are not explicitly associated with one another. in figure 1a 1 rcd's are associated because of overlap and the wall gets extended. the 1 rcds in figure 1b are not associated due to spacing between them and treated as independent walls.
1	experimental results and analysis
figure 1 is the map obtained by the current method of integrating features with the og paradigm for the same rectangular environment of figure 1  with the scans taken exactly at the same locations. the performance gain of the current method is apparent as the map of figure 1 is significantly closer to the ground truth. the resolution of every cell in this and subsequent maps is a 1cm1 area. figures 1a and 1b show two portions of a corridor as it bends around a corner that is not at right angles to the right shown by an arrow in 1a. figure 1b also shows a water cooler/fountain while 1a shows a trashcan on the right. the maps obtained by the og and current methods are shown in 1a and 1b. once again the performance gain of the current method is evident as 1b is much closer to the ground truth vis-角-vis 1a. the corridors corresponding to 1a and 1b are marked a and b in fig. 1a. also the region near the fountain is marked as f and the trash can as t in fig. 1b. figure1c shows a corridor studded with cartons  1a its og map and 1c the enhancement with current method.

figure 1: map obtained by current method corresponding to the environment of figure 1.
a more rigorous scheme for comparing performances of the two methods is developed here. the actual map is overlaidmethods. the actual map is compared with the two methods through a scheme that assigns error levels/values as shown in table 1. test1  table 1  finds if there is at least 1 occupied cell in the immediate neighborhood of the current cell  in the obtained map  while test1 does the same in the original map. based on these assignments an error level greater than or equal to 1 are dangerous  for they show cells that are occupied or unknown as unoccupied. a robot visiting those cells based on these assignments is prone to collide with objects or will have run time collision avoidance overheads. maps will be less accurate if neither the cell nor its neighbors resemble the original cells' states. a map will have exploration overhead if regions which should be known from a specific set of scans are still remaining as unknown. this will be slightly more in the present method because it finds out noisy readings as outliers and updates only till features  leaving some cells unknown as mentioned in 1
figures 1a and 1b show the error plots for the maps of figure 1 and figure 1. in these plots areas shown in white are those that have been mapped accurately and have no errors. areas that are shown in dark shades of gray have the highest errors and danger levels of 1 & 1. they are significantly lesser for the current method vis-角-vis og paradigm. the
figures 1a-1b  row 1   1a-1b  row 1  : 1a: : the map obtained by og method for 1a 1b. the corridors corresponding to 1a and 1b are shown marked a and b.1b: map obtained by the present method. the cooler  f  and trashcan  t  regions  shown by solid arrows are correctly detected by present method. the path of the robot is shown by dashed arrows.
1a & 1b:the maps obtained by og and present methods for 1c.the door d   shown by solid arrow  and the zig-zag nature of the environment have been correctly retained by present method.
ascendancy of danger levels from white to black is shown though the danger level indices in the middle gray-level bar. figures 1c and 1d show the histogram plots at error levels


figures 1a-1d  1st row   1a-1d  1nd row : 1a: the error plot for the map of figure 1. violet corresponds to error level 1 while maroon error level 1. 1b: error plot for the map of figure 1. 1c: histogram error plot for map in figure 1. abscissa represents error levels and ordinate number of unit cm1 cells. 1d: histogram error for map in figure 1.
figures 1a-1d: 1a: error plot for the map in figure 1a obtained by og method. 1b: error plot for map in figure 1b obtained by current method. 1c: histogram error plot for map in figure 1a. 1d: histogram error for map in figure 1b.table 1:error levels er.  and their interpretation for cell to cell correspondence between the obtained map and the actual map. here expl. stands for exploration.
1 to 1 for the maps of figures 1 and 1. figures 1a and 1b depict the error plots for the maps in 1a and 1b  1c and 1d are the error histograms of these maps.

table 1 : number of cells in different zones & sub-zones by both methods  for different environments. z1 = accurate  z1 = safe  z1 = exploration overhead  z1 = less accuracy  for safe zone cells only   z1 = danger. reduction in danger regions based on z1 is at-least 1% by present method.
﹛﹛table 1 shows corresponding values as follows. the dangerous cells  z1 in table 1 corresponding to error levels   1 in table 1  are at-least 1 to 1 times higher in the og methods over the current method. overall at-least 1% of the danger regions have been reduced by the current method  last column shows the percentage reduction of danger cells . the table also shows the number of cells classified as accurate  z1  to be more in the present method. the number of cells with exploration overhead is slightly higher in the current method due to reasons mentioned before. the number of cells with error levels less than 1  those that belong to safe zone or z1=z1+z1+z1  is once again higher for the present method. the number of overall inaccurate cells  z1+z1  is significantly lesser by current method. note that all cells in danger zone are also inaccurate. in absolute terms there are at-least 1 x 1 more number of cells of 1cm1 area that are mapped wrongly in the og paradigm when compared with the current method for the rectangular environment. this number is even higher for the corridor environments. the performance gain of the current method was of the same order for various other experimental runs on our robot on diverse environments that are not reported here for brevity.
1	retrospection
the reasons for enhanced performance of the current method are attributed to the following. firstly by associating measurements to known features; the updates of p gxy / zt = c   and p gxy / zt =w  are very different from the standard og update; the physics of the sonar is being accounted for more in the current method. typically at corners and at walls that are not at right angles to the conical front of the transmitted beam the measurement errors are significant due to specular and possibly multiple reflections. by understanding the presence of features at those locations through the rcd and by associating future measurements to those features the error is considerably reduced  consistency with ground truth increased. secondly associating measurements to features also implicitly takes care to certain degree what is often called the bane of the og paradigm; independence assumption between neighboring cells. thirdly the method of delayed update  mentioned before  of measurements not associated to any features at the current instant overcomes the inconsistencies that arise when a measurement that actually is due to a feature is updated as such. delayed update reduces inconsistencies that depict cells occupied behind features that should actually be depicted as unknown.
1 conclusions
this paper has presented a method of overcoming some of the limitations of the og paradigm which get pronounced especially with sonar data without sacrificing the elegancy associated with the og method in the form of bayesian updates. this it does by integrating features within the og updates thereby alleviating problems associated with the peculiarities of sonar range data. from an og perspective the method captures the physics of the sonar by initially identifying existence of features. by associating future measurements to these features it mitigates the chief problem of og albeit implicitly; the independence assumption between neighboring cells during updates. the nature of the formulation presented is such that any number of features can be integrated within the og paradigm. also since it enhances the performance of og and also extracts and uses the features like wall and corners  so any method of slam either based on feature or og can perform with more accuracy. extensive experiments and analysis reported confirm the performance gain of the current approach over the traditional og method of building maps.
