nonlinear planning: a rigorous reconstruction 
david chapman 
mit artificial intelligence laboratory 1 technology square room 1 cambridge. ma 1 
net zvonafumlt-mc.arpa 
   
   the problem of achieving several goals simultaneously lias been central to domain-independent planning research  the nonlinear constraint-posting approach has been most successful previous planners of this type ''. 1  1. f  have been complicated  heuristic  and ill-defined. 1 have combined and distilled the state 
of the art into a simple  precise  implemented algorithm  tweak  which i have proved correct and complete the simplicity and rigor of this algorithm illuminate the workings of previous planners  the range of applicability of current planning technology  and suggest future directions for research. this paper presents the mathematical foundations for non-linear planning; due to space limitations  i have omitted proofs  some detail  and much discussion these appear in 1 
   this paper begins by presenting a series of necessarily dry and obvious definitions  leading up to that of a plan that solves a problem 1 present a  truth criterion which provides an efficient means ol analyzing a plan to determine when a proposition will be true in the world as the plan is executed. the truth criterion also provides a wa  of making a plan achieve a goal  and this is the basis of the tweak algorithm finally 1 state a completeness correctness theorem and present conclusions. 
   tweak is a constraint posting planner constraint posting is the definition of an object  a plan in this case  by successively specifying more and more partial descriptions it must fit alternatively  constraint posting can be viewed as a search strategy in which rather than generating and testing specific alternatives  chunks of the search space are progressively removed from consideration by const raints that rule them out  until finally every remaining alternative is satisfactory. the advantage of the const ramt posting approach is that properties of the object being searcher! for do not have to be chosen until a reasoned decision can be made this reduction of arbitrary choice oft.en reduces the amount of backtracking necessarv. 
   this report describes research done at the artificial intelligence laboratory of the massachusetts institute of technology. support for the laboratory's artificial intelligence research has been provided in part by the advanced hesearch projects agency of the department of defense under office of naval hesearch contract n  1  1-c-1  1. in part by national science foundation grants mcs-1 and mcs-1.ro and in part by the ibm corporation. the views and conclusions contained in this document are those of the author  and should not be interpreted as representing the policies  either expressed or implied  of the department of defense  of the national science foundation  or of the ibm corporation 
   as tweak works on a problem  it has at all times an incomplete plan  which is a partial specification of a plan that may solve the problem this incomplete plan could be completed m many different ways  depending on what constraints are added to it. thus it represents a class of complete plans the incomplete plan supplies partial knowledge of the complete plan that will eventually be chosen; ideally all possible completions of the current plan should solve the given problem 1 will say  necessarily foo  if foo is true of all possible completions of the current plan  and  possibly foo  if foo is true of some completion of the current plan. 
   a complete plan is a total ' time  order on a set of steps  which represent actions the plan is executed by performing the actions corresponding to the steps in the order given a step has a set of preconditions  which are1 things that must be true about the world for it to be possible to execute the action a step also has postconditions  which are things that will be true about the world after the corresponding action has been executed. pre- and postconditions are both expressed as propositions propositions can be positive or negative  and have a content  which is a tuple of elements elements can be variables or constants functions  proposit lonal operators and quantification are not allowed. 
   plans in tweak can be incomplete m two ways; the time order may be incompletely specified  using temporal constraints  and steps may be incompletely specified  using codesignation constraints a temporal constraint is a requirement that one step be before another; thus a set of temporal constraints is simply a partial order on steps a completion of a set of temporal constraints c is any total order o on the same set of steps such that act implies sot. 
   codesignation is an equivalence relation on variables and constants in a complete plan  each variable that appears in a preor postcondition must be constrained codesignat ing with a specific constant. in execution  that constant will be substituted for the variable when the action is performed. distinct constants may not codesignate two propositions codesignate if both are positive or both are negative and if their contents are of the same length and if corresponding elements in the contents codesignate 
   tweak represents the state of the world as a set of propositions. this set changes as steps are executed a plan has an initial situation  which is a set of propositions describing the world at the time that the plan is to be executed associated with each step in a plan is its input situation  which is the set of propositions that are true in the world just before it  is executed  and its output situation  which is the set of propositions that are true in the world just after it is executed. in a complete plan  the input  situation of each step  is required to be the same set as the output situation of the previous step. the final situation of a plan has the same set of propositions in it as the output situation of the last step. the time order extends to situations: the initial and final situations are before and after every other situation respectively. the input situation of a step is before the step and after every other situation that is before the step; the output situation of a step is after the step and before any other situation that is after the step. 
   say that a proposition is true in a situation if it codesignates with a proposition that is a member of the situation say that  a step asserts a proposition in its output situation if the proposition codesignates with a postcondition of the step say that a proposition is asserted in the initial situation if it true in that situation a proposition is denied in a situation if another proposition with codesignating content but opposite truth value is asserted there  it's illegal for a proposition to be both asserted and denied in a situation 
   a step can be executed only if all its preconditions are in true in its input situation. in this case  the output situation is just the input situation minus any propositions denied the step  plus any propositions asserted by the step. this model of execution does not allow for indirect or implied effects of actions  any changes in the world must be explicitly mentioned as postconditions. 
   j will now sketch the derivation of a criterion for when a 
   proposition is necessarily true in a situation of course a propo-
sition is necessarily true in situation if it is necessarily asserted in it  once a proposition has been asserted  it remains true until denied thus a proposition p is necessarily true in a situation if there is some previous situation in which it is necessarily true  and there is no possibly intervening step that possibly denies it for if there is a step that is even possibly inbetween that even possibly denies p. there is a completion in which the step actually is inbetween and actually denies p  a step possibly denies p by denying a proposition q which possibly codesignates with p  the converse of this criterion is not true; this plan illustrates an exception: 

if p and q are possibly  ' c designating  this plan has two classes of completions: one in which p and q actually codesignate  in which case p is asserted by step 1; and one in which p and q are noncodesignatmg  so that p is asserted by step 1. and is never denied in either case  p is true in the final situation  even though no step necessarily asserts p without an intervening step possibly denying it the complete criterion is as follows 
truth criterion: a proposition p is necessarily true in a situation s iff two conditions hold: there is a situation t necessarily equal or previous to s in which p is necessarily asserted; and for every step c possibly before s and every proposition q possibly codesignating with p which c possibly denies  there is a step w 
d. chapman 1 
necessarily between c and s which asserts r  a proposition such that r and p codesignate whenever p and q codesignate the criterion for possible truth is exactly analogous  with all the modalities switched  read  necessary  for ''possible'' and vice versa  
   this criterion can be computed in polynomial time  though it does exponentially much  work  by describing properties of the exponentially large set of completions of a plan. the remainder of tweak depends heavily on this theorem; its proof is surprisingly complex. jt can be usefully viewed as a completeness/soundness theorem for a version of the situation calculus 
   now i will define problems and their solutions. a problem is an initial situation and a final situation  which are two sets of propositions a plan for a problem is a plan every proposition of whose initial situation is true in the initial situation of the problem a goal is a proposition which must be achieved  true  in a certain situation the goals of a plan for a problem are defined to be the propositions in the final situation of the problem which must be true in the final situation of the plan  and the preconditions of steps in the plan  which must be true in the corresponding input situations a complete plan for a problem solves the problem if all its goals are achieved thus  a complete plan solves a problem if it can be executed in the initial situation of the problem and if the final situation of the problem is a correct partial description of the world after execution the aim of tweak is to produce a plan that  necessarily solves the problem it is given this plan may be incomplete in this case any of its completions may be chosen for execution. 
   tweak's contract is to produce a plan for a specific problem it is given tweak has at all times an incomplete plan  initially null  which is an approximation to a plan that solves the problem. the top-level loop of the planner nondeterministically chooses a goal that is not already achieved and uses a procedure which j will now describe to make the plan achieve that goal 
   the goal-achievement procedure is derived by interpreting the truth criterion as a nondetermmistic procedure universal quantification over a set becomes iteration over that set. existential quantification a nondetermmistic choice from a set; disjunction a simple nondetermmistic choice; and conjunction several things that must all be done also  an existentially quantified situation can be satisfied b  nondeterministically choosing either an existing situation in the plan or a situation belonging to a newly added step the newly added step must represent an action that is possible to execute in the domain in which the problem is specified  the choice is among those that are allowed in the domain and that possibly assert  the desired goal 
   to make a situation be before another or to make two propositions codesignating or not codesignating. the procedure just adds constraints. these constraints may be incompatible with existing constraints; for example  you can't constrain a before / if 
you have already constrained / before  s. the constraint maintenance mechanism signals failure in such cases  and the top-level control structure backtracks since the set of things of things possibly asserted in a situation can not be changed  to make a proposition necessarily asserted there  the procedure constrains codesignation of the given proposition with one of those asserted 1 d. chapman 

   because the truth criterion is sufficient as well as necessary  this achievement procedure encompasses all the ways to make a 
   plan achieve a goal in this respect tweak can not. be improved upon. 
   step addition adds new preconditions to the plan that need to be achieved  and the added step may also deny  and so undo  previously achieved goals therefore. tweak tries to avoid step addition. this is not always successful there are three possible outcomes to planning: success  in which a plan is found; failure  when the planner has exhaustively searched the space of sequences of plan modification operations  and every branch fails; and nontermination  when the plan grows larger and larger and more and more operations are applied to it  but it never converges to solve the problem 
the central theorem of this paper is the following 
correctness/completeness theorem: if tweak  given a problem  terminates claiming a solution  the plan it produces does in fact solve the problem. if tweak returns signalling failure or does not halt  there is no solution to the problem 
the theorem follows easily from the truth criterion 
   the rigor of tweak's formulation has several uses previous planning research becomes substantially clearer when analyzed with the tools built in constructing tweak in  1   present a detailed history of planning  showing that the classic planners are more similar than has previously been realized 
   another use of this rigor is that the range of applicability of state-of-the-art planning techniques becomes clear the correctness of tweak and similar planners depends crucially on details of the representation of actions. useful extensions to this representation  such as range restrictions for variables  non-atomic propositions  derived effects of actions  actions whose effects depend on the situation m which the are applied  and changes in the world due to agencies other than execution of the constructed plan  invalidate the truth criterion  and so the correctness of tweak. there seems to be no simple way to extend the criterion to accommodate these effects the difficulty is just that of the mccarthy frame problem 1 ; my thesis suggests an approach to its solution 
acknowlegements 
   this paper incorporates suggestions phil agre  steve ragley  alan bawden  mike brady  gary drescher. margaret fleck. walter hamscher  scott layson  david mc.allester  kent pitman. 
charles rich  mark shirley. reid simmons  and dan weld 
