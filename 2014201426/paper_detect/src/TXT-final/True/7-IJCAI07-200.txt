
mechanisms for dividing a set of goods amongst a number of autonomous agents need to balance efficiency and fairness requirements. a common interpretation of fairness is envy-freeness  while efficiency is usually understood as yielding maximal overall utility. we show how to set up a distributed negotiation framework that will allow a group of agents to reach an allocation of goods that is both efficient and envy-free.
1 introduction
there are often two opposing requirements that we apply when judging the quality of an allocation of goods to a number of autonomous agents: efficiency and fairness  moulin  1 . while the quest for economically efficient outcomes is well aligned with the highly successful approach of modelling agents as rational players in the game-theoreticalsense  fairness is much more elusive and has generally achieved far less attention in the ai community  but recent exceptions include  for instance  the work of bouveret and lang   endriss et al.   and lipton et al.  .
모in this paper  we interpret fairness as envy-freeness. an allocation of goods is envy-free if no agent would prefer to receive the bundle assigned to one of its peers rather than its own  brams and taylor  1 . efficiency is interpreted as maximising utilitarian social welfare  i.e. as maximising the sum of the utilities of the individual agents  moulin  1 . we are interested in identifying those efficient allocations of goods to agents that are also envy-free. more specifically  we are interested in reaching such allocations by means of a distributed negotiation process  sandholm  1; endriss et al.  1; dunne et al.  1 . that is  rather than developinga  centralised  algorithmto compute such an allocation  we want agents to be able to reach the desired state in an interactive manner by means of a sequence of deals they negotiate locally  driven by their own interests and without regard for the global optimisation problem.
모the paper is organised as follows. in section 1 we review the distributed negotiation framework adopted. section 1 formally defines the concept of envy-freeness and gives a proof for the existence of efficient envy-free states in the presence of money  for the case of supermodular valuations. section 1 discusses how to reach such states by means of distributed negotiation. we prove a general convergence theorem for supermodular valuations  and show that very simple deals over one resource at a time suffice to guarantee convergence in the modular case. next  to be able to study how envy evolves over the course of a negotiation process  we introduce different metrics for the degree of envy in section 1. we have used these metrics in a number of experiments aimed at analysing how envy evolves in modular domains. the results of these experiments are reported in section 1. section 1 concludes.
1 distributed negotiation settings
in this section  we briefly review the distributed negotiation framework we adopt in this paper  endriss et al.  1 .
1 basic definitions
let a = {1..n} be a finite set of agents and let r be a finite set of indivisible resources  which we also refer to as goods . an allocation is a partitioning of the items in r amongst the agents in a  i.e. each good must be owned by exactly one agent . as an example  allocation a  defined via a i  = {r1} and a j  = {r1 r1}  would allocate r1 to agent i  and r1 and r1 to agent j. the interests of individual agents i 뫍 a are modelled using valuation functions vi : 1r 뫸 r  mapping bundles of goods to real numbers. throughout this paper  we shall make the assumption that all valuations vi are normalised in the sense that vi {}  = 1. technically  this is not a significant restriction  but it greatly eases presentation. we sometimes use vi a  as a shorthand for vi a i    the value agent i assigns to the bundle received in allocation a.
모agents negotiate sequences of deals to improve their own welfare. a deal is a pair of allocations  with
   specifying the situation before and afterwards. observe that a single deal may involve the reassignment of any number of goods amongst any number of agents. a 1-deal is a deal involving only a single resource  and hence only two agents . the set of agents involved in the deal 붻 is denoted as a붻. deals may be accompanied by monetary side payments to allow agents to compensate others for otherwise disadvantageous deals. this is modelled using so-called payment functions  pfs : p : a 뫸 r  which are required to satisfy. a positive value p i  indicates that agent i pays money  while a negative value means that the agent receives money. we associate each allocation a that is reached in a sequence of deals with a function 뷇 : a 뫸 r mapping agents to the sum of payments they have made so far  i.e. we also have. a state of the system is a pair  a 뷇  of an allocation a and a payment balance 뷇.
모each agent i 뫍 a is also equipped with a utility function ui : 1r 뫄 r 뫸 r mapping pairs of bundles and previous payments to real numbers. these are fully determined by the valuation functions: ui r x  = vi r    x. that is  utilities are quasi-linear: they are linear in the monetary component  but the valuation over bundles of goods may be any set function. for example  ui a i  뷇 i   is the utility of agent i in state  a 뷇   while ui a j  뷇 j   is the utility that i would experience if it were to swap places with j  in terms of both the bundle owned  and the sum of payments made so far .
1 individual rationality and efficiency
agents are assumed to only negotiate individually rational  ir  deals  i.e. deals that benefit everyone involved:
definition 1  ir deals  a deal is called individually rational iff there exists a payment function p such that  for all agents i 뫍 a  except possibly
 i  = 1	.
while negotiation is driven by the individual preferences of agents  we are interested in reaching states that are attractive from a  social  point of view. a common metric for efficiency is  utilitarian  social welfare  moulin  1 :
definition 1  social welfare  the social welfare of an allocation a is defined as.
we also speak of the social welfare of a state  a 뷇 . as the sum of all 뷇 i  is always 1  the two notions coincide  i.e. it does not matter whether we define social welfare in terms of valuations or in terms of utilities. a state/allocation with maximal social welfare is called efficient. a central result in distributed negotiation is due to sandholm :
theorem 1  convergence  any sequence of ir deals will eventually result in an efficient allocation of goods.
this result guarantees that agents can agree on any sequence of deals meeting the ir condition without getting stuck in a local optimum; and there can be no infinite sequence of ir deals. on the downside  this result presupposes that agents are able to negotiate complex multilateral deals between any number of agents and involving any number of goods.
모a valuation function v is modular iff v r1 뫋 r1  = v r1 +v r1  v r1뫌r1  for all bundles r1 r1   r. in modular domains  we can get a much stronger convergence result  endriss et al.  1 :
theorem 1  simple convergence  if all valuation functions are modular  then any sequence of ir 1-deals will eventually result in an efficient allocation of goods.
1 payment functions
requiring deals to be ir puts restrictions on what deals are possible at all and it limits the range of possible payments  but it does not determine the precise side payments to be made. this is a matter to be negotiated by the participating agents. estivie et al.  introduce several concrete payment functionsthat agents may choose to adopt. the two simplest ones are the locally uniform payment function  lupf  and the globally uniform payment function  gupf .
모choosing a pf amounts to choosing how to distribute the social surplus generated by a deal 붻 =
. it is known that the social surplus is positive iff 붻 is ir  endriss et al.  1 . the lupf divides this amount equally amongst the participating agents a붻; the gupf divides it equally amongst all agents a:
lupf: if i 뫍 a붻 and 1 otherwise gupf: 
1 envy-freeness
an important aspect of fairness is the absence of envy  brams and taylor  1 . in this section  we give two definitions of envy-freeness: the first applies to allocations of goods alone  while the second also takes previous payments into account. while the first may be in conflict with efficiency requirements  for the second definition there always exists a negotiation state that is both efficient and envy-free.
1 envy-free allocations of goods
in the context of our negotiation framework  the concept of envy-freeness can be formally defined as follows:
definition 1  envy-freeness  an allocation a is called envy-free iff vi a i   뫟 vi a j   for all agents i j 뫍 a.
observe that  were we not to require that all goods be allocated  it would be easy to find an envy-free allocation: simply allocate the empty bundle to each agent. on the other hand  it is well-known that if we either require all goods to be allocated  so-called complete allocations   or if we restrict interest to allocations that are pareto optimal  then an envy-free allocation may not always exist  just think of the case of two agents and a single good . bouveret and lang  have investigated the computational complexity of checking whether a given negotiation problem admits an allocation that is envyfree. one of the simpler results states that checking whether there exists a complete and envy-free allocation is np-hard  even if there are only two agents and these agents use the same dichotomous and monotonic valuation function.1
1 envy-freeness in the presence of money
definition 1 is the standard definition of envy-freeness which applies to domains without transferable utility; that is  it does not  yet  take the monetary component of our negotiation framework into account. next  we define envy-freeness with respect to full negotiation states:
definition 1  ef states  a state  a 뷇  is called envy-free iff ui a i  뷇 i   뫟 ui a j  뷇 j   for all agents i j 뫍 a.
a state that is both efficient and envy-free is called an eef state. this corresponds to pareto optimal and envy-free allocations without money.
모how does the move to a definition that explicitly accounts for payments affect the existence of envy-free states  in fact  in the presence of money  states that are both efficient and envy-free are known to always exist  alkan et al.  1 . while the proof given by alkan et al. is rather involved  in the case of supermodular valuations we can give a very simple existence argument. a valuation v is supermodular iff v r1 뫋 r1  뫟 v r1  + v r1    v r1 뫌 r1  for all bundles r1 r1   r. we show a proof here  as this will be helpful in following some of the material later on  cf. section 1 .
theorem 1  existence of eef states  if all valuations are supermodular  then an eef state always exists.
proof. there clearly always exists an allocation that is efficient: some allocation must yield a maximal sum of individual valuations. let a  be such an efficient allocation. we show that a payment balance 뷇  can be arranged such that the state  a  뷇   is eef. define 뷇  i  for each agent i: 뷇  i 	=	vi a     sw a  /n
first  note that 뷇  is a valid payment balance: the 뷇  i  do indeed sum up to 1. now let i j 뫍 a be any two agents in the system. we show that i does not envy j in state  a  뷇  . as a  is efficient  giving both a  i  and a  j  to i will not increase social welfare any further:
     vi a  i   + vj a  j   뫟 vi a  i  뫋 a  j   as vi is assumed to be supermodular  this entails: vi a  i   + vj a  j   뫟 vi a  i   + vi a  j  
adding sw a  /n to both sides of this inequation  together with some simple rearrangements  yields ui a  i  뷇  i   뫟 ui a  j  뷇  j    i.e. agent i does indeed not envy agent j. hence   a  뷇   is not only efficient  but also envy-free. 
this is an encouraging result: for the definitions adopted in this paper  efficiency and fairness are compatible. however  the mere existence of an eef state alone is not sufficient in the context of negotiation amongst autonomous agents. why should rational decision-makers accept the allocation and payments prescribed by the proof of theorem 1  and even if they do  how can we compute them in practice  just finding an efficient allocation is already known to be np-hard  rothkopf et al.  1 . finally  as argued in the introduction  we are interested in a distributed procedure  where agents identify the optimal state in an interactive manner.
1 reaching efficient envy-free states
in this section  we discuss to what extent eef states can be reached by means of negotiation in a distributed manner.
1 envy-freeness and individual rationality
in the previous section  we have seen that envy-freeness and efficiency are compatible in our framework. however  this does not necessarily mean that also envy-freeness and individual rationality will be compatible. and indeed  the following example  involving two agents and just a single resource  shows that this is not the case:
	v1 {r}  = 1	v1 {r}  = 1
suppose agent 1 holds r in the initial allocation a1. there is only a single possible deal  which amounts to passing r to agent 1  and which will result in the efficient allocation a . how should payments be arranged  to ensure that the deal is ir for both agents  agent 1 should pay agent 1 any amount in the open interval  1 . on the other hand  to ensure that the final state is envy-free  agent 1 should pay any amount in the closed interval  1.1 . the two intervals do not overlap. this means that  while we will be able to reach negotiation outcomes that are eef  it is simply not possible in all cases to do so by means of a process that is fully ir.
모for the procedure proposed in the sequel  we are going to circumvent this problem by introducing a one-off initial payment that may not be ir for all the agents involved: 뷇1 i 	=	vi a1    sw a1 /n
that is  each agent has to first pay an amount equivalent to their valuation of the initial allocation a1  and will then receive an equal share of the social welfare as a kick-back. we refer to this as making an initial equitability payment. note that this payment does not achieve envy-freeness  and it does not affect efficiency at all . all it does is to  level the playing field . in the special case where none of the agents has an interest in the goods they hold initially  vi a1  = 1 for all i 뫍 a   the initial payments reduce to 1.
1 convergence in supermodular domains
we are now going to prove a central result on the reachability of eef states by means of distributed negotiation. the result applies to supermodular domains and assumes that initial equitability payments have been made. it states that  if agents only implement deals that are individually rational  ir  and they use the globally uniform payment function  gupf  each time to determine the exact payments  then negotiation will eventually terminate  i.e. no more such deals will be possible  and the final state reached will be both efficient and envy-free  eef . importantly this will be the case whichever deals  that are meeting these conditions the agents choose to implement  i.e. we can never get stuck in a local optimum. in short:
theorem 1  convergence with gupf  if all valuations are supermodular and if initial equitability payments have been made  then any sequence of ir deals using the gupf will eventually result in an eef state.
proof. we first show that the following invariant will be true for every state  a 뷇  and every agent i  provided that agents only negotiate ir deals using the gupf:
	뷇 i 	=	vi a    sw a /n	 1 
our proof proceeds by induction over the number of deals negotiated. as we assume that initial equitability payments have been made  claim  1  will certainly be true for the initial state  a1 뷇1 . now let and assume  1  holds for a and the associated payment balance 뷇. we obtain the payment balance 뷇 associated with a by adding the appropriate gupf payments to 뷇:


this proves our claim  1 . now  theorem 1 shows that negotiation via ir deals  whichever pf is used  must eventually terminate and that the final allocation will be efficient. let a  be that allocation  and let 뷇  be the associated payment balance. equation  1  also applies to  a  뷇  . but as we have already seen in the proof of theorem 1  the efficiency of a  together with equation  1  applied to  a  뷇   implies that  a  뷇   must be an eef state. 
theorem 1 may seem surprising. as pointed out elsewhere  endriss et al.  1   it is not possible to define a  local  criterion for the acceptability of deals  which can be checked taking only the utilities of the agents involved into account  that would guarantee that a sequence of such deals always converges to an envy-free state. we circumvent this problem here by using the gupf  which adds a  very limited  nonlocal element. only the agents involved in a deal can ever be asked to give away money  and all payments can be computed taking only the utilities of those involved into account.
1 convergence in modular domains
in modular domains  we can even guarantee convergence to an eef state by means of 1-deals  over one item at a time :
theorem 1  simple convergence with gupf  if all valuation functions are modular and if initial equitability payments have been made  then any sequence of ir 1-deals using the gupf will eventually result in an eef state.
proof. this works as for theorem 1  except that we rely on theorem 1 for convergence by means of 1-deals  in place of theorem 1 . note that theorem 1 still applies  because any modular valuation is also supermodular. 
1 related work
there has been some work on procedures for finding eef states in the social choice literature  alkan et al.  1; klijn  1; haake et al.  1   albeit with little or no attention to computational issues. the work of haake et al. is particularly interesting. they propose two variants of the same procedure  the first of which assumes that an efficient allocation is given to begin with. the actual procedure determines compensatory payments to envious agents such that an eef state will eventually be reached. while their solution is very elegant and intuitively appealing  it fails to address the main issue as far as the computational aspect of the problem is concerned: by taking the efficient allocation as given  the problem is being limited to finding an appropriate payment balance. certainly for supermodular domains  our proof of theorem 1 shows that this is not a combinatorial problem.
모the second procedure put forward by haake et al.  interleaves reallocations for increasing efficiency with payments for eliminating envy. however  here the authors also do not address a combinatorial problem  because they assume  exogenously given bundles . that is  negotiation relates only to who gets which bundle  but the composition of the bundles themselves cannot be altered. this is equivalent to allocating n objects to n agents-not an np-hard problem.
1 degrees of envy
the convergence theorems of the previous section show that envy-freeness can be a guaranteed outcome of our negotiation process  under specific assumptions. but this is of course far from being the final word on this topic. the pf involved in proving theorem 1 introduces a non-local element  in the sense that it redistributes the social surplus over the whole society. how would a local pf  like the lupf  behave in comparison  also  agents need to start negotiation with a non-ir payment. but how does this affect the results in practice  lastly  the convergence theorems do not say how envy evolves over the course of negotiation. because negotiation can become very long in practice  it is likely that the process will have to be be stopped before completion. in that event  it would be valuable to be able to guarantee some monotonicity properties-but with respect to what parameter 
모to address such questions  not only the mere classification of a society as being envy-freeor not is needed. it is important to investigate to what degree we may be able to approximate the ideal of envy-freeness. in the remainder of this section  we discuss several options for defining such a metric. we propose to analyse the degree of envy of a society as a threelevel aggregation process  starting with envy between agents  over envy of a single agent  to eventually provide a definition for the degree of envy of a society.
1 envy between agents
how much does agent i envy agent j in state  a 뷇   generally speaking  when assessing the degree of envy between two agents  we can either focus on agents that we indeed envy  positive envy  epos   or consider both agents that appear to be better off  of course  but also agents we believe to be in a situation worse than ours  total envy  etot .
	etot i j 	=	ui a j  뷇 j     ui a i  뷇 i  
	epos i j 	=	max{etot i j  1}
while the latter option  epos  seems to fit best with our intuitions about envy  the former  etot  may be justifiable if we want agents to be able to compensate for envy.
1 degree of envy of a single agent
how envious is a single agent i in state  a 뷇   this notion considers the agent in relation with many other agents. a first option would be to count the number of agents that i envies. this arguably only makes sense when epos is used to assess the envy between two agents.
if
	   	=
	1	otherwise
more fine-grained  quantitative measures would also account for how envious an agent is. at least two obvious options for doing this come to mind. firstly  we could measure how much our agent envies the agent it envies the most  emax op . or we could compute the sum of envies it experiences with respect to all the agents in the system  esum op . emax op i  = maxj eop i j  where op 뫍 {pos tot}
 where op 뫍 {pos tot}
note that these two options can be of interest whatever the operator chosen to compute the degree of envy between agents.
1 degree of envy of a society
given the degrees of envy of each individual agent in a system for a given negotiation state  we can now define suitable aggregation operators to yield the degree of envy for the agent society as a whole. as for the aggregation of individual preferences to obtain a social preference ordering  moulin  1   there are a multitude of different options available for doing this. here we just mention two options that appear particularly appropriate in our context: the max- and sumoperators. using the max operator must be interpreted as focusing on the most envious agent of the society  whatever operator was chosen to measure that   while the sum  or average  provides a more global picture of the situation. lipton et al.   for instance  use emax max pos to describe the degree of envy of a society. this is the maximum envy experienced by any agent  where each agent measures their envy as the difference to the opponent they envy the most.
1 discussion
the different measures of envy introduced here are by no means exhaustive. other options for aggregating degrees of envy could be used  e.g. based on the leximin-ordering  moulin  1 . however  by just combining the options listed here  we obtain several candidate measures of envy. some of them are of course much more natural than others  as our discussion already suggested. while this question would certainly necessitate a deeper discussion  we only provide here some basic justification that supports the choice of the measure we decided to use in this paper. note first that a basic requirement of these measures would be that the degree of envy should be 뫞 1 iff that allocation is envy-free. this already rules out any measure based on etot. as for the rest  it is mostly a matter of what aspect you want to study as a priority. in what follows  we use two measures: the number of envious agents  esum 1 pos   because it gives a good snapshot of the distribution of envy within the society; and the sum of the sum of envies  esum sum pos   because it also reflects the overall magnitude of envy  which the previous one misses.
1 analysis of modular domains
in this section  we report on a first experimental analysis of how close we can get to the ideal of an eef state  if we do not make the initial equitability payment required by our convergence theorems; that is  if we use a framework that is fully ir. we restrict ourselves to the case of modular domains.
1 experimental setup
the experiments discussed in this section have been carried out using a simple simulation platform. after creating a number of virtual agents and resources  we randomly distribute the resources amongst the agents and randomly generate valuation functions for them. negotiation is simulated by going for each  randomly chosen  agent through all the goods currently held by that agent and trying to find a potential partner with whom an ir 1-deal over that good can be agreed upon. this process is repeated until no more ir 1-deals are possible. as we restrict ourselves to modular valuations  the final allocation is known to always be efficient  cf. theorem 1 .
모for all the experiments reported  the number of agents is n = 1. the number |r| of resources in the system varies between 1 and 1  depending on the experiment. for each agent  we randomly choose 1 distinguished resources. to all the other resources  the agent in question assigns valuation 1. for each of the distinguished resources  we randomly draw a weight from the uniform distribution over the set {1..1} to determine the  modular  valuation function of that agent.
1 envy over time
the first set of experiments is aimed at clarifying how envy evolves over the course of negotiation. before turning to the experiments  we observe the following fact: if an agent with a modular valuation function makes an ir bilateral deal  this will reduce its envy towards its trading partner. this means that the envy between the two agents cutting a deal will always reduce. however  non-concerned agents may become more envious than before  because one of those two agents may have improved its lot according to their own valuation.

figure 1: evolution of envy over time  1 goods 
this makes it difficult to predict how overall envy will be affected by a deal. a typical example is given in figure 1. the figure shows the sum of positive envies after each deal  for one particular negotiation process. the payment function used is the lupf  without any initial payments . as we can see  after about 1 deals negotiation terminates and we have reached an allocation that is almost envy-free. figure 1 shows that the degree of envy does not diminish strictly monotonically. on the other hand  the graph suggests  and more extensive experiments  not shown here  clearly demonstrate   that envy does diminish monotonicallyon average. further experiments show that the gupf  also without initial payments  performs slightly better than the lupf  faster convergence and lower overall envy in the end .
1 impact of number of resources
while for the example shown in figure 1 we do not reach an eef state  it seems nevertheless remarkable that we get rather close. it turns out that how close we can get depends very strongly on the number of goods in the system. this issue is analysed in more detail in our second set of experiments. an example is given in figure 1. it shows the number of envious agents in the final state of negotiation  as a function of the number of goods in the system  average of 1 runs each . for this experiment  the standard deviation ranges from  almost  1 to 1  depending on the number of resources.

figure 1: number of envious agents in the final state
note that for valuations generated using a uniform distribution  as is the case here  the initial degree of envy will always be rather high  independently of the number of goods  on average  1 out of 1 agents are envious to begin with-data not shown here . this can be explained by the fact that the initial allocation is independent of agent preferences  so for any agent the chance of liking a particular bundle more than its own is already 1%. on the other hand  as our experiments show  the potential for rational negotiation to reduce or even fully eliminate envy improves dramatically as the number of goods increases. this can be explained  at least in part  by the fact that for a high number of goods the probability of an agent receiving several of their top goods in the efficient allocation is very high. for instance  if each agent has 1 distinguished goods  it will on average value 1 of them between 1 and 1. it is then very unlikely that any of the other 1 agents will also value these 1 goods that highly  when there are  say  1 items in the system. so the fact that we are using a uniform distribution does go some way towards explaining these  nevertheless surprising  results. finally  as figure 1 shows  the gupf does better than the lupf.
1 conclusion
this paper has addressed the question of the fairness  understood here as envy-freeness of allocations obtained when one lets rational decision-makersnegotiateoverindivisible goods. we show in particular that eef outcomes can be guaranteed in supermodulardomains  providedagents initiate the process with some equitability payments that are not necessarily ir  but envy-freeness cannot be guaranteed with a fully rational process . to appreciate how this initial payment affects negotiation  we report on experimentalresults in modular domains where no such payments are made. the experiments demonstrate that envy decreases on average  although not monotonically  over a negotiation  and even tends towards zero at the end of the negotiation when the number of goods is large.
모there are many potential extensions of this work. perhaps the most obvious concerns the experimental study of nonmodular domains. theorem 1 still holds in supermodular domains  and it would be interesting to see how negotiation proceeds in these domains  when the efficient allocation may not be reached in practice. another tempting avenue of research is the design of local pfs specially customised to help approach envy-freeness as much as possible. while it is known that no such perfect pf can exist  more systematic experiments could shed a light on what makes a pf well-behaved. at last  this work makes the assumption that each agent has full knowledge of the bundles held by the others; this can be unrealistic in many applications. there are different ways to alleviate this  for instance by assuming that agents have a partial  pre-defined or dynamic  perception of the society.
