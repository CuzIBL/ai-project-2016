 
   well-known met hods for solving the shape-from-shading problem require knowledge of the reflectance map. here we 
show how the shape-from-shading problem can be solved when the reflectance map is not available  but is known to have a given form with some unknown parameters. this happens  for example  when the surface is known to be lambertian  but the direction to the light source is not known. 
   we give an iterative algorithm which alternately estimate* the surface shape and the light source direction. use of the unit normal in parameterizing the reflectance map  rather than the gradient or stereographic coordinates  simplifies the analysis. our approach also leads to an iterative scheme for computing shape from shading that adjusts the current estimates of the local normals toward or away from the direction of the light source. the amount of adjustment is proportional to the current difference between the predicted and the observed brightness. we also develop generalizations to less constrained forms of reflectance maps. 
i. introduction 
   given an image  e  and a reflectance map  r  the shapefrom-shading; problem may be regarded as that of recovering a smooth surface  z x y   satisfying the image irradiance equation 
over the domain 1 of e. any given boundary conditions on z x y  should also be satisfied. the problem takes the form of a first-order partial differential equation  horn  1 & 1 . 
   implicit in this formulation are a number of assumptions  the principal one being that the brightness of a surface patch does not depend on its position in space. another is that an image depicts a smooth surface of homogeneous reflectance. several algorithms have been devised to tackle the problem  notably those of horn  1   strat  1   and ikeuchi k horn  1 . 
	* 	on leave from: 
school of mathematical sciences  
flinders university of south australia  bedford park  sa 1  australia. 
   one of the many difficulties these schemes face in practice is that the reflectance map is typically not known. the reflectance map specifies how the brightness of a surface patch depends on its orientation under given circumstances. it therefore encodes information about the reflecting properties of the surface  and information about the distribution and intensity of the light sources. in fact  the reflectance map can be computed from the bidirectional reflectancedistribution function and the light source arrangement  as shown by horn & sjoberg  1 . 
   when encountering a new scene  the information required to determine the reflect ance map is usually not available. yet without this information  the shape-from-shading problem cannot be formulated  much less solved. we may resolve this dilemma if a calibration object of known shape appears in the scene  since the reflectance map can be computed from its image. here we wish to consider the situation where we are not that fortunate. 
   it is interesting to evaluate how some basic assumptions can resolve this impasse. pentland  1  has looked at the problem of recovering shape from shading under the assumption that the image depicts a lambertian surface illuminated by a point source whose direction is unknown. under the additional assumption that the surface is locally umbilical  surface normals are shown to be recoverable by a local operation. this method does not depend on the iterative propagation of information across the image. 
   there are some serious drawbacks to the local approach  however. one problem is that the umbilical assumption is very restrictive. in fact  spheres are the only surfaces whose points are all umbilical. so this method naturally computes incorrect normals for other shapes  although the errors for approximately spherical surfaces  such as ellipsoids of low eccentricity  may be acceptable. further  the constraining effect of known occluding boundary normals cannot be incorporated into the local method. this is unfortunate because these normals provide powerful boundary conditions on the shape-from-shading problem  as shown by bruss  1 . finally  because a local method does not take into account neighbors when calculating the normal at a point  nearby normals may differ a great deal  particularly in the presence of noise. 
   we now present an alternative approach that does not suffer from these disadvantages. 
   
m. brooks and b. horn 1 

   
1 m. brooks and b. horn 
this takes advantage of the fact that a need not be a unit vector. if the brightness of the source is known  we can normalize s so that it is a unit vector. then the determination of s becomes slightly more complex  since it involves a constrained minimization. 
iii. properties and performance of the scheme 
   the iterative scheme has two components: one concerned with the recovery of shape  the other concerned with the determination of the source direction. the shaperecovery component has an intuitively satisfying form. in essence  a new normal is computed by taking a local average  and adjusting this either toward or away from the source. the magnitude and sign of the adjustment is determined by the brightness error of the current estimate. 
   for a given shape  a new source direction is computed by a single pass through the image; unlike shape-recovery. 
given some initial values for the normals  the shape-andsource scheme will head for one or the other of these solutions. the dual shape and source direction can then be determined immediately using the equations given above. 
   we now present two examples of the program at work. synthetic images were used  each of which depicted a lambertian surface illuminated by a point source in the direction  1 1    the images each contained more than 1 points at which normals were to be determined. normals were assigned an initial value of  1    t  as was the source direction. occluding boundary normals were given. the equations for ni j  could be solved sequentially using the gauss-seidel algorithm. since we are ultimately interested in parallel implementation on a grid  we used the jacobi method instead  despite the fact that the gauss-seidel method has slightly better convergence properties . 
m. brooks and b. horn 1 
directly overhead. after 1 iterations with  = 1  the the first image portrayed a hemisphere viewed from average angular difference between estimated and correct normals was less than 1бу. the maximum such deviation was less than 1 times the average value. the estimate of the light source direction  at this time  had errors in azimuth and zenith angles of 1бу and 1бу respectively. 
   the second image depicted a cylinder with rounded  hemispherical ends  viewed from a direction perpendicular to its axis. after 1 iterations  this time with = 1  the average angular error in surface-normal was less than 1бу. a further 1 iterations brought this value down to 1бу. the maximum error remained somewhat larger  however  due to the scheme's tendency to smooth the intersections of the cylinder and the hemispheres. the errors in azimuth and zenith angles for the source were 1бу and 1бу respectively  achieved after 1 iterations. these  too  improved slowly with further processing. 
   the scheme was sometimes slow in converging. after rapid initial improvements  the rate of progress would decrease appreciably. however  one might expect the scheme to be slower than some of the current iterative methods given the disadvantage of not knowing the light source direction. convergence could be accelerated by employing multigrid techniques that propagate information across the image more quickly  see terzopoulos  1 . interestingly  in the examples considered  a reasonable estimate for the source direction was obtained after only a few iterations. 
subsequent processing just improved the estimate. 
iv. iterative schemes for other reflectance maps 
   we now present two more new iterative schemes: the first extends the shape-and-source finder to cover situations in which a simple model of the sky is also included; the second uses methods developed above to find shape from shading  given a general reflectance map  but does not recover source direction. 
a. incorporating a sky component 
the reflectance map 

captures the situation in which a lambertian surface is illuminated by a hemispherical source of uniform radiance  brooks  1; horn & sjoberg  1 . a point source may be added to the map to give 

here  a controls the relative intensity of the sun and the sky. we can now generate a method of shape-and-souree recovery  under the assumption that the image was formed 
in accordance with the reflectance map 
we seek to minimize 


note that a is assumed to be known. interestingly  the computation of s proceeds as before  except that the contribution of the sky is subtracted from e. this does not render the scheme trivial  however  as the calculation of shape does not follow suit. 
b. recovery of shape for the general reflectance map 
   recall that the iterative scheme for shape and source direction is composed of two parts. either component of the scheme may stand alone in the event that shape is required from source  or source is required from shape. indeed  if used in this way  the shape-recovery component may be 
   
1 m. brooks and b. horn 

v. summary 
   most current methods for obtaining; shape from shading assume complete knowledge of the reflectance map. here  we considered the situation in which a lambert ian surface is illuminated by a point light source from an unknown direction. thus we dealt with a parameterized  rather than a fixed  reflectance map. the local approach to recovering shape from shading  which is also intended to deal with unknown source direction  was found to have several drawbacks  notably its restrictive assumption that surfaces are locally umbilical. 
   the adoption of unit normal vectors for describing surface orientation was important to the development of our method. it led to simple derivations and elegant presentations. the problem was cast as one of minimizing a positive-definite functional incorporating a brightness error term  a regularizing term  and a lagrangian multiplier to enforce the condition that the normal be of unit length. the euler equation for this calculus of variations problem was shown to be a second-order partial differential equation in the unknown surface-normal function. a convergent iterative scheme solved it in the discrete domain. 
   the direction of the light source can be determined in closed form if the surface shape is known. at any iteration  a source-direction estimate can be obtained using the current estimate of the surface shape. the iterations for obtaining increasingly accurate estimates of the surface shape can be interlaced with estimation of the light-source direction. 
   we implemented and tested this method for recovering shape and source direction. we also discussed a two-way ambiguity that can appear in the solution. further  we showed how to extend the shape-from-shading component of the iterative scheme to more general reflectance maps. 
acknowledgements 
   we thank alan yuille for many useful discussions. comments on a draft by steve bagley  eric grimson  tomas lozano-perez  bruce nelson and  especially  demetri terzopoulos were much appreciated. mike brooks wishes to express gratitude to the mit ai laboratory for the opportunity to spend some months there  and to flinders university for granting leave. support for the laboratory's artificial intelligence research is provided in part by the system development found at ion. 
