 
patient scheduling in hospitals is a highly complex task. hospitals have a distributed organisational structure; being divided into several autonomous wards and ancillary units. moreover  the treatment process is dynamic  information about the patients' diseases often varies during treatments  causing changes in the treatment process . current approaches are insufficient because they either focus only on the single ancillary units  and therefore do not consider the entire treatment process of the patients  or they do not account for the distribution and dynamics of the patient scheduling problem. therefore  we propose an agent based approach in which the patients and hospital resources are modelled as autonomous agents with their own goals  reflecting the decentralised structures in hospitals. in this multi-agent system  the patient agents compete over the scarce hospital resources. moreover to improve the overall solution  the agents then negotiate with one another. to this end  a market mechanism is described  in which each self interested agent tries to improve its own situation. in particular we focus on how the agents can calculate demand and supply prices based upon their current schedule. further  an evaluation of first results of the proposed method is given. 
1 introduction 
patient scheduling in hospitals is concerned with the optimal assignment of patients to hospital resources. hospitals are divided into several autonomous wards and ancillary units  which are visited by the patients for treatments and examinations during hospitalisation in accordance with their illness  schliichtermann  1 . however  the pathways  the needed treatments and examinations  and the medical priorities  the health condition of the patients  are likely to change due to new findings about the diseases of the patients during examination. further  complications and arrivals of emergency patients  which are in urgent need for treatment  result in sched-
   * we would like to thank the dfg  deutsche forschungsgemeinschaft for funding this work as part of spp 1. 
1 
ule disturbances1  schliichtermann  1 . due to this  patient scheduling in hospitals requires an approach which is distributed  in order to leave the authority at the responsible hospital units  and flexible  to be able to react to plan changes in an efficient manner. 
　we have chosen to adopt a multi-agent based approach to this problem  because such systems allow the representation of every single coordination object  i.e. the responsible entities  as single autonomous agents with their own goals  weinhardt and gomber  1 . this  in turn  reflects the existing decentralised structures in hospitals  decker and li  1 . through social abilities  the agents can interact with each other to reach their own goals. moreover they can react with the needed flexibility to changes  as new information about the health status of a patient becomes available  and disturbances  e.g. emergencies and complications  through proactiveness and responsiveness  jennings  1 . 
　this paper advances the state of the art in two main ways. first is the design of a novel procedure  i.e. a patient centred multi-agent based coordination mechanism  where the patients are represented as autonomous agents  trying to improve their current scheduling state by negotiation with other agents. second is the derivation of health state dependent opportunity cost functions  based upon which the agents evaluate their current schedule and compute the gains and losses through plan modifications. 
　the remainder of the paper is structured as follows. section 1 describes the domain of patient-scheduling in hospitals. section 1 details the conceptual framework of our multi-agent system  the relevant coordination objects and the coordination mechanism. the results of the proposed mechanism are also evaluated. the paper ends with conclusions and an outlook to further work in section 1. 
1 the patient scheduling problem 
in addition to the complexity arising from the distributed structure of hospitals  patient scheduling has to be performed in the face of a high degree of uncertainty about the treatment pathways of patients within the hospital. thus patients arrive 
　　this problem can be ameliorated by the provision of additional  exclusive  emergency resources  e.g. separate x-ray facilities . however  for economic reasons  hospitals try to minimise these extra resources. 

continuously at the hospital and the necessary medical treatments are often not able to be completely determined at the beginning of the treatment process. moreover the results of a diagnostic examination might change the  medical  priority of the patients  invoke additional activities and/or make other medical actions obsolete. 
　due to this complexity  the application of traditional  operations research  methods from industrial scheduling to the patient scheduling problem is problematic  schlcichtermann  1 . to be able to handle the process dynamics in a distributed environment  hospitals commonly use a very flexible approach for patient scheduling. typically  the wards send treatment and examination requests to the ancillary units. based upon these requests  the ancillary units order the patients from the wards. this allows the units to react very flexibly to changes with very low communication needs. if  for example  an emergency patient needs to be inserted  the next patient will simply be called from the ward later  leaving this patient available to other ancillary units. 
　however  because there is no inter-unit coordination  this procedure cannot resolve resource conflicts  which occur if the same patient is requested by more than one ancillary unit at the same time  decker and li  1 . because the ancillary units only have a local view  i.e. they do not - and cannot - take the whole pathway of the treated patients into their scheduling consideration  no inter-unit process optimisation can be undertaken  i.e. the medical tasks for the patients cannot be scheduled and coordinated in an efficient manner . this causes undesired idle times as well as overtime hours for the hospital resources and extended patient stay times. 
1 agent-based patient scheduling 
in this section the conceptual framework of our multi-agent system is described. then  the relevant coordination ob-
jects  i.e. the patients and hospital resources  are modelled as agents. after this  a coordination mechanism is introduced. finally  examples are given and the first results of the implementation are presented. 
1 conceptual framework 
using a multi-agent system   decker and li  1  addressed the problem of resource conflicts in the patient scheduling domain. specifically  by adding a coordination mechanism to handle mutually exclusive resources  i.e. the patients  to the generalized partial global planning  gpgp  approach1  they achieved significant scheduling improvements compared to current patient scheduling without coordination. in their work  they took a function-oriented approach  where only the units are represented as autonomous agents. the treatment pathway of the patients is captured by the nursing units. however  the dynamics of the patient scheduling problem and the medical priorities of the patients were not considered. 
　for this reason  we use a patient-centred approach  in which the patients are modelled as agents  too. this allows the representation - and therefore consideration - of the hospital processes as a whole  adam and gorschliiter  1 . in 
　　1 gpgp is a domain independent  task environment centred  scheduling approach to coordination  decker and li  1 . contrast to the resource agents  who only see the patients as entities to be treated  the patient agents only see the medical actions as tasks that need to be performed. due to these opposing forces  the patient agents ensure that the resource agents also consider the treatments of the patients outside their unit  without any explicit knowledge of them  and vice versa. 
　to this end  the relevant coordination objects in the hospital  i.e. the entities to be coordinated   which will be represented as agents  can be identified as patients and resources  i.e. rooms  machines and personnel . to reduce complexity  all resources needed for a specific medical action are represented by the hospital unit responsible for this action  which will be implemented as the resource agents. 
　if more than one patient agent now wants to use the identical resource at the same time interval  a resource conflict occurs. to solve these conflicts  a coordination mechanism is needed. for this inter-agent coordination  we decided to use a market mechanism. the rationale for this is that a market mechanism is a distributed coordination mechanism which facilitates efficient solutions with low communication needs. in particular  only prices for specific goods are communicated  keeping all other information private to the market participants  wellman et al.  1 . additionally  a market facilitates a dynamic environment  where the market participants take actions according to their current  dynamically changing  situation based upon private information and preferences. in this market  the coordination objects are modelled as autonomous  self-interested market participants  trying to improve their local schedule. in markets  the price mechanism leads to an efficient resource allocation because the resources are assigned to the agents that are willing to pay the highest price  assuming that the agents bid rationally  these are the agents who gain the highest utility from this resource . a pareto optimal solution will be achieved  because no agent will accept a deal  which worsens its current state. therefore  the agents will trade resources until no agent can improve its schedule without harming another agent  weigelt  1 . 
1 	coordination objects 
to implement a coordination mechanism  the above mentioned coordination objects have to be modelled. in this work the main goal for the patients is to minimise their stay time and for the resources to minimise idle times. this kind of scheduling problems represents a worth-oriented environment  rosenschein and zlotkin  1   where the degree of goal achievement can be evaluated by a utility function  rather than a state or task oriented environment  where a single goal cannot be achieved partially . the usage of continuous worth functions instead of single worth values assigned to specific goals enables the agents to relax their goals  i.e. to compromise in order to achieve a better solution  rosenschein and zlotkin  1 . for example  if two agents want the same time slots at the same resource  the agents can agree upon a solution which does not fully satisfy their own goals  but reaches a better overall solution. this situation is illustrated in the figures 1 a  and 1 b . 
　because we adopt a patient-centred approach  the main focus will be on the patient agents  which will be modelled in 

scheduling 	1 

the first subsection. within this part  we introduce the health state dependent cost-functions  which are needed for price articulation in the market mechanism. in the second subsection  the resource agents are described. 
patient agents 
each patient is represented by an agent. the patient agents can only see their own schedule  containing their pathway through the hospital. the pathway of a patient agent comprises the needed treatments and examinations as well as the order constraints between those tasks. the patient agents are also equipped with a private worth function to be able to negotiate in a goal driven manner. this worth function is realised as a cost function  which they try to minimise. these cost functions increase over time  setting incentives for the patient agents to schedule their treatments and examinations as early as possible in order to reduce costs. 
　in contrast to commercial domains  the utility or cost functions cannot be based upon monetary values in hospitals. while in e-commerce scenarios the human principals reveal their preferences through their willingness to pay  e.g. by specifying maximum buy and minimum sell prices   patients do not - and should not - reveal thei; preferences through their willingness to pay for a specific treatment time slot. the preferences rather have to be based upon medical priorities  i.e. their health state. this absence of normalised monetary units additionally causes the problem of inter-agent utility comparison. to solve this problem  we operationalised the progress of the patients' health state. in current hospital practice  numerous health states or patient priority measures and indices are in use  e.g. apache it  acute physiology and chronic health evaluation   knaus et al.  1  in intensive care units . the choice of the measurement to use is up to the hospital. however  we propose  that it should support a cardinal measurement of the health state progress over time. 
　the cardinal measurement is necessary for inter-agent utility comparison and transfer  as we have to calculate with these units . because these health state  utility  units cannot be transferred between the actual patients in the hospital  the multi-agent system has to be separated from the actual patient world  where only the agents transfer utility units in order to reach a better overall solution  minimisation of health state adjusted patient stay time . 
　the health state progress is important  because the priority of the patients should not be based upon their current state  but on their health state development. for example  a patient with a currently reasonable but rapidly deteriorating health condition should have a higher priority than a patient with a  slightly  lower current  but continuously constant  health state. 
　for the necessary cardinal measurement of health  we rely on the concept of years of well being  torrance  1  because it handles the health state progress over time  a good overview can be found in  pedroni and zweifel  1  . in this method  the question is what time period xt of total health  1  equals one specific time period it of a certain health state h  i.e. 

through this  the health state of a patient can be described in time units. 
　the primary goal of patients in hospitals is to increase their current health state through treatment  where a disease could be viewed as disutility  decrease in quality of life  for the patient. this loss of utility adds up as long as this disease is not cured. based on this assumption  the  opportunity  cost  for not curing the patient right away equals the differ-
ence between the achievable health state  through treatment  z and the patient's health state over the time h t . formally  this can be expressed by 

　in addition  it has to be considered that the health state and the achievable health state can change over time. therefore  the patient's opportunity costs are influenced by his current health state a  the development of his health state over time h t   and the maximal reachable health state through treatment z. if the health state does not change over time  i.e. h t  = a  the opportunity costs are 

if the health state of a patient worsens over time  assumptions about the course of the health state have to be made by a physician. if we assume - for clarity - a linear reduction by b of the health state  i.e. h t  = a - bt  we get 

　however  this approach works with any health decrease rate  as the health state of a patient normally does not decrease linearly. nevertheless  a linear approximation of the decrease in health can be justified by practical reasons. instead of trying to estimate the exact shape of the curve  a physician could rather specify two or more specific points in time and in between a linear reduction could be estimated. figure 1 shows an exemplary course of an illness with linear reduction of the health state  resulting in a quadratic opportunity cost curve. 

figure 1: linear reduction of health state. 
finally  if the maximal reachable health state decreases  the 

1 

patient must be treated immediately to prevent lifelong damage to his health. 

　with these cost functions in place  the agents can now evaluate their current state  i.e. the degree of goal achievement. further  based on these functions  the agents are able to compute supply and demand prices for time slots which correspond to the losses or benefits caused by plan changes  which is essential for a market mechanism. how these prices are computed will be explained later in the context of the description of the coordination mechanism  section 1 . 
resource agents 
in contrast to the patients  the hospital resources are directly comparable with the resources in industrial scheduling domains. their main goal can be described as maximising their utilisation or  equivalently  minimising idle time. 
　to reach this goal  cost-functions can also be articulated for the resource agents. these cost functions represent the reserve prices  i.e. the price that will be charged for an empty slot  for the possible appointments  wellman et al  1 . through this  priorities between different resources can be established that allow penalisation of undesired appointment times  e.g. evening shift or overtime hours . here  the basis for the resource agents' cost functions comes from cost accounting. 
　however  for inter-agent utility comparison  i.e. between patient and resource agents  these measurements have to be equalised  which can be a very difficult task  because the health state of a patient has to be compared with monetary values from cost accounting. a good way out of this problem are trade-off considerations  e.g. what amount of idle time of a specific resource equals one hour waiting time for a patient with a specific health state. 
1 	the coordination mechanism 
the main goal of the coordination mechanism is to minimise the health state adjusted stay time of the patients  which is equivalent to an overall minimisation of suffering for the patients. the basic idea of our coordination mechanism is that the patient agents try to buy into resource time slots for the needed treatments and examinations. however  the usage of  central  auction mechanisms is obstructed by the dynamics of the patient scheduling problem described in section 1. 
　to ensure feasible  i.e. conflict free  initial task appointments for the patients  all new treatments and examinations are scheduled on a first-come first-served  fefs  basis. to do this  the patient agents who want to add a task to their pathway contact the responsible unit for the execution of this task in order to obtain the earliest time slot which is available at the unit as well as in their own schedule. to illustrate this  figure 1 a  shows a possible initial resource allocation. these initial appointments determine the budget  or better the initial opportunity costs  of the agents. this is important because a hypothetical price system is used  as per section 1 . 
　based upon this initial schedule  the agents try to improve their schedule in order to reduce their opportunity costs. the price p they are willing to pay for a specific time slot  expected gain  or they charge for a time slot  expected loss  is the difference between the cost-value of the current allocation told and the cost-value for the wanted appointment tnew  according to their individual cost function described in the previous section  i.e. 

　because in this approach the  opportunity  costs of an appointment increase over time for the patient agents  they must try to schedule their treatments and examinations as early as possible. if a demanded time slot is already occupied by another patient agent  the initial demander must try to buy the time slot from the current owner. with respect to the properties of a market mechanism  the agents act in a rational  selfinterested manner. therefore  the owners of the time slots will only release them  if the price offered equals the losses invoked through rescheduling. since they only charge for the costs invoked through rescheduling they can be viewed as acting in a partially cooperative manner. 
the detailed negotiation process goes as follows: 
1. a patient agent initiates a negotiation for rescheduling  if the pathway  additional or obsolete medical actions  or the health state of its patient has changed. 
1. the initiating agent selects the task with the highest possible improvement  difference between the costs of the current owned and the best reachable time slot  and contacts the resource agent that is responsible for the execution of this task. 
1. the resource agent reserves that time slot  and contacts all affected patient agents  i.e. the agents that currently own this interval  and informs them about the proposal of the initiator. 
1. the affected patient agents  sellers  try to reschedule to the first nonreserved time slots  see step 1  and notify the initiator about their costs due to rescheduling. to prevent cycles  reserved intervals cannot be demanded by other agents. 
1. if the alternative time slots for the sellers are already occupied  they again become demanders for those time slots and accumulate the invoked costs. here  order constraints can invoke additional rescheduling in other resources. 
1. after all prices are computed and submitted to the initiator  the initiator compares its expected gains from rescheduling to the total price asked for this interval. if the gains exceed the costs it accepts or rejects otherwise  and the negotiation for this time slot terminates. 
　the former initiator continues its rescheduling activities by opening new negotiations for the next task with the  now  highest possible improvement until it cannot improve any task any further. previously rejected time slots will not be considered unless these time slots are released by their owners. for concurrency issues only one  randomly chosen  agent can initiate a negotiation at a time. 
　in this coordination mechanism only the patient agents are active components. however  as described earlier  cost functions can be implemented into the resource agents  allowing prioritisation between the resources. the resource price for a time slot is charged when a patient agent buys a time slot  and reimbursed when the patient agent releases this time slot. 

scheduling 	1 

　as described earlier  the pathway of the patients through the hospital is likely to change during the treatment process  that is  additional treatments and/or examinations may become necessary while other tasks may become obsolete. in bur coordination mechanism  additional tasks  as well as additional patients  can be added at any time using the fcfs rule explained above. if a treatment becomes obsolete  the responsible patient agent notifies the affected resource agent that  again  informs the other patient agents in its schedule. 
1 	example scenarios 
figure 1 a  and 1 b  illustrate the functioning of our coordination mechanism. figure 1 a  shows an initial schedule with three patients  a b c . for illustration purposes  we start with identical cost-functions with an assumed initial health state a of 1  an achievable health state z of 1  a decrease rate b of 1 and equal possible starting times for all patients. the used cost function resolves as 1t + 1* . further  in this example  all task durations are set to lot. we will use the $-sign to indicate utility units. 
agent a would only ask for its slot  agent a moves to slot 1 and gains $1  and agent b moves to slot 1 and looses 

figure 1: gantt of the results of the taillard 1 open shop problem. 
based upon this initial schedule  agent c negotiates with 　we have applied the described coordination mechanism to the first taillard 1  1 open shop problem  taillard  1  to analyse the behaviour for tasks with different durations. figure 1 shows the resulting gantt chart with a solution of 1. the optimal solution is 1. to analyse the convergence of the mechanism  we logged the changes of the latest task for each agent. figure 1 shows the corresponding convergence behaviour  which indicate a fast convergence in the first third of the graph. 


agent b in unit 1 in order to improve its current situation. agent c's current opportunity costs in unit 1 are  1 x 1 + 1 x 1 r . its opportunity costs for the first time slot would be  i.e. a difference of  for the calculation of the offer price  agent b has to determine its additional rescheduling costs. therefore agent b has to negotiate with agent a in unit 1 for the next best time slot and in unit i  because the patients are exclusive resources which can only perform one task at a time. agent a looses in unit 1 and another  in unit 1. agent b looses  in unit 1 but gains $1 in unit 1. agent b is charged with the losses of agent a and adds this to its supply price for agent 	because the total 
supply price is less than agent c 's gains agent c accepts the deal  because it can compensate the losses of the other agents  and the plan is changed. no more deals are possible and figure 1 b  shows the result of this negotiation. 
　in this example  patient agent a accepted a schedule of lower quality in favour of patient agent c. however  only patient agent a - not the real patient - has received a compensation from patient agent c. this illustrates the necessary dis-
junction between the real patients and the multi-agent system in the hospital domain as described earlier  section 1 . 
　in the next step  we relax the assumption  that all agents have the same cost functions. if agent c would have had a lower health state  e.g.  = 1  it could have even improved its appointment in unit 1 because it would have gained $1 from moving to the second slot  agent a in figure 1 b   while 
1 

figure 1: converge of the taillard 1 open shop problem. 
　the number of negotiation rounds counts each improvement attempt  successful or not  of the agents. the same procedure was executed for the  open shop problems with equal task durations. for these problems the optimal solution will be always achieved. the resulting gantt chart is shown in figure 1. figure 1 shows the corresponding convergence  illustrating the simplicity of this problem type in contrast to the used taillard benchmark. 
　however  a better agent-based solution to this problem can be achieved through the usage of  central  appointment auctions. implementing an auction based approach using the same cost functions resulted in a solution at 1. however  these auctions cannot handle the dynamics of the patient scheduling problem  because the auction process would have 


figure 1: gantt of the results of the easy 1 open shop problem. 

　figure 1: converge of the easy 1 open shop problem. to restart again after severe changes in the pathway occurred. 
1 conclusions and future work 
in this paper  we presented a patient-centred coordination mechanism for inter-unit patient scheduling in hospitals. therefore  health state dependent cost functions were developed. we described the implemented coordination mechanism and evaluated first results  showing the different convergence for problems with equal and different task durations. 
　in the next step  we will run our approach on real hospital data  already retrieved out of a field study in five hospitals. based upon these results  our coordination mechanism will be enhanced in future work  where the main focus is on the development of a flexible auction mechanism in order to handle the dynamics of the patient scheduling problem. in this context  we will analyse how the usage of texture measurements  here: criticality and goodness measures   sycara et al  1  can facilitate our coordination mechanism in order to reduce backtracking. additionally  our agent based approach will be benchmarked with a genetic and evolutionary algorithm  which is under development in the context of this work. further  a decision theoretic approach facilitating stochastic task duration will be presented in the near future. 
