 
proposing measurements in diagnosis systems for static systems is a well understood task. usually  entropy based approaches are used  sometimes extended by cost and other considerations. how to do the same task in dynamic systems is less clear  and so far measurement proposal algorithms have been ignored in the recent approaches advanced for dynamic systems. in this paper we will describe a set of techniques and algorithms suitable for measurement proposal in a temporal diagnosis formalism discussed in our previous work. this formalism is based on qualitative allen constraints. the current paper introduces a measurement proposal algorithm and improves it in several ways. finally an entropy-based computation method is described for this temporal setting. 
1 introduction 
most current diagnosis systems are able to propose useful/optimal measurements to discriminate among competing hypotheses. several methods have been proposed  mainly based on entropy computations as described in  de kleer and williams  1 . recently  some systems for diagnosis of dynamic systems have been proposed  console et a/.  1; nejdl and gamper  1 .  console et a/.  1  is based on a time-slice approach  which considers the system dynamics as a sequence of static states. while this approach restricts expressiveness  it allows to use the same measurement proposal algorithms as in static systems. on the other hand  these static algorithms are insufficient to be applied in the more general approach described in  nejdl and gamper  1 . in  gamper and nejdl  1  we discussed first results on how to propose measurements in our diagnosis system  and this paper extends these results by proposing a set of techniques which propose measurements able to distinguish hypotheses described by qualitative temporal constraints. 
　in section 1 we summarize our diagnostic approach described in  nejdl and gamper  1j. section 1 explains the concept of measurement proposals and dis-

cusses the general techniques used to incorporate measurements into temporal networks. we improve these techniques in section 1 by exploiting the concept of temporal difference and in section 1 by using the concept of predicted patterns. section 1 generalizes the entropy computation framework in  de kleer and williams  1  for our approach. section 1 discusses related work. 
1 example and basic framework 
example 1  diagnosis of hepatitis b  in routine testing of hepatitis b the findings hbs.ag  anti-hbs  hbe.ag  anti-hbe  anti-hbc and igm.anttjxbc are tested  where 
each of them can assume the value positive  p  or negative  n . a hepatitis b virus infection is characterized by a typical sequence of these findings: 1 acute variants  two of them are shown in figure la where lines denote the periods of positive findings   and 1 persisting variants. in this paper we do not consider the different stages  e.g. incubation. 
　all variants look similar  involving basically the same findings. what distinguishes these variants is the order in which these findings occur. in  nejdl and gamper  1  we described a diagnosis framework which uses a subset of aliens interval algebra to explicitly represent such temporal relationships. 


	gamperandnejdl 	1 

1 	a measurement proposal algorithm 
we have to find a measurement proposal with a possible outcome which supports one hypothesis and refutes another one. the outcome of a measurement proposal supports a hypothesis if we can fit each observed value into the temporal behavior of the hypothesis and the temporal relations of the measurement proposal are satisfied; otherwise  the hypothesis is refuted. as we do not have time points in our temporal framework we assume that the measured value holds over a small time interval  around  the measurement time point. it is easy to show that this assumption does not influence the results. 
　the following procedure me as pro implements a measurement proposal strategy. for each hypothesis hi ♀ hyp we maintain a set si of ia-networks initially containing the corresponding temporal behavior network bi. for each hypothetical measurement with outcome m vft  we insert a measurement outcome node onode representing the small time interval around t into each ia-network n in si  and constrain it as follows: 
  for each other measurement outcome node onode' at time point t' we add the la-relation onode{b}onode if t   t'  onode{e}onode' if t = t' 
and onode {bi} onode if t   t'. 
  we constrain the onode to occur within a manifestation node mnode in the temporal behavior representing the same parameter m and the same value v by adding the relation onode{s d f e  mnode. if several such mnodes  same parameter and value  are related by before  after  the onode can only occur in one of them at a time. in this case we construct for each such mnode a copy of the actual n to represent the different possible constraints of onode. 
　* we constrain onode to occur outside each mnode representing parameter m and value v' not= v by adding the relation onode{b  m  bi  mi} mnode. finally we test consistency for each ia-network in si using known temporal reasoning algorithms  allen  1; van beek  1  and remove inconsistent networks. situations  where we have si  sj such that si  not= 1 and sj = 1 characterize possibly discriminating measurement proposals for the hypotheses hi  and hj. 
example 1 we choose the measurement hbs.ag vi t  with a positive outcome  insert the measurement outcome node o-hbs.ag into the ia-networks for variant1 and variant 1 and constrain it to be within the temporal extent of hbs.ag  i.e. o-hbs-ag{s d j e}hbs.ag. the positive hbs.ag is consistent with both variants  and we continue with a new hypothetical measurement at the same time point  e.g. anti-hbe v1    with a positive outcome. adding o-antlhbe{e}o-hbs.ag and o-anti.hbe{s d f e}antijibe  figure 1  and propagating these relations yields an inconsistency in variant1  due to hbs-ag{b}anti-hbe   but it is consistent in variant1- thus the measurement proposal hbs.ag vi t  a anti.hbe v1 t  has an outcome hbs.ag p t  a anti.hbe p t  which can distinguish between the two variants. 
　the algorithm me as pro makes no assumptions about whether measurements are proposed in the past igm anti hbc v1  and . examples of two con-
n
1	n i
1
	1amper and nejdl 	1 



relations we take the union of the patterns predicted by the basic relations  e.g. for {s  e  we take the union of the patterns predicted by  s  and  e   which is the set of all possible patterns. again we use the difference graphs to reduce the number of tuples to be considered. 
example 1 let us consider the measurement tuple  hbs-ag  anti-hbe  where we have a {b}-relation in variants and an {o}-relation in variant1. the corresponding relation tuples  1  and  o  predict different sets of patterns. the pattern  p.p  is only predicted by  o . thus  {hbs.ag  anti-hbe  represents a possibly-discriminating measurement tuple. a measurement which is not a possibly-discriminating one is  anti-hbs .anti-hbc  with the corresponding relations  /  and  d . 
　obviously  if we use only the 1-tuple table  no inferences are compiled over more than two measurements. if we want to propose a measurement tuple of length 1  the table tells us only about the pairwise consistency of the measurements included in this tuple. if we want to get better discriminating power  we have to construct similar tables for larger tuples of relations and patterns. table 1 shows a part of the relation tuples and the predicted patterns of length 1. 
example 1 in this example we assume that the positive hbs-ag and hbe.ag start at the same time  i.e. hbs.ag{si}hbe.ag. the measurement tuple  hbs ag  anti-hbe  is a possibly-discriminating tuple  as it allows a distinction in the case of  p p  as seen from table 1. if we look at the measurement tuple  hbs-ag  anti-hbe  hbe-ag   i.e. adding the additional measurement hbe.ag   we get no additional distinguishing patterns from the 1-tuple table. however  the 1-tuple table gives us an additional distinguishing pattern for the whole 1-tuple measurement  i.e.  p  n  n   which excludes variant1. 
proposition 1 given are two hypothesis h1 and h1 with temporal behavior b  and b1. a sufficient condition for a possibly-discriminating measurement tuple  mi ...  mn  for h1  h1 is that the corresponding relation tuples from b1  b1 predict different sets of patterns. 
　generating the predicted pattern tables requires to find all consistent scenarios for sets of ia-relations which is in general intractable. however  we can precompile these tables  and the set of relations depends only on the length of the measurement tuples and not on the size of the temporal behavior of the hypotheses as in me as pro. 
1 	evaluating measurements by entropy 
so far  we have only checked for possibly-discriminating measurement tuples. what we will do now is to generalize the entropy computation framework from  de kleer and williams  1  to our case. we have to use whole measurement tuples instead of single measurements and we have to deal with hypotheses which predict more than one value for a measurement tuple. 
　given are a set hyp of hypotheses h1  and their temporal behavior b1 . for a measurement sequence mts =  mt  ...  mtn  we represent the corresponding relations in bi as relation tuple ri mts and the set of predicted pattern sequences as pi mts. the set of possible pattern sequences of mts is mps mts. we construct for each pattern sequence mps 1 mps m t s the set hypmps of hypotheses which predict the pattern sequence mps. these sets provide the basis of our analysis. obviously  each hypothesis hi appears in at least one hypmps. the measurement sequence mts is possibly-discriminating iff there are at least two different sets hypmp$l =/ hypmps1  where at least one of these sets is neither the empty set nor the set of all hypotheses. 
　now the expected entropy for the hypothesis probabilities given a measurement sequence mts is given by 

p mts-mps  is the probability that the outcome of mts is mps and h mts-mps  is the entropy of the hypothesis probabilities given the hypothetical measurement result mps. the best measurement sequence mts is the one 
which minimizes the expected entropy he mts  of hypothesis probabilities  de kleer and williams  1 . 
the probability p mts=mps  is given by the formula 
  where p hi  is the probability that hi is the actual hypothesis  and p mts=mps/hi  is the conditional probability that the outcome of mts is mps assuming hi  is the actual hypothesis. in dynamic systems this probability depends on the duration of mps appearing in hi -. if we do not have quantitative information concerning the temporal extent of intervals in b  we can use the approximation  assum-
ing that each measurement pattern sequence predicted by hi has equal probability  mps c mps' means that mps is a subsequence of mps' . note  that this is a case where using quantitative information really helps. 
   the entropy h mts-mps  of hypothesis probabilities under the assumption that mts is measured to be mps is given by the formula h mts=mps  =  where 
p hi/mts=mps  is the probability that hi  is the hypothesis given that mts has been measured to be mps  and can be computed using the bayes rule. 
example 1 we consider the hypotheses variants and variant1 and the measurement tuple  hbs.ag  anti-hbe  with the possible patterns  p p    p  n    n p  and  n  n .  p p  is only predicted by variant1 whereas all other patterns are predicted by both variants and variant1. in table 1 we summarize the results of calculating the expected entropy. as the pattern  p p  distinguishes between both hypotheses its entropy is 1. for the other patterns the entropy is 1. the overall expected entropy for the measurement tuple  hbs.ag  anti-hbe  is approximately 1. for the other possibly-discriminating 
	gamper and nejdl 	1 

table 1: calculation of the entropy. 
measurement tuples of length 1 we get the same value  since they also have exactly one measurement pattern which allows to distinguish among the two variants. hence  all three measurement tuples of length 1 are expected to distinguish equally well  if we cannot exploit quantitative information. if we have quantitative information as in figure 1  then the best measurement tuple would be  anti-fibs  igm-anti-hbc   because the interval corresponding to the discriminating pattern is larger than for all other measurement tuples. 
1 	discussion 
proposing measurements which discriminate between a set of hypotheses is an important issue in diagnostic reasoning. for model-based diagnosis of static systems several algorithms has been developed  mostly variations of the entropy-based algorithm described in  de kleer and williams  1 . mcllraith  mcllraith  1  recently examined the problem of test generation for hypothetical reasoning in general including diagnosis. while some of the concepts are similar to ours  e.g. a relevant test in  mcllraith  1  corresponds to a possiblydiscriminating test in our framework  mcllraith characterizes test generation as an abduction problem  while we start with a nondeterministic algorithm and end up with efficient table lookup techniques. the major difference  however  is that we investigate measurement proposal for dynamic system and hence focus on the different temporal behavior of the hypotheses. 
   as far as we know no work has been done in proposing measurements in reasoning about dynamic systems. most closely related to our work are situation recognition systems. nokel  nokel  1  describes a system for generating measurement sequences in order to recognize dynamic situations  which also uses a subset of aliens interval algebra. the main difference to our approach is that we propose measurements to distinguish among several hypotheses characterized by a dynamic behavior which is different from recognizing such hypotheses. distinguishing among several behaviors is based on their difference  while recognizing them involves observing all their characteristics. indeed  nokel proposes at least one measurement for each manifestation. while nokel plans sequences of measurements allowing only one measurement at a single time point and does neither discuss entropy based algorithms nor efficiency improvements like we do  we investigate concurrent measurements as well as measurement sequences  including entropy based proposal algorithms and give a set of efficiency improving techniques to check for distinguishing measurement tuples. another situation recognition system similar to nokels approach is described in  dousson et al  1 . 
knowledge base technology 
1 	conclusion 
in contrast to static model-based diagnosis systems  current model-based formalisms for temporal diagnoses have not yet investigated the issue of proposing measurements in a dynamic setting. in this paper we investigate techniques and algorithms for proposing new measurements in the temporal diagnosis framework described in  nejdl and gamper  1  which represents explicitly qualitative temporal behavior using a subset of allen relations. we discuss a general  nondeterministic  algorithm based on constraint propagation for proposing possibly-distinguishing measurements. we show how the efficiency of this method can be improved by using temporal difference graphs and table lookup in precompiled predicted pattern tables. finally  we generalize the entropy based measurement proposal algorithm defined in  de kleer and williams  1  to our temporal setting. 
