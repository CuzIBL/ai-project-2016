
abduction is an important method of non-monotonic reasoning with many applications in ai and related topics. in this paper  we concentrate on propositional abduction  where the background knowledge is given by a propositionalformula. decision problems of great interest are the existence and the relevance problems. the complexity of these decision problems has been systematically studied while the counting complexity of propositional abduction has remained obscure. the goal of this work is to provide a comprehensive analysis of the counting complexity of propositional abduction in various classes of theories.
1 introduction
abduction is a method of non-monotonic reasoning which has taken a fundamental importance in artificial intelligence and related topics. it is widely used to produce explanations for observed symptoms and manifestations  therefore it has an important application field in diagnosis - notably in the medical domain  see  . other important applications of abduction can be found in planning  database updates  datamining and many more areas  see e.g.  1; 1; 1  .
¡¡logic-based abduction can be formally described as follows. given a logical theory t formalizing an application  a set m of manifestations  and a set h of hypotheses  find an explanation s for m  i.e.  a suitable set s   h such that t ¡È s is consistent and logically entails m. in this paper  we consider propositional abduction problems  paps  for short   where the theory t is represented by a propositional formula over a boolean algebra  {1};¡Å ¡Ä   ¡ú ¡Ô  or a boolean field z1 =  {1};+ ¡Ä   and the sets of hypotheses h together with the manifestations m consist of variables.
example 1 consider the following football knowledge base.
t = {weak defense ¡Å weakattack ¡ú match lost  match lost ¡ú manager sad ¡Ä pressangry starinjured ¡ú manager sad ¡Ä presssad }
moreover  let the set of observed manifestations be
m = {manager sad  pressangry }
finally  let the set of hypotheses be given as
h = {weak defense  weak attack  starinjured }
this pap has six abductive explanations  =  solutions  .
s1 = {weak defense} s1 = {weak attack}
s1 = {weak defense  weakattack}
s1 = {weak attack  starinjured}
s1 = {weak defense  starinjured}
s1 = {weak defense  weakattack  starinjured}
¡¡obviously  in the above example  not all solutions are equally intuitive. indeed  for many applications  one is not interested in all solutions of a given pap p but only in all acceptable solutions of p. acceptable in this context means minimal w.r.t. some preorder  on the powerset 1h. the most natural preorder is subset-minimality  . this criterion can be further refined by a hierarchical organization of our hypotheses according to some priorities  cf.  . in this context  priorities can be considered as a qualitative version of probability. the resulting preorder is denoted by  p. on the other hand  if indeed all solutions are acceptable  then the corresponding preorder is the syntactic equality =.
¡¡in example 1  only the solutions s1 and s1 are subsetminimal. moreover  suppose that for some reason we know that  for a specific team  weakdefense is much less likely to occur than weak attack. this judgment can be formalized by assigning lower priority to the former. thus  only s1 is considered as  p-minimal w.r.t. these priorities.
¡¡the usually observed algorithmic problem in logic-based abduction is the existence problem  i.e. deciding whether at least one solution s exists for a given abduction problem p. another well-studied decision problem is the so-called relevance problem  i.e. given a pap p and a hypothesis h ¡Ê h  is h part of at least one acceptable solution  however  this approach is not always satisfactory. especially in database applications  in diagnosis  and in data-mining there exist situations where we need to know all acceptable solutions of the abduction problem or at least an important part of them. consequently  the enumeration problem  i.e.  the computation of all acceptable solutions  has received much interest  see e.g.  1; 1  . another natural question is concerned with the total number of solutions to the considered problem. the latter problem refers to the counting complexity of abduction.
#-abduction=  pgeneral case#¡¤conp#¡¤conp#¡¤¦°1pt is horn#p#p#¡¤conpt is definite horn#p#p#pt is dual horn#p#p#pt is bijunctive#p#p#¡¤conpt is affinefp#p#ptable 1: counting complexity of propositional abduction
clearly  the counting complexity provides a lower bound for the complexity of the enumeration problem. moreover  counting the number of abductive explanations can be useful for probabilistic abduction problems  see e.g.  . indeed  in order to compute the probability of failure of a given component in a diagnosis problem  under the assumption that all preferred explanations are equiprobable   we need to count the number of preferred explanations as well as the number of preferred explanations that contain a given hypothesis.
¡¡the counting complexity has been started by valiant  1; 1  and is now a well-established part of the complexity theory  where the most known class is #p. many counting variants of decision problems have been proved #p-complete. higher counting complexity classes do exist  but they are not commonly known. a counting equivalent of the polynomial hierarchy was defined by hemaspaandra and vollmer   whereas generic complete problems for these counting hierarchy classes were presented in .
results. the goal of this work is to provide a comprehensive analysis of the counting complexity of propositional abduction in various settings. an overview of our results is given in table 1. the columns of this table correspond to the three preorders on 1h considered here for defining the notion of acceptable solutions  namely equality =  subsetminimality    and subset-minimality with priorities  p.
¡¡apart from the general case where the theory t is an arbitrary propositional formula  we also consider the subclasses of horn  definite horn  dual horn  bijunctive  and affine theories t. the aforementioned classes enjoy several favorable properties. for instance  they are closed under conjunction and existential quantification  i.e.  a conjunction of two formulas from c belongs to the class c and a formula from c with an existentially quantified variable is logically equivalent to another formula from c. moreover  they represent the most studied formulas in logic  complexity  constraint satisfaction problems  and artificial intelligence. this is mainly due to schaefer's famous result that the satisfiability problem for them is polynomial as opposed to the np-completeness of the general case  see  .
structure of the paper. the paper is organized as follows. after recalling some basic definitions and results in section 1  we analyze the counting complexity of propositional abduction for general theories  section 1   for horn  definite horn  dual horn and bijunctive theories  section 1  and finally for affine theories  section 1 . we conclude with section 1.
1 preliminaries
1 propositional abduction
a propositional abduction problem  pap  p consists of a tuple  where v is a finite set of variables  h   v is the set of hypotheses  m   v is the set of manifestations  and t is a consistent theory in the form of a propositional formula. a set s   h is a solution  also called explanation  to p if t ¡È s is consistent and t ¡È s |= m holds. priorities are a stratification of the hypotheses h = h1 ¡È¡¤¡¤¡¤¡Èhk into a fixed number of disjoint sets. the subset-minimality with priorities relation a  p b holds if a = b or there exists an i ¡Ê {1 ... k} such that
a ¡É hj = b ¡É hj for all.
¡¡in this paper  we follow the formalism of eiter and gottlob   allowing only positive literals in the solutions  except for the affine case. in contrast  creignou and zanuttini  also allow negative literals in the solutions s. we apply the latter to affine paps  where we need the possibility in the algebraic setting to assign a variable to 1.
¡¡together with the general case where t can be an arbitrary propositional formula  we consider the special cases where t is horn  definite horn  dual horn  bijunctive  and affine. due to schaefer's famous dichotomy result  see    these are the most frequently studied sub-cases of propositional formulas. a propositional clause c is said to be horn  definite horn  dual horn  or bijunctive if it has at most one positive literal  exactly one positive literal  at most one negative literal  or at most two literals  respectively. a clause c is affine if it can be written in the form of a linear equation x1 + ¡¤¡¤¡¤ + xk = b over the boolean field z1. a theory t is horn  definite horn  dual horn  bijunctive  or affine if it is a conjunction  or  equivalently  a set  of horn  definite horn  dual horn  bijunctive  or affine clauses  respectively.
1 counting complexity
the #-abductionproblemis the problemof counting the number of solutions of a pap p. the #- -abduction problem counts the subset-minimal solutions of p  whereas #- pabduction counts the minimal solutions w.r.t. priorities p.
¡¡formally  a counting problem is presented using a witness function which for every input x returns a set of witnesses for x. a witness function is a function w: ¦²  ¡ú p ¦Ø ¦£    where ¦² and ¦£ are two alphabets  and p ¦Ø ¦£   is the collection of all finite subsets of ¦£ . every such witness function gives rise to the following counting problem: given a string x ¡Ê ¦²   find the cardinality |w x | of the witness set w x . according to   if c is a complexity class of decision problems  we define #¡¤c to be the class of all counting problems whose witness function w satisfies the following conditions.
1. there is a polynomial p n  such that for every x ¡Ê ¦²  and every y ¡Ê w x  we have |y| ¡Ü p |x| ;
1. the problem  given x and y  is y ¡Ê w x    is in c.
it is easy to verify that #p = #¡¤p. the counting hierarchy is ordered by linear inclusion . in particular  we have that #p   #¡¤conp   #¡¤¦°1p   #¡¤¦°1p  etc. note that one can  of course  also consider the classes #¡¤np  #¡¤¦²1p  #¡¤¦²1p  etc. however  they play no role in this work.
¡¡the prototypical #¡¤¦°kp-complete problem for k ¡Ê n is #¦°ksat   defined as follows. given a formula
¦× x  =  y1 y1 ¡¤¡¤¡¤qkyk   x y1 ... yk  
where   is a boolean formula and x y1 ... yk are sets of propositional variables  count the number of truth assignments to the variables in x that satisfy ¦×.
¡¡completeness of counting problems in #p is usually proved by means of turing reductions. however  these reductions do not preserve the counting classes #¡¤¦°kp. it is therefore better to use subtractive reductions  which preserve the aforementioned counting classes. we write #¡¤r to denote the following counting problem: given a string x ¡Ê ¦²   find the cardinality |r x | of the witness set r x  associated with x. the counting problem #¡¤a reduces to #¡¤b via a strong subtractive reduction if there exist two polynomialtime computable functionsf and g such that for each x ¡Ê ¦² : b f x     b g x   and |a x | = |b g x  |   |b f x  |
a strong subtractive reduction with b f x   =   is called parsimonious. a subtractive reduction is a transitive closure of strong subtractive reductions.
1 general propositional theories
the decidability problem of propositional abduction was shown to be ¦²1p-complete in . the hardness part was proved via a reduction from qsat1. a modification of this reduction yields the following counting complexity result.
theorem 1 the #-abductionproblem and the #- -abduction problem are #¡¤conp-complete.
proof: the #¡¤conp-membership is clear by the fact that it is in ¦¤1p to test whether a subset s   h is a solution  resp. a subset-minimal solution  of a given pap  see   proposition 1.1 . the #¡¤conp-hardness is shown via the following parsimonious reduction from #¦°1sat. let an instance of the #¦°1sat problem be given by a formula
	¦× x 	=	 y   x y  
with x = {x1 ... xk} and y = {y1 ... yl}. moreover  let denote fresh  pairwise distinct variables and let. we define the pap as follows.

obviously  this reduction is feasible in polynomial time. we now show that the reduction is indeed parsimonious.
¡¡the manifestations r together with the formulas xi ¡ú ri   enforce that in every solution s of the pap  we have to select at least one of xi and. the additional formula enforces that we have to select at most one of. by these two conditions  the value ofis fully determined by xi  namelyis the dual of xi.
¡¡moreover  it is easy to check that there is a one-to-one relationship between the solutions s   x of p and the models of  y   x y  . hence  this reduction is indeed parsimonious. the complementarity of enforces each solution to be incomparable with the others and  therefore  to be subsetminimal.	
¡¡according to the above theorem  #-abduction and #- abduction have the same counting complexity. intuitively  this is due to the following equivalence  cf.  : s is a  minimal solution of the pap p  if and only if s is a solution of p and for every is not a solution. hence  taking the  -minimality into account makes things only polynomially harder. in contrast  as soon as there are at least 1 priority levels  the following effect may occur. suppose that s is a solution of the pap and thatis not a solution for every h ¡Ê s. then it might well happen that  for some h ¡Ê s  some set of the formis a solution  where all hypotheses in x have higher priority than h. checking if such a set s  and  in particular  if such a set x  exists comes down to yet another non-deterministic guess. formally  we thus get the following complexity result.
theorem 1 the #- p-abduction problem is #¡¤¦°1p-complete via subtractive reductions.
proof: the  p-minimal solutions of a pap can obviously be computed by a non-deterministic polynomial-time turing machine that generates all subsets s   h and  i  checks whether s is a solution of the pap and  ii  if so  checks whether s is  p-minimal. the latter test - which is the most expensive part - can be done by a ¦°1p-oracle. indeed  the problem of testing that s is not  p-minimal can be done by the following ¦²1p-algorithm: guess a subset is  p-smaller than s and check that s is a solution of the pap. hence  the #- p-abduction problem is in #¡¤¦°1p.
¡¡the #¡¤¦°1p-hardness is shown by the following  strong  subtractive reduction from #¦°1sat. let an instance of the
#¦°1sat problem be given by a formula
	¦× x 	=	 y  z   x y z 
with the variables x = {x1 ... xk}  y = {y1 ... yl}  and
 z = {z1  ... zm}. moreover  let   be fresh  pairwise distinct vari-
=	1	k  	=	1	k  	=
  and q = {q1 ...  ql}. then we define two paps p1 and p1 as follows.

	with priorities	and 

finally we set.
¡¡obviously  this reduction is feasible in polynomial time. now let a ¦×  denote the set of all satisfying assignments of a #¦°1sat-formula ¦× and let b p  denote the set of  pminimal solutions of a pap p. we claim that the above definition of the paps p1 and p1 is indeed a  strong  subtractive reduction  i.e. that
¡¡b p1    b p1  and |a ¦× | = |b p1 |   |b p1 | due to lack of space  the proof of this claim is omitted. 
1 horn  dual horn  and bijunctive theories
in this section  we consider the special case where the theory t is a set of  arbitrary or definite  horn  dual horn  or bijunctive clauses. if no minimality criterion is applied to the solutions then we get the following result.
theorem 1 the #-abductionproblem of horn  definite horn  dual horn  or bijunctive clauses is #p-complete.
proof: the #p-membership is easily seen by the fact that it can be checked in polynomial time whether some subset s   h is a solution  since the satisfiability and also the unsatisfiability of a set of  dual  horn or bijunctive clauses can be checked in polynomial time.
¡¡for the #p-hardness  we reduce the #positive-1sat problem  which is known to be #p-complete by   to it and show that this reduction is parsimonious. let an arbitrary instance of #positive-1sat be given as a 1cnf-formula ¦× =  p1 ¡Å q1  ¡Ä ¡¤¡¤¡¤ ¡Ä  pn ¡Å qn  
where the pi's and qi's are propositionalvariables from the set x = {x1 ... xk}. moreover  let g1 ... gn denote fresh  pairwise distinct variables and let g = {g1 ... gn}. then we define the pap
v=x ¡È gh=xm=gt={pi ¡ú gi | 1 ¡Ü i ¡Ü n} ¡È {qi ¡ú gi | 1 ¡Ü i ¡Ü n}obviously  this reduction is feasible in polynomial time. moreover  it is easy to check that there is a one-to-one relationship between the solutions s   x of p and the models of ¦×. note that the clauses in t are at the same time definite
horn  bijunctive  and dual horn.	
¡¡analogously to the case of general theories  the counting complexity remains unchanged when we restrict our attention to subset-minimal solutions.
theorem 1 the #- -abduction problem of horn  definite horn  dual horn  or bijunctive clauses is #p-complete.
proof: the #p-membership holds analogously to the case of abduction withoutsubset-minimality. this is due to following property  see   proposition 1.1 . s   h is a subsetminimal solution of p  if and only if s is a solution and for all h ¡Ê s  the setis not a solution of p.
¡¡for the #p-hardness  we modify the reduction from the #positive-1sat problem in theorem 1. let ¦×  x  and g be defined as before. moreover  letand r = {r1 ... rk} be fresh  pairwise distinct variables. then we define as follows.

the idea of the variables x and the additional manifestations g is exactly the same as in the proof of theorem 1.
¡¡actually  the formulacan even be omitted. this is due to the fact that  whenever a subset
 s is a solution of p  thenis also a solution since is useless as soon as xi is present  note that the only use of  is to derive ri in the absence of xi . therefore in a subsetminimal solution of the pap p  we will never select both xi and even without the formula. the remaining formulas are indeed definite horn and dual horn. 
¡¡below we consider paps with  p-minimality. it turns out that for definite horn and dual horn clauses  the priorities leave the counting complexity unchanged. in all other cases  the counting complexity increases.
theorem 1 the #- p-abduction problem of definite horn and of dual horn clauses is #p-complete.
proof: the #p-hardness is clear  since it holds even without priorities. the #p-membership for definite horn clauses is proved as follows. let where t consists only of horn clauses. according to   theorem 1.1  for any s   h  we can check in polynomial time whether s is a  p-minimal solution. the #p-membership for definite horn clauses is thus proved.
¡¡now suppose that t is dual horn  i.e. the clauses in t are either of the form  p or  p ¡Å q1 ¡Å ¡¤¡¤¡¤ ¡Å qm  or q1 ¡Å ¡¤¡¤¡¤ ¡Å qm  for p q1 ... qm ¡Ê v and m ¡Ý 1 . moreover  let n denote the propositional variables occurring in negative unit clauses in t  i.e. n = {p |  p ¡Ê t}. then for every solution s of p we have  since otherwise t ¡È s would be inconsistent. moreover  for any s with the set s is also a solution of p  since  by the special form of dual horn is also consistent and  by the monotonicity ofalso implies m.
¡¡let h1 ... hk denote the priorities of h. now s is a  p-minimal solution of p if and only if s is a solution of p and for all i ¡Ê {1 ... k} and for all x ¡Ê  s ¡É hi  the set

is not a solution of p. the latter test is clearly feasible in polynomial time in the dual horn case. 
¡¡recall from our remark preceding theorem 1 that the effect of at least 1 priority levels is as follows. in order to check that some solution s is not  p-minimal  we have to test that there exists some solution of the form  where all hypotheses in x have higher priority than h. in general  the difficulty of determining if such a set x exists is the following one. if we choose x too small  then s might not entail the manifestations m. if we choose x too big  then might be inconsistent. the intuition underlying theorem 1 is that the problem of choosing x too big disappears for definite horn and dual horn clauses. for definite horn  the only candidate x that has to be checked is x = hi+1 ¡È¡¤¡¤¡¤¡Èhk. for dual horn  the only candidate x is x =  hi+1 ¡È ¡¤¡¤¡¤ ¡È hk  ¡É n  where n takes care that if the theory t contains a negative unit clause  p  then p must not be included in any solution.
theorem 1 the #- p-abduction problem of horn or bijunctive clauses is #¡¤conp-complete.
proof: the #¡¤conp-membership is established as follows: given a set of variables s  we have to  i  check whether s is a solution of the pap and  ii  if so  check whether s is  pminimal. the latter test  which dominates the overall complexity  can be done by a conp-oracle. indeed  the problem of testing that s is not  p-minimal can be done by the following np-algorithm: guess a subsetsmaller than s and check  in polynomial time for a horn or bijunctive theory   that s is a solution of the pap. hence  in this case  #- p-abduction in #¡¤conp.
¡¡the #¡¤conp-hardness is shown by a  strong  subtractive reduction from #¦°1sat. let an instance of the #¦°1sat problem be given by a formula ¦× x  =  y   x y   with x = {x1 ... xk} and y = {y1 ... yl}. w.l.o.g.  see    we may assume that   x y   is in 1dnf  i.e.  it is of the form c1 ¡Å ¡¤¡¤¡¤ ¡Å cn where each ci is of the form ci = li1¡Äli1¡Äli1 and the lij's are propositionalliterals over
let 1 ... xk  p1 ... pk  y1 ... yl  q1 ... ql  g1
=	1	k  	=	1	l  	=	p1 ... pk} 
q = {q1 ... ql} and g = {g1 ... gn}. then we define two paps p1 and p1 as follows.

with priorities

where zij is either of the formdepending on whether the literal lij in ci is of the form  xk  xk   yl  or yl  respectively. in other words  zij encodes the dual of lij.
t1 = t1 ¡È {r ¡ú gi | 1 ¡Ü i ¡Ü n} ¡È {r ¡ú yj | 1 ¡Ü j ¡Ü l}
finally  we set.
¡¡obviously  this reduction is feasible in polynomial time. now let a ¦×  denote the set of all satisfying assignments of a #¦°1sat-formula ¦× and let b p  denote the set of  pminimal solutions of a pap p. we claim that p1 and p1 have the following property.
	b p1    b p1 	and	|a ¦× | = |b p1 |   |b p1 |
due to lack of space  the proof of this claim is omitted. 
1 affine theories
in this section  we consider the special case where the theory t is a set of affine clauses. recall that such a set can be written as a linear system ax = b over the boolean field z1. we change to the creignou and zanuttini approach  in this case  since we need the possibility to set a variable to 1. if no minimality criterion is applied to the solutions then we get the following result.
theorem 1 the #-abduction of affine clauses is in fp.
proof: given an affine papwhere t is an affine system ax = b  we reduce it to the problem of counting the satisfying assignments of linear systems over z1. recall that t ¡È s |= m means that x = 1 for each x ¡Ê s and x = 1 for each entails y = 1 for each
y ¡Ê m in the system t. first we check whether t ¡È s |= m can hold. if is nonempty then p has no solution  since we cannot force all y ¡Ê m to y = 1. otherwise transform the system ax = b to ey = b + fz  where y   m and z ¡É m =    such that ey + fz = ax. transform
 ey by gaussian elimination to smith normal form giving  has a row with more than one variable  say yi1 + ¡¤¡¤¡¤ + yil for l ¡Ý 1  then either p has no solution  or each solution s compatible with yi1 = ¡¤¡¤¡¤ = yil = 1 is also compatible with yij = 1 for some has only rows with one variable  then add to ax = b the equations y = 1 for each y ¡Ê m  resulting in the new system
. check whether the last system is satisfiable and transform it by gaussian elimination into the smith normal
 . each truth assignment i of the variables satisfying the linear system determines a solution s of p  i.e.  s = {y ¡Ê h | i y  = 1} ¡È { y | i y  = 1}. let the linear system  rows. then there are  different solutions of p. 
theorem 1 the #- -abduction problem of affine clauses is #p-complete.
proof: the #p-membership is clear from the fact that it can be checked in polynomial time whether a set s   h is a subset-minimal solution of an affine system according to proposition 1 in . the problem of minimal affine extension  namely that given an affine system ax = b and a partial assignment s to the variables x  count the number of extensions s which are minimal solutions of ax = b  is proved to be #p-complete in  even if the partial assignment contains no 1. there is a parsimonious reduction to an affine pap as follows. let v = h = x  m = {xi ¡Ê x | s xi  = 1}  and t = {ax = b}. let
y   x be the variables not assigned by s and let s¡¥ be an extension of s satisfying the affine system. then the set of variables s = {xi ¡Ê y | s¡¥ xi  = 1} is a subset-minimal solution of p if and only if the extension s¡¥is minimal. 
theorem 1 the #- p-abduction problem of affine clauses is #p-complete.
proof: the #p-hardness is clear  since it holds without priorities. the #p-membership for affine clauses is proved as follows. let where t is a linear system
ax = b over z1. let h1  ...  hk denote the priorities of h. now s is a  p-minimal solution of p if and only if s is a solution of p  there exists an i ¡Ê {1 ... k} such that s ¡Éhi is subset-minimal   and for each j   i and all other solutions
of p we have. we can decide in polynomial time if s ¡É hi is a subset minimal solution of an affine system. the second condition is tested in polynomial time as follows. for each j   i we set the variables in the system ax = b equal to 1  resulting in a system. then the identity holds if and only if the resulting system has at most one solution  what can be tested in polynomial time. hence the overall test can be performed in polynomial time. 
1 conclusion
eiter and gottlob proved in  a plethora of complexity results for propositional abduction. their results were extended to a trichotomy of paps without minimality-criterion by creignou and zanuttini . the use of complexity results is usually twofold. theoretically  they give us a better understanding of the nature of the considered problem class. practically  they give us a hint as to which subclass of the problem we should aim at  provided that the application in mind admits such a restriction. in this sense  the counting complexity results shown here are important in complementing the already known decision complexity results. note that our results reveal significant differences between the counting complexity behavior of paps and the decision complexity. for instance  definite horn abduction and bijunctive abduction were shown to be tractable in . in contrast  by our theorem 1  the corresponding counting problems are #pcomplete. this is one more example of the often observed  easy to decide  hard to count  phenomenon.
¡¡from a complexity theoretic point of view  there is another interesting aspect to the counting complexity results shown here. the class #p has been studied intensively and many completeness results for this class can be found in the literature. in contrast  for the higher counting complexity classes #¡¤¦°kp  with k ¡Ý 1   very few complete problems are known apart from the generic problems#¦°ksat. in fact  to the best of our knowledge  our #¡¤¦°1p-completeness result in theorem 1 is the first one apart from #¦°1sat.
¡¡in this work  we have considered the complexity of determining the number of all -minimal explanations of a propositional abduction problem  where . note that in   complexity problemsrelated to abductionwith further notions of minimality were analyzed  namely  minimal cardinality  with or without priorities and  minimal weight . abduction with  minimal weight  can also be considered as cost-based abduction. we are planning to extend our counting complexity analysis to these notions of minimality.
