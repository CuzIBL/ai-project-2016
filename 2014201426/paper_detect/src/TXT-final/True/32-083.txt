 
simple temporal networks have proved useful in applications that involve metric time. however  many applications involve events whose timing is not controlled by the execution agent. a number of properties relating to overall controllability in such cases have been introduced in  vidal and ghallab  1  and  vidal and fargier  1   including weak and strong controllability. we derive some new results concerning these properties. in particular  we prove the negation of weak controllability is np-hard  confirming a conjecture in  vidal and fargier  1 . we also introduce a more general controllability property of which weak and strong controllability are special cases. a propagation algorithm is provided for determining whether the property holds  and we identify tractable cases where the algorithm runs in polynomial time. 
morris and muscettola 	1 　in practice  temporal uncertainty is usually eliminated by padding each uncertain interval with a flexible wait period. for example  a task duration may be modeled as the upper bound of the task's possible executions. in this case  the event at the end of a task does not represent the time at which the task actually ends. instead  it constitutes a waypoint  i.e.  a time by which we can guarantee that the task has ended. synchronization with respect to waypoints can now proceed without uncertainty and simple temporal networks are completely adequate. although this use of waypoints provides a workable solution to the problem of execution uncontrollability  its indiscriminate application may not be desirable or possible. for example  it may obstruct tight synchronization with respect to follow-on requirements. moreover  it may not be possible to add a wait period after each uncertain delay if several uncontrollable delays are causally connected. 
　in this paper we introduce waypoint controllability  a general framework for a formal analysis of when networks that incorporate uncontrollable delays can be suc-

1 	introduction 
simple temporal networks  dechter et a/.  1  have proved useful in planning and scheduling applications that involve metric time  e.g.  bienkowski and iloebel  1; muscettola et a/.  1a  . however this formalism does not adequately address an important aspect of real execution domains: the occurrence time of some events may not be under the complete control of the execution agent. for example  when a spacecraft commands an instrument or interrogates a sensor  a varying amount of time may intervene before the operation is completed. in cases like this  the execution agent cannot select the precise time delay between events in accord with the timing of previously executed events. instead  the value is selected by nature independently of the agent's choices. this can cause inconsistencies at execution time even if the simple temporal network appeared consistent at plan generation time. the problem of control of temporal networks with uncertainty was first addressed formally in  vidal and ghallab  1 and  vidal and fargier  1 . 
cessfully executed. waypoint controllability generalizes the concepts of strong and weak controllability  vidal and ghallab  1; vidal and fargier  1 . roughly speaking  strong controllability supplies a guarantee of a fixed execution that works irrespective of the outcomes of the uncontrollable delays  while the absence of weak controllability means that there are some outcomes for which no execution will work. subject to restrictions on the type of network  an algorithm is presented in  vidal and ghallab  1  that determines strong controllability in deterministic polynomial time. it is shown in  vidal and fargier  1  that the negation of weak controllability is in  and it is conjectured that the problem is -complete. 
　we prove here that the negation of weak controllability is indeed   this complexity result applies also to waypoint controllability  of which weak controllability is a special case. sufficient conditions are presented for the tractability of waypoint controllability. from these  we are able to derive the tractability of strong controllability while relaxing the restrictions in  vidal and ghallab  1 . we also provide a propagation algorithm for determining waypoint controlla-


figure 1: simple temporal network. 

figure 1: distance graph. 
bility. finally we discuss the relationship between waypoint controllability and dynamic. controllability  where knowledge of uncontrollable delays is updated during execution. 
1 	preliminaries 
we assume the reader is broadly familiar with simple 
temporal networks  dechter et al.  1 . the definition is briefly reviewed here to set the stage for subsequent developments. 
　a simple temporal network  stn  is a graph in which the edges are labelled with upper and lower numerical bounds. the nodes in the graph represent temporal events or timepoints  while the edges correspond to constraints on the durations between the events. formally  an stn may be described as a 1-tuple 
where n is a set of nodes  e is a set of edges  and  and  are func-
tions mapping the edges into extended real numbers. figure 1 shows an example of an stn. figure 1 shows the corresponding distance graph  dechter et al.  1   which is an alternate representation useful for mathematical analysis. note that lower bounds are negated to give the lengths of the reverse edges. edges of infinite length are omitted.  given a distance graph  one can also find a corresponding stn  so the representations are interchangeable.  an stn is consistent if and only if the distance graph does not contain a negative cycle. 
controllability problems  vidal and ghallab  1; 
vidal and fargier  1  arise in stns where the edges  which we will call links  are divided into two classes  causal links and requirement links. the causal links are 
regarded as representing intervals whose duration is controlled by nature  subject to the limits imposed by the upper and lower bounds. the timepoints are regarded as variables. the goal is that they should have values that satisfy all the requirement links as well as whatever values are chosen by nature for the causal links. 
1 	temporal reasoning 
definition 1 a simple temporal network with uncertainty  vidal and fargier  1   stnu  is a 1-tuple  where n e l u are as in a stn  and c is a subset of the edges. the edges in c are called the causal links  and the other edges are the requirement links. we require  for each causal link e. 
　the requirement that the lower bounds of causal links be positive corresponds to the assumption that causal influences propagate only forward in time.  only theorem 1 actually makes use of this.  also notice that if a link e is rigid  then there is little point in making e a causal link  since there is no uncertainty in the outcome. 
　each set of choices made by nature for the causal links may be thought of as reducing the stnu to an ordinary stn. thus  an stnu determines a family of stns  as in the following definition. 
definition 1 suppose 	is an 
stnu. a projection  vidal and ghallab  1  of y is a simple temporal network derived from f where each requirement link is replaced by an identical stn link  and each causal link c is replaced by an stn link with equal upper and lower bounds  for some b such that 

　a boundary projection  vidal and fargier  1  is one where  for each causal link e  the above b is chosen so that 
　the simplest type of controllability property is concerned with whether some outcomes of the causal choices render it impossible to satisfy the requirements. 
definition 1 an stnu is weakly controllable  vidal and ghallab  1  if every one of its projections is a consistent stn. if an stnu is not weakly controllable  we will say it is weakly uncontrollable. 
　it is shown in  vidal and fargier  1  that weak uncontrollability can be determined in non-deterministic polynomial time  and that in fact the checking may be limited to the boundary projections.  recall that consistency of a distance graph may be checked in polynomial time by the bellman-ford-moore algorithm  cormen et al  1 .  
theorem 1   v i d a l and fargier  1  /f any projection is inconsistent  then a boundary projection is in-
consistent. 
1 weak uncontrollability np- completeness 
we now address the issue of showing weak uncontrollability is  since it is known from  vidal and fargier  1 that the problem is in afv  it remains to show it is 
theorem 1 	weak uncontrollability is afv-hard. 
proof: we show this by reduction of the 1-coloring 
problem  which is known to be afp-complete  cormen et al  1 . 


figure 1: nodes and colors widget. 
　our goal will be to construct a mapping from coloring problems to stnu distance graphs such that a solution to the coloring problem maps to a negative cycle in some projection of the stnu  and vice versa. for expository purposes  we adopt the widget approach of  gormen et al.  1 . 
　the first widget describes how nodes and colors from the coloring problem are represented in the stnu distance graph. this is illustrated in figure 1 for a coloring problem with 1 nodes  the node a from the coloring problem maps to a pair of nodes ax and ay. the three possible colors of a correspond to three concurrent paths from as shown.  the labels red  green  and blue do not actually appear in the temporal network; they are merely shown for the convenience of the reader.  a similar mapping is shown for nodes b and c. 
	suppose 	the 	coloring 	problem 	has 	n 	nodes 
  listed in some arbitrary order . 	we link all the node widgets to form a cycle by adding temporal edges 	and 
　　　　　　　this is also illustrated in figure 1. note that each complete set of color choices determines a cycle in the network. conversely  each cycle selects a 
　　　　　　　single color for each node. 
　so far  we have not assigned lengths to the distance graph edges. the final edge in the stnu distance graph  e.g.   in figure 1  is given a length of -1. 
apart from the mutex widgets  discussed below   all the other edges have zero length. notice that  so far  all combinations of color choices give rise to slightly negative  value -1  cycles in the distance graph. 
　　our next task is to represent in the temporal network the mutual exclusion constraints determined by the edges of the coloring problem.  nodes connected by an edge must have different colors.  we will do this by setting up  mutex  widgets between color paths that correspond to conflicting color choices. figure 1 shows how to make two color paths mutually exclusive from negative cycles. here l is a positive number large enough so that if a path through the widget has length l or greater  then it cannot possibly be on a negative cycle.  setting suffices here.  notice the edges and are each shown with two values for the edge length; these correspond to a causal link from p to q with bounds  and the different lengths are for the different boundary projections. 
　there are four paths through the mutual exclusion widget that may potentially lie on negative cycles: the 

figure 1: mutual exclusion widget. 

figure 1: multiple constraints. 
two color paths 	and 
	and the two short paths 	and 
notice that both of the short paths 
pick up a value of l  so they are definitely not on negative cycles. the two color paths may or may not be on negative cycles. 
　　recall that to check for weak uncontrollability  we need only consider boundary projections  where the p -  q causal link has a rigid length of either in the distance graph  this corresponds to values of either 
and  respectively  o r a n d respectively  for the forward  from p to q  and backward  from q to p  edges. in the first case  the color path from a  to 
a1 has distance 1  while that from  in the second case  the path from b  to b1 has distance 1 while that from .1 to a1 has distance  i.e.  the values are reversed. notice that in either case  at most one of the two color paths can be on a negative cycle  i.e.  they mutually exclude each other from such cycles. 
　the same node in the color graph may participate in several color constraints. in the temporal network  we represent these by mutual exclusion widgets connected in series  as illustrated in figure 1  where each  mutex  box indicates a mutual exclusion widget between the  color path and some other color path  not shown . 
　this completes the construction. now suppose the coloring problem has a solution. we can use the color choices to determine a cyclic path in the distance graph that passes through each mutual exclusion widget at most once  find then traverses the -1 edge. since there is a projection that sets the chosen passages through the mutual exclusion widgets to zero distance  the cycle will have a total length of - 1 . thus  the constructed stnu is not weakly controllable. conversely  suppose there is 
	morris and muscettola 	1 

a negative cycle in some projection. this cannot include any of the short paths  since if it did  the cycle would be non-negative. consequently  the cycle includes only color paths  as illustrated in figure 1. thus  it selects a single color for each color node. if two of the selections were in conflict  then the cycle would pass through some mutex widget twice  which contradicts the assumption that the cycle is negative. thus  the color selection provides a solution to the coloring problem. 
this reduction of the 1-coloring problem shows weak 
uncontrollability is np-complete. d 
1 	waypoint controllability 
now we consider a form of controllability in which we distinguish a subset of events  called waypoints  whose timing is set independently of the causal outcomes. 
definition 1 let  be an stnu. 
suppose w is a won-empty subset of n. 	we say  is 
waypoint controllable with respect to w if there is a fixed assignment of time values to the nodes in w that can be extended to a solution in every projection of the nodes in w are called waypoints. 
   in  vidal and ghallab  1   the property of strong controllability is defined similarly  except a specific set of waypoints is used. their definition corresponds to a 
   waypoint set where  and are the sets of start and end points  respectively  of the causal links. however  strong controllability lacks flexibility. for example  if two causal links are chained  the end of one is the start of the other   strong controllability requires that both the start and end of the earlier causal link be waypoints. however  a fixed assignment to those points cannot be consistent with varying durations of a flexible causal link. thus  the network is not strongly controllable. this limits the usefulness of strong controllability in many networks; in the example above  some other set of waypoints  for instance  may be more realistic. 
　note that weak controllability is a special case of waypoint controllability where the waypoint set is a singleton  since it is always possible to select a single node and give it a fixed value that is extendible to a solution in every consistent projection. 
　we will shortly prove a useful characterization of waypoint controllability. however  some additional definitions are needed. given an stnu t and a set of waypoints w  we can define a simple temporal network s f  w  as follows. the set of nodes of is between every pair of nodes x and y in w  we place a distance graph edge e whose length is given by 
where p is the set of projections of t and is the shortest-path distance from x to y in the distance graph of projection  this leads to the following result  which may be regarded as a generalization of the result in  vidal and ghallab  1  concerning strong controllability in a restricted network. 
1 	temporal reasoning 
theorem 1 v is waypoint controllable with respect to w if and only if it is weakly controllable and is a consistent stn. 
proof: suppose t is waypoint controllable with respect to w. then there is a fixed assignment that can be extended to a solution in every projection of t. it follows that every projection has a solution  i.e.  f is weakly controllable. it also follows for every projection p  where 
gives the shortest-path distances as before. hence  
thus  s gives a 
　　conversely  assuming 1 is a solution to argument can be reversed to deduce that for every projection p  and every x and y in w. by weak controllability  every projection is consistent  so by decomposability  dechter et al.  1   s can be extended to a solution for every projection. 
　　it can be shown that in the minimizations  the set p may be restricted to boundary projections without affecting the minimum value. nevertheless  the cardinality of p is generally exponential in the size of the problem. indeed  the proof of theorem 1 can be adapted to show that the minimization problem is  however  theorem 1 leads to a propagation algorithm for computing waypoint controllability  and there are important special cases where it runs in polynomial time. 
1 	propagation algorithm 
the propagation algorithm is an elaboration of the approach used for checking stn consistency  dechter et a/.  1; cormen et al.  1   and requires that every node be reachable from the initial node  which must be selected to be a waypoint. the basic idea is that we can perform a separate propagation for each projection until we reach a waypoint. at the waypoint  the propagated values for the different projections can be merged  and only the minimum value carried forward. the process continues with new independent propagations to the next waypoint  and so on. notice that the updates at the waypoints simulate an ordinary stn propagation in s f  w . both stn inconsistency and weak uncontrollability imply a negative cycle  so propagation to quiescence is a reliable indicator of controllability by theorem 1. 
   actually  we can do even better if we observe that large segments of the propagation are the same for projections that arc closely related. this suggests sharing the work of propagation between the projections. we do this by associating a tag with each propagated value. the tag carries a description of which causal links have been traversed so far  and which of the boundary values were used in the traversals. we say one tagged value subsumes another if its tag is as general  i.e.  its causal choices are a subset of the other  and its value is as good  less than or equal to the other . subsumed tagged values are subject to deletion. otherwise  the tagged propagations do 


figure 1: algorithm for way point controllability 
not interact until they reach a waypoint  where the tags are reset to empty. the usual bellman-ford cutoff terminates the propagation in cases where the network is not controllable. figure g shows a pseudo-code description of the algorithm. note that l e n g t h l   e   and length are the lengths of e corresponding to the two boundary values  and the choice descriptors and  indicate which of those was used in the propagation. 
　similarly to the ordinary stn case  the propagation algorithm can be modified to propagate upper and lower time bounds. thus  it potentially provides not just a single solution for the waypoints  but a flexible set of acceptable time assignments with the same decomposability property as for an ordinary stn. an execution algorithm can make use of this flexibility  tsamardinos et a/.  1  to help manage contingencies that are unanticipated  in addition to the formally represented uncertain durations considered here. 
　note that in general the number of possible tags grows exponentially with the number of causal links. thus  in the worst case  the time and space complexities are exponential. fortunately  the waypoints can serve to limit the complexity  as seen in the following result. 
t h e o r e m 1 suppose m is the maximum number of causal links that can occur in a path 'with no interior waypoints. then the complexity of the waypoint controllability propagation algorithm is 
proof: since the tags get reset at waypoints  the size of tags is limited to the number of causal links encountered between waypoints. under the condition of the theorem  at most  different tagged values can reside at any node. the update across an edge then requires at most 

figure 1: need for tags 
subsumption tests  where each test can be done time. the bellman-ford bound restricts the 
number of edge updates to thus  the total complexity is 
corollary 1 the algorithm can determine strong controllability in polynomial time. 
proof: the waypoint set used in strong controllability has a waypoint at the start of each causal link. thus  at most two causal links can occur in a path between waypoints  so m is bounded for this class of problems. 

　we remark that a  no u-turn  restriction  muscettola et a/.  1b  is insufficient to avoid interference between 
projections in computing minimum distance. for example  in figure where is a causal link  the propagation would produce a value of 1 at which blocks the propagation that would provide a shorter distance of 1 from a to b. this kind of interference is avoided by the tag mechanism used here. 
1 	dynamic controllability 
note that waypoint controllability requires the setting of times for non-waypoint events to depend on the causal outcomes. however  this is only feasible in practice if information about the causal outcomes is available in time. one scenario is where precise information about causal outcomes is obtained by observation when they occur. this corresponds to a property called dynamic controllability defined in  vidal and fargier  1 . informally  an stnu is dynamically controllable if there is a mapping from projections to solutions such that the partial solution up to any time depends only on the durations of the causal outcomes that have completed by that time. we are interested in conditions under which waypoint controllability implies dynamic controllability. 
　the following conditions will be relevant. consider the distance graph of a waypoint controllable network. we say a node x is insulated from another node y if every path from y to j- passes through a waypoint.  note that a waypoint is therefore insulated from every node.  a node x is downstream from a node y if  in every projection  there is a path of negative length from x to y.  we will also say y is upstream  of x in this case.  note that if x is downstream from y  then x must occur later than y in any solution of any projection. finally  a node x is protected from y if x is either downstream from y or is insulated from y. this leads to the following result. 
t h e o r e m 1 let t be an stnu that is waypoint controllable with respect to some set of waypoints. suppose 
	morris and muscettola 	1 

every node x is either itself a causal link endpoint  or is protected from every causal link endpoint. then  is dynamically controllable. 
proof: from the definition of waypoint controllability  there is a fixed assignment of times to the waypoints that is consistent with every projection. consider any projection p. we can obtain a solution of p by propagating from the fixed times of the waypoints  and then choosing the latest possible time for each node  dechter et a/.  1 .  ensured to be finite by adding a source 
vertex as in  cormen et a/.  1  page 1 .  this defines a mapping  from projections to solutions. 
　let x be any node. suppose pi and p1 are two projections that agree on causal outcomes that are completed no later than  then they must agree on outcomes of causal links whose endpoint is upstream from x  we wish to show that  and  must agree on the timing of x. we prove this by induction on the partial ordering imposed by the downstream relation  which allows us to suppose by induction that  and agree on the timing of all nodes upstream of x. 
　first consider the case where x is the endpoint of a causal link e. let x' be the startpoint of e. by the definition of stnu  / e    1. thus  x' is upstream of x. it follows that  and  agree on the timing of x'. also pi and p1 agree on the outcome of e  since it is completed no later than x. thus   and agree on the timing of x. 
　otherwise  x is not the endpoint of a causal link. let e 
　be any causal link  and suppose its endpoint is y. by the condition of the theorem  x is either downstream of y or is insulated from y. in the former case  y is upstream of x  so by the inductive hypothesis  and  agree on y. thus  any value propagated from y to x will be the same for pi and p'1. if on the other hand x is insulated from y  then any propagation from y to x is blocked by the fixed assignments given the waypoints. thus  .;: will have the same propagated window for both p  and p1  and so $ will assign x the same time value in both cases. 
　it follows that the value of x depends only on causal outcomes that are completed no later than x. thus  t is dynamically controllable. 
corollary 1   v i d a l and fargier  1  strong controllability implies dynamic controllability. 
proof: strong controllability corresponds to a set of waypoints such that every node is either a  causal link endpoint or a waypoint. in the latter case it is automatically insulated from every node. 
1 	closing remarks 
waypoint controllability provides a useful analysis tool that can be used by a planner to decide whether granting the executive access to uncertain events compromises controllability of a flexible plan. we have shown that the cost of controllability analysis can be affordable  provided that the planner judiciously manages the placement of uncontrollable links in the plan topology. 
1 	temporal reasoning 
　one important consequence of waypoint controllability is the possibility of devising more general and principled guidelines on the introduction of wait periods in a plan. the end time point of a suitable wait link can be made a waypoint. therefore  appropriately located wait periods can partition a plan into compartments that are insulated from each other as far as the effects of uncertain events are concerned. 
　previous work on strong controllability restricted the plan topologies for which controllability is guaranteed  and severely limited the extent to which an executive can react to uncertain events. for example  strong controllability does not allow an executive to have access to an event linking two uncontrollable tasks. waypoint controllability shows that such limitations can be lifted provided that small subnetworks of uncontrollable links  with arbitrary topology  are insulated from the rest of the plan through the appropriate use of wait periods. 
acknowledgments 
we thank ari jonsson and pandu nayak for suggestions to improve the presentation. 
