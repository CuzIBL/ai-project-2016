 
in this paper  we present qualex  a system and algorithm for generating first-order qualitative causal graphs for tutorial purposes based on de kleer and brown's qualitative modeling theory. qualex is embedded in a constructive simulation environment called heart works which teaches hydraulics principles about the cardio-vascular system to first year college biology students. 
1 	introduction 
drawing on the rich literature from mental models and qualitative physics  we find that qualitative causal reasoning is not only a central and coherent aspect of human mental life  forbus and gentner  1a; pearl  1   but also expertise. problem-solving within physical domains typically begins with a qualitative causal analysis of the problem  dekleer and brown  1; forbus  1; larkin  1; williams et a/.  1 . educational research has built on this evidence with both detailed studies of scientific concept acquisition  disessa  1; clement  1; forbus and gentner  1b; white and 
horwitz  1  and pedagogical design with a qualitative causal emphasis  brown et a/.  1; reif  1; white and frederiksen  1a and b; white and horwitz  1 . 
　in elementary physics education the pedagogical issues relate to whether  when and how to introduce qualitative reasoning into a predominate emphasis on quantitative methods. in contrast  elementary biology education  e.g. a first-year college for non-majors  tends to an entirely qualitative approach that can best be described as contrastive classification. the students' primary learning task is to absorb facts and causal relations as facts about a particular type  system  structure or function. students are rarely expected to problem-solve and the laboratory is intended to give the student experience with real entities and procedural operation of equipment. 
   *we wish to express our gratitude to the rest of the research group of heart works: nils peterson  dan udovic  keith downing  carla wenzlaff  and eckehard doerry. this research is supported in part by the fund for improvement of post secondary education  fipse   u. s. department of education. 
thus  although the student is given qualitative explanations  they are rarely sufficiently formal and robust to allow her or him to learn underlying principles and predict behavior. most biology students do not come with sufficient background in physics. the following quote is typical of the standard textbook treatment of the cardiovascular system. 
even though the total cross-sectional area increases in the terminal arteries  arterioles  and capillaries and even though the rate of blood flow through individual vessels decreases in tandem  these vessels  because of their small diameter  are the major sites of resistance in the circulation. this is reflected in precipitous drops in blood pressure. 
　much of this situation is not the fault of biology educators: biological systems are exceedingly complex and comparatively unknown. however  the cardio-vascular system is one of the few systems which is well-enough understood in terms of hydraulic principles to give us the rare opportunity to introduce to biology students through simulation these pedagogical objectives:  1  teach general scientific principles that underlie the operation of complex biological systems   1  develop skills for integrating knowledge about complex systems  and  1  make lab experience more accessible. 
   for the past two years we have been engaged in an intelligent tutoring system research project called heart works. heart works explores the above pedagogical objectives through two innovations. firstly  it makes the reactive learning environment for simulations more reactive by introducing the notion of a constructive simulation. secondly  it unabashedly believes that teaching dynamic physical system behavior should be based on qualitative causal explanations generated from first principles. to these ends  heart works creates a constructive simulation of the cardio-vascular system that is capable of explaining its own behavior in terms of qualitative causal hydraulic principles. 
　this paper will focus almost entirely on the issue of generating explanations from the simulation  however  a brief understanding of the constructive simulation environment will aid in general comprehension. by constructive simulation we mean that students build circulatory models from a set of cardio-vascular components such as valves and vessels. they may also manipulate 
	douglas and liu 	1 

the simulation through more traditional means such as parameter setting. whenever a change to the system is made  the components dynamically evaluate producing a new state s  of the system. to achieve this functionality  each component is modeled as a constraint-based numerical simulation and programmed in an object-oriented methodology. heart works was prototyped in kee running on a symbolics 1. a production version is currently implemented in allegro common lisp on the mac 
ii. 
　in contrast to simulation systems teaching diagnostic skills such as sophie  brown et a/.  1  and steamer  hollan et a/.  1   as a constructive simulation heart works is an experiment in teaching scientific principles and methods by a design approach. the student is presented with a system design problem that must be solved by an understanding of the function and structure of the components and their interacting behaviors. for example: given a pulsatile pressure source and using one-way valves create a counterclockwise blood flow loop from the pressure source through vessels to muscle and back through vessels. the solution to this problem requires that the student understand the relationship of pressure difference to flow and the structure and function of one-way valves. given that the simulation is highly reactive and uses a direct manipulation  graphic animation interface  it clearly falls into the class of intelligent tutoring systems that wenger  calls 
knowledge 	presentation 	systems. 
1 what is qualitative causal explanation  
however  we were not satisfied with a system that offered no direct causal explanation of its behavior to the student. for example  given the question   what is the effect of cholesterol deposits in the arteries on blood pressure  and why    generating an explanation requires understanding the implications of the fundamental tenets and principles of the underlying causal mechanics with regard to the topological structure of a cardiovascular system. 
1 	extension to confluence theories 
in developing the explanation system for heart works we need a language that is sensitive to the causal mechanisms  the directionality from causes to effects  and the sequential dependency of causal chains. following the taxonomy of white and frederiksen  1b   heart works requires explanations that are primarily firstorder. models that reason on the basis of changes in system properties are called  first-order  because they are based on the first order derivative  as in  if the pressure difference increases  then the flow increases.  
　because of its constructive simulation approach and thus the necessity to model individual components  heart works is based primarily on the de kleer-brown model   in this model equations constructed from the basic arithmetic operations  but using only sign values  are called confluences. confluences are solved by propagation of constraints  using generate and test when 
1 	intelligent tutoring systems 
unresolvable simultaneities occur. however  de kleer and brown's confluence notations are borrowed and extended to introduce the notion of global concepts  like system flow and total pressure difference. at first glance  the introduction of these global features may seem to violate the  no-function-in-structure  principle  for it goes beyond the original confluence theory. but  if one views the whole target system as a single device  then those global features will be  local  to the system. this view  in fact  corresponds to the notion of decomposable mental models discussed by williams et a/. . that is  a model consists of a set of mental objects  each of which can be further decomposed. 
　note that confluences as constraint equations do not distinguish causes and effects. in particular  de kleer and brown's theory does not have any principled way of distinguishing between possible causal factors in an intrastate. for example  if one needs to represent the relationship of  the change of a valve's opening area can cause the flow through the valve to change  but not vice versa   the formalism of confluence dp + da - df = 1 alone would not suffice. 
　we approach this problem by classifying the qualitative variables in the system model into two types  system parameters  exogenous variables  and system properties  endogeous variables . the system parameters in a qualitative model correspond to those features which can be directly manipulated to cause changes in the system  e.g.  a valve's opening area. they always stand for the root causes whenever the system behavior changes. by contrast  the system properties are those whose changes are caused by either a system parameter or a system property  e.g.  the flow through the valve. from a pragmatic standpoint of troubleshooting  for example  faults would fall into the system parameters and symptoms into the system properties. this strong typing is required for reasoning about what cause can bring about what effects. 
　though the qualitative model extends the original intention of the confluence theories  the three characteristics of de kleer and brown's notations still hold: 
1. a qualitative variable can appear in more than one confluence  and thus can be affected in different ways simultaneously; 
1. a confluence in a qualitative model must be individually satisfied no matter what the other effects on the same variable in different confluences are; 
1. a system component may have a different set of confluences in a different state. for example  when a vessel is closed  the system enters a new qualitative state and the above confluences would not apply. 
1 	generating causal explanation 
the previous discussion of causal explanation represents a general orientation to the issues of causal explanation and the desiderata chosen for heart works. it points out the necessity to develop a system for reasoning through causalities in order to explain dynamic system behavior. however  most of the previous research literature  with a few exceptions  is descriptive and does not yield much specific guidance about how to automate the generation of qualitative causal explanations. to transcend the limitations of past work  this section will focus exclusively on developing a formalism and implementation for a causal reasoning explanation process. this reasoner is called qualex. since heart works is a constructive simulation environment which we hope to use for systems other than the cardio-vascular  the qualex design should be dynamic  robust and domain-independent. 
　the approach is to break the process into three steps  ensuring reasoning from structures to functions  dekleer and brown  1 : 
  gather the information about the topology of the target system  including the types of the devices and their interconnections; 
  generate the component models of the individual devices and integrate them according to the system's topological information gathered above. the integration includes the qualitative descriptions of the system's continuity and compatibility conditions and results in a qualitative model of the target system.  for the hydraulics domain  compatibility conditions are  1  the total pressure drop in a passage equals the sum of all the sub-pressure drops along the way of the passage  and  1  the total resistance in a passage equals the sum of all the sub-resistances along the way of the passage. a continuity condition is that the total liquid flowing out of the passage equals the total liquid entering the passage.  
  use qualitative techniques to reason about the sys-tem model generated above to derive the first-order causal chains in the form of an intrastate causal graph. 
1 	a qualitative inference engine 
the task now is to derive causal graphs directly from the topology of the target system. causal graphs are directed  acyclic graphs whose nodes represent variables and whose arcs represent first-order cause-effect relations. these relations are typed as either directly proportional or inversely proportional. for example  the relations  a is inversely proportioned to b; b is directly proportional to c; b is directly proportional to d.  allow an instantiated representation such as  when a increases b decreases which in turn decreases c and d.  in order to derive the graphs the only information that 
qualex requires is the topological structure of the lab simulation  including the devices and their interconnections. all the other information about the underlying causalities of the system's first-order behaviors can be derived by a qualitative inference engine as described below. 
　deriving a causal graph is analogous to reasoning through the qualitative model in confluences to update the status of the qualitative variables  while observing the extensions introduced above. though they are a type of equation  confluences do not obey the available quantitative mathematical principles. a new causal reasoning framework must be developed. first  some key concepts for this formalism need to be defined. 
　besides its symbolic name and type  each qualitative variable in the model has two additional facets. the first is its qualitative value that indicates its state change. for example  if the quantitative value of a variable is increasing  then its qualitative value would be   +     and vice versa. the second is its sign in the confluence that indicates its relationship with other variables. the product of these two values determines the role played by that variable in a confluence. it is not surprising to see that a variable can play different roles in different confluences due to the signs preceding the variable  even though its qualitative value is always unique in the model. 
　now  in order to find the qualitative value  qv  of a 
　variable that appears in several confluences  any one of the confluences can be a candidate relation to derive qv. the roles of the variables in a confluence may be used to deduce the roles of other variables in the confluence. for instance  given a confluence dy - dx = 1  if the quantity of x is decreasing  then its qualitative value  derivative  dx is negative. because a  -  precedes dx in this confluence  and dx is negative  then x plays a positive role due to the interaction of the two  -  's. x's positive role determines that the role of y must be negative so that the equation will balance. consequently  from the role and the sign of a qualitative variable  the qualitative value can be deduced. in the above case  the qualitative value of y is  - . 
　the motivation in defining the term role is to introduce the qualitative value  qv  theorem for reasoning through the confluences to generate causal chains. 

	douglas and liu 	1 
on the blood pressure in the heart  and why   we will use the steady state cardiovascular model  peterson and campbell  1  to conduct the causal reasoning for this problem. 
　the hydraulic behavior can be modeled qualitatively by the confluences that consist of the descriptions of the components and the continuity and compatibility conditions in the system. in this formalism  p  a f  j   and k stand for pressure-drop  cross-sectioned area  flow  resistance  and coefficient of heart strength and conductivity  respectively. the subscripts indicate the particular components being modeled  with c for capillaries  a for artery  h for heart  and sys for system   in/out  attached to pressure-drop stands for input/output pressure to the component. 
　when the cholesterol deposits increase in the artery  the cross-section of the artery decreases. let us see how the causal chains from the decrease of the cross-sectional area aa to the increase of the heart pressure pheart and other changes in the system are generated. below  notations ft  jj-   c  attached to a variable  x  means that the quantitative value of the variable is increasing  dx = +   decreasing  dx = -   or remains constant  dx = 1   respectively. 
1 	intelligent tutoring systems 


begin causal-graph-generation: 
1. generate the complete set of confluences  confs  from the system topology. co nfs must capture the component models and the continuity and compatibility conditions in the system. 
1. substitute in confs the identical variables in the system with a unique name. for example  if an artery is connected to a capillary bed  then the outcoming pressure from the artery would equal the incoming pressure to the capillary bed. these two names will be substituted with a common internal name chosen by the system. 
1. gather the system parameters from confs into sys-params. identify the cause  c  chosen by the user in sys-params. mark the qualitative values of the variables in sys-params except c as 1 in confs. 
1. draw square nodes for the variables in sys-params and draw circle nodes for other system properties. the positions of the nodes are chosen to reflect the positions of the corresponding system components' icons in the simulation. 
1. select from confs those candidate confluences which involve the cause c and put these confluences in c f - s e t . 
1. for each cf in c f - s e t   do: 
  find those variables in cf whose qualitative value is not known and put them in u n k n o w n . put the remaining variables into knowns. 
  if u n k n o w n contains only one variable v  and the variables in k n o w n s all play an identical role r  then 
assign  sign v  x r x  -   as the qualitative value for v. note that sign v  is a function returning the sign of variable v in c f . 
draw a positive arc from c to v if the qualitative values of v  and c are equal  or a negative arc if the qualitative values of v and c are opposite. store cf as a justification for the arc just drawn. identify v as a new cause c  and recurse from step 1. 
end 	causal-graph-generation. 
　this procedure starts from the root cause  a system parameter  to derive the qualitative values of those system properties whose changes are directly related to the cause. each variable is assigned a qualitative value only once. these variables in turn become the causes that propagate further changes. note that a singleperturbation assumption is used  step 1  to reduce the complexity of multiple causalities. this suggests that in order to derive a causal chain  one can hold all but one causal parameter constant so as to create a situation ideal for studying the causal impact of this individual cause on all the system properties. the advantage of this is obvious: when a variable  x  remains constant  dx - 1. the zero effects can be ignored during qualitative reasoning. 
　the key notions used in the algorithm are the roles of qualitative variables in the model and the qv theorem described above. these notions are formed on the basis of mathematical deductive reasoning about the constraint equations. thus  the correctness of the algorithm for generating the causal chains is entirely dependent on the validity of the qualitative model of confluences. for the model to be valid  it is essential that it is both correct and complete: correct in the sense that it does not violate the underlying causal principles of the domain  and complete in the sense that none of the device descriptions and the system's compatibility and continuity conditions are missing. with a valid qualitative model of the system  this algorithm will always generate the optimal causal graph in the sense that the causal chain does not  leap over  any particular concept underlying the causalities. 
1 	discussion 
one limitation in the current approach is that it does not handle circular topologies with confluences  which only describe changes in an intrastate  dekleer and brown  1 . adding this extension would allow the representation of feedback. 
　qualex is domain-independent. it is based on device-ontology to generate qualitative  causal explana-
tions. qualex has been implemented in a version of heart works written in kee  intellicorp. corp.  and common lisp on a symbolics 1. as a result of a judicious choice of data structures  the algorithm is fairly efficient and runs sufficiently fast for human-computer interaction. for a qualitative model with q system components  n confluences  and an average number of v variables in a confluence  the computing time is 1 q + nv . 
in the c a u s a l - g r a p h - g e n e r a t i o n algorithm  step 1 takes 1 q  step 1 takes 1{n   step 1 takes 1 n : step 1 takes 1{nv : step 1 takes o n ; step 1 takes o nv . the 
	douglas and liu 	1 
total complexity  therefore  is 1 q + nv . 
　once the causal graph is generated the tutoring system can use it for either student modeling purposes or explanation and remediation. if it is used for student modeling  the causal graph can be generated as the expert model of the causality of the system and used in traditional student overlay models. if it is used directly as output  such as in our simulations  the system must integrate the output into the user interface or discourse manager. we have experimented with displaying the causal graph directly as part of the simulation window. the results of extensive protocol studies indicate that after students learn to read the notation  it seems to be an effective addition to animation in explaining the behavior of the system. in addition to a graphic display  we have also converted the causal graph output into synthesized english text. a more sophisticated use of the causal graph could focus on subgraphs of the explanation in response to student modeling concerns. 
　we should finally point out that the qualex algorithm will also work in tutoring systems that aire not simulation based. all that is necessary is provision of the initial system parameter values. these function as the initial causes in the causal chain. 
1 	conclusion 
in this paper  we have presented qualex  a system and algorithm for generating first-order qualitative causal graphs for tutorial purposes based on dekleer and brown's qualitative modeling theory. qualex is embedded in a constructive simulation environment called heart works which teaches hydraulics knowledge about the cardio-vascular system to first year college biology students. 
