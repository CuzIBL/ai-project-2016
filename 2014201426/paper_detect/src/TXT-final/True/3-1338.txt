
we investigate the properties of an abstract negotiation framework where agents autonomously negotiate over allocations of discrete resources. in this framework  reaching an optimal allocation potentially requires very complex multilateral deals. therefore  we are interested in identifying classes of utility functions such that any negotiation conducted by means of deals involving only a single resource at at time is bound to converge to an optimal allocation whenever all agents model their preferences using these functions. we show that the class of modular utility functions is not only sufficient but also maximal in this sense.
1 introduction
the problem of discrete resource allocation has recently received much attention from the artificial intelligence community. a large amount of this work is focused on combinatorial auctions  cramton et al.  1 . in this case  the allocation procedure is centralised  and the so-called winner determination problem consists in determining the allocation of resources maximising the auctioneer's revenue.
모a different perspective is taken when one assumes that the allocation process is truly distributed  in the sense that agents autonomously negotiate over the bundles of resources they hold. this assumption is justified in many applications where no central authority can be relied on to decide upon the allocation of resources. in this case  the system designer will typically seek to set up the system in such way that it guarantees desirable properties  without directly interfering in the negotiation process itself. in this paper we will make use of such an abstract negotiation framework investigated by a number of authors  sandholm  1; endriss et al.  1; dunne et al.  1 .
모to make things more precise  we assume a set of negotiating agents populating the system  and we model their preferences  over different bundles of resources  by means of utility functions. in order to pursue their own interests  agents agree on deals benefitting themselves but without planning ahead  i.e. they are both rational and myopic   thereby modifying the allocation of resources. from a global point of view  the quality of an allocation reflects the overall performance of the system  and the designer will naturally seek to ensure that negotiation converges towards an optimal allocation.
모section 1 introduces the negotiation framework used in this paper. as we shall recall in section 1  it is known that very complex multilateral deals are potentially required to reach an optimal allocation. when deals are restricted  e.g. to a limited number of resources   it is only possible to guarantee an optimal outcome by also restricting the negotiation process to agents whose preferences have certain properties. in this paper  we study the conditions under which negotiation conducted by means of the simplest deals  involving one item at a time  or 1-deal negotiation for short  still allows us to reach an optimal allocation. section 1 generalises a result from the literature and shows that modelling preferences with modular utility functions is a sufficient condition. however  modularity is not a necessary condition. this is demonstrated in section 1 by means of a counterexample. we also show that there can be no condition on utility functions that would be both necessary and sufficient for optimal allocations to be negotiable by means of rational 1-deals. the main contribution of this paper is to show that the class of modular utility functions is maximal  in the sense that no class strictly including the modular utility functions would still be sufficient for 1deal negotiation. the proof detailed in section 1 shows that  given any non-modular utility function  it is always possible to construct a modular utility function and select a scenario where the optimal allocation cannot be reached by 1-deals. section 1 concludes.
1 myopic negotiation over resources
in this section  we introduce the decentralised negotiation framework used throughout this paper and report a number of known technical results. in this framework  a finite set of agents negotiate over a finite set of discrete  i.e. non-divisible  resources. a resource allocation is a partitioning of the resources amongst the agents  that is  every resource has to be allocated to one and only one agent . as an example  the allocation a defined by a i  = {r1} and a j  = {r1 r1} would allocate resource r1 to agent i  while resources r1 and r1 would be owned by agent j.
모we are going to model the preferences of agents by means of utility functions mapping bundles of resources to real numbers. assuming that agents are only concerned with resources they personally own  we will use the abbreviation ui a  for ui a i    representing the utility value assigned by agent i to the bundle it holds for allocation a. the parameters of a negotiation problem are summarised in the following definition:
definition 1  negotiation problems  a negotiation problem is a tuple p = hr a u a1i  where
  r is a finite set of indivisible resources;
  a = {1 ... n} is a finite set of agents  n 뫟 1 ;
  u = hu1 ... uni is a vector of utility functions  such that for all i 뫍 a  ui is a mapping from 1r to r;
  a1 : a 뫸 1r is an  initial  allocation.
agents may agree on a deal to exchange some of the resources they possess. it transforms the current allocation of resources a into a new allocation a1; that is  we can define a deal as a pair 붻 =  a a1  of allocations  with a 1= a1 .
모we should stress that this is a multilateral negotiation framework. a single deal may involve the displacement of any number of resources between any number of agents. an actual implementation of this abstract framework may  however  not allow for the same level of generality. sandholm  has proposed a typology of different types of deals  such as swap deals involving an exchange of single resources between two agents or cluster deals involving the transfer of a set of items from one agent to another. the simplest type of deals are those involving only a single resource  and thereby only two agents .
definition 1  1-deals  a 1-deal is a deal 붻 =  a a1  resulting in the reallocation of exactly one resource.
the above is a condition on the structure of a deal. other conditions relate to the acceptability of a deal to a given agent. we assume that agents are rational in the sense of aiming to maximise their individual welfare. furthermore  agents are assumed to be myopic. this means that agents will not accept deals that would reduce their level of welfare  not even temporarily  because they are either not sufficiently able to plan ahead or not willing to take the associated risk  see also  sandholm  1  for a justification of such an agent model in the context of multiagent resource allocation . we will  however  permit agents to enhance deals with monetary side payments  in order to compensate other agents for a possible loss in utility. this can be modelled using a payment function p : a 뫸 r. such a function has to satisfy the side constraint pi뫍a p i  = 1  i.e. the overall amount of money in the system remains constant. if p i    1  then agent i pays the amount of p i   while p i    1 means that it receives the amount of  p i . the following rationality criterion will define the acceptability of deals:
definition 1  individual rationality  a deal 붻 =  a a1  is rational iff there exists a payment function p such that ui a1  ui a    p i  for all i 뫍 a  except possibly p i  = 1 for agents i with a i  = a1 i .
from a system designer's perspective  we are interested in
assessing the well-being of the whole society  or social welfare  arrow et al.  1   which is often defined as the sum of utilities of all the agents.
definition 1  social welfare  the social welfare sw a  of an allocation a is defined as follows:
	sw a 	= xui a 
i뫍a
this is the utilitarian definition of social welfare. while this is the definition usually adopted in the multiagent systems literature  wooldridge  1   we should stress that also several of the other notions of social welfare developed in the social sciences  e.g. egalitarian social welfare  arrow et al.  1   do have potential applications in the context of multiagent resource allocation.
모we conclude this background section by recalling two important results  sandholm  1; endriss et al.  1 : the first one makes explicit the connection between the local decisions of agents and the global behaviour of the system  and the second one is the fundamental convergence theorem for this negotiation framework.
lemma 1  individual rationality and social welfare  a deal 붻 =  a a1  is rational iff sw a    sw a1 .
theorem 1  maximising social welfare  any sequence of rational deals will eventually result in an allocation of resources with maximal social welfare.
the main significance of this latter result  beyond the equivalence of rational deals and social welfare-increasing deals stated in lemma 1  is that any sequence of deals satisfying the rationality criterion will eventually converge to an optimal allocation. there is no need for agents to consider anything but their individual interests. every single deal is bound to increase social welfare and there are no local minima.
1 negotiating over one item at a time
while theorem 1 shows that  in principle  it is always possible to negotiate an allocation of resources that is optimal from a social point of view  deals involving any number of agents and resources may be required to do so  sandholm  1; endriss et al.  1 . in particular  the most basic type of deal  which involves moving a single resource from one agent to another and which is the type of deal implemented in most systems realising a kind of contract net protocol  smith  1   is certainly not sufficient for negotiation between agents that are not only rational but also myopic.
모this has first been shown by sandholm  and is best explained by means of an example.1 let a = {1 1} and r = {r1 r1 r1}. suppose the utility functions of these agents are defined as follows  over singleton sets :
u1 {r1}  = 1u1 {r1}  = 1u1 {r1}  = 1u1 {r1}  = 1u1 {r1}  = 1u1 {r1}  = 1u1 {r1}  = 1u1 {r1}  = 1u1 {r1}  = 1furthermore  for any bundle r not listed above  suppose ui r  = 1 for all i 뫍 a. let a1 with a1  = {r1} 
a1  = {r1} and a1  = {r1} be the initial allocation 
i.e. sw a1  = 1. the optimal allocation would be a  with a  1  = {r1}  a  1  = {r1} and a  1  = {r1}  which yields a social welfare of 1. all other allocations have lower social welfare than a . hence  starting from a1  the deal 붻 =  a1 a   would be the only deal increasing social welfare. by lemma 1  붻 would also be the only rational deal. this deal  however  involves all three resources and affects all three agents. in particular  붻 is not a 1-deal. hence  if we choose to restrict ourselves to rational deals  then 1-deals are not sufficient to negotiate allocations of resources with maximal social welfare.
모of course  for some particular negotiation problems  rational 1-deals will be sufficient. the difficulty lies in recognising the problems where this is so. closely related to this issue  dunne et al.  have shown that  given two allocations a and a1 with sw a    sw a1   the problem of checking whether it is possible to reach a1 from a by means of a sequence of rational 1-deals is np-hard in the number of resources in the system.
모the structural complexity of deals required to be able to guarantee socially optimal outcomes partly stems from the generality of the framework. in particular  so far we have made no assumptions on the structure of utility functions used by the agents to model their preferences. by introducing restrictions on the class of admissible utility functions  it may be possible to ensure convergence to an allocation with maximal social welfare by means of simpler deals. in this paper  we are interested in characterising more precisely those classes of utility functions that permit 1-deal negotiation.
definition 1  1-deal negotiation  a class c of utility functions is said to permit 1-deal negotiation iff any sequence of rational 1-deals will eventually result in an allocation of resources with maximal social welfare whenever all utility functions {u1 ... un} are drawn from c.
under this perspective  a relevant result is due to endriss et al.   who show that rational 1-deals are sufficient to guarantee outcomes with maximal social welfare in case all agents use additive utility functions.1 we are going to prove a slight generalisation of this result in the next section.
1 modular functions are sufficient
we are now going to define the class of modular utility functions. this is an important  see e.g.  rosenschein and zlotkin  1    albeit simple  class of functions that can be used in negotiation domains where there are no synergies  neither complementaries nor substitutables  between different resources.
definition 1  modular utility  a utility function u is modular iff the following holds for all bundles r1 r1   r:
	u r1 뫋 r1 	=	u r1  + u r1    u r1 뫌 r1 	 1 
the class of modular functions includes the aforementioned additive functions. this may be seen as follows. let r be any non-empty bundle of resources and let r 뫍 r. then equation  1  implies u r  = u r {r} + u {r}  u {}  .
if we apply this step recursively for every resource in r  then we end up with the following equation:
	u r 	=	u {}  + x u {r}    u {}  	 1 
r뫍r
that is  in case u {}  = 1  the utility assigned to a set will be the sum of utilities assigned to its members  i.e. u will be additive . clearly  equation  1  also implies equation  1   i.e. the two characterisations of the class of modular utility functions are equivalent.
모it turns out that in domains where all utility functions are modular  it is always possible to reach a socially optimal allocation by means of a sequence of rational deals involving only a single resource each. this is a slight generalisation of a result proved by endriss et al.   and our proof closely follows theirs.
theorem 1  negotiation in modular domains  the	class m of modular utility functions permits 1-deal negotiation.
proof. by lemma 1  any rational deal results in a strict increase in social welfare. together with the fact that the number of distinct allocations is finite  this ensures that there can be no infinite sequence of rational deals  termination . it therefore suffices to show that for any allocation that does not have maximal social welfare there still exists a rational 1-deal that would be applicable.
모we are going to use the alternative characterisation of modular utility functions given by equation  1 . for any allocation a  let fa be the function mapping each resource r to the agent i that holds r in situation a. then  for modular domains  the formula for social welfare  see definition 1  can be rewritten as follows:
	sw a 	= xui {}  + x u1fa r  {r} 
	i뫍a	r뫍r
with . now assume we have reached an allocation of resources a that does not have maximal social welfare  i.e. there exists another allocation a1 with sw a    sw a1 . considering the above definition of social welfare and observing that pi뫍a ui {}  is a constant that is independent of the current allocation  this implies that at least one resource r must satisfy the inequation
  i.e. the agent owning r in al-
location a values that resource less than the agent owning it in allocation a1. but then the 1-deal consisting of passing r from agent fa r  to agent fa1 r  would already increase social welfare and thereby be rational. 1
like theorem 1  the above establishes an important convergence result towards a global optimum by means of decentralised negotiation between self-interested agents. in addition  provided all utility functions are modular  convergence can be guaranteed by means of a much simpler negotiation protocol  which only needs to cater for agreements on 1-deals  rather than multilateral deals over sets of resources .
1 modular functions are not necessary
in the previous section we have introduced a class of utility functions  namely modular functions  such that it is possible to guarantee that sequences of rational 1-deals will converge to an allocation with maximal social welfare under the condition that all agents' utilities belong to this class. a natural question to ask would then be whether modularity is also a necessary condition in this sense.
모it turns out that this is not the case. we demonstrate this by means of the following example. suppose r = {r1 r1} and there are two agents with utility functions u1 and u1: u1 {}  = 1 u1 {}  = 1 u1 {r1}  = 1 u1 {r1}  = 1 u1 {r1}  = 1 u1 {r1}  = 1 u1 {r1 r1}  = 1 u1 {r1 r1}  = 1
while u1 is a modular function  u1 is not. the optimal allocation is the allocation where agent 1 owns both items. furthermore  as may easily be checked  any 1-deal that involves moving a single resource from agent 1 to agent 1 is rational. hence  rational 1-deals are sufficient to move to the optimal allocation for this scenario  despite u1 not being modular.
모in fact  it is possible to show that there can be no class of utility functions that would be both sufficient and necessary in this sense. it suffices to produce two concrete utility functions u1 and u1 such that  i  both of them would guarantee convergence if all agents were using them  and  ii  there is a scenario where some agents are using u1 and others u1 and convergence is not guaranteed. this is so  because assuming that a necessary and sufficient class exists   i  would imply that both u1 and u1 belong to that class  while  ii  would entail the contrary. we give two such functions for the case of two agents and two resources  the argument is easily augmented to the general case :
	u1 {} 	=	1	u1 {} 	=	1
	u1 {r1} 	=	1	u1 {r1} 	=	1
	u1 {r1} 	=	1	u1 {r1} 	=	1
	u1 {r1 r1} 	=	1	u1 {r1 r1} 	=	1
the function u1 is modular  i.e. all agents using that function is a sufficient condition for guaranteed convergence to an optimal allocation by means of rational 1-deals  theorem 1 . clearly  convergence is also guaranteed if all agents are using u1. however  if the first agent uses u1 and the second u1  then the allocation a with a 1  = {r1} and a 1  = {r1} is not socially optimal and the only deal increasing social welfare  and thereby  the only rational deal  would be to swap the two resources simultaneously. hence  no condition on all agents' utility functions can be both sufficient and necessary to guarantee convergence to an optimal allocation by means of rational 1-deals alone.
모our argument for the inexistence of any such necessary and sufficient condition has directly exploited the fact that we were looking for a single condition to be met by the utility functions of all agents. the problem could be circumvented by looking for suitable conditions on negotiation problems as a whole  where different utility functions may meet different such conditions. clearly  such a condition does exist. however  the aforementioned result of dunne et al.  on the np-hardness of checking whether there exists a path of rational 1-deals between two given allocations immediately suggests that verifying whether a given negotiation problem meets any such condition would be intractable.
1 the modular class is maximal
we are now going to prove the main result of this paper  namely the surprising fact that the class of modular utility functions is not only sufficient for 1-deal negotiation but also maximal in the sense that no class of utility functions strictly including the modular functions would still be sufficient for 1-deal negotiation. the significance of this result can only be fully appreciated when considered together with the  negative  result on necessary and sufficient conditions discussed in the previous section.
모before stating the main result  we prove the following auxiliary lemma:
lemma 1  alternative characterisation of modularity 
a utility function u is modular iff the following holds for all r   r and all r1 r1 뫍 r with r1 r1뫍 r and r1= r1: u r뫋{r1 r1}  = u r뫋{r1} +u r뫋{r1}  u r   1 
proof. to show this  let us recall elementary facts about submodular functions. a function v : r 뫸 r is submodular iff  r1 r1   r v r1 +v r1  뫟 v r1 뫋r1 +v r1 뫌r1 . it is also known that v is submodular iff v r뫋{r1} +v r뫋 {r1}  뫟 v r 뫋 {r1 r1}    v r  for any r   r r1 r1 뫍 r r  with r1= r1  nemhauser and wolsey  1  p.1 . because a function u is modular iff both u and  u are submodular  the lemma holds.	1
we are now in a position to prove our theorem on the maximality of the class of modular utility functions with respect to rational negotiation over one resource at a time:
theorem 1  maximality  let m be the class of modular utility functions. then for any class of utility functions f such that m   f  f does not permit 1-deal negotiation.
proof. first observe that for |r| 뫞 1  any utility function is modular  i.e. the theorem holds vacuously in these cases. therefore  without loss of generality  from now on we assume that there are at least two distinct resources in the system.
모the proof is constructive. we will show that for any nonmodular utility function u1 on m resources  it is possible to construct a modular utility function u1  with ui 뫖 1 for all other agents i  and an initial allocation such that no optimal allocation can be reached by means of 1-deals. this implies that m 뫋 {u1} does not permit 1-deals.
모because u1 is non-modular  lemma 1 can be applied in the following way: there exist a bundle x and distinct resources r1 r1 뫍/ x such that   defined as follows  is not equal to 1:

from now on  a1|  a|1  a1 and a1 will refer to allocations in which r1 and r1 belong to one of the first two agents  and in which resources in x are owned by 1  and resources in y = r  x 뫋{r1 r1}  by 1  as shown in the following table.
agent 1agent 1a1|{r1 r1} 뫋 xya|1x{r1 r1} 뫋 ya1{r1} 뫋 x{r1} 뫋 ya1{r1} 뫋 x{r1} 뫋 y
figure 1: values of sw for the four allocations  case
let us build a modular utility function u1 defined as follows:
 r 뫍 r 
	u1 r  = x 붸r + x 뷎   x 뷎	 1 
	r뫍{r1 r1}뫌r	r뫍r뫌y	r뫍r뫌x
with 뷎 = 1 뫄 max|u1| + 1. let   = u1 y   = |y | 뫄 뷎. as the rest of the proof shall reveal  the value of 뷎 has been chosen such that the social welfare of each of these four allocations is greater than that of any other allocation. of course  this will imply that the optimal allocation has to be among these four. the values of 붸r1 and 붸r1 will be chosen later. the social welfare of each of these four allocations can then be written as follows:
sw a|1 =  + 붸r1 + 붸r1 + u1 x sw a1| =  + u1 x 뫋 {r1 r1} sw a1 =  + 붸r1 + u1 x 뫋 {r1} sw a1 =  + 붸r1 + u1 x 뫋 {r1} it remains to be shown that depending on the value of   we can always choose an initial allocation among these four and values of 붸r1 and 붸r1 such that  1  this initial allocation does not have optimal social welfare   1  there is only one rational deal from this allocation   1  this deal leads to the optimal allocation but however  1  this rational deal would involve more than one resource. we will have to consider two cases for equation  1 : the case of and the case of.
 1st case  suppose . let us choose 붸r1 = u1 x 뫋  and 붸r1 = u1 x 뫋 {r1 r1}    u1 x 뫋
모let us first show that the four allocations have a greater social welfare than any other. with the help of equation  1   observe that both |붸r1| and |붸r1| are less than 1 뫄 max|u1|. thus  all four allocations have a social welfare of at least   
|붸r1|   |붸r1|   max|u1| 뫟     1 뫄 max|u1|       뷎.
all other allocations have a social welfare lower than 뷎 + |붸r1| + |붸r1
. thus  the social welfare of each of the four allocations is greater than that of any other allocation.
모now let us show that a1 is the optimal allocation  as illustrated in figure 1. more precisely  let us show that sw a|1    sw a1   that sw a1|    sw a1  and that sw a1    sw a1 . by substituting the values of 붸r1 and

figure 1: values of sw for the four allocations  case
붸r1 and using equation  1   the social welfare of each allocation can be written as follows:

here  a1 is clearly the optimal allocation. if we choose a1 as the initial allocation  then the only 1-deals involving resources r1 or r1 are 붻 a1 a1|  and 붻 a1 a|1 . these deals decrease social welfare  and thus are not individually rational by lemma 1. thus  it is not possible to reach the optimal allocation a1 starting from a1 using only 1-deals.
  1nd case  suppose. let us choose 붸1 = u1 x 뫋  and.
모note that again  both |붸r1| and |붸r1| are less than 1 뫄 max|u1|. thus  by the same argument as in the first case  the four allocations all have greater social welfare than any other allocation.
모the optimal allocation is now a1|. to see this  let us show that sw a1    sw a|1   that sw a1    sw a|1   and that sw a|1    sw a1|  as illustrated in figure 1.

here  a1| is clearly the optimal allocation. if we choose
a|1 as the initial allocation  then the only 1-deals involving r1 or r1 are 붻 a|1 a1  and 붻 a|1 a1 . these deals decrease social welfare  and thus are not individually rational by lemma 1. thus  it is not possible to reach the optimal allocation a1| starting from a|1 using only 1-deals. 1
why is this result significant  as argued earlier  while the full abstract negotiation framework introduced at the beginning of this paper would be difficult to implement  designing a system that only allows for pairs of agents to agree on deals over one resource at a time is entirely feasible. as we would like to be able to guarantee socially optimal outcomes in as many cases as possible  also for such a restricted negotiation system  we would like to be able to identify the largest possible class of utility functions for which such a guarantee can be given. however  our discussion in section 1 has shown that there can be no class of utility functions that exactly characterises the class of negotiation problems for which negotiating socially optimal allocations by means of rational 1-deals is always possible. still  there are classes of utility functions that permit 1-deal negotiation. as shown by theorem 1  the class of modular functions is such a class and it is a very natural class to consider. an obvious question to ask is therefore whether this class can be enlarged in any way without losing the desired convergence property.
모our proof of theorem 1 settles this question by giving a negative answer: for any agent with a non-modular utility function there exist modular utility functions  for the other agents  and an initial allocation such that rational 1-deals alone do not suffice to negotiate an allocation of resources with maximal social welfare. there may well be further such classes  that are both sufficient and maximal   but the class of modular functions is one that is particularly natural and useful in the context of modelling agent preferences.
1 conclusion
this paper makes a contribution to the theoretical analysis of a negotiation framework where rational but myopic agents agree on a sequence of deals regarding the reallocation of a number of discrete resources. we have shown that the use of modular utility functions to model agent preferences is a sufficient condition to guarantee final allocations with maximal social welfare in case agents only negotiate 1-deals  involving one resource each . we have then seen that this is  however  not a necessary condition for optimal outcomes and  indeed  there can be no condition on  individual  utility functions that would be both necessary and sufficient in this sense. we have therefore concentrated on showing that the class of modular functions is maximal  i.e. no strictly larger class of functions would still permit an optimal allocation to be found by means of rational 1-deals in all cases.
모we consider this not only a surprising result  but also a useful characterisation of negotiation domains that can be handled reliably using simple negotiation protocols  catering only for contract net-like deals over single items between pairs of agents  rather than the full range of multilateral deals forseen in the abstract framework. such theoretical results affect both the design of agents and of negotiation mechanisms. for instance  if a given mechanism can only handle 1-deals  then it may be inappropriate to design myopic agents with very rich preference structures to use such a mechanism.
모in a companion paper  chevaleyre et al.  1   we prove a generalisation of theorem 1 which shows that rational deals involving at most k resources each are sufficient for convergence to an optimal allocation in case all utility functions are additively separable with respect to a common partition of r  i.e. synergies across different parts of the partition are not possible and overall utility is defined as the sum of utilities for the different sets in the partition  fishburn  1    and each set in this partition has at most k elements. the arguments against the existence of sufficient conditions for negotiation over k items at a time that are also necessary generalise in the expected manner. an important issue that remains to be investigated in the future therefore is to see whether it is possible to derive a similar maximality property as the one proved in this paper for this richer class of utility functions.
모another topic for future work would be to investigate what classes of utility functions are sufficient and maximal for negotiating socially optimal allocations by means of 1-deals without side payments.
