 
requirements engineering is a complex task which benefits from computer support. despite the progress made in automatic reasoning on requirements  the tools supporting requirements elicitation remain difficult to use. in this paper we propose a novel approach where a tool's reasoning is intimately linked to the dialogue it has with its users. because the dialogue is guided by rules ensuring coherence  the interaction with the tool is more natural. we discuss in detail the rules we use to organise the dialogue and how we apply them to the requirements elicitation tool. we present an evaluation of this approach demonstrating improvements in usability during the elicitation process. 
1 	introduction 
requirements elicitation is a difficult part of software engineering in which the specifications for a new system are discussed with potential users. because verifying that requirements are correct is a complex task  computer support is beneficial. this support requires formal specifications. however people arc usually not trained to use formal specification languages. task or domain specific languages smooth the learning curve to write formal specifications but the elicitation process often remains error prone. users need more support while writing specifications. in particular  a tool which interacts with them and helps them express their requirements in a domain specific way could lower the number of requirements elicitation errors. however  the interaction between the requirements engineer or future users and requirements elicitation tools has often been neglected. this is a problem since the easiest way to acquire the information for the requirements elicitation tools is often not the most acceptable in terms of human dialogue. adapting the dialogue so that users can make sense of the information provided by the tools is therefore important. on the other hand we do not want to force requirements elicitation tools to be aware of dialogue 
    psi-lirinsa  i.n.s.a.  place emile blondel  1 montsaint-aignan  france 
　　+  department of artificial intelligence  1 south bridge  edinburgh eh 1hn  scotland 

figure 1: system data flow diagram 
management strategies. a solution to this problem is to separate requirements elicitation tools and dialogue managers but make them interact and constrain each other. 
　we have developed a system which deals with this issue. this system communicates with its users to acquire requirements interactively. its main feature is to organise the dialogue it has with users in order to ensure a coherent interaction. it is composed of two parts: a requirements elicitation tool and a dialogue manager as shown in figure 1 i ward  1  details the graphical notation used . 
　the requirements elicitation tool checks that the requirements entered by users are correct. it also provides guidance by making deductions on the requirements. it uses a domain specific specification model which contains the domain knowledge of the system about what can be elicited. it also accesses a specification which represents the requirements that have been elicited so far. the specification is the instanciation of the domain specific specification model for the specific situation the users have described. 
　in our system  the requirements elicitation tool and the dialogue manager interact by means of  communications . the 
	lecoeuche  robertson  and barry 	1 

communication pool contains the communications to be output by the the dialogue manager and the answers provided by the users. the requirements elicitation tool puts communications in the communication pool depending on the deductions it makes and the dialogue manager puts users' answers to the communications as they become available. 
   the dialogue manager outputs the communications created by the requirements elicitation tool in natural language. it also enables users to write english sentences that are then transformed into a notation appropriate for the tool. it organises how the communications are output by means of focus theories. focus can be defined informally as  the set of all the things to which participants in a dialogue are attending at a certain point in the dialogue and the point of view they have on these things1'  lecoeuche et al.  1 . focus theories ensure that the guidance provided by the tool is appropriate to the users' current task. the dialogue manager has access to different focus theories that can be  plugged-in  the system. therefore we can adapt the level of text structure by using different focus theories. focus theories seem well-suited for organising the kind of dialogues we consider here. other techniques  such as those based on the intentions underlying the dialogue  would require the dialogue manager to know what the elicitation system is trying to achieve and what its plan is. for some elicitation systems  this knowledge may not be available. focus theories require less information and allow a stronger separation between the elicitation system and the dialogue manager. 
　we have tested our system with two theories: a global focus theory organising the dialogue at a high level and a local focus theory  not presented here but based on centering  grosz and sidner  1   organising the sentence-bysentence how of the dialogue. the dialogue organisation depends also on the communications available in the communication pool and therefore on the requirements elicitation tool. conversely  the reasoning of this module is dependent on which communications the dialogue manager outputs since this directly influences users' answers. the focus theories have access  through the dialogue manager  to the specification and the specification model in order to re-use the knowledge represented in these data stores. the access to these datastores is mediated by translation rules. 
   in this paper  we present in section 1 one of the focus theories we use in our system. we advocate the use of a formal focus theory independent of any domain. because the theory is formal  we can prove properties about the dialogues it allows. in section 1  we describe some translation rules we use to transform the domain knowledge used by our requirements elicitation tool into a form suitable to our formal focus theory. we show in section 1 an example of a requirements elicitation dialogue when using our dialogue manager. in that example  our system enables users to specify how to present a research group www site. we then summarise an evaluation of the effectiveness of this approach for requirements elicitation dialogues in section 1. the fact that focus rules improve the quality of texts is usually taken for granted and very few approaches provide a precise evaluation of their role. finally we conclude the paper in section 1. 
1 	knowledge-based applications 
1 	focus rules 
in this section we present the formal focus theory that our system uses. the theory ensures that dialogues between the tool and its users are globally coherent. it is based on a simplification of reichman's global focus theory  reichman  1 . the basic idea is that the dialogue is supported by a sequence of changes to a focus spaces set. the focus space set contains focus spaces which represent the information in focus during part of the dialogue. if  is the initial focus space set  only containing the initial focus space  at the beginning of the dialogue  then the set when some communications have been output is  where each contains some of the things spoken about in the dialogue. we may need to create several focus spaces since the dialogue may deal with more than one topic. focus spaces have different activation levels. we use three activation levels in our formalisation: 
active this is the space to which current communications arc added. this space is unique at any given point in the dialogue. 
controlling these are the spaces expected to become active again when the space they control is closed. the controlling spaces form a tree: each space is at most controlled by one other space and a space cannot control a space already controlling it or controlling any of its controlling spaces. 
closed these are the spaces which have been dealt with and are not expected to be returned to. 
　communications cause things to be included in the active focus space. they can also cause focus space activations to be modified and focus spaces to be created. in our theory  communications have one main subject which is a thing to be discussed  and possibly some other subjects which provide some context for the communication. 
　our theory is composed of seven rules. the focus rules define the possible ways the dialogue may develop. associated with an ordering  they represent what we expect to say next in the dialogue. the rules are based on four relations between the things that can be mentioned in the dialogue: 
direct relation there is a direct relation from one thing to another if the other is closely related to it and can be mentioned in the same focus space. 
specialisation relation there is a specialisation relation from one thing to another if the other is more specific than it. in that case the more specific thing can be discussed in the perspective of the more generic one. 
generalisation relation there is a generalisation relation from one thing to another if there is a specialisation relation in the other direction between the two things and no direct or specialisation relation already links the first thing to the other. 
simple relation there is a simple relation from one thing to another if it is related to the other and no direct  specialisation or generalisation relation already links it to the other. 
the exact nature of these relations depends on the application domain. the translation from the domain relations to these relations is discussed in section 1. 


table 1: notation used to formalise the global focus rules 
　because focus rules only indicate what changes in the focus spaces  most things stay the same   we are faced with a simple version of the frame problem  i.e.  how to indicate what changes and what does not. we tackle this problem by indicating the time during which a relation holds rather than asserting and deleting the relation itself  kowalski and sergot  1 . in particular  we represent the time in the dialogue as the sequence of communications and their associated focus moves performed since the beginning of the dialogue. for example  at the start of the dialogue  the time is the empty sequence  and after communications c1  c1 and c1 have been output with their associated moves m1  m1 and m1 respectively  the time is the sequence  m1 c1  ni1 c1  m  ci   . 
	we define the 	relation on time in the following way: 
where ＊ is the sequence concatena-
tion operator. the 	relation is then defined as t  
relations that begin to hold at a certain time 
are noted start p t  where p is the relation and t the time. relations that stop holding at a certain time are noted end p t . in order to know if a relation holds at a certain time  we define the predicate hold{p t . the definition of this predicate is 

because the notation used above is quite cumbersome  we will write hold p{a  ... a   t  as pt a  ... a  . the same applies for infix operators. for example  inclusion in a set at time t is noted  we will ignore the time if it does not influence the truth value of the predicate. 
　the notation used to represent the rules is expressed in our simplified notation in table 1. 
　in the following rules  the time variable  r  and the communication variable  c  are universally quantified.- all other variables are assumed to be existentially quantified unless explicitly universally quantified. when a new space is created  it is assigned an unused number. this number is computed by the function new t  where t is the dialogue time from which the number of existing focus spaces can be deduced. 
rule 1  no change  the focus space does not change and new information is added to it. this rule is used to speak about things closely related to the things in the current active focus space. 

where t' stands for t    no change  c  . 
rule 1  resetting  a new focus space is created. this rule is used to speak about more abstract things than the ones in the current active focus space. it may therefore serve to give background information on the things in the current active 
focus space. 

where t' stands for t    reset ting c  . 
rule 1  additive  a new focus space is created. it is controlled by the current active space. entities in the current active space are copied to the new space. this rule is used to speak about things that are more precise than the ones in the current active focus space. the new things are discussed 
from the perspective of the current active focus space. 

where tf stands for t    additive c  . 
rule 1  generating  a new focus space is created. entities in the current active space are copied to the new space. any controlling relation is passed from the current active space to the newly created space since we may not expect to come back to the current active space but we still expect to come back to its potential controlling space. this rule is used to speak about things related to the things in the current active focus space but not closely associated with them. 

where t' stands fort    gene rat ing c  . 
rule 1  pop  a controlling space becomes active again. 
this rule is used to come back to a space that was expected 
	lecoeuche  robertson  and barry 	1 

to be reactivated. this rule does not output any communications. it is always used in conjunction with one of the other rules which outputs a communication. 

where tf stands for t    pop c  . 
rule 1  digressing  a new focus space is created. it is controlled by the current active space. this rule is used to change the focus of the dialogue for a period of time after which the dialogue will resume where it was interrupted. 

where t' stands for t ＊  digressing c  . 
rule 1  reopening  an old space becomes active again. 
this rule is used to come back to a topic that was considered dealt with. there are two ways a topic may be re-introduced in a dialogue:  i  we realise we forgot to say something about it and come back to it  1  the topic is discussed from another 
perspective. the reopening move only addresses the first type of re-introduction. for the second type a new focus space would be created since the dialogue context  i.e.  the controlling space  has changed. 

where t' stands for t    reopening c  . 
the dialogue starting state for this theory is active  with 

　　now that the rules have been formalised  it is possible to prove properties of them. for example  we can verify that in any dialogue  there is exactly one active space. this can be shown by induction on the dialogue time. at time t =     the property is verified since there is only one focus space and this space is active. if we then suppose that for any time t t  the property holds  it also holds at time / = t because  1  every move starting a new active relation ends the current active relation   1  no move ends the current active relation without starting a new one. checking these properties is difficult in most other focus theories because they are not formalised. 
1 	knowledge-based applications 
1 	rule ordering 
several rules may have their preconditions satisfied at the same time. we prefer then to apply the rule that maintains the focus if possible  or minimises its movement. we minimise the focus movements by presenting general concepts before specialised ones and by avoiding references to unrelated concepts. rules are therefore applied in the following preference order: 
no change   resetting   additive   generating   pop   digressing   reopening. 
this means that we first try to find a communication to be output which would allow a no change move. if such a communication does not exist  we try to find a resetting communication and so on until a communication is found. 
　there is an exception to this ordering. if the main subject of a communication to output is already a member of a space controlling the current active space then a pop is the preferred move. this avoids reintroducing concepts that we are expecting to return to later in the dialogue. 
1 	from domain knowledge to focus rule 
representation 

figure 1: specification model example 
　because the focus rules we presented in section 1 are based on generic concepts such as direct  specialisation  generalisation or simple relations which are not necessarily used in the application domain of the system  we need to bridge the gap between the representation used in this domain and the representation used by the focus rules. this is done by  translation rules . these rules allow the use of this focus theory in different domains and for different applications. 
　we have created a set of translation rules to map the specification model used by our requirements elicitation tool to the generic concepts used by our formalised focus theory. in our system  the specification model is represented by an 

entity-relationship  er  model  chen  1 . a part of the model used to check the specification of a www site describing a research group is presented in figure 1  wieringa  1  details the graphical notation used . a research group involves a set of researchers and a set of publications. these three entities can be presented by a single www page or by a www site  i.e.  a group of pages. sites can be described by a home page. pages and home pages can be linked together. 
　the main idea behind the translation rules is to allow things that are related to the current focus and cannot be accessed easily otherwise to be mentioned immediately. we only present here two examples of such rules  these rules can be formalised  lecoeuche  1 . we do not show the formalisation here as it would require us to also explain the formal framework used to represent the specification model : 
  an entity is in direct relation with another if it may not exist at all and if it cannot exist without the other one. in our example  a home page is an optional entity whose existence requires the existence of a site. there is therefore a direct relation from the site to the home page. 
  if an entity can be linked to several others playing the same role  then there is a relation of specialisation from this entity to the others. in our example  the research group involves the researcher set and the publication set which fill the same role involving. these two elements are therefore in a specialisation relation with the research group. 
using the translation rules  the er relations presented in figure 1 are associated with the following focus relations: 
direct relations: present from publication set  researcher set and research group to site and page  describe from site to home page. 
specialisation relations: involve from research group to publication set and researcher set  link from home page to page and conversely. 
generalisation relations: involve from publication set and researcher set to research group  present from site and page to publication set  researcher set and research group. 
simple relations: all other relations. 
　basing the global focus relations on the specification model is a great advantage since it enables us to re-use the domain knowledge of the tool checking the specification. moreover the translation rules we presented here are dependent on the er model structure but not on the application domain itself. this makes them more generic. as a consequence we have been able to use them in other domains than the www site design one. in particular we have applied our system for a simple library loan process description tool and for a more generic er model acquisition tool. the translation rules could however be made more domain dependent if need be. 
1 example 
in this section we present an example of a requirements elicitation dialogue. our system enables users to specify how 
s: research group #rgl is the research group. do you want a site presenting it  u: yes s: a site presents the research group. which site presents the research group  u: a new site. s: site #sl presents the research group. do you want a home page describing site #sl   u: site #sl is described by a new home page. s: home page #hpl describes site #sl. what is the title of home page #hpl   u:  research group . s: do you want a page linked from it  u: 1 want to speak about the researcher set s: ok. researcher set #rsl is the researcher set. it is involved by the research group. do you want a page presenting it  
table 1: dialogue example 
to present a research group by a www site. once this has been done  the specification can be transformed into html and the site can be displayed by a www browser. our system allows users' intervention in the elicitation process but we show here an example where it has the initiative and is in charge of acquiring the requirements. 
　the system uses templates to generate sentences and interpret users' answers. depending on the focus information available  the templates can be adapted to produce pronouns  or definite noun phrases. entities introduced in the dialogue can be referred to using a unique identifier provided in the dialogue by the system. 
　using the results of the translation rules  the system tries to keep elements in direct relation together as explained in section 1. this is shown in the example presented in table 1. the system first deals with everything directly related to the research group  i.e.  site and home page  in the same focus space  f1. then it selects a specialisation relation from the home page to a page. this move opens a new focus space  f1  under the control of the previous one. however  the user redirects the dialogue by choosing another specialisation relation from research group to researcher set. this move closes the controlled focus space and opens another one  f1  under the control of the first focus space. the final state of the dialogue is presented graphically in figure 1. this dialogue is more coherent than a dialogue where the system is free to choose the topic and could possibly shift randomly between 

figure 1: dialogue evolution 
	lecoeuche  robertson  and barry 	1 

	local and global theories order 	1 
	global theory order 	1 
	elicitation module order 	1 
	local theory order 	1 
1 
table 1: evaluation 
research group  home page  site and researcher set. 
1 	evaluation 
a detailed evaluation of our focus theories has been carried out  lecoeuche  1 . in this section we summarise the results of initial tests with users. 
　we tested our system by asking people to read transcripts of requirements elicitation dialogues generated with and without focus theories and asking them to compare the dialogues pair-wise for coherence  saaty  1 . transformations can then be made on these comparisons to compute the overall ranking of the theories. for example  a theory with a value of 1 is considered three times more coherent than a theory with a value of 1. the values of all the theories add up to 1. 
　the experiment involved six persons for 1 minutes. six dialogues were evaluated. each participant compared four dialogues  resulting in 1 pair-wise comparisons. the results are presented in table 1.  the consistency ratio is equal to 1 which indicates reliable results. the participants may however not be representative of the whole user community.  they show that our global focus theory was judged to improve the global coherence of the dialogue compared to following the requirements elicitation tool order  i.e.  without using focus rules. the results also show that the local theory we use in our system performs badly on its own. this may be explained by the tendency of local theories to produce  spaghetti  dialogues without global structure. the local and global theories together perform somewhat better than the global theory alone. this can be explained by the local theory improving the transitions between communications in each global focus spaces and the transition between global focus spaces themselves. 
　this evaluation shows that our approach provides improvements in perceived dialogue quality. however using any individual focus theory may not be sufficient to achieve this result as demonstrated by the poor evaluation of the local focus theory on its own. 
1 	conclusion 
we have presented an interactive system for requirements elicitation dialogue. our system uses focus rules to improve the quality of its interaction with users. focus rules have rarely been used in interactive systems  especially to direct the system's reasoning. other systems used for requirements elicitation  rolland and ben achour  1; reubenstein  1  do not take them into account and leave users in charge of picking up the relevant information from the system output. we have discussed a formal focus theory. because of its 
1 	knowledge-based applications 
formality  properties of the theory can be proven mathematically. we then presented  translation  rules  bridging the gap between the representation used by the focus theory and the representation used for the domain knowledge. we then presented an example of dialogue showing the influence of the focus theory. finally  we showed that our approach was 
judged to improve the perceived quality of requirements elicitation dialogues. although we presented our results in the domain of requirements engineering  we believe that our theory could be used in other domains where the quality of interaction with users is important. we now plan to investigate how the theory presented in this paper could be integrated with other techniques  such as intentional ones in case the elicitation system is able to indicate its plan  and to use it in multi-agent systems where one of the agent would be in charge of the natural language interation with users. 
