channeling constraints and value ordering in the quasigroup completion problem 
ivan dotii and alvaro del val and manuel cebrian 
departamento de ingenieria informatica 
universidad autonoma de madrid 

1 introduction 
the quasigroup completion problem  qcp  is a very challenging benchmark among combinatorial problems  and a focus of much recent interest in the area of constraint programming. it has numerous practical applications  gomes et al  1 ; it has been put forward as a benchmark which can bridge the gap between purely random instances and highly structured problems  gomes et al  1 ; and its structure as a multiple permutation problem  walsh  1  is common to many other important problems in constraint satisfaction. 
　i gomes et al  1  reports that qcps of order 1 could not be solved by pure constraint programming approaches  but could sometimes be solved by hybrid approaches combining constraint programming with mixed integer programming techniques from operations research. in this paper  we show that the pure constraint satisfaction approach can solve many problems of order 1 in the transition phase  which corresponds to the peak of difficulty. our solution combines a number of known ideas -the use of redundant modeling  cheng et al  1  with primal and dual models of the problem connected by channeling constraints  walsh  1  - with some novel aspects  as well as a new and very effective value ordering heuristic. 
1 models for qcps 
a quasigroup is an ordered pair  q     where q is a set and 
 is a binary operation on q such that the equations a   x = b and y ＊ a = b are uniquely solvable for every pair of elements a  b in q  gomes et al  1 . the order n of the quasigroup is the cardinality of the set q. a quasigroup can be seen as an n x n multiplication table defining a latin square  which must be filled with  colors  so that the colors of each row are all distinct  and similarly for columns. a qcp is the problem of coloring a partially filled latin square  which is known to be np-complete  colbourn  1 . 
　each row and column of a latin square defines a permutation problem  i.e. a constraint satisfaction problem with the same number of variables as values  where a solution is a permutation of the values  walsh  1 . the qcp is a multiple permutation problem with 1n intersecting permutation constraints  n row permutation constraints and n column permutation constraints . in order to represent those permutation problems we have implemented three models: 
  primal model: this model has a variable xi j for each cell of the latin square  with i and j its coordinates. their possible values are the colors of the cell. 
  row dual model: this is the first dual model  it represents the colors in each row; the dual variable ri k is the k-th color in the i-th row  and the values it can take are the columns where it can be placed. 
  column dual model: this one models the colors in each column; the dual variable cj k represents the k-th color in the j-th column  with rows as its possible values. 
the primal and dual not-equal constraints specify that the colors in a row or column must all be different. while these are sufficient to capture the problem  and in fact redundantly so   it is known that these models can be improved by connecting them through channeling constraints: 
  row channeling constraints: constraints for the n row permutation constraints  linking the primal model with the row dual model:  
  column channeling constraints: corresponding to the n column permutation constraints  they link the primal and dual column models:  
  triangular channeling constraints: these  novel  constraints link both dual models  closing a  triangle  among the three models:  
it's easy to show that the first two kinds of channeling constraint fully capture a qcp  see also  walsh  1    making the primal and dual constraints redundant. 
1 value ordering 
key to our results is a new value ordering heuristic  which we might call the min-domain value selection heuristic. once a primal or dual variable is selected  we need to choose a value for it. since any such value corresponds to one specific variable from each of the two other models  we select the value whose corresponding two variables have a minimal  combined  domain. specifically  say we have chosen x{j. then we choose a color k from its currently active domain for which the sum of the current domain sizes of ri k and cj k is minimal among the currently available colors for xi j. 
1 results 
we focused our experiments on solvable instances. to make our results comparable with those reported in  gomes et al  

1 	poster papers 


figure 1: mean solution time on qcps of order 1  1 and 1 with  vol  and without value ordering  voo . 
1   we used the same generator1  and considered only  balanced  instances  which are known to be the hardest. we used an  ac1-based  generalized arc consistency algorithm based on van beek's cplan implementation  http:ai.uwaterloo.ca/~vanbeek/software/software.html   with a few improvements. we considered various  complete  combinations of all the above mentioned constraints  and found that adding the primal and dual  not-equal  constraints never helped performance in the presence of row and column channeling constraints  and yielded even worse results in their absence. most of the results discussed below therefore use a model with only row and column channeling constraints; they also use  mac   mantaining arc consistency  bessiere  regin  1 . since our preliminary tests showed that cbj and nogood learning seem to never help in these problems  and are often a source of significant overhead  we discarded them. we also considered various variable selection heuristics. we found the min-domain heuristic  which selects a variable with smallest domain to be uniformly the best among the alternatives we tried  which included more sophisticated heuristics such as dom+degree  dom/degree  and variants of the above which took into account the  primal or dual  model to which variables belong  e.g. selecting only among primal variables  etc. 
　with only row and column channeling constraints  our implementation outperforms classical approaches  in that we can solve a considerable amount of instances of order 1 in a reasonable time. as mentioned above  this was very recently considered as out of reach for pure constraint programming approaches  gomes et al  1   which ours is  in fact  we don't even use global or non-binary constraints . the results when this model was used with the min-domain value ordering heuristic were quite surprising  as it outperformed previous tests in three orders of magnitude in some cases. for example  for the instance bqwh-1-1.pls  balanced instance of order 1 and 1% preassigned  it took 1 sees without value ordering and only 1 sees with it. in figure 1 we present a comparison of our results with and without value 
'generator isencode  kindly provided by carta gomes. 
ordering for quasigroups of order 1 and 1  and 1% preassignment  close to the phase transition  gomes et al  1 . 
　encouraged by this performance  we generated some instances of order 1 and 1% preassignment. again the value ordering heuristic turns out to be so efficient that we were able to solve a great number of instances in a reasonable amount of time. the next table shows median and mean time in seconds  the latter taken only over solved instances  and percent of solved instances  using value ordering for problems in the transition phase. 
  order mean median % solved timeout 1 1 1 1% 1 1 1 1 1% 1 1 1 1 1% 1 1 1 1 1% 	1 	| 　finally  we are currently exploring the effect of adding  triangular  channeling constraints; our preliminary results suggest that they can improve performance by an additional 1%  using in this case only forward checking  e.g. from 1 to 1 seconds in one order 1% preassigned instance . the idea is that they provably allow forward checking to perform as much pruning as arc-consistency  while saving many useless checks; in fact  as many as 1% fewer checks  even though the savings in time are not as great due to effects we are currently exploring. 
1 	conclusions and future work 
we have shown that a pure csp approach can handle quasigroup completion problems significantly larger than was thought possible  using appropriate models and value ordering heuristics  and even in the absence of global alldiff constraints. yet our results are preliminary  and no doubt it would be interesting to consider other value ordering heuristics and ways to make the triangular channeling constraints most effective. 
