 
　　we have proposed a knowledge-based system for the recognition of time varying vital signals  such as electrocardiograms. this paper discusses its causal model approach. 
　　a prototype system exhibits the efficacy of the method of knowledge base stratification  where each knowledge base  kb  represents a distinct perspective to the phenomenon  such as the observable waveform knowledge and the causal knowledge of the physiological entity. projection links in our frame representation relate corresponding concepts in different kbs  e.g.  abnormalities in shape or temporality are mapped into abnormalities in physiological causality. the role of projections in the recognition process is to transduce established waveform hypotheses into corresponding event hypotheses and to form more global hypotheses using the causal model of entity. 
　　several types of one-shot causal links have been introduced to represent causal relationships among underlying physiological events. a causal link includes the existential dependency and the implicit temporal constraints between the effect and the cause events. 
　　using the causal knowledge with event statistics  the recognition system makes expectations for unseen events in relation to already-observed events when partial input information is given. statistical information defined coherently through metaclasses of the psn language supports a default reasoning process. the overall recognition framework is based on the hypothesize-and-test paradigm and the specializationand-aggregation of hypotheses using similarity links in is-a hierarchies and causal links in part-of hierarchies. 
1 	introduction 
　　the knowledge based systems approach has been applied to the recognition problem of time-varying vital signals such as electrocardiograms  ecgs . the developed recognition system uses a causal model of the physiological entity so that observed abnormalities of the temporality or morphology of the signal are explained by referring to the corresponding abnormalities of causal events and relationships in the entity model. 
　　in the domain of electrocardiology  this causal reasoning process is especially important because the domain involves causal and temporal knowledge about the cardiac conduction system  with which cardiologists analyze clinical observations  ecgs  and thereby provide diagnostic interpretations of abnormal events in the underlying physiological mechanism of the heart. the recognition problem of ecg rhythm disorders  above all  is interesting because the overall performance of existing ecg programs  e.g.  ibm bonner's program  is at most 1% reliable for abnormal ecgs  hagan1  and we believe a basic reason for this unreliability is that current systems lack underlying physiological knowledge to handle the complexity inherent in cardiac rhythms. the ecg wave identification is much complicated by its 
 antenna  nature of receiving only the aggregated of the electrical activity of the heart  i.e.  there is no simple correspondence between signal features and individual electrical discharges in the heart. 
　　our approach to the problem of building such a system is to construct a knowledge base stratified by several distinct knowledge bases  kbs  from different perspectives of the domain. its control structure  therefore  supports a guiding mechanism between corresponding concepts in different kbs as well as another guiding mechanism between causally related concepts in each kb. in our representational terms  the former is called projection links and the latter is causal links  and these links together contribute to the generation of hypotheses and the decision of overall interpretations in the recognition of ecg signals. this approach also integrates several established ai techniques. the system inherited the basic control framework from the alven system  tsotso1 tsotsos1  such as the attention mechanism for specialization and aggregation  which is supported by the implementation of similarity links  minsky1  and the exception handling mechanism. the hypothesize-and-test paradigm is used as in alven and other systems like pip  szoiovits1  and hearsay-ii  mostow1 . the knowledge organizational method is based on the is-a  part-of. and instance-of hierarchies as used in the psn  procedural semantic network  formalism  mylopoulos1 . 
　　to prove the efficacy of our methods  a prototype system called caa  causal arrhythmia analysis system  has been designed and implemented using a frame-input psn system on franz lisp  and uci lisp   shibahara1 . 
the prototype with a limited size of knowledge base is being tested and yielding so far satisfactory results. 
1 	t. shibahara 
1 	causality 
1 representation of causal 	connections 
causality may be viewed from its various facets. 
rieger and grinberg discerned the one-shot causality where the cause event s  is required only at the start of the effect event s  from the continuous causality where the continuous presence of the cause is required to sustain the effect.  rieger1  
　　caa causal links are based on two features of causal connections: first  they specify the existential dependency of an affected event on its causative event s ; second  they impose temporal constraints between causative and affected events. thus  the affected events cannot occur without the occurrence of the corresponding causative events  with effects temporally following their causes. interested in representing the dependencies of causal connections among events more precisely  we look at causality from the viewpoint of whether a causal influence is internal to a subject or it influences other distinct subject s . one-shot causal links  therefore  are specialized into the following: 
 1  transfer: the subject of the event normally completes the current event and proceeds to the following event. 
 1  transition: the subject is forced to terminate its current event and proceed to a new event. 
 1  initiation: the causative event  due to a given subject  triggers a new event of another subject. 
 1  interrupt: the causative event  due to a given subject  interrupts and forces the termination of an event by another subject. 
 1  causal-block: the causative event of a subject  fails to influence an event of another subject due to a blockage of the causal flow. 
　　the above caa causal links include implicit temporal constraints; thus  causal structures are described more qualitatively without specifying time coordinate values. 
　　causal events are aggregated at several levels involving arbitrary numbers of causal links. however  causal links themselves remain atomic lest the semantics of causal connections become ambiguous. 
1 use of causal links 
　　to interpret real ecg signals  the knowledge base must contain the causal knowledge about normal and abnormal connections among cellular events  which produce particular ecg tracings in the observable signal domain. we represent such causal activities using caa causal links. fig. 1 illustrates a typical ecg tracing for a normal cardiac cycle in  a   its electrical conduction path in an anatomical diagram in  b   and the corresponding causal conduction model with causal links in  c . in this causal model  short symbols like eoa are used to denote one of four basic events  phases  in a small portion of the cardiac conduction system; these phases are 
 depolarization   with symbol a    under-repolarization   with symbol b    partial-rrpolarization   with symbol c   and  full-repolarization   with symbol d . such basic phase events are successively aggregated into  cycle    activity    beat   and  beat-pattern  events in the physiological event kb to describe more global and complex causal structures. 



　　note that causal links across beat events  not shown  are transitions and interrupts except pace-making parts  normally  the sa-node  because the overall oscillation of the conduction system is controlled  or triggered  by such self-oscillating cells. also  since the current model is rather devoted to supraventricular arrhythmias  the bundle branches are included in the 
ventricles. 
1 recent work on causality 
　　abel and caduceus systems are recent medical expert systems that use causal notions. the abel system provides multiple levels of descriptions of medical hypotheses and hierarchically organizes disease structure  patil1 . in the caduceus system  analyzing differential diagnoses and causal graphs of diseases  pople proposed sophisticated control links for efficient decision making  pople1 . in spite of the sophistication in expressing causal mechanisms in abel and caduceus  these systems do not seem to provide a means to construct a recognition system of time-varying signals due to the weakness in the representation of precise timing contexts among events. 
　　causality has been recently approached from the standpoint of  qualitative reasoning . in this regard  long's work must be noted  long1 . he introduced qualitative times to describe the causal relations that might or must have taken place. he interestingly proposed four causal templates that give an extension of  continuous causality  while our causal links are specialized in  one-shot causality . we have taken a different approach because original signals are given to the system as real-valued data and the use of some quantitative analysis is inevitable at the measurement level so that unnecessary ambiguity is avoided  as kunz noticed in his ai/mm system  kunzb1 . 
　　based on the methods of multivariate analysis blum approached the problem statistically  blumb1 . however  our domain includes mostly exact causal relationships. therefore  we limit the use of statistical standards to the estimation of inherently spontaneous variables such as event durations. 
1 representation of domain knowledge 
1 frame 	representation and classes 
　　our knowledge representation is based on semantic networks  in particular  the psn language  with is-a  part-of  and instance-of organizational relations. in our particular formalism  concepts such as events and waveforms are described by frames and called classframes or classes. fig. 1 exemplifies the use of a frame and causal links.  the dot  .  notation is used to specify the component of the referred slot.  this normal activity of the ventricles is decomposed into three cycle events  i.e.  bundle-of-his-cycie-event  right-ventricle-cycleevent  and left-ventricie-cycle-event. two initiate links represent the conductions from the bundle of his to the left and the right ventricles  respectively. note that the information related to the class itself  in this case  the subject part name and the activation type  is given as the 
	t. shibahara 	1 
instantiation of a metaclass activity-concept. 
classvent-all-mature-forward-actjvity 
is-a vent-activity 
instance-of 	activity-concept 	instantiated-with subject: ventricle; 
activation: forward;; 
with 	components 
bundle-of-his-cycie-event: bhis-mature-cell-cycle; right-ventricle-cycle-event: rv-mature-cell-cycle; left-ventricle-cycle-event: lv-mature-cell-cycle; bhis-rv-delay:number-with-tolerances calculate := /* delay set-up expression  /; 
bhis-lv-delay:number-with-tolerances 
calculate := /* delay set-up expression  /; 
causal-links bhis-rv-propagation: initiate 
causative-starting-event: bundle-of-his-cycle-event.depolarization-phase-event; 
initiate d- event: 
right-ventricle-cycle-event.depolarization-phase-event; 
delay: bhis-rv-delay;; 
bhis-lv-propagation: initiate 
	c 	ausative-starting-event: 
 bundle-of-his-cycle-event.depolarization-phase-event; initiated-event: 
lcft-ventricle-cycle-event.depolarization-phase-event; 
delay: bhis-lv-delay;; 
end 
fig. 1 class frame for normal activity of the ventricles 
1 is-a and part- of hierarchies in knowledge base 
　　let us examine how the is-a and the part-of principles contribute to the organization of the caa knowledge base. we take a look at the qrs and qrst waveforms in the ecg waveform kb as examples. 
　　first  the qrst waveform consists of the qrs complex and the t wave; thus  the corresponding class qrstcomposite-wave-shape has the generic part-of structure with major components shown in fig. 1- a . this generic qrst waveform is specialized into several qrst waveforms in fig. 1- b   along its is-a hierarchy. let us pick up one component from the standard-qrstcomposite-shape. normal-qrs-complex is such a component and this class is itself included in the is-a hierarchy of the qrs waveforms as in fig. 1- c . the orthogonality of is-a and part-of hierarchies is shown in fig. 1- d  since standard-r-wave-shape is a component of standard-qrs-complex-shape and  at the same time  it is included in a local is-a hierarchy of r-wave-shape. 
　　similarly  various is-a and part-of hierarchies are defined in the physiological kb. such organizational hierarchies not only contribute to the clarification of the inter-dependency among domain concepts but also provide guiding knowledge for the recognition process as discussed later. 

1 	t.shlbahara 

1 metaclasses and statistical 	standards 
　　statistical information  so commonly used in medical reasoning systems  has particular importance when insufficient information is available about the disease status of a patient  szolovits1 . in our case  the recognition system uses statistical standards to make expectations for unknown attributes of events and to estimate consistencies  goodness-of-fit  of hypotheses. since statistical standards about a class are not the attributes of any particular instance of the class but the attributes of the class itself  such standards could be defined in appropriate metaclasses and instantiated as properties of the class itself. in other words  event statistics are good examples of meta-knowledge or  knowledge 'about knowledge  and such knowledge is organized along the instance-of axis. in fact  to provide  mean  and  standard-deviation  values to all the physiological phase events  caa has a metadata cellphase-concept as shown in fig. 1. 
metaclass cell-phase-concept with components 
subject: heart-portion; maturity: degree-of-maturity; phase: phase-name; mean: expression default meanfunc; deviation: expression default devfunc; 
end 
fig. 1 metaclass definition for statistical information 
　　in fig. 1. default functions meanfunc and devfunc are generic functions that are supposed to generate mean and standard deviation about durations of phase events. such statistical standards about phases are function procedures of  subject    maturity    phase   and a state variable hr$  heart rate . therefore  such a standard  for example  a mean value is given by the expression   mean subject maturity phase hr$   in a particular phase event class. in the evaluation of this expression  the slot-names such as  mean  and  subject  are replaced by real properties of the class  such as  meanfunc  and  sanode . this is considered as the tailoring process of the general  mean  expression to the definitional context of this event; i.e.. such statistics may change to fit into each event hypothesis. on the other hand  hr$ is a global variable that reflects the current state of the model  where hypotheses are being instantiated; in other words  such global variables are used to make statistical standards sensitive to the current recognition context. heart rate  blood pressure and breathing rate are examples of dynamic or time varying global variables while age-group  sex  race  and types of medications are static global variables. obviously  default functions  meanfunc and devfunc  may be replaced by any ad-hoc functions if necessary. 
1 knowledge-base 	stratification and projection links 
　　due to our causal model approach  we at least distinguish two subdomains  i.e.  the ecg morphological  shape  domain and the electrophysiological domain. therefore  the system's knowledge base is stratified by the ecg waveform kb and the physiological event kb. our idea of stratifying a knowledge base resembles rich's  overlays  since it provides different perspectives to the problem  rich1 . in our method  however  the linking mechanism between different kbs is biased to recognition purposes. 
　　projection links have been introduced into the caa system to relate corresponding concepts in distinct domain kbs. in our model based approach such links are essential since they relate temporal and/or morphological abnormalities in waveforms to corresponding abnormalities in physiological causal structures. 
　　the diagram in fig. 1 illustrates a projection link that defines the correspondence between the corner point information of a normal qrst waveform and the timings of a normal activity event of the ventricles. this 


projection link must be defined in the class frame of the normal qrst waveform. 
　　for recognition  the most important aspect of projection links is that they provide guiding paths to map concepts across differently organized kbs and support the synchronization of recognition activities in different domains. in our system  projections from established waveform hypotheses result in the basic data set  hypotheses  in the underlying event domain  on which the recognition of causal events works. 
1 recognition strategies and control system 
1 outline of recognition flow 
　　signals are processed by three functional modules in the following order: 
 1  the peak-detection module extracts wave segments and slopes from sampled ecg input signals and emits peak tokens with the measured parameters. this module uses the syntactic method given by horowitz  horowitz1  based on piecewise linearization and parsing techniques using a context-free grammar. 
 1  the waveform analyst module  for each cardiac cycle  forms waveform hypotheses on the peak tokens and refines the hypotheses to describe the given set of 
	t.shlbahara 	1 
tokens best. once established  such hypotheses are projected into the physiological event domain to form their corresponding event hypotheses. 
 1  the errant analysis modulle accepts projected events as a starting data set and generates rhythm event hypotheses in a more global context of time to elucidate rhythm abnormalities in the underlying cardiac conduction system. since most of physiological events do not have observable counterparts  waveforms   the event analysis module makes expectations on the attributes of unseen events using the causal knowledge of the conduction system and statistical standards of events. if the system encounters lack of information because of missing waves  it may request the peak-detection module to search for such missing tokens based on the expectation of such waves. 
1 	specialization 	and 	aggregation 	for 	hypothesis generation 
　　our recognition strategy is based on the hypothesize-and-test paradigm  in particular  the attention mechanisms of the alven system. the focusof-attention mechanism makes recognition  hypothesis formation  proceed from the generic to the specific along is-a class hierarchies downward. when a ciabs hypothesis succeeds  a focusing action is taken by choosing and hypothesizing an arbitrary specialized class of the succeeded class. when a current hypothesis failed  the change-of-attention mechanism chooses alternative hypotheses through similarity links  examining the similarity and the difference between classes. 
　　let us examine how the above specialization and aggregation process works for qrst waveforms  see fig. 1 . after all peaks are detected and measured  the waveform analysis module chooses groups of consecutive prominent peaks with high amplitude and steep slope as anchoring shapes. these anchoring shapes are candidates for qrst-composite-shape. the wave analysis for an anchoring shape starts with hypothesizing the class qrst-composite-shape on the prepared set of basic peak tokens  as the first step. this class is most generic for all the shapes composed of q  r  s  and t waves and only requires the existenoe of any qrs complex wave as the sole component; thus  this component class  which is again the most generic class for qrs complex waves  is hypothesized and its instantiation follows using the prepared q  r  and/or s wave tokens. if there is none of q  r. or s wave tokens  the hypothesis of qrs-complex-shape fails and so does qrst-composite-shape  too. as the second step  one of specialized qrst composite wave classes under qrstcomposite-shape is hypothesized and all its attributes are tested  i.e.  the slot tokens are tried to be instantiated. since all the specialized classes are connected by similarity links  using exceptions raised by test results the system may choose the next appropriate hypothesis and finally reach the valid hypothesis for the given anohoring shape. the test procedure for each attribute slot  however  triggers an independent process 

1 	t.shibahara 
to recognize the token of the slot. for example  class standard-qrst-composite-shape has a slot named qrs-complex and this slot is defined by class normalqrs-complex which is an is-a parent class to classes. 
standard-qrs-complex-shape  	standard-qr-
complex-shape. 	standard-rs-complex-shape 	and 
standard-r-only-complex-shape; thus  the previous 
qrs wave slot token of the generic qrst-compositeshape must be specialized along the is-a hierarchy of 
qrs-comflex-shape  and this process also uses the same procedure in order to reach the most refined qrs complex shape hypothesis. with such a specialized qrs wave token and a separately specialized t wave token  the second step decides the most appropriate hypothesis among qrst composite shapes for the given set of wave tokens. 
　　similarly but independently  in the physiological event domain  the specialization and aggregation process starts with the most generic beat pattern and eventually provides several specialized patterns as probable overall interpretations. 
1 projection mechanism and expectation mechanism 
　　the recognition starts with establishing hypotheses in the waveform domain. the projection mechanism maps such established hypotheses into the event domain  preparing a set of basic event hypotheses  which are treated like data in the event recognition process. 
　　a beat pattern  rhythm  is a complex time-varying event aggregated from more local events such as beats  activities  cycles  and phases. causal links in such an aggregated event imply connections among its component events. thus  once projections are made to some of these components  the system can produce expectations of unknown components from the known components. therefore  when the system hypothesizes such an aggregated event  it looks ahead or looks back for its component events which are causally linked to  already-established  component events. most frequently  causal links are used to locate the temporal positions of  to-be-expected  events by their inherent temporal constraints. this expectation is made by the following basic equality implicitly imposed over starting or ending times of participating events: 
 effect-time  =  cause-time  +  delay-period . 
　　let us look at the above mechanisms in a clear small case where a qrst composite wave is seen but the p wave has not been recognized for the current wave group. 

fig. 1 illustrates the case and the interval  area #1  is the probable area where a p wave would appear if the beat is a normal sinus-pacing beat. to estimate such an area under a particular beat hypothesis is important since the peak-detection module may search for a p wave intensively in this area  again. 
　　the area is estimated using the projection and the expectation mechanisms in the following fashion: 
 1  a hypothesis of normal-qrst-composite-shape is established. 
 1  a projection to a normal ventricle activity event  fig. 
1 : 
 a  the onset and offset times of the qrs complex are bound to the starting and ending times of the depolarization phase of the left ventricle. the offtime of the t wave is bound to the ending time of the partial-repolarization phase. these phase events are generated immediately and two other phase events are expected by three transfer causal links and event statistics. thus  the left ventricle  lv  cycle event is generated. 
 b  by the initiate causal link to the bundle of his  bh1s  and subsequent transfer links  the bhis cycle event is generated. also  by the initiate link from the bhis to the right ventricle  rv . the rv cycle event is generated. 
 c  with the above three cycle events  the projection to the normal ventricle activity event is completed. 
 1  expectation of the av-node activity  the atrium activity  and the sa-node activity under a hypothesis of the normal sinus-pacing beat  fig 1- c  : 
 a  the initiate link c1 is invoked to expect the phase e1a. then e1b. e1c  and e1d phases are expected by three transfer links  and finally  the lower av-node cycle event is generated. similarly  using c1 and c1 initiate links  the middle and the upper av-node activity events are generated. thus  the av-node activity event is formed with these component cycle events. 
 b  starting with the initiate link c1  the atrium activity event is expected in the same as above  and  next  the sa-node cycle event is expected.  c  a hypothesis of the normal sinus-pacing beat is completed. 
under this hypothesis  the on-time and the off-time of the p wave correspond to the starting time of the upperatrium cycle and the ending time of the lower-atrium cycle  respectively. therefore  the search area for a probable p wave is given as the interval between theses times  e.g.  from 1 ＼1ms to 1 ＼1ms before the qrs complex . the request of the search for the p wave is fed back to the peak-detection module to repeat the detection with different sensitivity parameters. 
　　the above caa expectation mechanism is characterized by the following features: 
 1  the expectation is made from the known to the unknown  forward or backward in time  and upward or downward in a part-of class structure. 
	t.shibahara 	1 
temporal 	and/or 	structural 	dependencies 	and  1  the expectation proliferates to make a closure of complete the part-of structure of the hypothesis. 
projections are made in the following fashion: 
 1  projections may be made between differently structured classes as seen in fig. 1. 
 1  to eliminate unnecessary instantiations of projections  any projected class is instantiated only when a current global hypothesis requests the class as a component. 
1 	beat-pattern analysis 
　　to recognize a periodic or successive arrhythmia  its repetitive behavior is defined by the recursive definition of beat-pattern frames. by such a frame  recognition may proceed one beat to the next along the time axis instantiating successive beats to form the beat-pattern. 
　　in the process of forming beat-patterns  causal links between adjacent beats allow the system to verify the causal relationship that govern the pace-making mechanism on a beat-to-beat basis. the overall consistency of a beat-pattern is calculated based on the consistencies of these causal links and beat components. 
　　as well as the causal consistency among beats  overall characteristics and tendencies are observed and used to recognize individual arrhythmias. for this purpose  most beat-pattern classes include a component that monitors the changes of variables from one beat to another. a typical example is to monitor the change of the r-r interval or the p-r interval. 
　　in arrhythmia beat-patterns  similarity links must also be defined to relate beat-patterns that have some features in common and handle situations where one or more matching exceptions have been raised. fig. 1 shows ecg wave configurations that correspond to three different av-block arrhythmia patterns and the matching exceptions used by similarity links. such similarity links between repetitive beat-patterns enable the system to switch beat-pattern hypotheses from one pattern to its alternatives according to the matching exceptions. for example  the class definition of mobitz-1 second degree av-block contains a similarity link toward the mobitz-1 second degree av-block and the first degree av-block for the situation where no progressive prolongation is seen in the atrium-ventricle-interval. 
　　to recognize particular arrhythmia patterns  the specialization-and-aggregation process must be initiated with the most generic class for repetitive arrhythmias. the final interpretation  therefore  is given by a set of all survived beat-patterns with overall consistency factors. the consistency is is calculated using event statistics and a test-score function  which is similar to a fuzzy constraint in  zadeh1 . 
1 concluding remarks 
　　we have discussed a recognition system guided by a causal model of the underlying physiological entity. we think a definite advantage of such a recognition system is the use of the causal knowledge and appropriate statistical knowledge about underlying events  enabling the system to make  expectations  of the event structure of the entity even when partial information is given. this approach is applicable in other medical applications because the ultimate purpose of recognition of vital signals is normally the elucidation of such causal abnormalities in the physiology  rather than merely the recognition of contour deformation or interval changes. 
　　our recognition system is effectively supported by various link constructs such as causal links  similarity links  and projection links  which are regarded as the distributed control knowledge. in fact  causal links support the expectation of unknown events using part-of hierarchies  similarity links guide the recognition in focusing or changing attentions using is-a hierarchies  and projection links help hypothesis transduction across different kbs. 
　　our recognition method may not be successful when key waveforms are missing and no expected waves can be uncovered in spite of intensive search in the area of expectation. therefore  we are designing the system that will interact with diagnostic interventions when the system faces lack of information. the purpose of such interventions is to perturb a patient's physiological state so that the state could move to a disease specific state. 1 	t.shibahara 
acknowledgement 
the caa system has been developed as the author's 
ph.d. work at the university of toronto. a variety of people contributed to this work. as his supervisor  prof. john tsotsos of the dept. of computer scienoe played a key role with his excellent insight and direction. prof. john mylopouios  who supervised the knowledge representational aspect  and his psn group provided a fertile environment for this research. h. dominic covvey  director of cardiovascular computing at toronto general hospital  now at clinicom international   contributed greatly to the development of the caa system with his medical expertise and contacts. the author is especially thankful to menashe b. waxman  m.d.  cardiologist at toronto general hospital for his helpful discussion on arrhythmia problems. programming assistance f r o m ken anderson  m.d. and andrew gullen is gratefully acknowledged as well as assistance f r o m brian nixon in document preparation. 
financial assistance is provided by the ontario heart 
foundation. during the course of the work  the author was a recipient of a scholarship from the department for foreign affairs of canada  and a research fellowship f r o m defense research establishment atlantic. 
