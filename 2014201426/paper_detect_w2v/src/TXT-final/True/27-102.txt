 
any attempt to introduce automation into the monitoring of complex physical systems must start from a robust anomaly detection capability. this task is far from straightforward  for a single definition of what constitutes an anomaly is difficult to come by. in addition  to make the monitoring process efficient  and to avoid the potential for information overload on human operators  attention focusing must also be addressed. when an anomaly occurs  more often than not several sensors are affected  and the partially redundant information they provide can be confusing  particularly in a crisis situation where a response is needed quickly. 
the focus of this paper is a new technique for attention focusing. the technique involves reasoning about the distance between two frequency distributions  and is used to detect both anomalous system parameters and  broken  causal dependencies. these two forms of information together isolate the locus of anomalous behavior in the system being monitored. 
1 	introduction 
mission operations personnel at nasa have the task of determining  from moment to moment  whether a space platform is exhibiting behavior which is in any way anomalous  which could disrupt the operation of the platform  and in the worst case  could represent a loss of ability to achieve mission goals. our approach to introducing automation into real-time systems monitoring is based on two observations: i  mission operators employ multiple methods for recognizing anomalies  and 1  mission operators do not and should not interpret all sensor data all of the time. we seek an approach for determining from moment to moment which of the available sensor data is most informative about the presence of anomalies occurring within a system. the work reported here extends the anomaly detection capability in the selmon monitoring system  1; 1  by adding an attention focusing capability. 
　other model-based monitoring systems include dvorak's mimic  which performs robust discrepancy detection for continuous dynamic systems  1  and decoste's datmi  which infers system states from incomplete sensor data . this work also complements other work within nasa on empirical and model-based methods for fault diagnosis of aerospace platforms  1; 1; 1; 1. 
1 	background: the selmon approach 
abnormal behavior is always defined as some kind of departure from normal behavior. unfortunately  there appears to be no single  crisp definition of  normal  behavior. in the traditional monitoring technique of limit sensing  normal behavior is predefined by nominal value ranges for sensors. a fundamental limitation of this approach is the lack of sensitivity to context. in the other traditional monitoring technique of discrepancy detection  normal behavior is obtained by simulating a model of the system being monitored. this approach  while avoiding the insensitivity to context of the limit sensing approach  has its own limitations. the approach is only as good as the system model. in addition  normal system behavior typically changes with time  and the model must continue to evolve. given these limitations  it can be difficult to distinguish genuine anomalies from errors in the model. 
　noting the limitations of the existing monitoring techniques  we have developed an approach to monitoring which is designed to make the anomaly detection process more robust  to reduce the number of undetected anomalies  false negatives . towards this end  we introduce multiple anomaly models  each employing a different notion of  normal  behavior. 
1 	anomaly detection methods 
in this section  we briefly describe methods that we use to determine when a sensor is reporting anomalous behavior. the first few measures use knowledge about each individual sensor  without knowledge of any relations among sensors. 
　surprise. an appealing way to assess whether current behavior is anomalous or not is via comparison to past behavior. this is the essence of the surprise measure. it is designed to highlight a sensor which behaves other than it has historically. specifically  surprise uses the historical frequency distribution for the sensor in two ways: to determine the likelihood of the given current value of the sensor  and to examine the relative likelihoods of different values of the sensor. it is those sensors which display unlikely values when other values of the sensor are more likely which get a high surprise score. surprise is not high if the only reason a sensor's value is unlikely is that there are many possible values for the sensor  all equally unlikely. 
	doyle 	1 
　
　alarm. alarm thresholds for sensors  indexed by operating mode  typically are established through an off-line analysis of system design. the notion of alarm in selmon extends the usual one bit of information  the sensor is in alarm or it is not   and also reports how much of the alarm range has been traversed. thus a sensor which has gone deep into alarm gets a higher score than one which has just crossed over the alarm threshold. 
　alarm anticipation. the alarm anticipation measure in selmon performs a simple form of trend analysis to decide whether or not a sensor is expected to be in alarm in the future. a straightforward curve fit is used to project when the sensor will next cross an alarm threshold  in either direction. a high score means the sensor will soon enter alarm or will remain there. a low score means the sensor will remain in the nominal range or emerge from alarm soon. 
　value change. a change in the value of a sensor may be indicative of an anomaly. in order to better assess such an event  the value change measure in selmon compares a given value change to historical value changes seen on that sensor. the score reported is based on the proportion of previous value changes which were less than the given value change. it is maximum when the given value change is the greatest value change seen to date on that sensor. it is minimum when no value change has occurred in that sensor. 
　although many anomalies can be detected by applying anomaly models to the behavior reported at individual sensors  some can only be detected by reasoning about interactions occurring in a system and about behavior reported by several sensors. 
　deviation. the deviation measure is our extension of the traditional method of discrepancy detection. as in discrepancy detection  comparisons are made between predicted and actual sensor values  and differences are interpreted to be indications of anomalies. this raw discrepancy is entered into a normalization process identical to that used for the value change score  and it is this representation of relative discrepancy which is reported. the deviation score for a sensor is minimum if there is no discrepancy and maximum if the discrepancy between predicted and actual is the greatest seen to date on that sensor. 
　deviation on y requires that a simulation be available in any form for generating sensor value predictions. however  the remaining sensitivity and cascading alarms measures require the ability to simulate and reason with a causal model of the system being monitored. 
　sensitivity and cascading alarms. sensitivity measures the potential for a large global perturbation to develop from current state. cascading alarms measures the potential for an alarm sequence to develop from current state. both of these anomaly measures use an event-driven causal simulator  1; 1  to generate predictions about future states of the system  given current state. current state is taken to be defined by both the current values of system parameters  not all of which may be sensed  and the pending events already resident on the simulator agenda. the measures assign scores to individual sensors according to how the system parameter corresponding to a sensor participates in  or influences  the predicted global behavior. a sensor will have its highest sensitivity score when behavior originating at that sensor causes all sensors causally downstream to exhibit their maximum value change to date. 1 qualitative reasoning and diagnosis 
a sensor will have its highest cascading alarms score when behavior originating at that sensor causes all sensors causally downstream to go into an alarm state. 
1 	previous results 
in order to assess whether selmon increased the robustness of the anomaly detection process  we performed the following experiment: we compared selmon performance to the performance of the traditional limit sensing technique in selecting critical sensor subsets specified by a space station environmental control and life support system  eclss  domain expert  sensors seen by that expert as useful in understanding episodes of anomalous behavior in actual historical data from eclss testbed operations. 
　the experiment asked the following specific question: how often did selmon place a  critical  sensor in the top half of its sensor ordering based on the anomaly detection measures  
　the performance of a random sensor selection algorithm would be expected to be about 1%; any particular sensor would appear in the top half of the sensor ordering about half the time. limit sensing detected the anomalies 1% of the time. selmon detected the anomalies 1% of the time. 
　these results show selmon performing considerably better than the traditional practice of limit sensing. they lend credibility to our premise that the most effective monitoring system is one which incorporates several models of anomalous behavior. our aim is to offer a more complete  robust set of techniques for anomaly detection to make human operators more effective  or to provide the basis for an automated monitoring capability. 
　the following is a specific example of the value added of selmon. during an episode in which the eclss preheater failed  system pressure  which normally oscillates within a known range  became stable. this  abnormally normal  behavior is not detected by traditional monitoring methods because the system pressure remains firmly in the nominal range where limit sensing fails to trigger. furthermore  the fluctuating behavior of the sensor is not modeled; the predicted value is an averaged stable value which fails to trigger discrepancy detection. see  1; 
1 for more details on these previous results in evaluating the selmon approach. 
1 	determining the locus of an anomaly 
a robust anomaly detection capability provides the core for monitoring  but only when this capability is combined with attention focusing does monitoring become both robust and efficient. otherwise  the potential problems of information overload and too many false positives may defeat the utility of the monitoring system. 
　the attention focusing technique developed here uses two sources of information: historical data describing nominal system behavior  and causal information describing which pairs of sensors are constrained to be correlated  due to the presence of a dependency. the intuition is that the origin and extent of an anomaly can be determined if the misbehaving system parameters and the misbehaving causal dependencies can be determined. such information also supports reasoning to distinguish whether sensors  system parameters or mechanisms are misbehaving due to the fact that the signature of 
　

 broken  nodes and arcs in the causal graph are distinguishable. see figure 1. 
　for example  the expected signature of an anomalous sensor includes the node of the sensor itself and the immediately adjacent arcs corresponding to the causal dependencies that the sensor participates in directly. the intuition is that the actual system is behaving normally so the locus of  brokenness  is isolated to the sensor and the set of adjacent causal dependencies which attempt and fail to reconcile the bogus value reported by the sensor. 
　the expected signature of an anomalous system parameter also includes nodes and arcs which are downstream in the causal graph from the node corresponding to the system parameter. the intuition here is that the misbehavior  being in the actual system  will propagate.  clearly a heuristic interpretation  for not all misbehaviors will propagate . 
　the expected signature of an anomalous mechanism also includes arcs and nodes causally downstream from the arc corresponding to the mechanism. once again  the intuition is that the misbehavior is in the system itself  and it will propagate. the way to distinguish this case from the anomalous system parameter case is to examine all input arcs  assuming there are more than one  to the most causally prior node in the  broken  subgraph. 
1 	distance and causal distance 
while selmon runs  it computes incremental frequency distributions for all sensors being monitored. these frequency distributions can be saved as a method for capturing behavior from any episode of interest. of particular interest are historical distributions which correspond to nominal system behavior. 
　to identify an anomalous sensor  we apply a distance measure  defined below  to the frequency distribution which represents recent behavior to the historical frequency distribution representing nominal behavior. we call the measure simply distance. to identify a  broken  causal dependency  we first apply the same distance measure to the historical frequency distributions for the cause sensor and the effect sensor. this reference distance is a weak representation of the correlation that exists between the values of the two sensors due to the causal dependency. this reference distance is then compared to the distance between the frequency distributions based on recent data of the same cause sensor and effect sensor. the difference between the reference distance and the recent distance is the measure of the  brokenness  of the causal dependency. we call this measure causal distance. 
1 	desired properties of the distance measure define a distribution d as the vector dt such that 
and 	
　for a sensor s  we assume that the range of values for the sensor has been partitioned into n contiguous subranges of equal size which exhaust the range. we construct a frequency distribution as a vector ds of length nt where the value of dx is the frequency with which s has displayed a value in the ith subrange. 
　if our aim was only to compare different frequency distributions of the same sensor  we could use a distance measure which required the number of partitions  or bins in the two distributions to be equal  and the range of values covered by the distributions to be the same. however  since our aim is to be able to compare the frequency distributions of different sensors  these conditions must be relaxed. 
   before defining the set of desired properties of the distance measure  we define two special types of frequency distribution. let f be the random  or flat distribution where  and entropy is maximized. let sz be the set of  spike  distributions where dl = 1 and  = 1  and entropy is minimized. 
　it is our view that the flat and spike distributions should be maximally distinguished by our distance measure. for what change of behavior seems more startling  more abnormal  more indicative of a deep anomaly than a sensor which has been perfectly predictive suddenly offering no basis for prediction  or vice versa  
　more generally  we seek a distance measure for frequency distributions with the following properties: 
distance 

　this property merely defines the measure as a distance measure. 
identity 

symmetry 
  
　we do not wish to emphasize whether we are comparing recent data to historical data or vice versa. also  we do not wish to emphasize whether we are comparing cause data to effect data or vice versa. we want our method to be driven by the simplest causal graphs of undirected dependencies. 
distinctness 
	doyle 	1 
　
the euclidian distance between the projections of the distributions. the extrema property is satisfied by taking = φ =pie/1. this choice of φ guarantees that  so  sn-1  = a f  so  = a f  1 n - 1   = 1 and all other distances in the region which is the range of a are by inspection   1. 
　the distinctness property is not satisfied by the function a d  d1 . this is not surprising because the multidimensional space arising from the number of bins in a distribution is collapsed to a two-dimensional space  /  s . thoughts on how to address this limitation appear below. 
　insensitivity to the number of bins in the two distributions and the range of values encoded in the distributions is provided by the  /  s  projection function  which abstracts away from these properties of the distributions  
	1 	results 
in this section  we report on the results of applying the distribution distance measure to the task of focusing attention in monitoring. the distribution distance measure is used to identify misbehaving nodes  distance  and arcs  causal dis-
tance  in the causal graph of the system being monitored  or equivalently  detect and isolate the extent of anomalies in the 
system being monitored. 
	1.1 	a space shuttle propulsion subsystem 
　figure 1 shows a schematic for the forward reactive control system  frcs  of the space shuttle. helium provides backpressure when valves are open to force propellant into the manifolds  or jets. there are two assemblies as shown  one for fuel and one for oxidizer. when these substances mix in the jets  spontaneous ignition occurs. 
　figure 1 shows a causal graph for a portion of the frcs of the space shuttle. a full causal graph for the reactive control system  comprising the forward  left and right rcs  was developed with the domain expert. 
	1.1 	examples 
   selmon was run on seven episodes describing nominal behavior of the frcs. the frequency distributions collected during these runs were merged. reference distances were computed for sensors participating in causal dependencies. 
　selmon was then run on 1 different fault episodes  representing faults such as leaks  sensor failures and regulator failures. two of these episodes will be examined here; however  
1 	qualitative reasoning and diagnosis 
results were similar for all episodes. in each fault episode  and for each sensor  the distribution distance measure was applied to the incremental frequency distribution collected during the episode and the historical frequency distribution from the merged nominal episodes. these distances were a measure of the  brokenness  of nodes in the causal graph; i.e.  instantiations of the distance measure. 
　new distances were computed between the distributions corresponding to sensors participating in causal dependencies. the differences between the new distances and the reference distances for the dependencies were a measure of the  brokenness  of arcs in the causal graph; i.e.  instantiations of the causal distance measure. 
　the first episode involves a leak affecting the first and second manifolds  jets  on the oxidizer side of the frcs. the pressures at these two manifolds drop to vapor pressure. 
the dependency between these pressures and the pressure in the propellant tank is altered because the valve between the propellant tank and the manifolds is closed. thus there are two anomalous system parameters  the manifold pressures  and two anomalous mechanisms  the agreement between the propellant and manifold pressures when the valve is open . 
　the distance and causal distance measures computed for nodes and arcs in the frcs causal graph reflect this faulty behavior. see figure 1.  to visualize how the distribution distance measure circumscribes the extent of anomalies  the coloring of nodes and the width of arcs in the figure are correlated with the magnitudes of the associated distance and causal distance scores . 
　the behavior at the third manifold is due to a known bug in the training simulator software  which generated the anomaly signatures used in these examples. the apparent anomaly at the helium tank temperature has a different explanation. when the valves between the propellant tank and the manifolds close  the volume of the total system decreases. since pressure remains the same  temperature changes in accordance with the ideal gas law. selmon detects this change. 
　the second episode involves an overpressurization of the propellant tank due to a regulator failure. onboard software 
	doyle 	1 
　

automatically attempts to close the valves which isolate the helium tank from the propellant tank. one of the valves sticks and remains open. 
　the distance and causal distance measures isolate both the misbehaving system parameters  propellant pressure and valve status indicators  and the altered relationships between the helium and propellant tank pressures and between the propellant tank pressure and the valve status indicators. overpressurization of the propellant tank also alters the usual relation between propellant tank pressure and manifold pressures. see figure 1. note that the software bug affecting predicted behavior at the third manifold has manifested again. 
1 	applications 
selmon is being applied at the nasa johnson space center as a monitoring tool for space shuttle operations. current application efforts include the one for the propulsion  prop  flight control discipline reported on here  and ones for the guidance  navigation & control  gnc  discipline  the mechanical  mmacs  discipline and the thermal  eecom  discipline. an operational selmon prototype has been available since the recent hubble repair mission. selmon runs in a client-server environment and processes change-only data from the telemetry server on hundreds of sensors in real time. 
　at the jet propulsion laboratory  we are looking at the problem of onboard automated downlink determination for the pluto express pre-project. there has also been a general surge of interest recently in spacecraft autonomy. the challenge is to devise methods for robustly detecting and recovering from anomalies onboard. when onboard software is unable to effect a recovery  the spacecraft requests assistance from the ground and prepares an anomaly report to bootstrap the analysis of the ground experts. the anomaly detection and attention focusing capabilities of selmon may be wellmatched to these tasks. 
1 	qualitative reasoning and diagnosis 
1 	discussion 
the distance and causal distance measures based on the distribution distance measure combine two concepts: 1  empirical data alone can be an effective model of behavior  and 1  the existence of a causal dependency between two parameters implies that their values are somehow correlated. the causal distance measure constructs a model of the correlation between two causally related parameters  capturing the general notion of constraint in an admittedly abstract manner. nonetheless  these models of constraint arising from causality provide surprising discriminatory power for determining which causal dependencies  and corresponding system mechanisms  are misbehaving.  in the distance measure for detecting misbehaving system parameters  we are simply using the degenerate constraint of expected equality between historical and recent behavior.  
　the approach described in this paper has usability advantages over other forms of model-based reasoning. the overhead involved in constructing the causal and behavioral model of the system is minimal. the behavioral model is derived directly from actual data; no offline modeling is required. the causal model is of the simplest form  describing only the existence of dependencies. for the shuttle rcs  a 1-node causal graph was constructed in a single one and one half hour session between the author and the domain expert. 
1 	monitoring architecture 
the attention focusing capability provided by the distance and causal distance measures can be combined with the multipleviewpoint anomaly detection capability already developed in selmon to construct a general monitoring architecture. 
　the multiple anomaly measures  including the distance and causal distance measures  which are anomaly detection measures in their own right  provide continuous anomaly detection capability. all of these measures are normalized to the range  1  1  so their sensitivity  individually or collectively  can be fine-tuned for the behavior of particular monitored systems. whenever a detected anomaly is announced  the extent of the anomaly is isolated by applying the results of the distance and causal distance measures to the causal graph of the system. if selmon is supporting a human operator  the operator's attention is focused on the locus of the anomaly  rather than the potentially long and confusing list of the individual manifestations of the anomaly. 
1 	alternate distance measures 
other distance measures derived from more standard statistical concepts certainly are possible. for example  the mean and standard deviation of a distribution might form the basis for the projection space of the function a. most of the desired properties for the distance measure can be achieved  with the notable exception of the extrema property.  consider three distributions: the flat distribution f  a spike distribution sn/1  and a distribution with equal peaks at the lowest- and highestvalued bins i = 1 and i = n - 1. the mean is the same for these distributions and the standard deviation is least for the spike distribution. however  the flat distribution does not have the greatest standard deviation  violating the extrema property. satisfying this property is a prime motivation for our work. nonetheless a performance comparison of a distance measure based on the mean and standard deviation of a distribution  or other features  would be useful. 
　the x1 measure of the difference between two distributions is another possibility. however  the standard definition of x1 would have to be modified to accommodate not only distributions with different numbers of data points  but also distributions with different numbers of bins. 
1 	future work 
in addition to exploring alternate distance measures  several issues need to be examined to continue the evaluation of the attention focusing technique based on the distance measure  and its utility in monitoring. 
　we need to understand the sensitivity of the technique to how sensor value ranges are partitioned. clearly the discriminatory power of the distribution distance measure is related to the resolution provided by the number of bins and the bin boundaries. the results reported here are encouraging for the number of frcs sensor bins were in many cases as low as three and in no cases more than eight. separately  we are developing a density-based auto-binning technique which selects bin boundaries which the data naturally reflect. results have been promising and we hope to soon remove this element of arbitrariness in our approach. 
　we need to understand the suitability of the technique for systems which have many modes or configurations. we would expect that the discriminatory power of the technique would be compromised if the distributions describing behaviors from different modes were merged. thus the technique requires that historical data representing nominal behavior is separable for each mode. if there are many modes  at the very least there is a data management task. a capability for tracking mode transitions is also required. we are exploring the use of unsupervised learning to identify and build classifiers for system modes directly from historical data. 
　we need to understand the consequences of the distinctness property not being satisfied by the distribution distance measure. of concern is whether or not distributions we wish to distinguish are in fact being distinguished. the judicial introduction of additional components  e.g.  the number of local maxima in a frequency distribution  to the distribution projection space  /  s  may be required to enhance discriminability. 
1 	acknowledgements 
the members of the selmon team are len charest  dennis decoste  nicolas rouquette and jay wyatt. matt barry and dennis decoste provided valuable discussion on the concepts in this paper. harry porta provided valuable mathematical and counterexample insights during the development of the distance measure. matt barry also served invaluably as domain expert for the shuttle frcs. dave goeken and charlie robertson provided valuable support at johnson space center. 
the research described in this paper was carried out by the 
jet propulsion laboratory  california institute of technology  under a contract with the national aeronautics and space administration. 
