
holonic multi-agent systems  hmas  are a convenient and relevant way to analyze  model and simulate complex and open systems. accurately simulate in real-time complex systems  where a great number of entities interact  requires extensive computational resources and often distribution of the simulation over various computers. a possible solution to these issues is multilevel simulation. this kind of simulation aims at dynamically adapting the level of entities' behaviors  microscopic  macroscopic  while being as faithful as possible to the simulated model. we propose a holonic organizational multilevel model for real-time simulation of complex systems by exploiting the hierarchical and distributed properties of the holarchies. to fully exploit this model  we estimate the deviation of simulation accuracy between two adjacent levels through physics-based indicators. these indicators will then allow us to dynamically determine the most suitable level for each entity in the application to maintain the best compromise between simulation accuracy and available resources. finally a 1d real-time multilevel simulation of pedestrians is presented as well as a discussion of experimental results.
1 introduction
a large complex system contains a great number of interacting entities. their components are themselves complex  nested relationship  and the boundaries of the system are difficult to determine. some behaviors and patterns emerge as a result of interactions between elements  simon  1; holland  1; rodriguez  1 . exhibiting all these characteristics  the urban environments can thus be considered as complex systems. in recent years  scientific community has seen an great number of research works dedicated to complex systems. multiagent systems are emerging as one of the most adapted tools for analysis  modeling and simulation of this kind of systems. the holonic paradigm  koestler  1  and its application to multiagent systems have proven to be an effective solution to model complex systems  tecchia et al.  1; ulieru and geras  1 . holons are defined as self-similar structures composed of holons as substructures. they are neither parts nor wholes in an absolute sense. the organizational structure defined by holons  called holarchy  allows the modeling at several granularity levels. each level corresponds to a group of interacting holons.
　since we consider several individuals and their relationships  the complexity of the system is increased. one issue in the real-time simulation of complex systems is to allow multilevel simulation. this type of simulation aims at dynamically adapting the level of the entity behaviors  microscopic  macroscopic  while being as faithful as possible to the simulated model. we propose a holonic organizational multilevel model for real-time simulation of complex systems by exploiting the hierarchical and distributed properties of the holarchies. to fully exploit this model  we estimate the deviation of simulation accuracy between two adjacent levels through physics-based indicators. these indicators will then allow us to dynamically determine the most adapted level for each entity of the application to maintain the best compromise between simulation accuracy and available resources.
　after a short review of related works  this paper will introduce our holonic organizational model. then we will detail our physics-based indicators and how to integrate them into a multilevel model. finally a 1d real-time multilevel simulation of pedestrians is presented as well as a discussion of experimental results.
1 related works
a great number of works dedicated to multilevel simulation have already been proposed in many scientific domains : social simulation  troitzsch  1   virtual urban simulation  donikian  1   robotics  pettinaro et al.  1   real-time multilevel simulation platforms  kim  1 . however  multilevel modeling works are mainly concentrated on computer-aided design  cad  optimizations  schwabacher  1 . besides the major part of existent multilevel models work with a fixed number of levels  usually two : microscopic and macroscopic. moreover the level at which an entity is simulated is usually fixed  determined a priori by the designer according to its experience and experimental results of previous simulations. this point of view is shared by  ghosh  1  who proposes the first dynamical multilevel simulation. his approach is based on hierachical models from an abstract level to a more concrete one.
　as soon as we consider a highly detailed simulation of several individuals and their relationships  the complexity of the system and the associated computational costs increase. the multilevel simulation appears as one of the best solutions.  brogan and hodgins  1  and  musse and thalmann  1  propose multilevel behavioral models for mobile entities in virtual environments or situated environments  where various behaviors are attached to virtual characters.
　in the multiagent domain  works dealing with multilevel problems mainly focus on the study of emergent phenomena with various approaches : mathematical  biological  or a purely multiagent way. mas models for emergence usually deal with multilevel emergent structures  also called multiple emergence   heylighen  1  and focus on the detection and the recognition of behavioral patterns  beurier et al.  1 . multiagent-based simulations  mabs  often lead to the emergence of local groups of entities  servat et al.  1   but provide no means of manipulating them. giving a full sense to multiagent simulations would certainly imply the dynamic creation of agent's groups  but also their agentification to deal with specific behaviors at each level.  van aeken  1  introduces the notion of minimal multiagent system to study the dynamics of multiagent systems. this approach is based on the creation of a composed agent for each couple of atomic agent that could be merged. even if its model remain relatevily abstract and difficult to apply to real applications  we can consider that with hmas we adopt an equivalent approach. but the modularity and the reusability of the holonic organizational model  cf. section 1  allow us to overcome van aeken's model drawbacks. our approach consists in dynamically grouping agent and creating new level  and also determining the deviation of simulation accuracy between adjacent levels through physic-inspired indicators. the aims of these indicators is to dynamically detect when it's necessary to switch between simulation levels.
1 an holonic multiagent approach for multilevel simulation
1 an holonic organizational model
a holon can be seen  depending on the level of observation  either as an autonomous  atomic  entity or as an organization of holons. this duality of holons  sometimes called the janus effect in reference to the two faces of a holon  is particularly useful for the multilevel simulation and is detailed in the next section. in order to allow a modular and reusable modeling that minimizes impact on the underlying architecture  we have leaned for a model based on an organizational approach. we have selected the framework of  rodriguez et al.  1; rodriguez  1  based on the role-interaction-organization  rio  model  hilaire et al.  1  to represent organizations. this model enables formal specification  animations and proofs based on the ozs formalism  gruer et al.  1 . ozs is a multi-formalisms language combining object-z and statechart notations to describe an agent's role. statecharts are used to describe the behavior of the roles  and specify their possible states and how events may change these states. object-z schemas describe operations called by the statechart.
　so as to maintain this framework as generic as possible   rodriguez  1  distinguishes two aspects that overlap in a holon. the first is directly related to the holonic character of the entity  i.e. a holon  super-holon  is composed of other holons  sub-holons or members . this aspect is common to every holon  thus called holonic aspect. and the second is related to the problem s  the members are trying to solve  and thus specific to the application or domain of application.
　a super-holon is an entity in its own right  but it is composed by its members. then  we need to consider how members organize and manage the super-holon. this constitutes the first aspect of the holonic framework. to describe this aspect   rodriguez  1  define a particular organization called holonic organization. this organization represents a moderated group  gerber et al.  1  in terms of roles and their interactions. it defines three main roles corresponding to the status of a member inside a super-holon. the head role players are the representatives or moderators of the group  and a part of the visible interface. for the represented members two different roles have been defined. the part role represents members belonging to only one super-holon. the multi-part role is played by sub-holons shared by more than one super-holon. in this approach  every super-holon must contain at least one instance of the holonic organization. every sub-holon must play at least one role of this organization to define its status in the super-holon composition.
　super-holons are created with an objective and to perform certain tasks. to achieve these goals/tasks  members must interact and coordinate their actions. the framework also offers means to model this second aspect of the super-holons. these goal-dependent interactions are modeled using organizations  called internal organizations  since they are specific to each holon and its goals/tasks. the behaviors and interactions of the members can thus be described independently of their roles as a component of the super-holon. the set of internal organizations can be dynamically updated to describe additional behaviors. the only strictly required organization is the holonic organization that describes member's status in the super-holon. at the holon level  organizations are instantiated into groups. figure 1 depicts an example of such an instanciation. notation g1: scheduling denotes that g1 group is an instance of the organization scheduling. super-holon 1 is thus composed of three groups. the first one represents an instance of the holonic organization  and the other two groups instanciate the goals-dependent organizations : scheduling and pedestrian navigation1.
　this approach guarantees a clear separation between the management of the super-holon and the goal-specific behaviors and favors modularity and re-usability. further details on the framework can be found in  rodriguez  1 .
1 applying holonic model to multilevel scheduling mechanism
 michel  1  describes the 1 fundamental aspects of a mabs : agent behaviors  environment  scheduling and interaction. agents' behaviors and interactions being strongly

figure 1: the rio diagram of the multilevel scheduling organization
dependent from the applications  our approach focus on the scheduling aspect to remain generic. so we propose to exploit the hierarchical structure and scalable properties of the holarchy to ensure dynamical scheduling of the behaviors  role  at various simulation levels. this approach is essentially dedicated to simulations requiring good performances  real-time  virtual reality...  and involving a great number of individuals and their relationships  i.e. crowd  traffic or more generally urban simulation . by simulation levels  we refer to the accuracy  the complexity and/or the realism of the individuals behaviors.
　each individual is associated to an atomic holon. these holons are grouped into super-holons according to their affinity. then super-holons are grouped in their turn  and so on  to obtain a single and complete holarchy. the affinity measures  according to the applications objectives and simulation constraints  the compatibily of two holons to work together to a shared objective  inspired from  rodriguez  1  . in this context affinity is exploited to dynamically aggregate holons to obtain a scheduling holarchy coherent with application objectives. a holon can thus change of super-holons during the simulation if its goals have evolved and thus impacted its affinity with other members. affinity provides an easy mean to integrate application constraints in our model.
　each holon of this holarchy plays at least one role in the scheduling organization and one role corresponding to the behavior related to the application. if we have two or more independant application behaviors/roles to schedule at various levels  we have to dispose of one holarchy per role.
　the behaviors related to the scheduling mechanisms are depicted in the rio diagram shown in figure 1. the scheduling organization defines five roles : the scheduler role have to be played by a holon having and controlling its own computational resources  i.e. thread  computer ... . this role provides to its player the right to schedule1 holons playing the role multilevelscheduler or scheduled. the scheduled role provides the right to schedule/execute its roles. the multilevelscheduler role have absolutely to be played by a superholon  composed . it represents a fusion of the two previous

figure 1: the structure of the scheduling holarchy

figure 1: simulation and holarchy levels
roles allowing its player to schedule its role and its members. this role also provides all required tools to dynamically determine if it is necessary to schedule its members or its application roles  cf. the section 1 on the next page . environmental reactor represents the environment and allowed other roles to add/remove holon body to the environment. simulation's controller is dedicated to the controls of the simulation and their graphical user interfaces if any.
　an example of a possible structure of the resulting scheduling holarchy is described in the figure 1. the lowest level of the holarchy represents the simulation most accurate level where each individual is modeled using an atomic holon. this level is commonly described as the microscopic level. then the more we rise in the holarchy the more the application behavior is aggregated. the wide range of possible simulations levels is depicted in figure 1. the height of the holarchy depends on the affinity function that defines how holons are grouped  this holarchy is build from a dynamic bottom-up approach. each new super-holons is associated with a behavior of a more aggregated level than its members. this mechanisms allows thus to simulate applications behaviors at several granularity levels.
1 a physics inspired evaluation of simulation accuracy
one of the main problems in mas is the evaluation of the accuracy/efficiency of the system relatively to the task to perform and to the local mechanisms involved. our measurements are designed by considering local and/or global characteristics such as individual holon goal  system's goal  and holons' and environmental dynamics. in order to tackle this issue  solutions have been developed in the literature taking inspiration from biology  fitness value   sociology  altruism  or physics  energy . among the physics inspired measurements  the most widespread is entropy which value represents disorder/organization in the system. several ways to compute entropy were proposed from the hierarchical social entropy  balch  1  to the dynamic and static entropy  parunak and brueckner  1 . however  this kind of analysis has two main drawbacks. first  since it depends on the past transformations of the system  entropy cannot be considered as a state function  i.e. two identical system can be in a same state but with two different values for their entropy depending on their previous states . second  entropy is mainly a global measurement that does not take into account local mechanisms of the system. in order to evaluate the accuracy of our multilevel simulation and to overcome these drawbacks  we have designed three measurements that are inspired by different energy values wide used in physics :
  kinetic energy eci : measurement linked to the dynamics  velocity  of the considered holon i.
  goal potential energy epgi : measurement linked to the individual goal to reach for holon i.
  constraints potential energy epci : measurement linked to interactions of holon i with other holons and with obstacles in environment.
these three measurements can be considered as state functions since they only depend on current parameters  velocity  position relatively to the individual goal  positions of obstacles/other holons  etc . moreover  these measurements can be used whatever the level of the considered holon in the holarchy  microscopic  mesoscopic  macroscopic . the way to compute the various energies is dependent from the application  and will be detailed in the following sections  cf. section 1 .
　according to these three energies  we can define the global energy of a holon k by ek = eck +epgk +epck. this energy is characteristic of the current state of a holon and thus can be used to determine the deviation of the simulation accuracy between two adjacent levels. in that way  we introduce the notion of level similarity s  defined by :
           sn+1 =  Δe n+1 = ejn+1   ein  1  with ein the energy of holon i of a level n and ejn+1 the energy of its super-holon j  level n + 1 . if the similarity is aiming toward zero  we can consider that the upper level consitutes a good estimate of the lower level. if the difference is increasing  it can be interpreted as a degradation of the upper level approximation. the similarity can thus be considered as a indicator of the quality of the approximation realized by a more aggretated behavioral level.
1 application to real-time pedestrians simulation in urban environment
1d multiagent simulations of pedestrians  human crowds  implies to simulate the motions of a large number of people

figure 1: the structure of the pedestrian's holarchy
while maintaining a reasonable frame rate. multiagent systems are a convenient way to simulate such behaviors at the finest level but it often requires a lot of computations and it is thus often difficult to maintain acceptable performances for the 1d visualization unless having important computational resources. this is a typical application where the complexity/realism of simulated behaviors have to be adapted according to simulation constraints  here available computational resources. we propose to adapt our holonic multilevel model to this case study and detail the instanciation of the previous physics-based indicators.
1 pedestrian model
in this application  we are interested in simulating pedestrian navigation  virtual human  in urban environment  this kind of behavior is used in a wide range of applications : escape panic  urban dynamics  bus network validation...
　we use an organizational model  so pedestrian behaviors are defined in terms of roles and interactions. the pedestrian organization  depicted in figure 1  describes the three main roles involved in the simulation of pedestrian motion : actor and perceptor provide means to act  resp. perceive  in the urban environment  role environment . integration of the perceptions and computation of the motion according to holon objectives and environmental constraints  other holons and obstacles  are assured by the pedestrian role.
　in this application  we have choosen an hybrid approach : in the low levels of the holarchy the pedestrian behavior of a super-holon is the same of its members but perceptions/actions are aggregated  and then we use aggregate pedestrian behaviors.
　affinity between two pedestrians is defined according to three main functions : the distance between holon objectives  the distance between holon location  and the energetic affinity  cf. equation 1 .
given i and j two holons  affener
　the two lowest levels of the resulting scheduling holarchy are shown in figure 1. four pedestrians are grouped into a super-holons  if available computational resources are comfortable. the super-holon schedules its multilevelscheduler role and thus schedules its members  else it schedules its pedestrian behavior. all members play the head role in the holonic organization of the holon 1  because they have all an equivalent part in the decision making process within their super-holon. super-holon 1  mesoscopic level 1  disposes of the same pedestrian behavior as its members but its perceptions correspond to an aggregation of its members per-
micro level
figure 1: the rio diagram of the pedestrian's navigation organization
ceptions. its environmental body corresponds to a group of individual bodies. when a motion is computed  all members bodies are impacted by the same movement. thus we exploit the self-similarity of the holon to reuse the same behavior at various levels  in this case a meso holon can be considered as a kind of elementary pedestrian boids. aggregating perceptions and actions allows a significant reduction of computational costs while maintaining a relatively good simulation accuracy.
1 instanciation of physics-based indicators
this section will introduce a physics-based evaluation of simulation accuracy for the case study of pedestrian simulation. each pedestrian disposes at least of one objective  local and/or global . to model pedestrian behavior  we use a classical force model based on three main forces : a forward force  1  attracting the holon to its goal  and two repulsive forces from other holons  1  and the obstacles  1 .
 1 
 1 
 1 
ai position of the holon i.   position of the next holon's goal. position of a given obstacle.
with 
 :βobj  βij  βobs constants.
　according to this force model  energy measurement can be detailled as follow :
  for kinetic energy  a standard expression is used. in the following equation  mi corresponds to the mass of agent

figure 1: the evolution of computational cost according individual number  to its velocity
		 1 
  goal potential energy  epgi for agent i  is computed using the general expression of the potential energy considering a conservative force :
	ep =  δwf  obj★ =  f  obj★.du ★	 1 
with du ★ a unit vector in the direction of agent speed. expression of the goal potential energy is given by equation 1.
		 1 
  constraints potential energy  epci for agent i  is computed with the same principle as previous item.

1 experimental results and discussion
we have introduced a holonic multiagent model for multilevel simulation. first we have compared computational costs  in millisecond  between microscopic and mesoscopic simulation levels. experimental results are presented in figure 1. these results confirm that mesoscopic approximation is effectively less expensive than the microscopic level. that validates rising in the scheduling holarchy implies a reduction of computational cost. so our model is able to adapt agent behavioral level according to simulation constraints  i.e computational cost. then we can consider that mesoscopic level maintain a good approximation of pedestrian behavior because the difference between energy value  level similarity  is relatevily small and the animation of pedestrian navigating into the 1d world remains realistic compared to microscopic level. finally using this model  we have succeeded to simulate on a quite performant computer1 a reasonable number of agents with a good behavioral level while maintaining an acceptable 1d visualization : frame rate 1.
1 conclusion and future works
in this paper  we have presented a holonic multi-agent scheduling model to enable multilevel simulation. to achieve that we exploit the hierarchical structure and scalable properties of the holarchy to assure a dynamical scheduling of the application's entities at various behavioral levels. the use of an organizational approach allows a modular and reusable model. this approach confirms that multiagent systems allow through multilevel mechanism to simulate complex systems while satisfying application dependent constraints  like realtime. this work is part of a larger effort to develop a whole holonic multiagent simulation platform. further works will particularly deepen the study of levels' transition  micro   meso . based on our physics-based indicators  we will try to determine if and when it is really appropriate to change level  by trying to foresee at short terms the next states of a holon.
