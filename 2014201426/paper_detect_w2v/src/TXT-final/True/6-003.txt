 
in this paper we address the problem of query answering and rewriting in global-as-view data integration systems  when key and inclusion dependencies are expressed on the global integration schema. in the case of sound views  we provide sound and complete rewriting techniques for a maximal class of constraints for which decidability holds. then  we introduce a semantics which is able to cope with violations of constraints  and present a sound and complete rewriting technique for the same dec idable class of constraints. finally  we consider the decision problem of query answering and give decidability and complexity results. 
1 introduction 
the task of a data integration system is to combine data residing at different sources  providing the user with a unified view of them  called global schema. user queries are formulated over the global schema  and the system suitably queries the sources  providing an answer to the user  who is not obliged to have any information about the sources. the problem of data integration is a crucial issue in many application domains  
e.g.  re-engineering legacy systems  data warehousing  data mining  data exchange. 
　a central aspect of query processing is the specification of the relationship between the global schema and the sources; such a specification is given in the form of a so-called map-
ping. there are basically two approaches for specifying the mapping. the first approach  called global-as-view  gav   requires that a view over the sources is associated with every element of the global schema. conversely  the second approach  called local-as-view  lav   requires the sources to be defined as views over the global schema  lenzerini  1; duschka and levy  1 . 
　the global schema is a representation of the domain of interest of the data integration system: integrity constraints are expressed on such a schema to enhance its expressiveness  thus improving its capability of representing the real world. 
　since sources are in general autonomous  the data provided by the sources are likely not to satisfy the constraints on the global schema. integrity constraints have to be taken into account during query processing; otherwise  the system may return incorrect answers to the user ifagin et al.  1; call et al  1 . 
　another significant issue is that the sources may not provide exactly the data that satisfy the corresponding portion of the global schema; in particular  they may provide either a subset or a superset of the data satisfying the mentioned portion  and the mapping is to be considered sound or complete respectively. mappings that are both sound and complete are called exact. 
　in this paper  we restrict our analysis to the gav approach  which is the most used in the context of data integration. in particular  we study a relational data integration framework in which key dependencies  kds  and inclusion dependencies  ids  are expressed on the global schema  and the mapping is considered sound. the main contributions of this paper are the following: 
1. after showing that query answering in the general case in undecidable  we provide a sound and complete query rewriting technique first for the case of ids alone  and then for the case of kds together with the maximal class of ids for which the problem is decidable  called nonkey-conflicting ids  or simply nkcids  section 1 . 
1. since it is likely that data retrieved at different  autonomous sources violate the kds  we introduce a novel semantics that is a  relaxation  of the sound semantics  and that allows minimal repairs of the data  section 1 . we then present a sound and complete query rewriting technique in the case where kds and nkcids are expressed on the global schema  section 1 . 
1. finally  we present decidability and complexity results of the  decision  problem of query answering in the different cases  section 1 . 
1 formal framework for data integration 
in this section we define a logical framework for data integration  based on the relational model with integrity constraints. 
syntax we consider to have an infinite  fixed alphabet t of constants  also called values  representing real world objects  and will take into account only databases having t as domain. we adopt the so-called unique name assumption  i.e.  we assume that different constants denote different objects. 
　formally  a data integration system i is a triple  g  s  m   where: 

1 	al and data integration 

1. g is the global schema expressed in the relational model with integrity constraints. in particular  g = assume  without loss of generality  that the attributes in a are the first n attributes of r. moreover  we assume that at most one kd is specified for each relation. 
1. s is the source schema  constituted by the schemas of the various sources that are part of the data integration system. we assume that the sources are relational  and that integrity constraints expressed on s are satisfied data at the sources. hence  we do not take such constraints into account in our framework. 
1. m is the mapping between the global and the source schema. in our framework the mapping is defined in the 
a view  i.e.  a query  over the sources. we indicate the mapping as a set of assertions of the form  r  v   where r is a relation and v is the associated view over the source schema. we assume that the language used to express 
queries in the mapping is positive datalog  abiteboul et al  1   over the alphabet of the relation symbols in s. a datalog query  or program  q of arity n is a col-
　finally  a query over the global schema q is a formula that is intended to extract a set of tuples of elements of t. the language used to express queries over g is union of conjunctive queries  ucq   abiteboul et al  1   i.e.  a datalog program such that each rule head uses the same predicate of the same arity  and only relation symbols of g occur in each rule bodv. 
　in order to specify the semantics of a data integration system i  we start by considering a source database for i  i.e.  a database p for the source schema s. based on p  we now specify which is the information content of the global schema g. we call global database for i any database for g. for-
al and data integration 	1 


1 	al and data integration 


al and data integration 	1 

	1 	summary of complexity results 
strictly-sound semantics. query answering is undecidable even if we allow a slightly more general class of ids than the nkcids; let us define a 1-key-conflicting  1kc  data inte-
theorem 1 the problem of query answering in 1kc integration systems  under the strictly-sound semantics  is undecidable. 
　in the strictly-sound semantics  the complexity of the decision problem of query answering is immediately derived from the rewriting of section 1. 
theorem 1 the problem of query answering in nkc integration systems  under the strictly-sound semantics  is in ptime in data complexity. incide  it is easy to see that the above properties of query answering under the strictly-sound semantics can be easily generalized. 
theorem 1 the problem of query answering in 1kc integration systems  under the loosely-sound semantics  is undecidable. 
　we now characterize the problem of query answering under the loosely-sound semantics in nkc systems. 
theorem 1 the problem of query answering in nkc integration systems  under the loosely-sound semantics  is conpcomplete in data complexity. 
　proof  sketch . membership in conp follows from theorem 1  and from the fact that query answering in datalogis conp-complete in data complexity  while conp-hardness 
can be easily proved by a reduction of the 1-colorability problem to our problem. 	＆ 
　the summary of the results we have obtained is reported in the table in figure 1  which presents the complexity of query answering for both the strictly-sound and the looselysound semantics. each row corresponds to a different class of dependencies  specified in the first two columns   while each cell of the table reports data complexity and combined complexity1 of query answering for ucqs: for each decidable case  the complexity of the problem is complete w.r.t. the class reported. in the second column of the table  fk stands for  foreign key dependencies   a well-known class of ids  while gen stands for  general ids . we have marked with results or to results immediately implied by known results. 
　　1 the results for combined complexity  which we cannot present in detail due to space limitations  hold under the assumption that the mapping is expressed in terms of ucqs. 
1 	al and data integration 


1 discussion and related work 
in this paper we have presented techniques for query rewriting in data integration systems with integrity constraints  and analyzed the complexity of query answering. to this aim  we have exploited formalisms and methods both from the traditional database theory and from computational logic. 
　several works in the literature address the problem of data integration under constraints on the global schema. in this respect  query rewriting under integrity constraints has been first studied in the lav setting. in particular   duschka and genesereth  1  presents a method for query rewriting under functional dependencies in lav systems  which is able to compute the perfect rewriting in the case of queries and mapping expressed through conjunctive queries  and  maximally contained  rewritings in the case of recursive mappings. 
　then   gryz  1  analyzes query rewriting under inclusion dependencies in lav systems  and presents a method which is able to deal simultaneously with acyclic ids and functional dependencies  based on an algorithm for computing the rewriting of a conjunctive query in a database with inclusion dependencies. the algorithm is based on a very interesting idea: obtaining query rewriting by computing the rewriting of each atom in a way  almost independent  of the other atoms. this can be obtained if the body of the initial query q is preliminarly  minimized . however  we have found out that gryz's algorithm does not actually compute the perfect rewriting  in the sense that some conjunctions of the perfect rewriting are missing. our algorithm id-rewrite presented in section 1 is certainly inspired by gryz's main intuitions  but overcomes the above mentioned incompleteness through a new technique for generating the rewriting. 
　complexity of query answering in gav under ids alone is immediately derived by the results in  johnson and klug  1 ; in this work  the same problem is solved for a restricted class of kds and ids  which  however  is significantly less general than the one treated in this paper. more recently  integration under constraints in gav systems has been addressed in  call et al  1  which presents a method for query rewriting in the presence of kds and foreign key dependencies  under a semantics analogous to our strictly-sound semantics. thus  the method does not deal with data inconsistencies w.r.t. kds. moreover   fagin et al  1  presents an approach for dealing with integrity constraints in a glav setting  a generalization of lav and gav . 
　in single database settings   arenas et al  1; greco et al.  1  propose methods for consistent query answering in inconsistent databases  which are able to deal with universally quantified constraints. the semantics adopted in these works is different from the ones considered in the present paper. 
acknowledgments this research has been supported by the 
projects infomix  ist-1  and sewasie  ist1  funded by the eu  and by the project d1i funded by miur  ministero per i'lstruzione  i'universita e la ricerca . we thank maurizio lenzerini and jarek gryz for precious discussions about this material. 
