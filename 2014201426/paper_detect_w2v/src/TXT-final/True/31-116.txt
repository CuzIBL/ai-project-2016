 
geographical database systems deal with certain basic topological relations such as  a overlaps b  and  b contains c  between simply connected regions in the plane. it is of great interest to make sound inferences from elementary statements of this form. this problem has been identified extensively in the recent literature  but very limited progress has been made towards addressing the considerable technical difficulties involved. in this paper we study the computational problems involved in developing such an inference system. we point out that the problem has two distinct components that interact in rather complex ways: relational consistency  and planarity. we develop 
polynomial-time algorithms for several important special cases  and prove almost all the others to be np-hard. 
1 	introduction 
suppose that you are told that a simply connected planar region a overlaps another region b  and that one of the regions a and c contains the other but you don't know which. what can you infer about b and c  for example  could they be disjoint  
　such questions are of great interest for developing intelligent inference engines for geographic database systems. it has been recently pointed out  egenhofer 1l  that there are eight fundamental relations that can hold between two planar regions:  overlaps    disjoint    inside    contains    meets   overlaps only at the boundary    covers   contains but also shares some boundary   
 covered by   the inverse of  covers   and  equal   see figure 1 . we call these relations high resolution case; they are the only relations that can be defined by considering intersections of two regions  their boundaries  and their complements  egenhofer 1l . 
　now  any three planar regions cannot stand in arbitrary relation with respect to each other; for example  if a is inside b and b meets c  then a and c must be 
'work supported by nsf grant no. dms-1. *work supported by nsf-iri 1. 
*work supported by nsf grant no. ccr-1. 

disjoint. the complete table of such one-step inferences was derived in  egenhofer 1; smith and park 1   see table 1; notice that this is an extension -as we shall see  a surprisingly subtle one- of allen's classical work on temporal intervals  allen  1  . 
　in some cases the refinement provided by the high resolution relations is not needed. in a cadastral application  for instance  the difference between  inside  and  covered by  may not be important. consider the query  find all land parcels in a given area.  the land parcels of the result should be inside or should be covered by the area. in this paper we also focus on the  possibly more useful  case in which there is no differentiation between  meets  and  overlaps   they are both called  overlap   or between  covers  and  contains   they are both called  contains    or their inverses  they are both called  inside  . it can be shown that these are the only relations that are relevant if one considers intersections of two objects and their complements  but not of their boundaries . the one-step inferences of these medium resolution relations are given in table 1. 
　in addition  we consider a sub-case of medium resolution in which the relation  overlap  is not permitted  instead objects can only meet . this situation arises often in geographic applications where geographic regions and administrative subdivisions obviously can only meet or contain one another  but cannot overlap. the one-step inferences in this case are shown in table 1. 
　we also consider the even coarser situation in which there are only two possibilities of interest:  disjoint  and  overlap   table 1 . overlap in this case is just the negation of disjoint  it means the two objects have points in common . these two relations are important 
	grigni  papad1as  and papadimitriou 	1 
　

1 	knowledge representation 
　

figure 1: levels of topological resolution 
　we are interested in deriving inferences involving topological relations such as the above. instead of considering the inference problem directly  we shall focus on the corresponding satisfiability problem  that is  determining whether or not a boolean combination of statements of the form  a meets b    b overlaps c  etc. can hold for certain planar regions a  b  c  etc. if the expression is unsatisfiable  we should be able to conclude so; if it is satisfiable  we should be able to come up with actual planar regions that satisfy it. 
　the paper is organized as follows: section 1 describes in detail the problem and its sub-cases. section 1 summarizes the computational complextiy results  classifying each problem in a complexity class. section 1 describes proof sketches and section 1 concludes with comments about future work. 
1 	problem description 
we shall only consider boolean expressions that are conjunctions of clauses  where each clause is of the form   a meets b  or  a overlaps b  or  a inside b    that is  the conjunction of one or more atomic statements  all involving the same pair of objects; furthermore  without loss of generality  there is exactly one clause involving each pair of objects  if there are two or more  then this is equivalent to the disjunction of the relations that are common to all clauses; if there is none  then we implicitly have the full clause  the disjunction of all possible relations at the present resolution . we call such expressions topological expressions; the generalization to arbitrary boolean expressions in cnf involves no additional difficulty  and would change our results very little  see entry 1 in section 1  but also appears to be of no use. 
　there are two important special cases of topological expressions that are of interest: in the explicit case  all clauses are singletons  the relation for each pair of ob-
jects is known . in the conjunctive case we only have clauses that are either singletons or full  the relation for each pair of objects is either explicit or unknown . this situation arises in geographic applications where the relation between objects in the same map is known  but not explicit information is given about objects in diffferent maps. 
　we consider two example topological expressions involving objects a  b  c  and d in medium resolution. 
 a overlaps b  a  b contains c  a  a inside d  a  b disjoint d  a  c disjoint d  
this first expression is conjunctive but not explicit: there are no v's  but there is a pair  a  c  whose relation is unspecified. the pair is only related by an implicit full clause  a overlaps c v a disjoint c v a equal c v a inside c v a contains c . 
 a overlaps b v a equal b  a  b contains c  a  a inside d v a contains d  
this second expression is not conjunctive  there are clauses that are not full  but have at least two disjuncts . the second is satisfiable  by three cocentric circles  starting from the outermost  a=b  c  and d   whereas the first is not  a  b  and d contradict first-column  last-row entry of table 1 . 
　there are two distinct kinds of reasons why a topological expression may be unsatisfiable. first  it may contradict the relational consistency as expressed by the inference tables  tables 1 through 1 . this aspect of the satisfiability problem is in effect a constraint satisfaction problem  and has been studied as such. 
　the second aspect is more subtle  and had escaped the researchers in this area1. a set of relations may be consistent  and still there may be no planar regions that realize it because of reasons related to planarity. for example  it is well-known that the complete graph with five nodes is non-planar  see figure 1 . assume that we are given the objects x i   x1  x1  x1  x1  y l   
...  y1 related as shown  all objects are disjoint except 
   *it is easy to understand why this important point had not been noticed before. topological reasoning is a two-dimensional extension of the classical work of allen  allen 1  on reasoning about temporal intervals. in the case of intervals  however  constraint satisfaction is enough; in the case of planar regions it is not. 
	grigni  papadias  and papadimitriou 	1 
　
that xi overlaps y l   y1  y1  and y1  and so on for the other nodes and edges . in addition we are given that y1 overlaps xi and x1 and is disjoint with every other object. then relational consistency according to tables 1 will reveal no contradiction. for instance  in the simplest case of table 1 any topological relation between a pair of objects is permitted regardless of the relations between the other pairs of objects. however  there is no way to realize this set of relations by a set of regions in the plane  without having two of the y objects overlap. if we try to insert y1 in the partial realization of figure 1  then y1 must overlap with at least one other y object  y1 illustrated . 
　therefore  there are some subtle geometric constraints that must be satisfied  besides the relational consistency ones; notice the analogue with the scene recognition problem  kirousis and papadimitriou 1   where  besides the relational consistency constraints of labels of the edges of a scene   convex    concave    boundary    there are subtle additional geometric constraints  the planar regions must be realizable in terms of actual slopes and heights . 

figure 1: planarity obstructions 
　we start by addressing the constraint satisfaction aspects of the problem. in a constraint satisfaction problem we are given variables x 1  ... x n taking values in corresponding finite domains d  ...  dn. we are also given constraints on subsets of the variables: a constraint rix ...ik is a k-ary predicate on the values of x 1 l   . . .   xik  we will only consider ternary constraints . the problem is to find an assignment of values to the variables such that all the constraints are satisfied. constraint satisfaction problems are typically np-complete  although special classes can be solved in polynomial time. 
　in the constraint satisfaction problems arising in connection to topological inference  the variables are pairs of distinct objects   all domains are the subsets of the set 
of eight topological relations in table 1  or the five in tables 1 and 1  or the two in table 1   as dictated by the clause corresponding to the pair of objects; and for each triple  i j k  of objects we have a constraint  namely  that the value of the pair t  j  the value of the pair j  k  and the value of the pair i  k must be related as in table 1  or 1  or 1  or 1 . 
1 	knowledge representation 
for example  the topological expression 
 a overlaps b v a equal b  a  b contains c  
a  a inside d v a contains d  is expressed by six variables  all unordered pairs of ob-
jects from a  b  c  d . the domain of variable ab is the set {overlaps  equal}  the domain of bc is {contains}  and the domain of the unrestricted pair ac is all five medium resolution relations. there are twenty-four ternary constraints  one for each ordered triple   expressed by table 1. a satisfying assignment assigns equal to ab  contains to ac  inside to ad  contains to bc  inside to bd  and inside to cd. 
1 	summary of results 
the satisfiability problem for topological expressions has several special cases and subproblems along three dimensions: 
1. generality of the 	topological 	expression. 
there are three cases of interest  unrestricted topological expressions  conjunctive topological expressions  and explicit topological expressions. obviously  their complexity is non-increasing in this order. 
1. resolution of the topological relations. we consider four cases: in the finest level we have the eight topological relations of figure 1; this is the high resolution case. in the next level we overlook the difference between contains and covers  and between overlaps and meets; this is the  medium resolution case.  in the coarsest level  we only have the relations  disjoint  and  overlap   this is the low resolution case. finally  we also consider the spe-
cial case of the second level where we can have no  overlap   but  meet   this is the no-overlap case . there is no a priori dominance of the complexities of these cases. 
1. notion of satisfiability. we consider two notions of satisfiability: relational consistency means that there is a global choice of a disjunct from the clause of each pair of objects  so that all triples of choices are consistent with the table of the present resolution. as the example in figure 1 indicates  this concept is sound but not complete  its answer to the satisfiability question may be a false positive  but never a false negative . the full form of satisfiability is called realizability: a topological expression on a set of objects is said to be realizable if it has a planar model; that is  if there is a set of simply connected planar regions  one for each object  any two of which are related by a topological relation that is a disjunct of the corresponding clause. 
　tables 1 and 1 summarize our results. the rows refer to the level of generality of the topological expressions. the columns correspond to the resolution of the topological relations. the first table indicates the complexity of the relational consistency problem  while the second table the complexity of the realizability problem.  p  means that the problem is solvable in polynomial time;  np-h  that it is np-hard. 
　
we have s a  c s b ns c  in this model  either s b  and s c  are equal or one contains the other. such sets are consistent with table 1. 
　entries 1  1  1. path-consistency suffices here. however  path consistency is not complete  even for relational consistency  in the unrestricted case. that is  there are examples in which the path consistency algorithm will halt without identifying an inconsistency  and still the expression is unsatisfiable  simple examples can be found using our np-completeness construction below . 
　entry 1. this is basically a planarity problem  in a graph that combines the  contains  and the  meets  relations. the only problem is that four or more regions may meet pairwise at a point  resulting in large cliques  graphs with large cliques are  of course  nonplanar . this is circumvented by a pre-processing phase that identifies all maximal cliques of size four or more  and replaces them by a new vertex connected to each of the vertices in the clique  intuitively  the new vertex stands for the common point . the maximal cliques of a graph can be identified in time polynomial in the nodes and the number of maximal cliques  which must be poly-
nomial for any realization. 
　entries 1  1  1 . since table 1 imposes no real constraint in low resolution  all topological expressions are satisfiable. incidentally  if we allow general boolean combinations of relational statements instead of topological expressions  that is  clauses that involve statements about more than one pair of objects   then this entry becomes np-hard: we can simulate boolean satisfiability by having an object for each variable  and also another object 1  and replacing all instances of variable x with  1 disjoint x  and the negation of x with  1 overlap x . entry 1 is the only result in our tables that would be changed by allowing general boolean expressions. 
next we sketch the np-hardness results. 
　entries 1  1  and 1. the proof for entry 1 is by a reduction from the  not-all-equal satisfiability  problem. we notice that if a and b contain one another but we do not know which  the same for b and c  and if we know that a and c overlap  then we can conclude that either both a contains b and c contains b  or the opposite. hence  if  a contains b  stands for  x is true  and  a inside b  for  x is false   this observation allows us to  propagate the truth values  of the variables. the  not-all-equal  clauses are simulated by a triangle of  contains-or-inside  relations  that cannot all three go clockwise  or all three counterclockwise  because this would violate transitivity. the same reduction works for entry 1  while for entry 1 a more complex  value propagation gadget  is needed. 
　entries 1  1  1  1  1  and 1. the easiest problem among these is entry 1  and it turns out to be np-hard because of a result of  kratochvil 1l : it is np-hard to tell whether a given graph is a string graph; that is  whether there exists a set of curves  one for each node  such that for any two nodes the corresponding curves intersect if and only if the nodes are adjacent. furthermore the result of  kratochvil and matousek 1l  that some string graphs require exponential 
	grigni  papadias  and papadimitriou 	1 
　
size realizations carries over to the case of regions as well  so it is not clear whether any of these problems is in np. 
1 	discussion and further questions 
the qualitative representation and processing of spatial knowledge has recently gained much attention in spatial databases  see for example  papadias and sellis 1    because very often in geographic applications we need to handle spatial relations such as   disjoint    overlap  and  north . in this paper we assume that we are given a database of objects with their interrelationships explicitly represented. the data may be incomplete  we may have no information for some pairs of objects   indefinite  more than one relation between the same pair of objects is possible  or inaccurate  the relations may lead to non-realizable configurations of objects . such problems arise often in spatial databases and geographic information systems  gis  where data from various sources and of variable quality are incorporated in the same system. this paper discusses algorithms that can be used to infer the relation between the pairs of objects for which the spatial relation is not known and to prune the impossible relations. 
　the proposed methods refer to configurations of arbitrary objects. on the other hand geographic databases contain particular objects whose shape and size further restrict the allowable topological relations. an interesting extension of the work in this paper would be to study the topological inference problem when we know something about the regions  they are all convex  or circles  or rectangles  or even given polygons . despite the fact that satisfiability for particular objects would require further processing that takes into account the sizes and the shapes of the objects  our method can be used as a pre-processing step in commercial gis's that currently do not involve any inference or satisfiability mechanisms. 
　in this paper we have demonstrated that several practical problems can be solved by reasonably sophisticated polynomial algorithms  while for the rest we have shown that only non-polynomial solutions may exist for the general case. even for the np-hard cases  we suspect that heuristics will be of great use. naturally  standard or specialized constraint satisfaction heuristics can solve the relational consistency subproblem. as for the planar readability subproblem  which we showed almost everywhere np-hard  there is hope. our counterexample showing that planarity is an additional constraint  figure 1  involves fifteen regions; in the low-resolution case  the smallest non-realizable example involves twelve regions. one could devise heuristics that have an excellent chance of finding a planar model  if one exists. 
　finally  further work can be done for other types of spatial relations  such as cardinal directions  e.g.  
 north    northeast   and distance relations   near    far   and applications that involve several kinds of qualitative and quantitative spatial constraints   1 km to the north    disjoint but near  . when choosing a set of relations to model  a reasonable criterion is to choose relations where at least the conjunctive relational consistency problem is solvable in polynomial time. 
1 	knowledge representation 
