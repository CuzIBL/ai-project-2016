 
we present a new method for image retrieval by shape similarity able to deal with real images with not uniform background and possible touching/occluding objects. first of all we perform a sketch-driven segmentation of the scene by means of a deformation tolerant version of the generalized hough transform  dtght . using the dtg1t we select in the image some candidate segments to be matched with the user sketch. the candidate segments are then matched with the sketch checking the consistency of the corresponding shapes. 
1 	motivations and goals 
in this paper we present a new method for content based image retrieval  cbjr  based on the analysis of the object shapes. in  anelli et ai  1  we have proposed a cb1r technique based on a deformation tolerant version of the well-known generalized hough transform  dtght . in this paper we start from that work and we go further with the objective to augment the system precision. we introduce some segmentation rules corresponding to gestalt principles  see  for example   ullman  1  and  koftka  1   exploiting the continuity properties of the edge segments and a more accurate matching method which compares the searched shape with the image lines. we have obtained an acceptance/rejection rule able to classify a data base image as relevant or not relevant with respect to the user's query. 
　the novelties of our approach with respect to similar systems is its capability to deal with every kind of real images  without caring of light conditions  with not uniform backgrounds and possible occluding objects. 
1 	pre-processing and sketch localization 
each image of the system data base is off-line pre-processed in order to extract an edge map and to reduce the noise. we perform a standard edge extraction and thinning process using the canny edge detector with sobel 1 masks  shapiro and stockman  1 . after this standard pre-processing  we use two salience filters to erase those thick textured areas which deteriorate the retrieval process  for details  see  anelli et al  1  . from now on we call / the image's edge map after these pre-processing phases. 
　we are now interested in merging the pixels in i with their neighbors in order to build line segments. we define a segment .s as an ordered list of points belonging to /: .s =   p1  p1 ...pn1   such that each pi  i = 1 ...  ns  is adjacent to pi-1 and pi+1 in a 1-connected interpretation of pixel adjacency. moreover  p1 and pns  the segment end-points  can alternatively be such that:  1  they have only one adjacent point; or  1  they are a junction with another segment  i. 
e.  they have more than 1 adjacent points. all the other points pi  i; = 1 .... ns - 1  have exactly 1 adjacent points. this segmentation process is performed because pixels that are part of the same continuous segment are more likely to belong to the same object. 
　on-line  the system accepts a user drawn query representing the shape she/he is interested to find in the data base. the sketch s is processed in order to extract the r-table t  ballard  1 . we use the following algorithm: 
sketch representation construction s  
1 compute the centroid pr of 1. 
1 for each point pk.  k - 1 .... m  of s set: 
　　t k  : - p r -pk where m = |s|  m is the cardinality of 1 . 
　once the r-table is computed  we compare such sketch representation with the previously processed data base images with the aim to localize a region in each image which maximizes the likelihood of the presence of a shape similar to the sketch. this phase is important because we do not manually select in the images the interesting objects from their background like the most working cbir systems presently do. we adopt a deformation tolerant version of the generalized hough transform  dtght   anelli et al  1 . 
　the main difference with the generalized hough transform  ght  ballard  1  concerns the voting phase. here we increment all those accumulator's positions belonging to a bi-dimensional squared range centered in pr  called the voting window w pr    for each edge point p of i and each vector v - pr - p in t. this is efficiently achieved using a dynamic programming technique and splitting the voting process in two sequential phases: the exact voting phase and the spreading phase  for details  see  anelli et ai  1  . if m is the point with the highest score in the final hough accumulator  a  after the spreading phase  then we take it as the 

poster papers 	1 

most likely position for the center of mass of a possible shape similar to s in i. in other words  if such a shape exists in i  m is its most likely centroid. experimental results presented in  anelli et al.  1  confirm this assumption. nevertheless  differently from the original ght  in which the score of the accumulator in its maximum is equivalent to the number of points of s in 1  with a dtght approach  due to the augmented voting area  it is sometimes possible that a thick and random distribution of points and segments in / can produce a high value a m  not corresponding to a shape really similar to s. in order to reject such cases  in the next section we perform some tests on the segments distribution around m. 
1 	verification phase 
in the following we assume that m is the point in / found as described in section 1  m =  s  and w is the voting window. the aim of the verification phase we are going to explain in this section is to verify if the disposition of the segments in / around m is really perceptually similar to the s' shape. in order to avoid false positives  first of all we check the portion of 1 which can be matched with segments in i. this is intuitively done by projecting s on i  let us call s' such pro-
jection  with m its centroid   looking for segments on / in the the neighborhood of s' and marking the portion of s justified by these segments. furthermore  we need to take into account inhibitory segments intersecting the neighborhood of s' but not really following the shape 1. in the following we give the operational definitions for justifying and inhibitory segments. a point p belonging to i is called a valid point if: 
 1  
tively  the edge orientation of the point p in i and the edge orientation of the i-th point of 1. we call i a valid hypothesis for p. a segment s  is a justifying segment if: 
		 1  
where k  is a fixed threshold  presently k1 = 1  and vi is the set of all the valid points of the segment si. let j be the subset of i's segments which are justyfing segments. 
　finally  a segment si is called an inhibitory segment if si is not a justifying segment and: 
		 1  
where k1 and k1 are two fixed thresholds  presently k1 =1  k1 = 1  and f  is the set of all the points p in si which satisfy: 
		 1  
let h be the subset of all the inhibitory segments of/. the verification test is given by the logical and of the justification test and the inhibitory test. 
table 1: precision and recall scores for the three users. the columns show  for each user  the precision and recall values obtained for each query type.  
query userl user 1 user1 average car 1 1 1 1 1 1 1 1 pistol 1 1 1 1 1 1 1 1 racket 1 1 1 1 1 1 1 1 watch 1 1 1 1 1 1 1 1 bottle 1 1 1 1 1 1 1 1 guitar 1 1 1 1 1 1 1 1 in the above algorithm k1 is a threshold  currently fixed to 
1. we check in this way that at least a portion k1 of s is present in i in the right position with respect to m. 
finally  the following is the inhibitory test: 
inhibitory test h.j  :=  
1 	experimental results 
we have tested our method with a data base composed of 1 images randomly taken from the web. they show a great variety of subjects: 1 cars  1 horses  1 guitars  1 pistols  1 tennis rackets  1 saxophones  1 bottles  1 watches  1 crucifixes  1 vases. moreover  the data base contains different other subjects such as: animals  faces  landscapes  airplanes  boats  fruits  mushrooms  cups and so on. 
　no simplifying assumption has been done about images: they usually have not uniform backgrounds and often the retrieved objects are occluded by other objects. no manual segmentation has been performed on the images. 
　we paid attention to choose as users people not aware of the data base images' shapes. indeed  only one of the three users in table 1 has had the possibility to observe the repository images before his drawings  user 1 . each user has performed six queries. the drawn subjects are: a car  a pistol  a tennis racket  a watch  a bottle and a guitar. we report our results in table 1. average precision and recall for all the three users and all the queries are  respectively: 1 and 1. 
