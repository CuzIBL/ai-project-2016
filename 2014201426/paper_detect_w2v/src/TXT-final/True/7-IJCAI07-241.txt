
we study the problem of autonomous agents negotiating the allocation of multiple indivisible resources. it is difficult to reach optimal outcomes in bilateral or multi-lateral negotiations over multiple resources when the agents' preferences for the resources are not common knowledge. selfinterested agents often end up negotiating inefficient agreements in such situations. we present a protocol for negotiation over multiple indivisible resources which can be used by rational agents to reach efficient outcomes. our proposed protocol enables the negotiating agents to identify efficient solutions using systematic distributed search that visits only a subspace of the whole solution space.
1 introduction
negotiation is the most preferred approach for resolving conflicts in human and agent societies. automated negotiation is being increasingly used in different multiagent domains including robotics  network bandwidth allocation  space applications  etc. where agents need to reach agreements on the allocation of one or more shared resources  chevaleyre et al.  1; endriss et al.  1 . in multi-issue negotiation1  agents with divergent preferences can cooperate to reach agreements beneficial for both agents. but when the preferences are not common knowledge  self-interested agents often fail to explore win-win possibilities using existing protocols and end up with inefficient agreements. hence  there is a need for negotiation protocols which can lead rational agents to mutually preferred agreements. by efficient or optimal solution  we refer to a solution which is pareto optimal  brams and taylor  1 . an outcome is pareto-optimal or paretoefficient if there exists no other outcome which is at least as good as this outcome for both agents and strictly better for at least one agent. another desirable property of an agreement is its fairness. an agreement can be considered to be fair if it is envy-free. an agreement is envy-free iff each agent's utility for its own share is at least as much as its utility for the share allocated to the other agent  brams and taylor  1 . often no envy-free agreement exists when resources are indivisible. we  therefore  argue that the goal of the negotiation process should be to produce pareto optimal agreements that maximizes egalitarian social welfare  the minimum utility of the negotiating agents.
모when agents' preferences are common knowledge  negotiating agents can reach an efficient point of agreement using distributed protocols like one-step monotonic concession protocol or monotonic concession protocol  rosenschein and zlotkin  1  where each agent searches the entire space of possible agreements. most negotiations in real life  however  take place under incomplete information where agents do not have complete knowledge about the preferences of the other agent. negotiation protocols for such negotiation scenarios are proposed by brams and taylor  brams and taylor  1 . but their protocols do not guarantee optimality for allocation of indivisible resources. these protocols produce close to optimal agreements only for negotiationsinvolvinguncorrelated resources  i.e.  situations where the utility of possessing two resources is the sum of the utilities of possessing each individual resource. but real-life negotiations typically involve correlated resources. these protocols can produce very inefficient agreements for such negotiations.
모our objective is to design a protocol for negotiation over multiple indivisible resources  both correlated or uncorrelated  which can lead participating agents to efficient outcomes  without any prior information about opponent's preferences. this situation is common in e-commerce domains  where the number and diversity of agents is so large that an agent may not have any knowledge of the preferences of any particular agent it has to negotiate with. we present a threephase protocol that guarantees pareto optimal agreements between rational agents and ensures that the agreement reached will be at least as fair as the agreements reached by the protocols proposed by brams and taylor1.
모our work has some similarity with the work on contract negotiation by sandholm  sandholm  1  and endriss et al  endriss et al.  1; 1  in the context of task allocation  where agents negotiate to reallocate tasks. but these approaches are geared towards identifying  under complete information  necessary deals or exchanges required among agents to reach efficient allocation from an arbitrary initial allocation. we  on the contrary  want to find mechanisms that lead agents  without any prior information about opponent's preferences  to efficient outcomes revealing as little information as possible.
모another advantage of our proposed protocol is that each agent is required to search only a subset of the whole set of possible allocations. even under complete information  finding out necessary exchanges required to reach pareto optimal solution requires o 1n  computations  where n is the number of issues  chevaleyre et al.  1 . fortunately  in most negotiations  the number of issues is not very high  less than 1 . although the worst case complexity of our algorithm is o 1n   it requires significantly less search compared to exhaustive search in most negotiation instances.
1 related research
we consider the problem of designing a negotiation protocol for two or more agents so that they can reach a mutually acceptable allocation of multiple indivisible resources or tasks without any external intervention. when agents' preferences are common knowledge  each agent can search the entire space of allocations and find out possible points of agreement. in case of multiple points there can be a problem of selecting the point of agreement. however  using distributed protocols like one-step monotonic concession protocol negotiating agents can reach an efficient point of agreement rosenschein and zlotkin  1 . according to this protocol  both agents simultaneously make an offer. the offer that maximizes the product of the agents utilities will be chosen as the point of agreement. it can be shown that rational agents will reach pareto optimal solution using this protocol. here  each agent will choose the offer that has maximal product of utilities. so  each agent needs to know the other agent's complete preferences and search for all possible allocations. this protocol fails when agents do no have complete knowledge of other agent's preferences. similar is the case with monotonic concession protocol. most of the negotiations in real life  however  take place under incomplete information where agents do not have complete knowledge about the preferences of the other agent. in this paper  we focus on negotiations under incomplete information settings.
모in similar research on multiagent resource allocation  mara   researchers have investigated the efficiency of allocations of multiple tasks or resources among multiple agents  endriss et al.  1; 1 . existing research have focused on identifying necessary exchanges  under complete information  to reach pareto optimal solution from an initial allocation. in our research  agents do not have any information about the other agent's preferences and our objective is to design a protocol using which agents can reach an optimal agreement.
1 negotiation framework
we formally describe a representative negotiation scenario for allocation of multiple indivisible resources as a 1-tuple  is the set of agents  r = {r1 r1 ... rh}  h 뫟 1  is the set of h indivisible resources whose allocation are being negotiated  and u = {u1 u1} is the set of utility functions  where ui is the utility function of agent i. each resource is considered as a negotiation issue. the negotiating agents must agree on the allocation of the resources. we assume a monotonic scenario  where an agent's utility increases if it possesses one more resource. therefore  each agent wants to obtain each of the resources and for different bundles of resources  it has different utilities. the valuations for all possible bundles of resources is known as the agent's complete preference  which is not known to the other agent.
we now define some terms formally:
outcome: an outcome o is an allocation of the resources to different agents. formally   where  is a 1 뫄 h matrix  whose  i j  cell content  xoij 뫍 {1}  presents agent i's allocation of the jth resource. xoij = 1 if jth resource is allocated to agent i  otherwise xoij = 1. we can write  whereis the column vector representing the allocation of resources to agent i under outcome o.
utility: for agent i  utility of an outcome o is defined as:
  where r+ is the set of non-negative real numbers.
pareto optimality: an outcome o is pareto optimal if there exists no other outcome o such that all agent's utility in o is at least as good as their utility in o and at least one agent's utility is more in o. if outcome o is pareto optimal  there cannot exist any outcome o such that   for both for at least one i.
individually rational agent: an	individually	rational will accept an agreement o instead of o only if i	뫟	i .
egalitarian social welfare: for an outcome o  egalitarian social welfare  esw o   is defined as the minimum utility among the agents under that outcome  i.e.  esw o  = mini뫍a{uio}.
모we now present an example of a bilateral negotiation scenario involving 1 indivisible resources: a b c  and d. the utilities of the two agents for different allocations are given in table 1. both agents want to maximize their individual utilities.
1 existing negotiation protocols
in this section  we present existing negotiation protocols for allocation of indivisible resources among agents when agents do not have any knowledge of the preferences of the other agents:
strict alteration: in this protocol  agents take alternate turns and in each turn an agent selects one resource from the set of resources not yet allocated. after an agent selects a resource  the resource will be removed from the set  brams and taylor  1 . the advantage of this protocol is its simplicity and the time required to reach an
allocationu1u1 {} {abcd} 1 {a} {bcd} 1 {b} {acd} 1 {c} {abd} 1 {d} {abc} 1 {ab} {cd} 1 {ac} {bd} 1 {ad} {bc} 1 {bc} {ad} 1 {bd} {ac} 1 {cd} {ab} 1 {abc} {d} 1 {abd} {c} 1 {acd} {b} 1 {bcd} {a} 1 {abcd} {} 1table 1: utilities of two agents for different allocations where  x y  represents allocation of item sets x and y to agent 1 and 1 respectively.
agreement. the agreements reached  however  are often very inefficient.
balanced alteration: this protocol is used to improve fairness. here it is assumed that an agent who first chooses a resource has an advantage over the agent who chooses second. hence  the second agent will have the opportunity to choose third  and so on  brams and taylor  1 . therefore  one agent gets to choose in turns 1 1 ...  and the other agent in turns 1 1 .... this protocol has similar advantages and disadvantages as the strict alternate protocol.
exchange auctions: this protocol is an exchange-based extension of the contract-net protocol  golfarelli et al.  1 . this protocol assumes an initial allocation of the resources to the agents. the protocol allows the agents to exchange resources to improve the allocation. an agent announces one or more resources for exchanges and other agents bid one or more resources that they are ready to exchange. but this protocol does not guarantee pareto optimality unless repeated infinitely.
1 our proposed negotiation protocol
in this section we present our proposed protocol: protocol to reach optimal agreement in negotiation over multiple indivisible resources  ponomir . we first define some concepts required to describe our protocol.
negotiation tree: we assume that the issues or resources are ordered in some way  e.g.  lexicographically. in this paper  we conceptualize the allocations of the resources as a tree  known as negotiation tree. for a negotiation over h resources  the maximum possible depth of the negotiation tree is h  the root being at level 1. the root node represents a null allocation to the agents and then each successive level represents allocation of the next resource in the order chosen. for a bilateral negotiation  the negotiation tree is a binary tree1. the left and right branches at the lth level imply that the lth resource will be allocated to agent 1 and 1 respectively. each leaf node at level h represents one possible allocation of the resources and the path to reach that leaf node from the root specifies the allocation of all the resources. such a negotiation tree is shown in figure 1 for the negotiation scenario presented in table 1. a negotiation tree is created by the negotiating agents in a distributed manner. it starts with a rootwith id = 1. the tree is then created in a top-down process  where at any level agent 1 can only create the right child of a node in the previous level of the tree. similarly  agent 1 can only create the left child nodes. each agent  however  may choose not to create any node  which it can  at any level. if an agent does not create a node  that node will be marked as black node and no further sub-tree will be created from that black node. therefore  a black node prunes that node and its descendants. the distributed formation of a negotiation tree can be implemented using message-passing. at any level  each agent knows the nodes created at the previous level and the nodes that either of the agents can create at this level. hence both agents can send a message to the other agent stating the nodes it has created at this level before proceeding to the next level.
best possible agreement  bpa : at each node of the negotiation tree  each agent has a best possible agreement which is the allocation where the resources until the current level are allocated according to the path from the tree root to this node and the remaining resources are allocated to this agent.
모now we present our three-phase protocol  ponomir. the first phase of ponomir consists of a primary allocation procedure using any one of strict alteration or balanced alteration protocol. we have used strict alteration protocol in this paper. the second phase consists of distributed formation of the negotiation tree by the negotiating agents. after the second phase  the agents will be left with few probable agreements. in the third phase  agents reach the final pareto optimal solution by exchanging offers.
first phase of ponomir:
step 1: a random device chooses one of the two agents and marks this agent as s. denote the set of resources yet to be negotiated by g. initially  g = r.
step 1: now  s will choose one of the remaining resources  c 뫍 g. c is allocated to s.
step 1: mark the other agent as s and update g to g {c}. if |g|   1 return to step 1  otherwise stop.
after the first phase  there is an initial allocation  l  of the resources as suggested by the strict alteration protocol.
for this allocation l  agents have corresponding utilities uil i = 1. if no mutual improvement is possible in the subsequent phases  agents will have to agree on this allocation1. this phase ensures that the agreement reached will be at least as good as l.
second phase of ponomir: this phase involves the distributed generation of the negotiation tree by the negotiating agents.
step 1: let l denotes the level of the negotiation tree. set l = 1. the root node is created with id root  = 1.
step 1: agents 1 and 1  respectively  can create the right and left child nodes of each node in the level  l  of the tree and send a message to the other agent.
step 1 increase l by one. if l   h and no node is created at level l  the negotiation terminates and the final allocation will be l. if l   h and there is at least one node in this level of the tree  go to step 1. if l = h  stop the second phase  collect all the allocations corresponding to the nodes at level h and proceed to the third phase. we refer to this set of leaf nodes  or allocations  as q.
after this phase  the agents will be left with a small number of probable agreements in q. the final agreement will be chosen in the third phase. note that  at each level agent 1 can create only right child nodes and agent 1 can create only left child nodes. a right child implies that the resource representing that level is allocated to agent 1. since we assume a monotonic scenario  the utility of the bpa of agent 1 will not decrease for allocating a resource to agent 1  but the utility of the bpa of agent 1 may decrease. so  it is sufficient if agent 1 only checks whether if it is interested in expanding this right subtree. similarly agent 1 only needs to check the left child. if the utility of the bpa for an agent at any node is less than its utility under the initial allocation  l  it is sure that any allocation under the subtree starting at that tree node will always produce utility less than its utility under initial allocation l. an individually rational agent has no incentive to create that node. if a node is not created at any level by the corresponding agent  no further subtree will be generated from it. this implies that all the allocations under that subtree are discarded. if agents are individually rational  for each allocation in q  the utilities of both agents are at least as much as their corresponding utilities in l. this is because all allocations which produce less utility to any of the agents will be discarded by that agent in the distributed tree generation process.
third phase of ponomir: in this phase  agents will select the final agreement from allocations in the set q. let us define a set f  as the set of final agreements. initially  it contains only the initial allocation l  i.e.  f = {l}.
step 1: one agent is chosen randomly to start. mark this agent as s and the other agent as s. now  s needs to propose an allocation q from q.
step 1: s can remove any other allocation o from the set q and. update f to f 뫋 {q}.
step 1: if q is not empty  then swap the agents and go to step 1. otherwise  the set f contains the set of final agreements. if only one element remains in f  it will be selected as the final agreement. otherwise  any one of them will be chosen randomly as the final agreement.
1 properties of ponomir
the objective of an efficient protocol is to lead rational agents to efficient agreements. as we have discussed earlier  our goal is to obtain pareto optimal agreements and to increase fairness as much as possible. as a measure of fairness  we use egalitarian social welfare.
모our proposed negotiation protocol  ponomir  is not strategy-proof and does not guarantee pareto optimal agreements if agents are arbitrarily risk seeking. however  in this paper we consider a completely uncertain negotiation scenario where participating agents do not have any knowledge about the preferences of the other agents and agents do not want to reveal their utilities for different allocations. the rational behavior of the agents  under such complete uncertainty  depends on their risk attitudes. bossert introduced and argued for uncertainty aversion for decision making under such complete uncertain scenarios  bossert  1 . in this negotiation scenario  we assume that the rational agents will be cooperative-individually rational. an agent is cooperativeindividually rational if it satisfies two properties: i  it does not take any risky action that can lead to an agreement which produces less utility than what it is already assured of  and  ii  if there exists two agreements which produces same utility to it but different utility to the opponent  then it will agree to accept any of the agreement proposed by the opponent. ponomir guarantees pareto optimal agreements if the participating agents are cooperative-individually rational. the agreements reached also guarantees at least as much egalitarian social welfare as the agreements reached by the existing protocols. since the agents are individually rational  both of them will discard all agreements that produce utilities less than the utility from the initial allocation  l  obtained in the first phase and hence the egalitarian social welfare will never decrease.
proposition 1: the agreement reached by cooperativeindividually rational agents using the ponomir protocol is pareto optimal.
to prove this proposition  we first prove the following lemmas:
lemma 1: an allocation o will not be discarded in the second phase  only if uio 뫟 uil  i = 1  where  l is the initial allocation after first phase.
proof: there are two parts of this proof. in the first part we will prove that any allocation  for which there is at least one agent i such that uio   uil  will be discarded in the second phase. in the second part we will show that the remaining allocations will not be discarded. for
an allocation like o  such that  there will be at least one level in the distributed tree construction process when agent i will realize that its utility from the bpa at that node is less than uil. therefore  the agent has no incentive to create that node and hence the allocation will be discarded. the proof of the next part of the lemma is clear from the properties of the agents. since they are cooperative-individually rational  they do not want to discard any possibility which can lead to an allocation which produces utility at least as much as the utility produced by the initial allocation.
lemma 1: while proposing an allocation in the third phase  an agent always propose the allocation that produces highest utility among the set of remaining allocations q.
proof: in a complete uncertain environment  the likelihood of the opponent accepting any allocation is not known a priori. hence  an allocation of higher utility to an agent should be proposed before an allocation with a lower utility. therefore  a cooperative-individually rational agent proposes the allocation with the highest utility from the set of remaining allocations q.
lemma 1: after an agent proposes an allocation in the third phase  the other agent will remove all allocations which produce less utility to it from the sets q and f.
proof: an individually rational agent will remove all allocations that produce less utility to it compared to the offer proposed by the other agent as it is guaranteed to get the allocation proposed by the other agent. but if it does not remove any one of those it may end up with one of them which will not be individually rational. it will also remove the allocations which produce equal utility to it. according to the previous lemma a rational opponent proposes the offer which produces highest utility to the opponent. this implies that an allocation which is not offered by the opponent produces less than or equal utility to the opponent. therefore even if it produces equal utility to this agent  it is either equivalent or pareto dominated by the allocation proposed by the opponent. so  the agent should remove this from the set.
also  the agent will not remove other allocations with higher utility as this may eliminate possible agreements which have better utility for it.
proof of proposition 1: from lemmas 1  1  and 1  it is evident that any allocation in the final set f is not pareto dominated by any of the other possible allocations. therefore  each of the allocations is pareto optimal.
1 experiments
in this section  we present experimental results to show the effectiveness of ponomir to reduce search requirement for the negotiating agents. before that we present an illustration of our proposed protocol.
1 an illustration
in this subsection  we demonstrate the execution of ponomir on the example presented in table 1. in the first

level 1:	    1  	 1        1 	 1    
 resource d 
figure 1: negotiation tree formed for example in table 1.
phase  agents take alternate turns to choose one resource. let us assume that an agent  at first  chooses the resource which produces highest utility to it among the resources yet to be allocated. then onwards  it will choose the resource  from the set of resources not yet allocated  which produce highest utility together with other resources already allocated to it. agents with this strategy produce an initial allocation  l  where l =  {b d} {a c}   i.e.  resources b and d are allocated to agent 1 and resources a and c are allocated to agent 1. the corresponding utilities to the agents are 1 and 1 respectively.
모figure 1 shows the formation of the negotiation tree in the second phase. for example  consider the formation at level 1. while verifying the left child of the root node  which implies that the resource a is allocated to agent 1  as shown in the corresponding edge of the graph   agent 1 observes that if resource a is allocated to agent 1  the best possible agreement for agent 1 will be  {a} {b  c  d}  where all other resources will be allocated to it and the corresponding utility is 1  less than   its utility from the initial allocation  l. so  it decides not to create the left child and therefore it is marked as a black node and no subtree will be generated from it. hence  all allocations under this subtree are discarded from the set of possible agreements. note that in the figure 1  only one utility is given at each node which is the utility of the bpa of the agent who is deciding whether to create that node. the corresponding utility for the other agent is blank as it is not known to the deciding agent. at the end of the second phase only two allocations are chosen for the third phase:
o1 =  {b d} {a c}  and o1 =  {c d} {a b} . observe that both agents need to find the utility for only 1 nodes  instead of 1 = 1 nodes. in the third phase one agent is chosen to propose one allocation. the chosen agent proposes the second allocation  o1  as that produces highest utility to it and the other agent will remove o1 from the final set of chosen agreements  f. so  the final agreement will be  {c d} {a b}   which is pareto optimal and with an egalitarian social welfare 1  which is the highest possible egalitarian social welfare in the entire space of allocations.
1 experimental results
we tested ponomir on a large number of scenarios varying agents' preferences and number of issues. we show the average reduction in the search effort required by each agent. we consider monotonic utility scenarios  which implies that for any agent the utility of a bundle of n resources is more than any of the n possible subsets of  n   1  resources. we vary the number of resources n. for each n  we generate 1 random examples of agent preferences and execute the negotiations using the ponomir protocol. we observed that they always reach pareto optimal agreements and significant percentage of these produce maximum possible egalitarian social welfare. for the agreements where the fairness are not maximum  they are close to this maximum value. but  this result depends on the strategies used by the agents in the first phase of ponomir. it is  however  guaranteed that the agreement reached will be pareto optimal. we have also calculated the average percentage of allocations that each agent searched during each negotiation process compared to all allocations that an agent needs to search to find a pareto optimal outcome using protocols like one-step monotonic concession protocol under complete information. table 1 shows significant reduction in average search by each individual agents using ponomir.
# of resources% of allocations searched by each agent1.111.111.1table 1: reduction in search by agents
1 conclusion and future work
existing research in multiagent systems for allocating multiple indivisible resources have focused on identifying necessary exchanges  under complete information  to reach pareto optimal agreements. in a large number of real-world negotiations  however  agents are required to negotiate under a completely uncertain environment. in this paper  we propose an efficient three-phase negotiation protocol  ponomir  for negotiation over multiple indivisible resources when an agent does not know the preferences of the other agents. we have shown that ponomir leads rational agents to pareto optimal agreements and the negotiating agents do not need to explicitly reveal their utilities for different allocations. the agreement reached depends on the initial allocation after phase 1  but will always be pareto optimal if the negotiating agents are cooperative-individually rational.
모the last two phases of ponomir can also be used separately for producing pareto optimal outcomes given any initial allocation of the resources to the agents. this is a useful property of ponomir as in several multiagent resource allocation problems the negotiating agents may initially possess some resources. the second and third phase of ponomir guarantees pareto optimal outcome in such situations.
모we have also experimentally shown the effectiveness of the ponomir protocol for reducing the search costs of the participating agents. ponomir  however  cannot guarantee a timely agreement if the number of resources is very high  e.g.  1. fortunately most real-life negotiations do not involve very high number of resources and ponomir produces agreements quickly for 1 resources or less. we are currently working on improving the time complexity of our protocol to address the problem of negotiations over very large number of resources.
모a major advantage of ponomir is its extensibility to multilateral negotiation. we have presented ponomir for bilateral negotiation  but this can be extended to multilateral negotiation with minor modifications.
모we have experimentally observed that the fairness of the agreements reached using this protocol are high. but we can only guarantee that the fairness will not be reduced after the first phase. we are working to develop a novel first phase of our protocol to ensure increased guaranteed fairness of the negotiation outcome.
acknowledgments: this work has been supported in part by an nsf award iis-1 and an nasa epscor rig.
