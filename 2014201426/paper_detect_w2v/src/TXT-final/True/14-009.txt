 
general principles for fitting models to data containing 
 gross  errors in addition to  measurement  errors are presented a fitting technique is described and illustrated by its application to the problem of locating cylinders in range data  two key steps in this process arc fitting ellipses to partial data and fitting lines to sets of three-dimensional points the technique is specifically designed to filter out gross errors before applying a smoothing procedure to compute a precise model such a technique is particularly applicable to computer vision tasks because the data in these tasks arc often produced by local computations that are inherently unreliable 
1 introduction 
　　a common problem in computer vision is the fitting of on analytic model  such as a curve or surface  to data containing two types of errors  measurement  errors and  gross  errors  i.e.  classification errors  measurement errors can often be adequately modeled as small  normally distributed deviations from the model to be fitted  whereas gross errors are relatively large and unpredictable an example of this kind of problem is the fitting of a plane to a set of points  most of which belong to the plane  but some of which arc from other surfaces in the scene 
　　a program to perform such fitting must include tech niques to 
* kilter out gross errors 
* smooth out measurement errors 
* evaluate proposed fits 
* incorporate a priori constraints 
the traditional least-squares fitting technique   1   is basically a computationally convenient smoothing procedure that computes the optimum fit  with respect to a squared error metric  for tasks in which the errors are normally distributed the technique is limited to linear models and linear constraints  i.e.  the models and constraints arc linear in the set of unknown parameters   it has no built in mechanism to filter out gross errors  and it provides only a single number as the basis for evaluating a fit therefore  by itself  least squares adequately performs only one of the four operations listed above 
　　least squares  or any linear smoothing technique  can be applied to a nonlinear problem by iteratively applying it to locally linearized subspaces of the search space  1 . to do so. it is necessary to start with a good initial estimate of the model parameters and to formulate a linear approximation of the search space in a neighborhood containing a proposed set of parameter values this iterative approach is one of the best ways to fit nonlinear models  even though it is essentially a hill climbing technique  which implies that it may not converge or find the global optimum obviously  other techniques do exist for global optimization  but they are often less general  and almost always much more expensive computationally 
  the work reported herein was supported by the 
national science foundation under grants dar1 and ecs-1 
　　many heuristics based on the iterative application of a smoothing technique have been proposed to filter out gross errors the basic theme of these heuristics is to use all the data to derive a set of model parameters  locate the datum that is farthest from the instantiated model  assume that it is a gross error  delete it  and iterate this process until the maximum deviation of the data from the currently instantiated model is less than some threshold  or until there is no longer sufficient data to proceed even though it is easy to show that a single gross error can cause these heuristics to fail  in practice they have been quite useful  successfully deleting gross errors when only a few such errors exist our contention is. however  that smoothing is not an appropriate technique to apply to an  unverified  data set. especially when the data set may contain a large percen tage of gross errors  say 1 percent or more  in this paper we present a two-step fitting procedure that employs a filtering technique  which we call random sample consensus  ransac    specifically designed to handle data sets containing a large number of gross errors 
our basic approach is the following 
* compute initial estimates of the model parameters and eliminate gross errors 
* compute an improved fit by applying a smoothing technique  such as least squares  to the filtered data the first step involves two tasks that arc so intimately related that it is impossible to separate them computing a  reasonable  estimate of the parameters inherently implies an evaluation of each point's validity  and evaluating a point's consistency with a model requires an instantiated model and thus an estimate of the model parameters one might further note that the filtering task can be viewed as a 
　　restatement of the classical partitioning problem for scene analysis. 
　　in the remainder of this paper we describe how to use ransac to perform step 1. briefly describe how to use on iterative least-squares approach for step 1  present our ideas on how to evaluate a proposed fit. and then illustrate these ideas by showing how they can be applied to find cylinders in range data. 
ii filtering and computing initial estimates 
　　the philosophy of the ransac filtering technique is opposite to that of conventional smoothing techniques. rather than using as much of the data as possible to obtain an initial solution and then attempting to eliminate the invalid data points  ransac uses as small on initial data set as is feasible and enlarges this set with consistent data when possible for example  given the task of fitting a circle to a set of two-dimensional points  the ransac approach would be to select a set of three points  since three points arc required to determine a circle   compute the implied circle  and count the number of points close enough to that circle to suggest their compatibility with it  i.e.. their deviations are small enough to be measurement errors  if there are enough compatible points. ransac passes the parameters of the circle and the set of mutually consistent 
1 
　　
points to a smoothing technique to compute an improved estimate for the parameters. if there are not enough compatible points  another triple of points is selected and tested this process is repeated until a sufficiently large set of compatible points is found or until some predetermined number of trials is made 
　　given a specific task  the following elements must be present before using ransac: 
* the minimum number of data points required to instantiate a model 
  a procedure to compute a model from the minimum number of points 
* the expected magnitude of the measurement errors 
  the minimum number of compatible points required to suggest a valid instance of the model 
　　  the number of trials to be made before giving up the number of points that define a model is generally small three points define a plane; four correspondences define an one-to-one mapping between two planes; and five points define a conic section the maximum error allowed for compatible points is generally somewhat larger than the expected measurement error because the initial model parameters are determined by points that are also in error 
　　the basic requirement for the threshold on the number of compatible points is that it should be large enough to avoid accidental alignment for example  if the task is to fit planes to a set of data points that may be from two or three different planes  the threshold should be set high enough to avoid accepting planes defined by points from distinct planes that just happen to be coplanar task-dependent considerations may be needed to determine this threshold  fortunately  in most tasks the available number of points associated with each valid instance of a model is generally much larger than the number of points that might accidentally be consistent with an incorrect instance thus  in practice  establishing a reasonable threshold for distinguishing between valid and  accidental  fits poses no problem 
　　given an estimate of the probability that a datum is a gross error  based on physical considerations associated with the data acquisition process and semantic or contextual considerations   it is possible to estimate the number of trials required to select a sample of a certain size that contains no gross errors a set of formulas for this task is derived in  1 j. 
iii applying a least-squares technique 
　　if the unknown parameters in a model are linearly related  the best least-squares solution for the parameters can be directly computed  l  if the parameters are not linearly related  the least-squares solution to the linear problem can be embedded in an iterative solution to the nonlinear problem the idea is to approximate the surface about the estimated parameter values by a hyperplane  solve that linear problem  and iterate until the desired pre cision has been achieved if the hyperpiane is determined by the partial derivatives of the function relating the parameters  this approach is similar to a multidimensional newton-raphson method.  see  or  for a more detailed description of this approach.  
　　the advantages of this approach are that it has quadratic convergence  when it converges   the data can be weighted according to their measured precision  and the parameters can be constrained to he within specific ranges the disadvantages are that an initial set of parameter values is required  the method may not converge  and it may not converge to the global optimum we have used this method to fit curves  surfaces  and correspondences  and have had very little trouble with the method not converging or converging to the wrong values unless the solution was underdetermincd or the data contained several gross errors. 
iv evaluating a fit 
　　given a set of data and a proposed  hypothesized  model  how does one decide whether or not the model is an accurate description of the data1 it is difficult to think of a more pervasive question most of statistics  and much of the methodology of science  revolves around ways to answer this question  a full treatment of the issues involved in model evaluation are well beyond the scope of this paper we limit our discussion here to justifying the particular approach we have adopted 
　　the approach we employ is based on the following viewpoint 
if one subtracts the predictions of a proposed model from the experimentally measured values  then the residuals should be independent  uncorrelated  to the extent that the measurements have a natural spatial or temporal ordering  the sequence of residuals should have the characteristics of  white noise   
what we are saying is that all. of our ability to predict the experimentally measured values should be embedded in the proposed model. if the residuals show any significant degree of correlation  then a more effective/accurate model can be constructed to explain the given experimental data in a more important sense  the existence of correlated residuals can indicate an invalid model or faulty data 
　　as a consequence of the above viewpoint  and to limit the required computational burden  we have selected the following statistics to evaluate  i.e.. compare  accept  or reject  the quality of the fit of a proposed model to a set of experimental data 
error-tolerance-test the percentage of residuals that lies within a context-dependent tolerance band  this is the basic ransac evaluation metric  
sign-test the ratio of positive to negative residuals  ignoring very small values  
　　run-length test the length of the longest sequence of monotonically increasing or decreasing residuals  allowing for a small amount of hystensis  the error tolerance test  based on problem-dependent parameters  provides the primary basis for accepting or rejecting a model  a . the sign and run-length tests are perfectly general in that they require no problem dependent information  but are obviously weaker and thus can provide only secondary evaluation criteria 
　　the sign test assumes that the signs of the residuals are determined by independent bernulli trials with equal probabilities of positive or negative excursions the stan dard deviation of the absolute difference between the number of positive residuals and the expected number of positive residuals  for a large number of trials  n  is bvn thus  if d is the absolute difference between the number of positive and negative residuals  we can reject the hypothesis that the proposed model is unbiased at a 1 percent level of confidence when d 1n 
　　the run-length test assumes that the signs of the differences between sequentially taken measurements are determined by independent bernulli trials with equal probabilities of positive and negative increments it can be shown that with confidence level b  we can reject the hypothesis that the sequence of residuals is uncorrelated when the longest run exceeds r  where 
r w log1 
1 
thus  for  1 = .1  we have r w 1. 1+log1n 
1 
v finding cylinders in range data 
　　we recently started a project to investigate ways of recognizing industrial parts jumbled together in a pile since we are restricting our attention to industrial tasks  we generally know the universe of parts the system is likely to sec  and we can control the environment to simplify data acquisition in particular  we believe that range sensors will soon be economical for such an environment therefore  one aspect of our research is to develop techniques for using a part model to quickly and reliably locate occurrences of the part in a combination of range and intensity data 
　　the first task we have set for ourselves is to find cylinders  with a known diameter  in range data the data for this experiment are gathered  one slice at a time  from a simple  structured-light range sensor as diagramed in figure 1  see  for a more detailed description of the data acquisition system  several computer vision programs locate cylinders in range data  1 1 1   but they are computationally expensive and are untried in complex domains intuitively  knowing the diameter of the cylinder significantly reduces the complexity of the problem the question is how to use the known diameter to increase the speed and reliability of locating cylinders 


figure 1 a simple range sensor 
　　since the intersection of a plane and a cylinder is an ellipse  in the plane  whose minor diameter is equal to the diameter of the cylinder  our idea is to fit ellipses constrained to have the proper minor diameters to all curved segments along the intersection line  find clusters of similar ellipses by histogramming the orientations and major diameters of the ellipses  and then use ransac to partition the clusters into groups of ellipses belonging to individual cylinders the histogramming can be done quickly therefore  the viability of such an approach depends on the speed and precision of  l  fitting ellipses with a known diameter to partial data  and  1   ransacing  lines to sets of three-dimensional points  to find the cylinder axes  in this section we describe the application of the general curve-fitting principles discussed in previous sections to these two problems 
　　figure 1 shows the intersection of the light plane with a simple scene containing two cylindrical castings. figure 1 shows a composite picture formed from 1 slices of those two castings. the cylinder-finding program first classifies the segments of the intersection into one of three types according to their curvature and length - straight lines  circular arcs  and elliptical arcs - and then tries to fit circles to the cirular arcs and ellipses to the elliptical arcs the circular arcs are treated separately because the ellipse fitter has trouble converging on them since a circle does not have a distinct orientation  almost all values of the ellipse's orientation parameter are equal  causing the iterative procedure to wander 
figure 1 the intersection of the light plane and two cylindrical castings 
figure 1 twelve slices along the two castings shown in figure 1 
　　the arcs look circular more often than one might think. the ratio of the minor diameter of the intersection ellipse to its major diameter is equal to the cosine of the angle between the axis of the cylinder and the normal to the plane of light therefore  at 1 degrees this ratio is .1  which corresponds to an ellipse that is only slightly elongated since the available range data cover only approximately one third of each ellipse  this elongation is not enough to reject a circular model. thus  circles can generally fit the intersections from cylinders within this 1-degree interval 
	a. 	fitting 	ellipses 
　　as shown in figure 1  points along a small portion of an ellipse do not adequately define it. knowing the length of the minor diameter  however  significantly reduces the number of possible matches. the question is how to use the minor diameter to fit ellipses to such short segments. 
　　in our particular task the data presented to the ellipse fitter are generally free of gross errors because the process that segments the intersection line into line segments  circular arcs  and elliptical arcs works quite well. the data contain measurement errors due to quantization errors  calibration errors  and noise  but the lack of gross errors implies that a global smoothing technique is appropriate however  since the parameters of an ellipse are not linearly related  an iterative fitting procedure is required  and to start such a procedure requires initial parameter estimates we have experimented with three methods for computing initial estimates of an ellipse's parameters: 
1 
　　
linear-least squares first  use a least-squares tech niquc to fit a general second order curve of the form  
to all the data  then determine whether or not the result is an ellipse with approximately the right minor diameter if so. use the parameters of the ellipse as the initial parameter values; if not  try another method 
construction first  use two sets of parallel chords to estimate the center of the ellipse  then use the known minor diameter and a theorem about central right angles to estimate the major diameter  and finally use the positions of the extrema to estimate the orientation 
ransac rerativcly select sets of five points  compute the general second-order curve that passes through them  and then determine whether or not the result is an ellipse that has approximately the right minor diameter and comes close to a sufficiently large number of the points if so  use the parameter values  if not. try another sel of five points 
since the parameters of an ellipse with a known diameter are not linearly related  it is not possible to directly apply a least-squares technique to all the data and produce a solu tion however  since the coefficients of a general second order equation  which may represent an ellipse  a hyper bola. or a parabola  are linearly related  we can solve for them in hopes that the result is an ellipse of the right size 
     the form of the second-order curve used in the linear least-squares method was chosen because its coefficients could be directly computed from a list of points on the curve it is not a completely general second-order curve because the leading coefficient is set to 1. which implies that the curve cannot be a parabola with its axis parallel to the x-axis but this limitation does not affect us because we arc looking only for ellipses 
     in theory  the points along an arc in the data from a cylinder form an ellipse  however  in practice  measurement errors perturb the points these perturbations  although relatively small  can dramatically affect the curve produced by the least-squares technique because the data cover such a small section of the ellipse these perturbations may even change the curve from an ellipse to a para bola or hyperbola the better the data  the less likely these abrupt changes 
     in the construction method we use two facts about ellipses that are illustrated in figure 1 the first fact is that a line through the centers of two parallel chords passes through the center of the ellipse  this result  which we derived   is a generalization of the fact that a line joining two points on a ellipse with the same slope passesthrough the center of the ellipse this latter fact has been used by tsuji et al to locate ellipses  but it requires them to be almost completely visible    two sets of parallel chords uniquely determine the center of the ellipse 
     having found the center of the ellipse  we use the second fact  which states that the sides of a right angle whose vertex is at the center of the ellipse are related by the formula shown in figure 1  where r is a constant for the ellipse  this fact was also used by tsuji et al. to separate concentric ellipses .  we construct a right angle at the center and use the length of the minor diameter to compute the length of the major diameter to determine the orientation  we first find the points on the arc that are closest to the center and farthest from the center  use the lengths of the major and minor diameters to verify that they are extrema. and then compute the orientation from one or more of them. 
1 
　　
     the parallel chord method for estimating the center of the ellipse is the least reliable step in this method  being particularly susceptible to noise when the visible arc is a relatively straight section of the ellipse. this is because small perturbations can significantly change the positions of the parallel chords. thus  this method probably should be considered only when the high curvature portions of the ellipse are visible. 
     in the ransac method of estimating ellipse parameters  the general second-order curves to be tested are directly computed from sets of five points for each set. four lines are constructed as shown in figure 1 the coefficients of the quadratic in x and y are computed by evaluating the linear equation: 
where  	
at the fifth point and solving for a this computation is a fast and accurate way to compute the conic section determined by five points however  it too is sensitive to small perturbations of the points for example  given the points 

which are on the ellipse 

incrementing the y coordinate of the third point by 1 changes the fitted curve from an ellipse to a hyperbola to overcome this sensitivity  sets of five points are tried until the implied ellipse fits the data well thus  while all the methoas for obtaining an initial estimate of the ellipse parameters are sensitive to noise  ransac is the only approach that gives one the option of trading search time for an acceptable solution. 
     given initial estimates of the ellipse parameters from one of these three methods  we use an iterative leastsquares technique to improve the estimates the quantity to be minimized is shown in figure 1 this metric is used instead of the perpendicular distance to the ellipse because it is significantly easier to compute  see f == for the exact formula used and its partial derivatives  

figure 1 the metric used in the iterative leastsquares technique 
	b 	ransacing lines 
     given a set of similar ellipses  we partition it into subsets that correspond to individual cylinders by locating groups of ellipses whose centers lie along three-dimensional lines  which are the axes of the cylinders  in this task the data may contain gross errors because there are two or more parallel cylinders in the data or because the grouping procedure included an incorrect ellipse ransac is used to find the axes a pair of centers is selected  the line passing through them is computed  and the number of other centers lying within the expected measurement error of that line are determined if the number of compatible centers is larger than some threshold  that subset of points is used to hypothesize a cylinder; otherwise  another pair of centers is selected 
c. an example 
     figure 1 shows a set of 1 slices taken from the two cylinders in figure 1 the arcs at the top of the picture are almost circular in the plane of light because the cylinder is almost perpendicular to that plane the program fits circles with the appropriate diameter to these arcs after they have been transformed into the plane of light two of these circles are shown in figure 1 they appear as ellipses in the picture because they have been transformed back into the image plane of the camera that took the data figure 1 shows the same data  but from a point on the axis of the cylinder associated with the circular intersections. notice the set of elliptical arcs from the cylinder lying on top of the located one 

1 
　　
　　figures 1 through 1 illustrate the process of finding a cylinder from a set of elliptical intersections ellipses are fitted to the arcs after they have been transformed from the image plane into the plane of light. figure 1 shows the initial ellipses produced by the procedures to estimate the ellipse parameters figure 1 shows the ellipses produced by fixing the length of the minor diameter and iteratively improving the initial estimates and finally  figure 1 shows the ellipses produced after histogramming and identifying a set of ellipses that corresponds to one cylinder for this fit the orientations and major diameters of the ellipses were set to the averages of the parameters for all ellipses associated with the cylinder 
d discussion 
　　the intersection of the plane of light and an object is a relatively thin line  but since there is some thickness  it appears as a line several pixels wide in an image which points in the image should be defined to be on the plane1 for simplicity  most range acquisition systems that use a projected light plane have selected one point in each row of the image  e.g.  see   usually they choose the middle pixel of the first long run of pixels that are  on  however  since the images are perspective images  there may be more than one valid intersection per row. more impor tantly  when the intersection line is horizontal in the image  the row centers are completely wrong  see figure 1 . since some of the most important data for our task are obtained from horizontal or almost horizontal intersections  we apply a thinning algorithm  see   to produce a center line that is independent of the intersection's orientation in the image this center; line still may not lie in the light plane  but it is close  and to first order it is independent of the camera's focus and the threshold used to produce the binary picture. 
　　as mentioned in the discussion about how to evaluate a fit  an error in the fit can be due to an incorrect model as well as to inaccurate parameter values. we have used this principle to check our range data the data shown in figure 1 were taken from two cylinders perpendicular to the plane of light. the intersections should be circles whose diameters equal the diameters of the cylinders. however  as can be seen in figure 1 and as confirmed by our evaluation criteria  the data contain a slight systematic flattening that cannot be accounted for by the circular models we have not determined why this occurs 
　　our approach to finding cylinders applies taskdependent knowledge  i.e.  the known diameter of the cylinder  at the time the program fits ellipses. it does not use the position of one elliptical section to help find the next one. the fact that cylinders occupy a continuous volume in space that leads to sets of similar ellipses is used later in the histogramming step. this decision raises an important question of when to apply contextual knowledge when the data are good  it is computationally effective to find the ellipses independently and perform a global histogramming. if the data are degraded  the volume model of a cylinder would have to be used earlier. 
figure 1 the initial ellipses for the elliptical arcs 
figure 1 the iteratively improved ellipses 
　　
vi concluding remarks 
　　we have presented a conceptually new way to approach the problem of fitting a model to data containing gross errors - a fundamental problem in science. although we have concentrated on the problems of finding lines  ellipses  and cylinders  our approach to fitting is applicable to most problems in which the data may contain gross errors. it is robust in the sense that any gross errors are filtered from the data before a smoothing technique  such as least squares  is applied. it is slow compared to a single application of a smoothing technique  but its results arc unaffected by gross errors 
　　we briefly described the application of this approach to the problem of locating cylinders with a known diameter in range data we used it in two different tasks: estimating 
1 
　　
figure 1 the final ellipses 
　　
ellipse parameters and locating groups of ellipses that belong to different cylinders in the first task the full power of ransac was not required except when the data had not been correctly segmented in the second task the basic use of ransac was to perform a segmentation  i.e.  partition a set of points. we believe that the ransac paradigm provides a general way to perform partitioning and we plan to investigate its properties when applied in this way 
　　we also presented the basis for an approach to evaluat ing a fit that is independent of the method used to produce the fit we plan to investigate ways of making this evaluation procedure an integral component of our fitting techniques 
