 
　　　t h i s p a p e r d e s c r i b e s a n image u n d e r s t a n d i n g s y s t e m w h i c h i n t e r p r e t s l i n e segments d e t e c t e d i n c i n e - a n g i o g r a m s   c i n e - f i l m r e c o r d s o f r a d i o g r a p h i c i m a g e s o f c o r o n a r y a r t e r i e s   i n t o a model o f t h e a r t e r i a l s y s t e m b a s e d o n e x p e r t k n o w l e d g e o n t h e a r t e r y . a p r o d u c t i o n s y s t e m a c c e s s e s r u l e s o n shapes and s t r u c t u r e s o f 
　　　t h e b l o o d v e s s e l s t o e v a l u a t e t h e 
g e o m e t r i c a l p a r a m e t e r s o f s e q u e n c e s o f 
s e g m e n t s   and a t r e e of h y p o t h e s e s on t h e 
i d e n t i t i e s o f t h e i n d i v i d u a l segments i n 
e a c h v i e w i s g e n e r a t e d . f i n a l l y   t h e 
h y p o t h e s e s o b t a i n e d f r o m d i f f e r e n t v i e w s 
a r e i n t e g r a t e d t o f i n d a more r e l i a b l e 
i n t e r p r e t a t i o n o f t h e i m a g e s . 
	1. 	introduction 
     visual inspection of coronary a r t e r i e s in cine-angiograms  c i n e - f i l m records of 
radiographic images of beating h e a r t s   has increased i t s importance to f i n d diseased p o r t i o n s w i t h i n the a r t e r i e s and to assess the s e v e r i t y of the coronary diseases. semi-automatic inspection systems have been proposed for q u a n t i t a t i v e analysis   1   but they need c a r e f u l monitoring a large number of frames in the records and t r a c i n g the diseased parts by experts. also it is a very d i f f i c u l t and time-consuming task for the experts to l o c a l i z e the detected lesions in the a r t e r i a l s t r u c t u r e   because the records consist of sequences of p r o j e c t i o n s of the moving  complex  three-dimensional a r t e r i a l system from d i f f e r e n t d i r e c t i o n s . 
　　we have studied w i t h professor abe's group of medical school of osaka u n i v e r s i t y to develop an i n t e l l i g e n t system which could help medical doctors by f i n d i n g diseased p o r t i o n s of the a r t e r i e s in the cine-angiograms and l o c a t i n g them in a model of the a r t e r i a l system. 
　　since the arteriograms are much noisy  low c o n t r a s t e d   and t i m e - v a r y i n g images  the f i n d i n g of the a r t e r y branches and t r a c k i n g of t h e i r precise boundaries are very d i f f i c u l t image processing tasks. an 
1 
a t t e m p t t o a u t o m a t e t h i s p r o c e s s has been a l r e a d y r e p o r t e d   1   . t h i s p a p e r d e s c r i b e s h i g h e r l e v e l p r o g r a m s o f t h e s y s t e m   a n e x p e r t s y s t e m   f o r i d e n t i f y i n g t h e i n d i v i d u a l l i n e segments d e t e c t e d i n e a c h v i e w and c o n s t r u c t i n g a model of t h e 
a r t e r i a l s y s t e m b y i n t e g r a t i n g i n f o r m a t i o n o b t a i n e d f r o m d i f f e r e n t v i e w s . 
     a k i t a and kuga   1   have studied an i n t e l l i g n e t system which analyzes another type of images of blood vessels  color ocular fundus images. their system c l a s s i f i e s each segment of the blood vessel i n t o an a r t e r y or a vein by u t i l i z i n g knowledge on the shapes and patterns around crossing points of two segments. our system needs much deeper understanding of the s t r u c t u r e of the coronary a r t e r i a l system. the a r t e r i a l systems in the cine-angiograms show a wide v a r i e t y of appearances because of  1  i n t e r - i n d i v i d u a l v a r i e t i e s of shapes and 
s t r u c t u r e s of the a r t e r i e s    1  temporal changes in each cardiac c y c l e   and  1  s i g n i f i c a n t changes in t h e i r shapps and s t r u c t u r e s by even a small amount of change in the d i r e c t i o n of image p r o j e c t i o n . a number of medical studies have acculmutated knowledge on the anatomical s t r u c t u r e of the coronary a r t e r i e s   t h e i r appearances in the radiographic images taken from d i f f e r e n t d i r e c t i o n s   and techniques of i n t e r p r e t i n g the images. expert medical doctors w i t h much experience on the inspection nf the arteriograms can i d e n t i f y most of a r t e r i a l branches  e s p e c i a l l y those important for d i a g n o s i s   by c a r e f u l l y examining the images and i n t e g r a t i n g i n f o r m a t i o n 
obtained from m u l t i p l e views. therefore  we f o l l o w the knowledge engineering approach   1   1   and design an image understanding system so as to e a s i l y t r a n s f e r the e x p e r t i s e to the knowledgebase of the system and test i t s e f f e c t i v e ness and v a i l d i t y by experiments. 


a r t e r i e s 	w h i l e 	x-ray 	opaque 	dye 	is i n t e r m i t t e n t l y 	i n j e c t e d 	through 	a c a t h e t e r . 	the 	images 	are 	taken 	from several 	d i r e c t i o n s 	such 	as 	lao 	  l e f t a n t e r i o r oblique p r o j e c t i o n   	or rao 	  r i g h t a n t e r i o r oblique 	p r o j e c t i o n   	to 	observe the 	three-dimensional 	s t r u c t u r e 	of 	the a r t e r i e s . 	the 	diseased 	p o r t i o n s   o b s t r u c t i n g 	l e s i o n s   	are 	detected 	as i r r e g u l a r 	and 	narrow 	or 	completely occluding p o r t i o n s 	in the vessels. 
change in the d i r e c t i o n of the p r o j e c t i o n sometimes causes s i g n i f i c a n t changes in s t r u c t u r e * of the images  and the system needs to compare the i n t e r p r e t a t i o n s of two views in order to obtain a more r e l i a b l e i n t e r p r e t a t i o n . we should also note that there e x i s t temporal changes of the arteriograms in the shapes  and sometimes in the s t r u c t u r e s of images  in each cardiac c y c l e . 
understanding of coronary arteries 

1 

cover the wide v a r i e t i e s of the a r t e r i a l systems. also it is very d i f f i c u l t to map the image data to the model because we deal w i t h the images which were taken from d i f f e r e n t d i r e c t i o n s by a camera in d i f f e r e n t time courses. 
     instead  we study another approach  the u t i l i z a t i o n of the expert knowledge on appearances of the a r t e r i e s in each view. the knowledge  as most of the expert knowledge of other f i e l d s   is not d e f i n i t e l y d e f i n e d   t h e r e f o r e the system must be f l e x i b l e in such a way that we can e a s i l y t r a n s f e r the e x p e r t i s e to the knowledge-base  test i t s v a l i d i t y and e f f e c t i v e n e s s by a series of experiments  and modify i t . the production system which has been widely used in the c o n s u l t a t i o n systems is also s u i t a b l e for our purpose. we have constructed an image understanding system which acquires r u l e s f r o m ' e x p e r t s   analyzes input l i n e images detected in the artriograms to generate hypotheses on the i d e n t i f i c a t i o n of the input segments  and r e p o r t s the r e s u l t s . the e x p e r t i s e we use include both the h e u r i s t i c s for i d e n t i f y i n g each a r t e r i a l branch and 
procedures for s e l e c t i n g s u i t a b l e . a r t e r i a l branch to be examined next. 
system design and knowledge representation 
     as mentioned in the previous chapter  we have designed an image understanding system for the anteriograms which is characterized by i t s f l e x i b i l i t y to e a s i l y t r a n s f e r the expert knowledge to i t s knowledge-base and modify i t . we also consider it is very important to provide it w i t h the c a p a b i l i t y of i n t e g r a t i n g i n f o r m a t i o n obtained from multiple sources. the system needs to compare hypotheses on the a r t e r i a l s t r u c t u r e deduced from each of multiple views and construct a model of the a r t e r i a l system. u t i l i z a t i o n of other information than the l i n e images w i l l be also useful to augment the c a p a b i l i t y of the system. the expert 
medical doctors e f f e c t i v e l y use such information for s p e c i f i c d e c i s i o n making. for example  the knowledge that a n t e r i o u l y located vessels appear to move in a d i r e c t i o n opposite to the p o s t e r i o u s l y located a r t e r i e s is used to d i s c r i m i n a t e 
the anterious descending from the many v e n t r i c u l a r branches in a rao view  otherwise the task is very d i f f i c u l t even for the experts   1   . we have been developing such image processing programs which analyze temporal changes of the 

i. system description 
system input 
　　in order to concentrate fundermental problems of understanding the s t r u c t u r e s of the vessel system in the images  the system analyzes the l i n e images of the a r t e r i e s obtained from the arteriograms under an assumption that a l l l i n e segments are found. each l i n e segement is represented by i t s s t a r t i n g point and terminal point   i n a 1 by 1 image a r t e r i e s in t h e i r l o c a t i o n s or measure the v e l o c i t y of blood flow in each branch in the images  and plan to add these programs to the system. therefore  the system is designed so as to accept information sent from various types of image processing programs. 
     the main part of our expert system is schematically shown in f i g . 1 . it consists of  1  inference engine   1  rules   1  blackboard  and  1  interactive system. 
and 
1 an expert gives the system his or her knowledge  rules represented in a simple e n g l i s h - l i k e format  through interactive system. inference engine accesses rules  c o l l e c t s necessary data from the user  analyzes the l i n e image data on 
blackboard  and generates hypotheses on the s t r u c t u r e of the a r t e r y in the given image. the r e s u l t s are then shown on a 
color 	d i s p l a y . 
　　blackboard is a data s t r u c t u r e for c o l l e c t i n g l i n e image data obtained from d i f f e r e n t views of the coronary a r t e r i e s and hypothesis trees generated for the views  which are then used to construct a model of the a r t e r i a l system. it is designed so as to accept image data manipulated by the image processing programs which w i l l be added in f u t u r e . 
     the expert knowledge used in t h i s system is a c o l l e c t i o n of modular type production rules as used in mycin and other c o n s u l t a t i o n systems. in most cases  r u l e s for i d e n t i f y i n g each a r t e r i a l branch are independently used from those for the other branches and  t h e r e f o r e   we organize the rules in a context tree shown in fig.1. 
     the r u l e s are c l a s s i f i e d into three types:  1  control rules to specify a r u l e 
or a context of rules to be selected next   1  i d e n t i f i c a t i o n rules to give c o n d i t i o n s for reasoning whether a sequence of segments is a s p e c i f i e d a r t e r i a l branch  and  1  judgment rules to give c o n d i t i o n s for judging which  or which p a r t   of mutually c o n t r a d i c t i n g hypotheses is more probable. 
knowledge for interpreting arteriograms 
     the experts seem to have h e u r i s t i c s for i n t e r p r e t i n g the arteriograms. they f i r s t search the input images for large blood vessels which are e a s i l y and r e l i a b l y d e t e c t a b l e . for example  the l e f t a r t e r i o r descending coronary a r t e r y  lad  is the vessel with the most constant o r i g i n   course  and d i s t r i b u t i o n   and it is used as a key p a t t e r n for the i n t e r p r e t a t i o n . if lad is found  the 
experts search for the next large v e s s e l   for example cx   c i r c u m f l e x     which 
1 
     at f i r s t   the user is asked to point out the segment corresponding to the catheter by an i d e n t i f i c a t i o n r u l e accessed by a control r u l e . the context of lai  d e t e c t i o n is accessed next. it contains the f o l l o w i n g type of i d e n t i f i c a t i o n r u l e s . 
rule oil 
if the candidate satisfies that 
 1  it branches at 1 - 1% of the catheter  and 
 1  it 	satisfies 	the 	continuity 
conditions  at branching points   and 
 1  its width variation  at branching points  is 1 - 1%  and 
 1  its 	direction is 1 - 1% of the 
longest sequence  
then 
 1  the candidate is definitely lad cf*1   and 
 1  add 	the 	candidate 	as 	lad 	to 
hypothesis. 
when t h i s r u l e is accessed  the o r i g i n   c o n t i n u i t y   w i d t h   and d i r e c t i o n of each candidate  a sequence of segments  are examined  and a l l candidates s a t i s f y i n g these c o n d i t i o n s are r e g i s t e r e d on the hypothesis tree w i t h the highest c e r t a i n t y f a c t o r . the context contains another r u l e 
which finds less confident candidates for lad. candidates for cx are also examined by accessing the s i m i l a r r u l e s . mlca  main l e f t coronary a r t e r y   is a short blood vessel from which lad and cx o r i g i n a t e   and it is not observable in many lao views. lmca rules examine whether there e x i s t a segment in each lad's candidate between the end of the catheter and the point where the cx's candidate o r i g i n a t e s . if so  the segment is added to the hypothesis t r e e . if not  lmca is an empty segment and is considered as the cross point of lad and cx. now we w i l l show in more d e t a i l how the hypothesis tree is generated. 
rule 1 
if the candidate satisfies that 
 1  the candidate branches at 1% - 	1% 
of lad  and 
 1  the candidate branches from lad at 
1 - 1 degree  and 
the rules 	for 	a l l 	branches 	in 	the 　　 1  there is a strong evidence  cf-1  
that the candidate is dia  and 
　　 1  add the candidate as dia to this is one of rules for f i n d i n g dias 
 diagonal branches  which o r i g i n a t e from lad.  since a large dia sometimes o r i g i n a t e s d i r e c t l y from lmca  we also implement rules for such cases in the 
knowledge-base.  suppose that rules for f i n d i n g three large vessels  lmca  lad  and cx  were accessed and several hypotheses on the i d e n t i t i e s of these vessels were already generated on blackboard as shown in fig.1 w i t h s o l i d l i n e s . in t h i s example  cath has been uniquely determined w i t h cf=1  and there are three hypotheses on lad and lcx:  lad1 lcx1   lad1 lcx1   lad1 lcx1 . when rule 
1 is accessed  a l l possible candidates for the diagonal branches are found on blackboard and are t r a n s f e r r e d to a short term memory  then i n d i v i d u a l premise c o n d i t i o n s are evaluated for each candidate. predicates in the rules are lisp functions which evaluate t or nil by e v a l u a t i n g the s p e c i f i e d geometrical a t t r i b u t e s . some lisp functions can access fortran programs c a l c u l a t i n g complex shape parameters of which u t i l i z a t i o n considerably save the computing time. this l i n k of production rules w i t h fortran programs w i l l be useful for augumenting our system because the production system can c o n t r o l image processing . subroutine packages. at present  the system has functions examining a t t r i b u t e s on the o r i g i n   l e n g t h   d i r e c t i o n   width v a r i a t i o n   angle  
c u r v a t u r e   c o n t i n u i t y   and index of shape complexity of the candidate or the vessels detected already. if the candidate s a t i s f i e s the premise  the a c t i o n part is excuted and the r e s u l t is added to the hypotheses on blackboard. the dotted lines of fig.1 shows the hypotheses on dia generated by the context c o n t a i n i n g rule 1. note that the system u t i l i z e s knowledge on the maximum number of each a r t e r i a l branch such that lcx and lad are s i n g l e vessel but dia are sometimes more than two branches. 
context of lao view are applied to the input image  and the hypothesis tree is completed for that view. the hypothesis having the highest c e r t a i n t y factor is displayed on the color d i s p l a y . 
　　　if the input anteriograms contain another lao view of which d i r e c t i o n   is d i f f e r e n t by a small angle  then another hypothesis tree is generated bv the same 
procedure. then the judgment r u l e s are applied to the trees and the most reasonable hypothesis is s e l e c t e d . the d e t a i l e d process w i l l be explained in the next chapter using an example. 
	1. 	experimental results 
     we have implemented the system w r i t t e n in flisp  a modified version of interlispf and fortran on a minicomputer hp1a. about 1 rules are c u r r e n t l y used for i d e n t i f y i n g the branches of l e f t coronary 
	a r t e r i e s 	in lao views. 
     the analysis of the l i n e image w i t h 1 segments obtained from an input image shown in fig.1  b   a 1 degree lao view  y i e l d s 1 hypotheses  and the i n t e r p r e t a t i o n w i t h the highest c e r t a i n t y factor is shown in fig.1   a   . the short l i n e segment without any label is not given any i d e n t i t y   since the knowledge-base does 
not contain rules for such small branches. most of the i d e n t i t i e s of the segments are i d e n t i c a l to those by an expert and are considered as t r u e . the branch i d e n t i f i e d as the t h i r d diagonal branch  however  is judged as a septal branch by the expert 
who examined other images taken from d i f f e r e n t - d i r e c t i o n s . 
     the cine-angiogram of t h i s subject contains images taken from a d i r e c t i o n d i f f e r e n t by a small angle; 1 degree lao views. the system analyzes the l i n e image obtained from one of them  and generates another hypothesis t r e e . the most confident hypothesis is shown in fig.1 
1 

	f1g.1 examples 	of the 	i n t e r p r e t a t i o n s . 
  b   . the judgment rules are then applied to f i n d correspondences between the two i n t e r p r e t a t i o n s shown in f i g . 1 . s t a r t i n g w i t h the most r e l i a b l e vessels  lad in t h i s case   the correspondence of the other a r t e r i a l branches are examined. if the branches o r i g i n a t e from the same vessel in the two views are not same  t h e i r c e r t a i n t y f a c t o r s are re-examined. in t h i s case  the t h i r d branch from lad is assigned two d i f f e r e n t meanings; a diagonal and a septal branch. the system evaluates the c e r t a i n t y factors of both hypotheses on the i d e n t i t y of the branch for the two images.   b   . we have 
cf dia 1*la1 =1  	cf sep  1＜la1 =1 . 1 
cf dia 1＜la1 =1  	and 	cf sep f1g.1 b   
= 1 . 1 . also the system searches the knowledge-base for d e s c r i p t i o n s on the branches of lad and finds the knowledge that if lad has more than two branches  there is suggestive evidence  cf=1  that lad has the f i r s t dia and the f i r s t sep and the other. since the two other branches are i d e n t i f i e d as dia  then the r u l e gives cf dia =-1 and cf sep =1. by using the method for the inexact reasoning   1     the system concludes that the t h i r d branch is the f i r s t s e p t a l   and t h i s i n t e r p r e t a t i o n is i d e n t i c a l to that by the e x p e r t . 
     we have tested the performance of the system for a set of input images. the hypotheses w i t h the highest c e r t a i n t y f a c t o r obtained from sample input images are shown in f i g . 1 . the system c o r r e c t l y i d e n t i f i e s the major branches. i he 
computing time for the i n t e r p r e t a t i o n of one image ranges from 1 minutes to 1 minutes depending on the number of segemnts and the complexity of the s t r u c t u r e our experiences i n d i c a t e that the u t i l i z a t i o n of the large computer such as facom m1 w i l l shorten the computing 
time by a factor of 	1. 
	1. 	discussions 
     the image understanding system for the anteriograms c u r r e n t l y i n t e r p r e t s the l i n e images of the l e f t coronary a r t e r y of a 1 degree lao view. also it can i n t e g r a t e the hypotheses generated for the images taken from a s l i g h t l y d i f f e r e n t d i r e c t i o n and o b t a i n a more r e l i a b l e model of the a r t e r y . because of the modularity of the knowledge  it seems us easy to consruct the knowledge-base on other views of the l e f t coronary a r t e r y and rao and lao views of the r i g h t coronay a r t e r y . the i n t e g r a t i o n of hypotheses obtained from rao and lao views is more d i f f i c u l t and needs f u r t h e r research. the i n t e g r a t i o n of other source of information such as temporal i n f o r m a t i o n is also important. 
　　　although we use the rules on the s t r u c t u r e of the a r t e r y of healthy s u b j e c t s   the system can i n t e r p r e t the images c o n t a i n i n g diseased lesions if they appear as narrow p o r t i o n s of the segments. we consider the m o d i f i c a t i o n of the rules so as to f i n d completly occluded p o r t i o n s would be easy if the i n v i s i b l e segments of the vessels are s h o r t . however  there e x s i t images in which t o t a l lack of v i s i b l e parts beyond the diseased lesions is observed  and f u t u r e research is needed to i n t e r p r e t these images. 
　　we assume that the noise free l i n e image is extracted from the raw image data  but it is very d i f f i c u l t to f i n d small a r t e r i a l branches in the cine-angiograms. the knowledge-based l i n e f i n d e r   1   c o n t r o l l e d by the production system w i l l be useful for automatic inspection of the cine-angiograms. 
acknowledgement 
     the 	authors 	wish 	to 	express 	t h e i r hearty 	thanks 	to 	professor m. 	inoue and dr. t. shimazu  medical 	school 	of 	osaka 
u n i v e r s i t y for t h e i r kind and valuable d i s c u s s i o n s . 
