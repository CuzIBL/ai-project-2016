 
we present a model for flexible extruded objects  such as wires  tubes  or grommets  and demonstrate a novel  self-adjusting seven-dimensional hough transform that derives and analyzes their three-space curved axes from position and surface normal information. the method is purely local and is very cheap to compute. the model considers such objects as piecewise toroidal  and decomposes the seven parameters of a torus into three nested subspaces  the structure of which counteract the errors implicit in the analysis of objects of great size and/or small curvature. we believe it is the first example of a parameter space structure designed to cluster ill-conditioned hypotheses together so that they can be easily detected and ignored. this work complements existing shape-from-contour approaches for analyzing tori: it uses no edge information  and it does not require the solution of high-degree non-linear equations by iterative techniques. most of the results  including the conditions for the existence of more that one solution  phantom  anti-tori    have been verified using a symbolic mathematical analysis system. we present  in the environment of the ibm convex system  robust results on both synthetic 
cad-cam range data  the hasp of a lock   and actual range data  a knotted piece of coaxial cable   and discuss several system tuning issues. 
1. introduction 
   we consider the problem of analyzing dense depth images to determine the parameters of flexible extruded objects. our approach views such objects as being piecewise toroidal  since the torus is the simplest solid geometric object whose generating axis exhibits curvature. this is justified by our observation that many piecewise sections of flexible extruded objects have co-planar spines  either because they are easy to manufacture that way  or because they represent a minimum energy configuration  these reasons are often equivalent . however  a torus is an object with seven free parameters: three of position  two of orientation  one of size  and one of relative 
rick kjeldsen 
exploratory computer vision group 
ibm thomas j. watson research center 
p.o. box 1 yorktown heights  ny 1 fem k watson. ibm. com 
 thickness . this pushes the limits of the current state of the art in parsing high-degree parametric object models  particularly since the parameters of position and size are potentially unbounded  especially for objects that are nearly cylindrical. 
   following what might be called the principle of least variability  we first recover the thickness parameter  since among all seven it is the one parameter most likely to be constant across the toroidal pieces. the method exploits a novel but efficient algorithmic interpretation of a result in differential geometry called meusnier's theorem. then  using the knowledge gained from deriving the thickness  we recover the next most well-behaved parameters  the orientation and size. these are computed simultaneously and in a manner that compensates for the ill-conditioning of orientation estimates when size is large. lastly  using knowledge of both thickness and size  we recover the position of the local toroidal section  again automatically compensating for the ill-conditioning of large and/or nearly straight objects. 
   the significance of the work rests on its two principal results: the elegance and speed of the thickness-finding transform  reviewed only briefly here  for more details see  kender and kjeldsen  1   and the novel way in which the parameter space structure decomposes a difficult seven-dimensional problem so that ill-conditioned hypotheses cluster together for easy detection and removal. the work as a whole is applicable in vision systems wherever depth and surface orientation  however sparse  are obtainable  particularly for those cases where object boundaries are occluded  and where contourbased methods therefore fail. 
1. the torus in brief 
   we adopt the terminology of docarmo   and review the results on tori that we will exploit. 
   a torus is a solid of revolution formed by a generating circle   minor circle   of radius r being swept in a circle of revolution   major circle   of radius a  note that we have reversed the sense of/' & a from docarmo . generally speaking  we will assume that r a  that is  that the  donut  has a  hole . this constraint will be exploited in the decomposition of the parameter spaces. 
   surface properties are best represented in the framework of the following parameterization  which identifies the center of the torus  and hence  the center of the major circle  with the 
	kender and kjeldsen 	1 

fig. 1: torus terminology. 
center of a cylindrical coordinate system  making a to be cylindrical radius and v as cylindrical angle; the axis of the torus becomes the remaining coordinate z. we parameterize the surface of the minor circle by the angle u; unlike the angle v  its origin is critical  and is set to equal 1 when it is most distant from the torus center. the locus of points with a given v lie on a  meridian . the locus of points with a given u lie on a  parallel . 
   as with any other regular surface  each point of the torus has two principal curvatures  with directions of principal curvature that are perpendicular to each other. every point has one positive curvature  k1  which is oriented along the meridian. the other curvature of the point  k1  is more elaborate  although it is always oriented along the parallel  k1 is 1 at the  top  and  bottom  parallels of the torus  where the surface is locally cylindrical. it attains its extreme positive value at the 
 outermost  parallel  and its extreme negative value at the  innermost  parallel. we note and will heavily exploit the observation that the largest positive curvature at any point is always the value of k . 
   we will adopt the following notation. a point on the torus is denoted as pi; it is considered to be vector in three space. we will abbreviate the vector p i -p j as p i j . likewise  we will refer to the unit normal vector of the surface at pi as ni  and a similar comment applies to vectors of the form ni j. note that the values of the points and the normals are available as input data  measured in the coordinate system of the imaging apparatus. we will often refer to the  translated  points 
ti = pi - rni; if the r is the true minor radius  then ti = si  that is a point on the torus spine. 
1. computing minor radius 
   it is not hard to show that when computing the parameters of a two-dimensional surface in three space  the information that a point is on the surface can be used to fix one parameter  and the information that a given vector is the normal to the surface at a point can be used to fix two parameters.  analogous statements can be made about curvature  but we avoid curvature information because of its intrinsic susceptibility to noise.  thus  a sphere is uniquely determined by four points  or  more simply  by two points and the normal at one of them. 
1 	vision 
thus  two points and their normals are insufficient to uniquely determine a torus  since they fix only six parameters. however  three points and their normals in general overdetermine the torus in the following way. there must exist a local space circle that serves as the torus spine  and it must be equidistant from all three points  this common distance is the value of r . but  in addition  this space circle must have the property that at the point of closest approach to each of the pi  the tangent to the space circle must be perpendicular to the corresponding ni it is the need for some means to guarantee this tangent property that leads to the following observations and constructions. 
   we select a distinguished point pi; without loss of generality assume that it is the point p1. we then construct all the space circles through the translated point 1 whose tangents at t1 are perpendicular to n1  and that also pass through a second translated point  call it t1- there is a one degree of freedom family of such circles  and they all lie on the surface of a sphere. that such a construction is possible can be seen both geometrically and algebraically; it is also a special case of the theorem of meusnier.  meusnier's theorem states that if a set of planes are drawn through a tangent to a surface in a 
   non-zero curvature direction  then the osculating circles of the intersections with the surface lie upon a sphere  struik  1 .  
   geometrically  we consider t  to be the south pole of a sphere whose north-south axis is collinear with n1. the size of the sphere is determined by t1. call this sphere the supporting sphere. any circle  great or little  that passes through t1 and t1 now also has its local tangent at t1 perpendicular to n1. algebraically  we can look for the size of the support sphere  s; since we know that the center is fig. 1: minor r extraction geometry. 
constrained to lie along the direction of the n1  the center is given by c=t1+sn1. both t  and t1 lie on a common sphere if their distances from the center are equal. this is captured by equating the norms of their relative possition vectors  giving in vector form the equation of the plane of their perpendicular bisectors: . expanding  we find that  that is  the size of the support sphere needed to accommodate t1  is a function of r. 

   note  however  that the local tangent at t1 is not necessarily perpendicular to n1- worse  t1 may not even lie on the support sphere at all. 
we remedy this second defect first  by constructing with 
t  and t1 the same sort of support sphere as was constructed with t1 and t1- what results is a symmetric relationship  

which expresses the size of the support sphere which would not only accommodate t1  but which would also allow us to draw a one-dimensional family of circles through t1 and t1 whose local tangents at t1 are perpendicular n1. 
   now note that if  for whatever r  the support spheres must be coincident  since they are both defined relative to p1  and all three ti lie upon it. basically  equating will find those r that allow a solution to the now overdetermined problem of finding a sphere that passes through three points and attains a specified normal at a given point  here  the south pole . equating gives a 
   this equation will have at most two solutions for the value of r  and they are easily obtainable by the quadratic formula. since they are based on t1 being the south pole  call them 
1 and ri 1. we still have to address the need for t1 and t1 to satisfy their tangent condition  however. we do this in a completely symmetric fashion  by finding two more support sphere systems  first by considering t1 a south pole  and then t1. the quadratic equations in r that result are derived by inspection by permuting the indices of the pi and ni. 
   from t1 as south pole we get two more candidates for the value of r  r1 and r1  and from t1 we get r1 and r1. this would appear to call for the calculation of 1 inner products  but it is easy to show that any two of these three quadratics have four inner products in common; thus  there is a total of only 1 innerproducts. 
   we now have three pairs of candidate r values. let us define a consensus r to be any ri j that satisfies 
 1a   	
   there may be zero  one  or two consensus r. they can be accumulated and filtered in the usual hough way using a one-dimensional parameter space. we note several properties of this consensus algorithm. 
   the values of r are derived by independently solving three quadratics in 1 image observables  three for each point pi  and two for each unit normal ni   the virtue of this method is that despite the non-linearities that would result when variables are eliminated  the method does not require any iterative root finding. nor does it suffer from the attendant problems of choosing starting values  guaranteeing convergence  or tracking multiple roots. 
   enlisting the aid of ibm's proprietary symbolic math system scratchpad iii  jenks et al.   1   we were able to show that the transform always produced one consensus value for r  corresponding to the true minor radius of the torus  and that if a second consensus existed  it was always easily distinguishable by its sign and/or magnitude from the true consensus r  which is always the smallest positive radius of curvature. 
   further  the analysis suggested several intriguing examples of what should probably be called anti-tori. the most straightforward example is what happens when two of the data points are on a meridian  and the third is on the innermost parallel. the transform properly returns two consensus: one is r  and the other is  the value of k1 at the  innermost  parallel. what the transform  sees  is an anti-torus whose thickness is equal to the torus' hole  and whose hole is equal to the torus' thickness. that is  it interprets the data to be lying on the negative image of an anti-torus  whose axis is perpendicular to the given torus  with the torus and anti-torus interlocking: much like confusing the impression in plaster of a face with the face itself. 
1. computing orientation  and major radius  
   following the principle of least variability  we next recover orientation by examining the spine points produced by our candidate r. orientation is a naturally bounded quantity  and is easily represented as a point on the surface of the upper gaussian hemisphere  mathematically  on p1. 
   the approach is straight forward: given a candidate r  we form the spine points si = pi - rni from the pixels supporting r  and determine the orientation of the plane on which they lie. the direction of the plane's normal is easy to compute: simply take the normalized unit vector of the following cross product  or any of its variants obtained by permuting the si : 

   however  this orientation is ill-conditioned when the spine points are nearly co-linear  which occurs when a is large. using derivatives  it is not hard to show that small changes of 
s1 in a direction perpendicular to this plane have an effect on the plane's orientation that is roughly proportional to the major radius  a. this suggests that the computation for orientation should be accompanied by the computation of a  so that orientation can be  weighted  inversely by a somehow. 
   rather than use a as a pure parameter space voting weight  we note the following. the value of a eventually has to be recovered anyway  and if it disappears into a weighted sum it is not recoverable. instead  we scale the unit orientation vector by dividing it by a. the parameter space now becomes the interior of the upper gaussian hemisphere  which is three dimensional  and the values of a are recoverable simply by taking each vector's length. more importantly  orientations accompanied by high a cluster near the origin  where they are easy to detect and remove. conversely  other orientations receive parameter space representation proportional to their certainty  since they are proportionately distant from the hemisphere center. 
   this parameter space has two other advantages. first  it uses the interior of what would otherwise be a very inefficient use of three-space  thus obviating the need to cleverly tesseilate the surface of the gaussian sphere. secondly  points that cluster at its origin can immediately be considered evidence of cylindrical objects in the image  which have no orientation and infinite a . 
	kender and kjeldsen 	1 
   
   since the orientation and a spaces are now combined  the computation of the resulting parameter point  the scaled orientation vector  can also be combined; it is not necessary to actually plot the spine circle or calculate its center. by means of a three-space geometric construction related to the planar  law of sines  for circles  it can be shown that the scaled vector is directly given by the following  or by any of its variants obtained by permuting the si : 

where 

1. computing center 
   what remains are the three most difficult parameters  the center parameters  which are potentially unbounded and highly sensitive to the value of a. local tori with small curvature have distant centers which are difficult to compute accurately. since triangulation error of the center is also roughly proportional to a  this final space computes and accumulates vectors to the center point  scaled again by a. in effect  this measures each center in units of major radius  thus relative error is nearly constant. it is not hard to show that this space is now bounded  since for local tori with large a  their center must be about a units from the image origin  otherwise they would not fall within the image. thus  most tori have centers within one unit from the origin. the upper limit of this space is determined by small tori at the image edge; since a is bounded by r  and r is bounded by physical considerations  this limit is calculable directly. 
   we note that although many tori might map to the same scaled vector  they have already been classified and separated by the value of a in the prior parameter space. thus  the nesting of these spaces is critical both for adjustment to error  and for disambiguation of results. 
   the computation is straightforward but a bit messy  however  it is again invariant to the permutation of the si : 

where and 

1. system considerations 
   in practice  the above method relies on the ability to pick  good  triples of points pi. additionally  the performance and behavior of the method can be enhanced by simple  sanity checks  on computed intermediate results. lastly  the orientation space can be improved by a judicious choice of  offset  for the scaled orientation vector. we handle these in turn. 
1 	vision 
   picking good triples is determined by enforcing a minimum and maximum distance between image points/*/; we call this distance the  radius of coherence   roc . if the roc is too small  accuracy suffers due to small triangulation baseline; too large  and most triples do not lie on the same torus. for the minor radius space  it can be set in accordance with the expected range of minor radii  which can be determined from the imaging parameters. empirically  we have found that a wide range between minimum and maximum roc works well for minor r. the two other spaces have similar considerations  however the range between minimum and maximum roc must be rather narrow or the system becomes overwhelmed with noise hypotheses. fortunately  experience shows that a narrow range of roc about r works very well for a large range of torus shapes. 
   sanity checks are inexpensive checks on the data before it is used in a parameter transform. our sanity checks are of the following form. in computing r  no points in a planar neighborhood are used; they are easy to detect  since they have very small and equal principal curvatures. nor are points near a depth discontinuity used  as the surface approximations become inaccurate there. further  degenerate quadratics  with a=1 or with imaginary roots  are ignored . in computing orientations and centers  spine points within a pixel of each other are ignored. these checks take a minute percentage of the computation times  but reduce the noise in parameter space dramatically. 
   in practice  the scaling of orientation vectors by 1/u results in vectors too tightly clustered around the origin. this is because any torus large enough to be seen in the image as a torus will have a major radius of at least eight pixels  approximately. thus  all the activity in the space happens in a hemisphere of radius 1; this uses less than 1% of the space. if a 
   lower bound on a is known  and it usually can be approximated   then the scaling function should be of the form 
b / a+c   with c serving to shift small values of a closer to the surface of the hemisphere. heuristic choices of constants based on expected torus and image sizes can be selected; one good one maps the smallest torus onto the surface of the hemisphere  and the largest torus that can be fully seen  a=1  assuming a range image of size 1  into the midpoint of the hemisphere; the scaling function becomes 1/ a+1 . 
1  system description 
   we briefly survey the complete system of which this transform is a part  highlighting those aspects most germane to our results. a more complete description can be found in  kjeldsen et al  1 . 
   recognition is structured as a hierarchy of layered and concurrent parameter transforms  ballard  1  sabbah  1 . each transform examines input data or previously established features and accumulates evidence for new feature hypotheses in an associated parameter space. compatibility relations accumulate evidence for or against a hypothesis on the basis of peer hypotheses. a large number of hypotheses are typically generated. the evidence for and against each is integrated using an iterative refinement process in a dynamically constructed constraint satisfaction network  feldman & ballard  1 . 
   
   each parameter space is instantiated as a subnetwork where nodes correspond to hypotheses. the links in the network are  1  bottom-up connections  representing support from input data  and  1  lateral links between hypotheses. the former links can be thought of as votes generated by the parameter transforms  hough  1 . the latter links  generated by the compatibility relations  can be inhibitory  or excitatory. for example  surface hypotheses generated from the same pixels are connected by an inhibitory link  because they represent conflicting interpretations of the same data. 
   evidence integration works as follows. each node i computes an activation level ui representing a confidence level in the corresponding feature. at each iterative step t  the activation level of a node  denoted by ui r   is computed as 

   where li represents bottom-up support for feature i  and the summation embodies the collective inhibition and excitation of conflicting and cooperating hypotheses;. the weight factor wij is negative when hypothesis j conflicts with hypothesis i and positive when hypothesis j is supporting i. di is a decay term that suppresses spurious hypotheses with little support  and helps insure stability. 
   a unit  survives  iteration when it has sufficient ui and insignificant inhibition. it is then passed to the next parameter transform in order to create hypotheses in higher-level spaces. units also feed-back to their component features in lowerlevel spaces and to consistent hypotheses in parallel spaces. thus  surviving features form stable coalitions which represent globally consistent interpretations of the scene. 
   additional features are added to the system by defining parameter transforms and compatibility relations which work within a well defined i/o structure. these generally make use of techniques described in  califano  1  and  califano et al  1 . our first transform takes triples of data points and returns values of r on the basis of the consensus in eq 1a. the second transform takes triples of the data points that support a surviving r hypothesis  and returns the parameters of the scaled vector of section 1. finally data points supporting surviving orientation/major radii are used as described in section 1. the current system contains 1 parameter transforms for various features. 
   the lowest level of the system extract local features such as surface approximations or depth discontinuities from the data for use by the parameter transforms. the local features important to this work use bicubic interpolations to obtain the least mean square error fit to dense depth data  
then 	computes 	directly from the polynomial coefficients of 
the 	approximation 	fig. 1: points voting for minor radius both the surface gradient vector  and the directions and amounts of principal surface curvature  sabbah & bolle  1 . experiments comparing computed values with known true values indicate that over a wide range of imagery and circumstance the inaccuracy of the approximations is no more that 1% from the ideal. 
1. results 
   the torus extraction transforms have been run on about a dozen images. we will present two of the more interesting cases. the first is a depth map generated from a csg representation of a padlock  figure 1 . the image contains a single torus segment  as well as several other surfaces. the second image is an actual range image of a knotted length of cable  figure 1 . the cable forms a continuously varying tube of constant cross section  which can be reasonably approximated as piecewise toroidal. 
   in both cases we used only a small percentage of the possible triples within the roc; the percentage was large enough to give reasonable coverage but small enough to give acceptable running times. additionally  hypotheses receiving votes from fewer than 1 triples were not instantiated. since many noise hypotheses receive just a few votes  this pruning helped cut down on the time and memory needed to support them. 

fig. 1: depth map of lock. 	fig. 1: depth map of knot. 
1. lock 
   figure 1 shows a 1 plot of the 1 depth map of the lock. surface approximations were taken using a 1 window around each point. after the sanity checks  only the points hilighted in the dithered image in figure 1 were passed to the minor radius parameter transform. roc was 1 to 1  and 1% of the possible triples were used. 1 hypotheses received votes from more than 1 triples  and so took part in iteration. after 1 iteration steps a single hypothesis of 1 for r survived  which corresponds closely to the apparent radius of the hasp. 
   figure 1 shows the points which supported the winning r. to find the orientation/major radius  roc was set to range from 1 to 1  approximately r  and 1% of the triples formed from the spine points were used. 1 hypotheses received sufficient sup-
	fig. 1: pixels supporting winning r. 	port to be instantiated. 
	kender and kjeldsen 	1 

	fig. 1: orientation hyotheses plotted in 1-space. 	fig. 1: pixels voting for orientation 1. 	fig. 1: pixels voting for orientation 1. figure 1 shows the hypotheses receiving votes plotted in 1-space  it does not show the number of votes each received . you can make out the hemispherical outlines of the parameter space  as well as a distinct cluster of hypotheses in the -x +y +z quadrant. two hypotheses survived after iteration. the points supporting them are shown in figures 1 and 1. the first captured the orientation of the torus forming the top of the hasp as closely as we were able to measure it ourselves. the major radius was captured as accurately as the parameter space resolution  bucket size  would allow  actual a=1  computed a=1 . the second surviving orientation hypothesis  found  a very large diameter torus  a=1  on the straight segment of the hasp. as we mentioned in section 1  it is possible to eliminate hypotheses of very large radius  that is near-cylinders by discarding those very close to the origin of the parameter space. since the length of the parameter vector of the torus on top of the hasp is .1  and the length of the parameter vector for the torus found on the cylinder was .1  the cutoff could easily be adjusted to eliminate such misinterpretations. 
   both orientation hypotheses now voted into location space. the same roc and hit rate were used. the cylindrical segment was not able to find any consistent location  and therefore created no hypotheses strong enough to be considered. the actual torus created 1 hypotheses. only one survived iteration. the surviving center was  1.1 -1   with the actual center at approximately  1 -1 . thus  the system found the results to within one bucket of available resolution. 
   these runs were done on a symbolics 1. with the parameters set as described the entire recognition took roughly utes. generating votes for location space took 1 minutes. in all  1 iterations were needed to prune down the hypotheses. total time for all iteration was roughly 1 minutes  including a rather elaborate trace of system status. 
1. knot 
   the second image is a range image of a knot of coax cable  figure 1  taken using a laser triangulation range finder  technical arts  1 . roc was the range 1 to 1  hit rate was 1%. figure 1 shows the points supporting the winning  and correct  as far as we can measure  minor radius hypothesis. 
   these points were passed thru the orientation/major radius parameter transform. despite the lack of distinct peaks in the histogram of votes  figure 1   the iterative refinement was able to find three distinct clusters  representing competing hypotheses of orientation from different areas of the knot. the strongest hypothesis in each cluster survived iteration. the points supporting them are shown in figures 1  1 and 1. the light coverage is due to the low hit ratios  1%  we had to use. the low hit rate also appears responsible for some regions of the knot not being covered by any hypotheses. 
   figure 1 shows a histogram of the votes the three orientation hypotheses generated in location space. one peak was generated by the segment in fig. 1  and the other peak is an overlap of the votes from both fig. 1 and fig. 1. the two locations which survived iteration correspond well to the center points we expected from those torus segments. 
   running times were somewhat better than those for the lock test case  except for the time to generate votes for orien-
   
1 minutes. computing the surface approximations took 1 tation hypotheses. here the continuously varying curve creminutes. generating the votes for minor r space took 1 ated a very large number of noise hypotheses  and very wide minutes. generating votes for orientation space took 1 min- peaks in the histogram of votes. with the 1% hit rate used 

fig. 1: pixels supporting winning 	fig. 1: pixels supporting winning location. minor radius. 	fig. 1: knot orientation votes / 1d projection. 
1 	vision 

fig. 1: pixels supporting orientation fig. 1: pixels supporting orientation fig. 1: pixels supporting orientation hypothesis 1. hypothesis 1. hypothesis 1. 
   
here  roughly 1 hypotheses were created. linking them took well over an hour. with somewhat higher hit rates  1 hypotheses were created. many hours were needed to create and link them. 
1. discussion 
   these experiments demonstrate the ability to break a continuously varying curve into piecewise toroidal segments  to deal with non-toroidal surfaces and cylinderical segments. we hope that speeding the implementation and a future port to faster hardware will improve the coverage  but these results are very promising. 
   system parameters must currently be adjusted for each image. an initial setting generally gives either impossibly long running times  due to the number of hypotheses created  or poor coverage of points supporting the winning hypotheses. the latter makes recognition in subsequent parameter spaces difficult. roc and hit rate can generally be adjusted for good coverage in reasonable time  but it takes several attempts. a faster implementation would allow us to use all triples and a wider roc  especially in minor radius space. we believe this would almost eliminate the need to tune system parameters. 
acknowledgments 
   this work was performed while the first author was partially supported on sabbatical leave by ibm hawthorne; additional support was provided by the defense advanced research projects agency  contract n1-c-1. we thank sanjaya addanki  ruud bolle  andrea califano  and rakesh mohan for their generosity and insight. we especially are grateful to another visitor  russell w. taylor  for many useful discussions over donuts  and anti-donuts. 
