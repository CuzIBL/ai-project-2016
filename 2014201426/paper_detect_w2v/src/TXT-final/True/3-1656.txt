
mobile robot map building is the task of generating a model of an environment from sensor data. most existing approaches to mobile robot mapping either build topological representations or generate accurate  metric maps of an environment. in this paper we introduce relational object maps  a novel approach to building metric maps that represent individual objects such as doors or walls. we show how to extend relational markov networks in order to reason about a hierarchy of objects and the spatial relationships between them. markov chain monte carlo is used for efficient inference and to learn the parameters of the model. we show that the spatial constraints modeled by our mapping technique yield drastic improvements for labeling line segments extracted from laser range-finders.
1	introduction
building maps of indoor spaces is an extremely important task in mobile robotics. over the last years  the slam  simultaneous localization and mapping  community has made tremendous progress in the development of efficient and highly accurate map building techniques. most of these techniques focus either on capturing the metric layout of an environment with high accuracy  eliazar and parr  1; konolige et al.  1  or on representing the topological structure of an environment  kuipers  1 . while metric maps have the advantage of being well suited for robot navigation tasks  they are typically unstructured and contain no information about the different types of places or objects in an environment. topological approaches  on the other hand  are more compact and expressive in that they describe significant places in an environment. however  these techniques often ignore valuable metric information and they still lack the ability to describe individual objects in an environment.
　our goal is to build on the progress made in metric mapping and to enhance metric maps with semantic information about different objects in an environment. object-based representations have much higher expressive power in that they combine metric accuracy with a semantic description of an environment. in addition to allowing more natural interfaces between humans and robots   take the third door on the right    they enable robots to perform better reasoning  especially about dynamic objects such as doors.
　recently  anguelov and colleagues made important steps toward building such maps by developing techniques for detecting and labeling objects in metric maps. in  anguelov et al.  1   they showed how to learn models of nonstationary  free-standing objects such as rectangular or round boxes. to overcome the limitations of this technique  they then developed a generative bayesian approach for detecting doors and walls in a hallway environment  anguelov et al.  1 . while this approach yields good results for labeling line segments extracted from laser range-scans  it has limited capabilities in modeling context information. even thoughthe approachcan express informationsuch as all doors share the same width and color  it can not model more complex  spatial relationships between objects. as  murphy et al.  1  showed for scene analysis in computer vision  such context information can be extremely useful for distinguishing between different types of objects. in mobile robot map building  for example  an object standing in the middle of a hallway cannot be a door  even if it has the same width and color as other doors in the hallway.
　in this paper  we show how to reason about the appearance of and spatial relationships between objects so as to build metric maps with object representations. we denote the resulting mappingparadigmrelational object maps  romaps for short. ro-maps build on relational markov networks  rmn  to represent hierarchical structure and the relationships between objects. rmns are undirected graphical models that are learned discriminatively  taskar et al.  1 . they provide an extremely flexible framework for describing and reasoning about relations. our ro-maps detect objects such as doors and walls by a combination of features  including appearance features such as the width of a door  neighborhood features describing what type of objects are next to each other  and spatial features such as the indentation of a door relative to the wall. in our experiments we show that the parameters of ro-maps can be learned from a set of hallways and then be successfully applied to labeling the objects in a
　hallway of a different environment.
　this paper is organized as follows. after providing background on rmns  we will show how ro-maps model object appearance and the spatial relationships between them. inference and parameter learning will be discussed in section 1. experimental results are presented in section 1  followed by conclusions and a discussion of future work.
1	relational map building
this section describes rmns and several extensions that make them applicable to the problem of mobile robot map building. we denote the resulting framework ro-maps  short for relational object maps.
1 relational markov networks we will now briefly review the basic ideas of relational markov networks  more detailed information can be found in  taskar et al.  1 . rmns are an extension of conditional random fields  crfs   which are undirected graphical models that were developed for labeling sequence data  lafferty et al.  1 . crfs are discriminative models that have been shown to out-perform generative approaches such as hmms and markov random fields in areas such as natural language processing  lafferty et al.  1  and computer vision  kumar and hebert  1 . rmns extend crfs by providing a relational language for describing clique structures and enforcing parameter sharing at the template level. thereby rmns are an extremely flexible and concise framework for defining features and relationships that can be used in our map building context.
　specifically  an rmn consists of three parts: a schema e for the domain  a set of relational clique templates c  and corresponding potentials Φ. the schema e specifies the set of classes  i.e.  entity types  and the attributes in each class. in the map building context  the classes are types of objects  such as walls or doors  and the attributes describe their physical properties. an instantiation i of a schema specifies the set of entities for each class and the values of all attributes for each entity. in our case  i is an ro-map consisting of line segments extracted from laser range-scans. a relational clique template c （ c is similar to a query in a relational database. it selects tuples from an instantiation i; the query result is denoted as c i . in an ro-map  for example  a clique template can select all wall or door objects on one side of a hallway.
　each clique template c is associated with a potential function φc vc  that maps values vc of variables in the clique to non-negative real numbers. using a log-linear combination of feature functions to define these potentials  we get the following representation: φc vc  = exp{wct ，fc vc }  where fc   defines a feature vector for c and wct is the transpose of the correspondingweight vector. for instance  a feature could be the indentation of a door  defined on a clique template selecting a door and wall objects on one side of a hallway.
　for a specific instantiation i  an rmn defines a conditional distribution p y|x  over labels y given observations x. to compute the conditional distribution of a label vector y  the rmn generates an unrolled markov network  in which the nodes correspond to the entities. the cliques of the unrolled network are built by applying each clique template c （ c to the instantiation  which can result in the generation of several cliques per template. all cliques that originate from the same template must share the same weights wc.
the resulting cliques factorize the conditional distribution as
		 1 
== 	 1  where the normalizing partition function z x  =  follows by moving the
products into the exponent and combining all summations into w and f.
　for efficient inference in rmns   taskar et al.  1  suggest using  loopy  belief propagation. however  because of the extensions described below  we cannot apply belief propagation directly. instead  we will show how to perform efficient inference and learning using mcmc.
1	relational object maps
in the most general form  ro-maps represent an environment by a hierarchical collection of objects and relations between them. ro-maps estimate the types of objects under the assumption that their locations are known. this assumption is justified by the progress made by the slam community  which focuses on the problem of concurrently estimating the pose of a robot and the locations of sensor measurements. such techniques generate well aligned laser range-scans even for large scale environments  e.g.   eliazar and parr  1; konolige et al.  1  .
　we introduce an extension of the relational framework of rmns to reason about physical objects in ro-maps. the ro-map of a specific environment is modeled by an unrolled markovnetwork. each node in such a networkcorrespondsto an object or geometric primitive  and the links between nodes represent relations between these objects.
objects: the basic building blocks of ro-maps are geometric primitives such as line segments extracted from sensor data. these primitives typically describe objects such as doors or wall segments. more complex objects can be generated from existing ones by a process we call physical aggregation. this process first selects all objects with a certain property  just like relational clique templates do in rmns   and then computes the parameters of the aggregated object. for example  physical aggregation generates a wall object by selecting all wall segments on one side of a hallway  followed by the computation of the line parameters and color distribution describing the wall. the left and right wall of a hallway can be aggregated into a hallway object  which has parameters such as orientation and width.
relations between objects can be spatial  such as  distance from each other   or appearance based  such as  similar color . relations can be defined on basic objects and objects generated by  multiple  physical aggregations. relational clique templates of rmns can be used to define ro-map relations. for example  to consider the similarity between the widths of the doors in a hallway  ro-maps use a clique template c that first selects all objects that are labeled as doors  such selections are defined via sql queries on the objects  taskar et al.  1;

figure 1: upper graph: endpoints of laser range-scans observed in a hallway. the points line up very accurately due to the position correction performed by a scan matching procedure. middle graph: line segments extracted from the scans. wall segments are shown as dashed lines  doors as solid lines  others as thin black lines. lower figure: markov network with example cliques generated for this specific labeling. thin solid lines define neighborhoods. the doors in the upper part of the hallway are linked by the door variance clique template. the wall object is generated by physical aggregation  dashed lines . it is linked to doors by the door indentation clique template  solid lines .liao et al.  1  . the widths of the selected doors define the value vector vc of this clique  which is then fed into the feature function fc   that computes the variance. the potential of the clique  φc vc   is given by exp{wc ， fc vc }  where wc is the feature weight.
ro-maps are illustrated in figure 1. the upper plot shows laser range-scans observed by a robot traveling down a hallway; the middle plot shows the labeled line segments extracted from these scans; and the lower plot shows the nodes in the corresponding ro-map along with some of the undirected links generated by the clique templates for this labeling. among others  the figure shows two cliques generated by the template that measures the indentation of doors. the template generates pairs of doors and the corresponding wall object. the potential of the clique is then based on the distance of the door from the line representing the wall. more details on features for detecting doors and walls will be given in the experimental results section.
1	inference and learning
1	inference: labeling objects in ro-maps
the goal of inference is to estimate the labels  types  of the objects represented in an ro-map. inference in ro-maps is more complicated than in regular rmns. this is due to the fact that the clique structure of the markov networks generated by ro-maps depends on the unknown labels of objects  and thus changes during inference. since it is not clear how  loopy  belief propagation can be applied to such labelspecific cliques  we use gibbs sampling  an mcmc technique  for inference  gilks et al.  1 . whenever the label of an object is changed during sampling  we determine all  aggregated  objects and cliques that could be affected by this change and re-compute their parameters and potentials. to initialize a markov chain  we randomly assign labels to the basic objects in the ro-map. based on these labels  we generate all aggregate objects and their parameters. finally  the relational clique templates generate the cliques of the unrolled  fully instantiated markov network.
　at each mcmc step  we update the label of a randomly selected object by sampling from the conditional distribution
　　p yk | y k x w  『 exp{wt ， f x y k “ yk }  1  where k is the index of the object  yk is one of its possible labels  and y k are the labels for the other objects. to compute the probabilities of the different labels yk  we update the cliques and the parameters of aggregated objects involving the object k. even though this process can become inefficient for highly complex ro-maps  inference on our current test hallways is very efficient  as we will describe in section 1. we expect further efficiency gains by more elaborate sampling techniques.
1 learning: determining feature weights the parameters of ro-maps are the weights w of the features that define the clique potentials. the key idea of our technique is to learn these parameters from a set of labeled environments  and then apply the learned weights when the robot explores a new environment.

figure 1: examples of hallways used for learning and testing. line segments were labeled manually as door  wall  or other.　the details of our learning technique are beyond the scope of this paper  more information is given in  liao et al.  1 . in a nutshell  the weights are learned by minimizing the negative log-likelihood of the labeled training data collected in n environments:
w
 1 
	j=1	σ1
here  j is the index of map mj  and yj are the labeled objects in the j-th map. the rightmost term avoids overfitting by imposing a zero-mean  gaussian shrinkage prior on each component of the weight vector  taskar et al.  1 . since  1  is convex  we can determine the global minimum using a quasi-newton method  where the value and gradient of l w  are determined by mcmc sampling  liao et al.  1 .
　the outcome of the learning procedure is a set of feature weights that best represent the appearance and spatial constraints of the training maps by maximizing the classification rate. ro-maps inherit the important benefit from rmns of automatically enforcing parameter sharing between  aggregated  objects and relations of the same type. this  smoothing  over instances of classes provides a very powerful tool for dealing with sparse training data.
1	implementational details and experiments
we evaluated ro-maps on the task of labeling line segments extracted from laser range-finder scans collected by a robot traversing a hallway. the data sets were taken from the radish robotics data set repository  howard and roy  1 . we took two to three hallways from five different environments each and manually labeled the extracted and aligned line segments into the three categories door  wall  and other. line segments were extracted using the technique described in  gutmann and konolige  1 . some of the test hallways are shown in figure 1. to perform the labeling  we relied on our experience in typical layouts of hallways. in several cases  we were not sure about the labeling or were only able to label doors based on the fact that we knew the real buildings represented by the maps.
1	features
to label the line segments in the hallways  we implemented various features. the features were represented by the loglikelihood of the measured values under a generative model. this approach allows our technique to automatically take variability between different features into account.
physical aggregation wall objects are the only physically aggregated objects in our current system. wall objects are lines that are generated from line segments that are labeled walls and are on the same side of a hallway  see figure 1 . the wall object parameters can be computed efficiently from the parameters of the line segments.
local features describe appearance properties of objects. in ro-maps  such features are modeled by generating a clique for each object and the corresponding attribute. we use the length of line segments as a feature. the corresponding feature functions return the log-likelihood of a specific lengthgivena gaussian representingthe distribution over lengths  conditioned on the object type. the means and variances of the gaussians for doors  walls  and others were estimated from the labeled maps. in our frameworkit is straightforwardto add other features  such as the color of objects  anguelov et al.  1 . unfortunately  the radish data sets do not contain camera information.
aggregated wall objects have a feature that measures the alignment of the line segments that make up the wall object. alignment is measured by the average distance of the line segments from the aggregated wall line. this feature helps ro-maps to label line segments as walls only when they are well aligned with other wall segments.
neighborhood features describe which object types are located next to each other. for example  it is common to observe a wall segment next to a door  but uncommon to find many doors in close proximity to one another. we compute a line segment's neighborhood by determining all other segments with endpoints within 1 cm. neighborhood features are then modeled by binary indicator functions on the possible label pairs  e.g.   ww    wd    do  .
spatial features describe the relative position of objects. the indentation of a door object is computed relative to the aggregated wall object on the same side of the hallway. indentation is given by the minimum distance between the door line endpoints and the wall line  thereby estimating indentation at the hinge point of a door. as with line width  the indentation feature function returns the log-likelihood under a gaussian indentation model estimated from the training maps.
unless an object is a wall segment  it is highly unlikely

figure 1: hallway with the highest classification error. the doors in the lower half of the hallway are wide double doors with very large indentations. since none of the other training environments contained such doors  our approach labeled them as other. some of the open double doors were detected as doors. all doors in the upper half and all walls  dashed lines  are labeled correctly.to be both very close and well-aligned with a wall object. ro-maps detect other objects by considering the distance and angle alignment of such objects relative to the closest wall object. to compute the likelihood of specific distances and angles  we estimate discrete distributions from the training maps  these distributions are typically non-gaussian .
global features depend on multiple objects that are potentially far apart. in our experiments  we measure the similarity of the indentations of all doors in a hallway by computing their variance.
1	experiments and results
to test the performance of our learning method  we used 1fold cross-validation on the five environments extracted from the radish repository. to do so  the model parameters were trained on labeled hallways from four environments and then tested on the remaining one. training on a set of 1 hallways took 1 hours. to generate the statistics needed for each iteration of the quasi-newton optimization technique  we ran a gibbs sampler for 1 iterations on each training map. the final 1 samples from each chain were used to compute differences between the sampled feature values and the feature values extracted from the labeled maps. these differences were then used to compute the relative  negative log-likelihood  1  and the gradient.
　testing  that is  labeling of the objects in an unknown map  was very efficient and took around one minute or less on average. for each environment  the labeling error rate was determined by comparing the most probable assignment to the manually generated label. most probable assignments were extracted from the markov chains by counting the different labels for each object. the label with the highest count was compared to the ground truth. to gauge the importance of different features for labeling the objects in these hallways  we varied the set of features we used.
environm.lengthslengths + neighborsall1.1%1%1%1.1%1%1%1.1%1%1%1.1%1%1%1.1%1%1%table 1: average accuracy rates on maps using different features.
table 1 summarizes the results. the numbers give the accuracy rates of the labels  averaged over the two hallways of each test environment. the leftmost result column gives the accuracy rates achieved when using only the lengths of line segments to distinguish between the different object types. the next column summarizes results obtained when considering length and neighborhoodfeatures. the resulting models are similar to standard hmms or mrfs in that they consider local appearance features  length  and connect neighboring objects. as can be seen  object neighborhood improves the results significantly. furthermore  these results indicate that the labeling task is by far not trivial. the last column presents the accuracy rates achieved when using all features discussed in the previous section. the results show that the additional consideration of spatial constraints such as door indentation improves the classification performance by a large margin.
　figure 1 shows the hallway with the highest classification error  environment 1 . as can be seen  most of the doors along the lower wall of the hallway are mislabeled as other. however  this is not surprising given that the indentation of these doors is far larger than in the other training maps. furthermore  most of these double doors are closed  which results in very long line segments. thus  the labels are very reasonable  given the training data available to the approach.
truthinferred labelswalldoorotherwall11door11other1table 1: confusion matrix  counts .
　table 1 shows the confusion matrix summarized over all test environments using all features. the table shows that most errors are due to confusion between others and walls  and others and doors. walls and doors are rarely confused. the overall accuracy rate is 1%. this is a very encouraging result  especially since several maps contained objects for which even humans were uncertain about the correct labeling.
　it shouldbe notedthat  anguelovet al.  1 achievedrelatively high accuracy using a hierarchical bayesian approach without spatial constraints. this is due to the fact that they trained model parameters in the same environment and took visual color information into account. adding such appearance information to ro-maps is straightforward and we expect strong improvements from such additional information.
1	conclusions and future work
we introduced relational object maps for mobile robot mapping. ro-maps use relational  discriminative techniques to generate metric maps with semantic object representations. ro-maps build upon and extend relational markov networks so as to reason about the appearance of and the spatial constraints between objects in an environment. in order to distinguish between different types of objects  ro-maps can incorporate a variety of features  ranging from global  such as the width of all doors in a hallway  to spatial  such as the indentation of a door. to handle the changing structure of the markov networks instantiated by ro-maps  we showed how to perform inference and parameter learning using mcmc. during learning  ro-maps benefit from automatic parameter sharing provided by relational clique templates. this allows the models to be trained from relatively sparse training sets.
　experiments in five different environments demonstrate that ro-maps are able to achieve high accuracy in labeling objects in previously unknown hallways. we show that the accuracy is improved drastically by taking spatial constraints between objects into account. these results are particularly encouraging given that objects are labeled based on laser range-data only.
　ro-maps provide an extremely flexible framework for combiningmetric accuracywith the representationof individual objects and structures in an environment. we believe that ro-maps are an important step toward more expressive  semantic representations of environments. however  the work presented here is only the first step in this direction  laying the foundation for future research projects.
　our current implementation relies on line segments extracted from laser range-scans as the building blocks of romaps. as shown by  anguelov et al.  1   color information extracted from cameras strongly improves the performance of object classification. the flexibility of our framework allows us to integrate such additional appearance information without modifications to the underlying ro-map concept. we observed significant improvements in initial experiments with a camera pointed toward the walls. we additionally plan to improve line segmentation by incorporating segmentation into the ro-map inference process. thereby  high-level information provided by the ro-map can guide range-scan segmentation.
　the ro-maps presented here model objects in individual hallways only. a key next step will be the extension to more object classes and multiple  connected hallways  rooms  and open spaces. the ro-map framework enables the definition of high-level structures such as hallways or rooms using the notion of physical aggregation. we are currently developing hierarchical representations and inference techniques that label both high-level structures and individual objects within these structures.
1	acknowledgments
the authors would like to thank jeff bilmes for fruitful discussions during the early stages of this project. this research is sponsored in part by the national science foundation  career grant number 1 .
