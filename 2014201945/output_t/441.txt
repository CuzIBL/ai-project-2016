            insideoutside probability computation belief propagation                                                 taisuke sato                                       tokyo institute technology                             ookayamaˆ  meguroku tokyo japan                           abstract                          bns  sato kameya  mcallester et al                                                         chavira darwiche  propositionalization      paper prove wellknown cor   mean represent discrete random variable having val      respondence forwardbackward algo                                                        ues vvn set xv xvn  mutually ex      rithm hidden markov models hmms                                                        clusive binary random variables xvi true iff      lief propagation bp applied hmms gen    vi  ≤ ≤ propositionalization explodes      eralized bp junction trees number states bn beneﬁt      generalized insideoutside probability compu weighs explosion makes possible share com      tation probabilistic logic programs applied putation ﬁner grain size valuedependently runtime      junction trees                                   dynamic programming rule  probability compu                                                        tation compile time explains omit details    introduction                                       probability computation polynomial time                                                        expected direct application bns pcfgs pyna  bayesian networks bns probabilistic context free dath wellman  carried time  grammars pcfgs basic probabilistic frameworks sentence length prism casefactor  uncertainty modeling bns statistical natural lan diagrams cfds mcallester et al   guage processing respectively indepen follows ﬁrst review basic notions section   dently developed strong indication close prove main theorems series lemmas sec  relationship example include hidden markov mod tion  space limitations description sketchy  els hmms common subclass furthermore belief prop reader assumed familiar logic program  agation bp applied hmms coincides forward ming doets  bp junction trees jensen   backward algorithm hmms smyth et al  lauritzen spiegelhalter  shafer shenoy   specialization probability computation used inside prism probabilistic logic programming language used  outside io algorithm pcfgs baker  nonethe paper detailed sato kameya   exact correspondence  known knowledge                                  background    paper upgrade correspondence prove  insideoutside probability computation io algo  bayesian networks junction trees  rithm generalized probabilistic logic programs                                                        bayesian network bn directed acyclic graph deﬁn  applied junction trees yields bp particular prove                                                        ing joint distribution  xxn  xn   collecting evidence resp distributing evidence bp                                                        Π   xi   xi  Πi   πi nodes random  coincides computation inside probabilities resp                                                        variables xxn node xi parent nodes  outside probabilities generalized io computation                                                        Πi  xs  xs  ≥  conditional probability table    prove computational correspondence bns                                                                     representing conditional distribution xi  xi  Πi  πi  pcfgs uniﬁed manner need general language                                                        associated xi  ≤ ≤ lower case  bns pcfgs choose prism sato                                                        letter xi denotes value xi similarly πiwe  kameya  ﬁrstorder probabilistic language                                                        denote range xi rxi direct product  purpose need “propositionalization”of rx ×···×rx       rΠ           ∈ rx                                                                        sk    write                                                            πi ∈ rΠi use xxn       assume paper bns discrete bp               π   normalization                                                     consider                                                                         π         ∪π    note bns propositional framework deal function itheset called argu  ﬁnitely random variables pcfgs allow recursion ments xi  πiletα  ssk set  deal inﬁnitely random variables describing prob variable indices ⊆n xα stands set                                                                                   α       abilistic choices sentence derivation           variables       sk  example                                                                ijcai                                                    xα  xxx notation extends vectors    ∈ rv  introduce ground term iden    junction join tree ve bn isatreesat  tiﬁer ground msw atom mswi  isfying following conditions node set xα true iff outcome nth trial named vhere  variables bn follows use xα natural number iids represented set  dex set α interchangeably edge connecting α β mswi  ∈ rv   msw atoms                                                                                                   labeled α ∩ β second xxn Πα∈v φαxα   msw atoms satisfy certain conditions  prob  hold φαxαapotential function prod ability mswi true called parameter  uct conditional distributions prism program db  ∪ consists set  arguments included xα condition run deﬁnite clauses head msw atom set  ning intersection property rip dictates nodes msw atoms base distribution pf deﬁning  α β common variable contained probabilities parameters msw atoms  simple distri  node path α β rip ensures butions deﬁnable soley terms msw atoms com  conditional independence subtrees given variables plex distributions constructed using deﬁnite clauses  node key property efﬁcient probability com semantics db deﬁnes probability measure pdb ·  putation bp given bn junction tree constructed set herbrand interpretations distribution seman  way triangulation variable elimination jensen  tics sato kameya  consider pdb ·  kask et al  lauritzen spiegelhalter  distribution ground atoms    pcfgs insideoutside probabilities                                                          propositionalization through tabled search  pcfg cfg probabilities assigned produc                                            tion rules way nonterminal rules approach pdb probability atom   →  αa  →  αn  probability pi assigned ﬁned program db  computed steps ﬁrst                            n  →  αi  ≤ ≤ nand pi holds pi step propositionalization apply sld refutation pro  probability choosing → αi expand probabilis cedure doets  db ⇐ topgoal search  tic derivation pcfgs basic tool statistical natural sld proofs reduce logically equiv  language processing include hmms subclass   alent propositional dnf formula ∨··· ∨ ek    let ai denote event nonterminal prob ei  ≤ ≤ kanexplanation conjunction  abilistically derives substring wiwj sentence ground msw atoms record probabilistic choices   wwn  ≤ ≤ ≤ probability ai process constructing sld proof each  called inside probability ai deﬁned msw atom represents probabilistic event   sum products probabilities associated rules random variable  second step compute  derivation belonging ai similarly outside proba probability pdb gpdb ∨···∨ek  bility ai wrt sum products probabil general exponentially proofs  ities associated rules used derivation starts explanations naive proof search produce  start symbol derives wwi−awjwnthe  exponential size dnf fortunately introduc  product insideoutside probabilities ai gives ing tabling ﬁrst step produce equiva  probability deriving ai insideoutside probabil lent polynomial size boolean formula common                                                    ities computed dynamic programming time ol  subexpressions ei’s factored tabled atoms  generalize insideoutside probabilities context factored formula explg set conjunction  probabilistic logic programming                   deﬁnitions form ⇔  tabled atom                                                         deﬁned conjunction tabled atoms    probabilistic logic programming language         msw atoms assume deﬁning relation       prism                                            tabled atoms acyclic convenience think  brieﬂy explain probabilistic logic programming lan each deﬁnition andor graph conventionally  guage prism nutshell prism prolog extended explg explanation graph collection  tabling probabilistic builtin predicate called msw multi andor graphs explg stands factored  ary random switch generic parameter learning routine formulas graphical representation  learn parameters embedded program computing  generalized insideoutside probabilities sato kameya  generalized insideoutside probabilities      basic ideas prism propositionalization compute pdb convert each deﬁnition ⇔ ∨                                                        ∨a    explg         ∧···∧b   ∧      ∧···∧  random variables using special builtin predicate msw                mi  msw  let discrete random variable set rv   ground terms range represent proposition                                                                                                require pf mswi ∧ mswi                                                                                                                                                   ∈  rv  pf       mswi     tabling means memoize goals predicate symbol                      v∈rv                                                                                      i  declared table predicate cache successful goals table v∈rv  msw holds alsowhen  later reuse zhou sato  atom containing table  n mswi mswinv independent  predicate called tabled atom                    mswi mswi nv identically distributed                                                    ijcai                                                    mswni  ≤ ≤ numerical sumproduct equation                                                                                              pdb hpdb      a···   pdb al        pdb aipdb     ···pdb bmi ·                               pdb msw ···pdb mswni     note conversion assumes mutual exclusiveness                                                                                   disjuncts aal independence conjuncts     root                                                                                         bbmi  mswmswni  guaranteeing         node  conditions basically user’s responsibility  automatically satisﬁed far prism pro  gram describing junction trees concerned section                              eqg  lemma  denote      set converted           figure  junction tree   ve  equations    ground atom pdb pvariable  pvariables just numerical variables named ground  belief propagation generalized io  atoms assume deﬁning relation tabled atoms  computation  acyclic pvariables eqg linearly ordered  eqg efﬁciently solved bottomup manner section prove generalized io computation  dynamic programming time proportional size computation generalized insideoutside probabili  eqg acyclicity implies higher pvariable ties subsumes bp junction trees  multivariate polynomial lower pvariables  derivative higher pvariable function  program bp messages  lower pvariables                             suppose bn deﬁning joint distribution                                                                                   suppose given program db  analogy xxn   xn Πip   xi  xi   Πi  πi  insideoutside probabilities pcfgs deﬁne gener junction tree ve xxn                                                                                              alized inside probability insidea ground atom Πα∈v φαxαletδ root node            def                                                                          db         ∪  insidea                                        construct prism  program                             db    extend deﬁnition                                                                   def               describes bp  follows  introduce each  junction ground atoms insidew   pdb   conditional probability xi  πi ground msw atom      deﬁne   generalized outside probability mswbni πi oncexiifxi parent πi   outsideg  wrt topgoal follows null list deﬁne ﬁnite set ft msw atoms  enumerate a’s occurrences explg                                                                 def                                                            ft     mswbni πi oncexi             ⇔  ∧    ∨···∨a ∧                                                                  ≤ ≤ nxi ∈ rxiπi ∈ rΠi                ···                                                                        θ           hj ⇔  ∧ wj ∨···∨a  ∧ wjij          set parameters bniπixi                                                          θ          pf mswbni πi oncexi  xi  πi  outsideg  recursively computed eq    bniπixi    outsideg                                     easy joint probability represented                                                                                       conjunction ground msw atoms    outsideg  aoutsideg      insidewj                                                                                                            ··· outsideg   ij  insidew                                                                      jj          xxn pf    mswbni πi oncexi                                                     using eq  outside probabilities computed time introduce atom mswbni Πi oncexi           eqg  size     sato kameya  prove taining variables xi Πi each  ≤ ≤                               insidea · outsidea  ground atom  product                  mswbni Πi oncexi represents conditional distribu                                                                             average number occurrences proof tion xi  xi  Πi  πi  node α junction  deﬁnition generalization usual deﬁnition tree  deﬁne conjunction wαxα representing poten  insideoutside probabilities pcfgs lafferty  tial φαxα α introduce clause cα deﬁning mes                                                        sage atom qαγxα∩γ  describes message bp sent         mentioned pdb pvariable function                                                             pvariables pdb mathematical deﬁnition follows simplicity assume evidence given  outsideg                                      variables observed conclusions remain                                                        valid ﬁxed observed values                                                                                       def ∂pdb                   programming convention follows prolog               outsideg                                                            ∂pdb                     use intentionally xi logical variable                                                        random variable make explicit correspondence gen  derives eq                                   eral msw atoms conditional distributions bn                                                    ijcai                                                                    α                γ                                    ⎧               parent node  respectively deﬁned     ⇐      bn  ∧                                                                        ⎪   γ   msw                                                                                       ⎪                         def                                            ⎪          mswbn xxx∧                wαxα                 mswbni Πi oncexi        ⎪                              xiπi∈φα                              ⎪                                  def                                                 ⎨⎪          αγ                              ⇐   ∧                 α      αγ   α∩γ      α   α                                qαγ xx ⇐                                                                    rt                            qβ αxβ  ∩α ∧···∧qβ  αxβ  ∩α                     bn  ∧                                                                    ⎪     msw                       βα                                                                            ⎪       ⇐                                                                        ⎪   βα                   ββk  ≥  child nodes α    ⎪                                                                        ⎩⎪    mswbn xx ∧                                     wαxα              lemma states     correctly describes          mswbn xx              potential node α proof straightforward omitted              lemma                                                                        figure  deﬁnitions message atoms               pf wαxα                xi  πiφαxα                                ip π ∈φ                                      α                         deﬁnition tabled atom qαγ xα∩γ  node α                                                                   shown                                                                                                                                             δ                                           ⇔            ∧                       root node  parent add special αγ α∩γ         α  α     βiα  βi∩α                                                                                 αγ              parent node  deﬁne δ                                                                                             def                                            xα∩γ denotes arbitrary ground instantiation xα∩γ                 cδ    qδ ⇐ wδxδ∧                                                                    qαγ xα∩γ  represents message sent α γ α’s                              qβ δxβ ∩δ ∧···∧qβ δxβ ∩δ                                                k    k          parent node receiving messages α’s child nodes                                                                  ββk figure               β β  child nodes δ qδ ar                                                                   prove recursive equations eq               guments calls message atom directly indirectly                                                                    “solved” uniquely let tα subtree rooted xα              finally                                                                    xξα set variables appearing tαweﬁrstin                                                                                    ταxξ     α                            def                                     troduce formula    α   eq  rewrite                        rt    cα   α ∈ vt ve              eq  represents potential subtree tα                illustrate small example discrete bayesian             def                                                                             ταxξ             wρxρ                             network bn xx lefthand side fig          α         ρ∈tα                                                                                                 k              ure  junction tree  righthand side             wαxα  ∧      τβ xξ                                                                                                        βi                   root node γ dotted lines bn indicate edges added tri              angulation figure  shows deﬁnitions message atoms lemma                                                                                                                                                       ξ      α ∪    ξ                                                                          α            βi                                                                        ξβi  γ ξβi   α ∪ βi ∩ α  γ rip                                                       px                                                    px                             k                                                                   ξα  γ α     γ ∪    ξβ  α                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               px                      proposition  qαγ xα∩γ      ταxξα                                                                                                       xξαγ                                                                                                                                                       proof wellfounded induction whenα leaf                                                                     proposition obviously true assume true wrt                                                                                                                                                              child nodes α                                                  px                                                                                                                          px                                                                         ταxξ                                                                    α                                                                                                                                     ξαγ                                                                                                                                                         ···     ταxξα  eq                      bn                 junction tree                                                                                                                                                            αγ βα   βk α                                                                          α  γ βi  α’s mutually disjoint                        figure  bn junction tree                  ⎛             ⎛              ⎞⎞                                                                                        k                                                                                  ⎝             ⎝              ⎠⎠                                                                               wαxα ∧           τβ xξ                                                                                                         βi     eq                 explanation graphs bp messages                     xαγ            xξ α                                                                                                βi                 db     ∪                                                                                      let          program constructed subsec                  k              tion  declaring qαγ predicate table predi                                                                               wαxα ∧    qβiαxβi∩α  induction              cate apply tabled search proofs topgoal ⇐ qδ                                                                          xαγ                        δ root node  search terminates                                                                                          yields explanation graph explqδ contains   αγ  α∩γ  eq                qed                                                                ijcai                                                                  bp generalized io computation              proof                                       db  let  db distribution deﬁned          insideqαγ xα∩γ   generalized inside probability  tabled atom                                                                                  db αγ  α∩γ  insideqαγ xα∩γ  generalized outside proba                                 outsideq                                                τ    bility       δ  αγ  α∩γ   wrt δ computed           db        α   ξα   proposition                                                                         xξαγ  using eq  sumproduct computation speciﬁed eq                                                                           τ                                                                       db  α  ξα  lemma   independence conjuncts mutual exclusiveness      ξαγ         disjuncts righthand side eq  guaranteed             ···            ·                                                                                  db  α  α                                                                   αγ  βα      βk α    each msw atom mswbni Πi oncexi occurs                                                                                  τ     wα reﬂecting fact conditional            db βi  ξβ    eq                                                                                    ⎛             ⎞  distribution function xi  πi bn belongs exclu                                                                                k           sively potential φα junction tree wαxα                            ⎝             ⎠                                                                  pdb  wαxα   pdb         τβ xξ   qβ αxβ ∩α’s share msw atoms                                      βi                                                                                  ﬁrst condition independence condition satisﬁed au   αγ                         βiα  tomatically hand proving mutual exclu            k                                                                  φxα   pdb  qβ αxξ ∩α  siveness condition straightforward lemma                          βi    lemma   low assures exclusiveness condition combined   xαγ      proposition                                                       k            ξ  ∩ γ  α ∩ γ                      note α           holds thanks rip sowe            φxα    insideqβ αxξ ∩α                                                                                      βi        qed  rewrite ταxξα                                                                xαγ                  τ  τ                           α  ξα        α  ξαγ   ξα∩γ                         τ                     theorem  tells generalized inside probabilities                           α  ξαα   α∩γ                tabled atoms satisfy exactly equations mes                                                       sages collecting evidence phase bp  lemma   let xξ γ          different                   α           ξαγ                     root node δ jensen  lauritzen spiegelhalter                           ground instantiations ξαγ    arbi   shafer shenoy  bottomup computa  trary ground instantiation xα∩γ of xα∩γ    tion generalized inside probabilities identical bp                           ¬  ταx    xα∩γ  ∧ ταx  xα∩γ                    collecting evidence phase         ξαγ            ξαγ                                                                 let distribution deﬁned bn figure   sketch proof loss generality  equations generalized inside probabilities tabled atoms                                      write  ξαγ          im way ij   junction tree                                            parent node  ik original bn ij pre       xi                       xi  xi     cedes   list ξαγ                          insideqαγ xx  x    x  x                                               ξ γ          im  variable                      bn  ·    α                                                                   db msw                 x      x     x   ≤ ≤                                      is−    is−                                                                                       insideqβα xx  ﬁrst note Πi  ⊆  xξ  holds xi appears                                          α                                         insideq                                                                                      βα      tα conditional distribution xis  Πis              contained potential tα rip second    insideq                                                                       βα              Πi ∩ xξ  γ ⊆xi  xi           α               s− wealsohave                     pdb       bn xx ·                                                                         msw  Πi  ∩ xξ ∩γ  Πi    ∩ xα∩γ   conclude        α                                                                   bn                                   Π                         db msw             facts ξαγ α∩γ instantiates                                                                                                 xis  πis  xα∩γ instantiates xis  Πis            px  · px                     ξαγ                                                 x  π         x           rest immediate  omitted                                     qed     compute generalized outside probabilities                                                        tabled atoms loss generality compute    prove main theorems applying computation  outside probability tabled atom β apply  eq  tabled atoms deﬁned eq  recall deﬁnition generalized outside probability eq   insideap                                   explq                                                  db    ground atom   db         δ noting tabled atom βα β∩α oc  distribution deﬁned db  derive equation curs explqδ eq  obtain recursive equations  satisﬁed inside probabilities tabled atoms     generalized outside probabilities follows    theorem                                            theorem                                                                                                                                        outsideq               φ                                                                    βα  β∩α           α  α  insideqαγ xα∩γ    φαxα   insideqβ αxβ ∩α                             αβ                                                             outsideq      insideq                         xαγ                                            αγ  α∩γ          βiα βi∩α                                                                                                                                                              ijcai                                                    
