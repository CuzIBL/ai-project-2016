           probabilistic reasoning hierarchically structured variables                           rita sharma                                  david poole               department science               department science                university british columbia               university british columbia             httpwwwcsubccaspiderrsharma          httpwwwcsubccaspiderpoole                      rsharmacsubcca                             poolecsubcca                        abstract                          values lt millions species classiﬁed ac                                                        cording linnaean taxonomy hierarchy living things      practical problems random variables     divided kingdoms plantae animalia classes      large number values hierarchi mammals birds ﬁsh way species      cally structured abstraction tree classes paper look related problems hierar      paper considers represent exploit chical variables bayesian networks ﬁrst compact      hierarchical structure probabilistic reasoning representation conditional probability distributions      represent distribution variables spec second exploit representation probabilistic      ifying each class probability distribution inference computational gain assume tree hi      immediate subclasses represent   erarchy values ﬁxed does change      conditional probability distribution variable context      conditioned hierarchical variables using inher  compute posterior probability given evidence      itance present approach reasoning   bayesian network simple hierarchi      bayesian networks hierarchically structured  cal variables construct ﬂat bayesian network col      variables dynamically constructs ﬂat bayesian lapsing hierarchies including values neces      network given evidence query col sary answer query answer query      lapsing hierarchies include values ﬂat bayesian network using standard inference algorithm      necessary answer query   domain size variables ﬂat bayesian network      single pass network answer independent size hierarchies depends      query ﬂat bayesian network using classes hierarchy directly associated      standard probabilistic inference algorithm evidence query      variable elimination stochastic simulation      domain size variables ﬂat bayesian net  hierarchical variables      work independent size hierarchies      depends classes hierar divide discrete random variables cate      chies directly associated evidence gories simple variables hierarchical variableswe      query representation applicable bayesian networks simple hierarchical      hierarchy conceptually inﬁnite       variables hierarchical bayesian networks use upper case                                                        letters denote simple random variables                                                        actual value variables small letters    introduction                                       domain written val set values                                                         problem domains discrete variables large hierarchical variable variable subsets  number values represented priori abstrac values variable represented hierarchically tree  tion hierarchy isa hierarchy taxonomic hierarchy pearl  refer node tree class                                   pearl  mackworth et al   vari nodes tree represent subsets values variable  ables hierarchical variables taxonomic hierarchies allow root tree represents set values  manage effectively large state space variable variable children node correspond partitioning  cause allow facts regularities revealed set values node subsets represented  high low levels abstraction taxonomic hierarchies children class mutually disjoint  information highlevel abstractions automatically class represents union children tree  inherited speciﬁc concepts abstraction hierarchies  allow answer abstract queries example http  wwwwikipediaorgwikilinnaeantaxonomy  hierarchical variable consider random variable lt term hierarchical bayesian network used paper  describes species living things large number different term hierarchical bayesian model used statistics                       livingthing                    specify probability immediate subclass                                                        mammal  given mammal probabilities                              plant                     animal                                 pbatmammal                 reptile            fish                    compute prior probability class recur                                                        sive manner multiplying probability class given                              bird                mammal   insect                         immediate superclass probability immediate su               platypus               penguin             perclass root probability  represents set                   cat bat    sparrow                   values example given probabilities                                                        pbat computed follows                                                          pbat     pbatmammal × pmammalanimal ×    figure  taxonomic hierarchy living things          panimallivingthing                                                                         class cj child ci say cj immediate representation computing probability class  subclass ci subclass relation symmetric transi linear depth class hierarchy  tive closure immediate subclass relation cj function hierarchy’s size  subclass ci written cj ≤ ciifcj descendant ci  abstraction hierarchy ci inverse subclass  hierarchical variable parent simple  superclass conjunction classes cj ck written variable  cj ∧ ck denotes set intersection cj ck  unless superclass        suppose hierarchical variable simple vari    denote hierarchical variables using boldface upper able parent exploit hier  case letters lt example tree hierarchy archical structure assuming inﬂuence local                                                      hierarchy specify conditional probabil  values variable lt shown figure  tree lt denotes                 tree hierarchy lt                             ity distribution cpd use notion default                                                        probability distribution default probability distribution                                                                                      conditional probabilities hierarchical          class cj written pd cj  assumed inherited                                                        subclasses cj unless overridden speciﬁc     bayesian networks                                  default probability distribution represent pfh                                                                        main issues considered represent hier specifying pd cj classes cj hierarchy  archical bayesian networks                           classes cj exceptional classes idea                                                        using “inheritance” abstraction hierarchies similar  specifying conditional probability hierarchical use “context speciﬁc independence” compact      variables                                        representation cpts bayesian network boutilier  specifying variables conditioned hierarchical et al       parents                                            make properly deﬁned need ensure    simplest case specify prior prob terminal node tree hierarchy covered  ability hierarchical variable simplest case default probability distribution union sets                                                        values associated exceptional classes equal  specify conditional probability simple variable    conditioned hierarchical variable complicated val  condition holds trivially root class  cases built simpler cases             exceptional class root class exceptional                                                        class exceptional class path    prior probability hierarchical variables     root                                                          conditional probability class  prior probability hierarchical variable speci                                                                                           pfc  computed follows  ﬁed topdown manner each class subclasses  specify probability distribution immediate sub •ifck does exceptional subclasses pfck  classes example suppose want specify prior inherited default probability distribution  hierarchical variable lt shown figure  lowest exceptional superclass cj ck  root hierarchy class livingthing specify                                                                           pfc   fc   probability distribution immediate subclasses                                     panimallivingthing                            • pfck derived children      pplantlivingthing                                                                                                                pfc               pfc  × pc   specify probability distribution immedi                                                                                                          ∀ ∈         ate subclasses animal suppose                ci children ck  distribution                                         example consider bayesian network hierarchi      pmammalanimal                              cal variable lt parent simple variable flying      pbirdanimal                          domain ﬂying ¬ﬂying represent pflyingltwe need deﬁne default probability distributions                               location                                                                    loc  flying exceptional classes lt example                               land  ocean  state livingthings low probability ﬂying    default bird insect exceptional                     northern  southern                                                                                          equatorial hemisphere  high probability ﬂying children class mam     lt               hemisphere    malabat exceptional high probability                  n−temperate n−polar s−temperate s−polar  ﬂying children class birdapenguin excep flying     layseggs  tional low probability ﬂying             tree hierarchy location earth  represent pflyinglt                                                        ﬂyinglivingthing                                                        figure  aa bayesian network simple hierarchical      ﬂyingbird                                                        variables tree hierarchy loc      pdﬂyingbat        pdﬂyingpenguin        pdﬂyinginsect                              hierarchical variable loc represents location  note pﬂyinglivingthing   class liv earth simple variable represents season figure   ingthing contains bird bat each higher shows hierarchy location consider  probability ﬂying                                 values northern hemisphere summer                                                        – october winter november – april prob    general case                                 ability distribution class animal lt immediate                                                        subclasses conditioned parents suppose  general case random variable hierarchical distribution class animal equatorial region  simple number kind variables dependent season parent context  equatorial  parents represent cpd hierarchical variable default distribution  conditioned parents assume each class                                                                          ∧       hierarchy probability distribution immediate pd reptile animal                                                                           ∧       subclasses conditioned parents pd insect animal                                                                             ∧       treat each classes simple variable pd mammal animal    problem representing conditional probability dis polar regions distribution class animal  tribution hierarchical variable reduces problem children depends season parent context   representing conditional probability distribution − polar default distribution  simple variables                                                           pdreptileanimal ∧  summer ∧      let simple variable simple hier mammalanimal ∧  summer ∧                                                           archical parents suppose pa denotes simple parents insectanimal ∧  summer ∧    suppose pahf denotes hierarchical parents  let denote assignment class each hierarchical                                                  construction flat bayesian network  parent parent context cx  cx                                        th             observation hierarchical variable posi  cx class tree hierarchy hierarchical  parent                                        tive negative observation positive    represent fpas ∧ pah specify default observe cobs cobs class hierarchy                                                                                                     ∈  probability distribution different combinations means value vh vh cobs  values simple parents pasf parent contexts observation negative observe                                                        ¬                                            ∈  given parent contexts parent contexts cobs means value vh vh cobs  fault distribution deﬁned represented loss generality assume                                                                                              concept hierarchy cp partial ordering cp  zp ≤ positive observation  denoted pos ex                                                                                                       zp set given parent contexts parent context ample suppose positive observations    ∈ super parent context parent context written classes disjoint observations                                                                                                    ∧  ≤ xif∀i  ci ≤ ci  conditional distribution consistent subclass                                                    equals negative observations  parent context inherited default probability                                                        assume root class positive observation  distribution super parent context                                                      multiple negative observations descendants  overridden speciﬁc default probability                                                          hierarchy  distribution parent context ≤  pos                                                          assume query asks distribution  example consider bayesian network shown figure  simple variable probability particular class                                                        hierarchical variable    assume mostspeciﬁc super parent                                                          given evidence set observations query  text mostspeciﬁc compatible parent                    texts different default probability distributions construct ﬂat bayesian network  hierarchical                                                                          default distribution disambiguates default distributions bayesian network replacing each hierarchical variable  forcing user disambiguate cases simple variable domain includes val  problem multiple inheritance ues necessary answer query state space hierarchical variable abstracted given                                                                                croot  problem certain classes supported directly               true                                                evidence relevant query construct                                                                                                    given evidence query traverse              false  leaves upwards prune variables irrelevant             swer query abstract hierarchical variables              abstract hierarchical variables pass remove                 cpos    variables irrelevant query                        recursively prune variable chil                    dren observed queried geiger et al               cneg            cneg  pearl  abstract hierarchical variables  children abstracted answer  query ﬂat bayesian network using standard prob                                                                                         abilistic inference algorithm                        figure  abstraction hierarchy divided three                                                        regions positive cpos negative cneg    abstraction hierarchical variables            cneg observations  let hierarchical variable values val ab  straction domain denoted parth partition respect each children classes  val parth set subsets val associated evidence query domain                                                      ha set nonempty abstract values each excep  sets mutually disjoint union                                             sets equals val refer set parth tional class algorithm computes abstract value   abstract value hanabstraction hierarchical exceptional class ck follows                                                            variable denoted  simple variable domain •  ckifck does exceptional strict sub  val ha  parth                                       classes                                                           • va  − − −     finding safe abstraction                                                                                                                             highest exceptional strict subclasses ck  section simple algorithm flatbayes set difference represents set values                                      constructing ﬂat bayesian network hierarchi ck covered abstract values                       cal bayesian network given evidence query abstract values removed  safe abstraction posterior distribution main ha recursively abstract parents                       query variable  develop safe abstraction algorithm ﬁnds strict super classes exceptional  efﬁcient inference following constraints followed classes ck affected h’s parents  flatbayes  evidence query                                                        case observed  abstract value directly associates evidencequery                                                        observations divide tree hierarchy three  conveys effect  abstract values mutually                                                        regions includes classes true  disjoint exclusive algorithm flatbayes consists                                                        observation superclasses  includes classes  three phases                                                                     pos                                                        know includes classes  phase                                               know false example suppose positive  query asks probability particular class cpos negative cneg cneg observations  hierarchical variable create extra binary child shown figure  regions shown  true exactly query true bold lines figure  need distinguish                                    pd    true croot   pd   true cq      values know false values  croot root class cq query class tree hi partitioned disjoint exclusive subsets  erarchy variable probability vfalse corresponds values false  query class reduce problem computing vnotknow corresponds values know  probability simple variable                                                                                         phase abstract                                                             vfalse  croot − cpos ∪ negative observations  phase flatbayes traverses bh leaves                                                                                                           −  negative observations  wards  prunes variable queried ob     notknow   pos                                                                                  served does children geiger et al  val     vnotknow vfalse  pearl  each unpruned hierarchical variable children need partition abstract value  algorithm computes abstraction ha follows     vnotknow subsets based evidence children  case observed                              need ﬁnd exceptional classes ck respect                                                        children region hierarchy hwe  hierarchical variable parent simple                                                                            compute abstract value vo corresponds each  variables need ﬁnd exceptional classes ck                                                        exceptional class ck way described case    note bottomup nature algorithm need remove false values                                                              simple children stage algorithm vo  − negative observations subclasses ofck                                                        let vo    vok nonempty abstract values cor let xs nonquery nonobserved random vari                                        ∪ ∪                    respond exceptional classes ck let vr vo  vok ables  pa xi denotes parents variable xi                     −                  marginal pq ∧ computed follows  val     vo    vok vnotknow vr vfalse    recursively abstract parents algorithm ﬁnds                  n                                                                ∧   ∈                     strict super classes exceptional classes ck cpos                 xi pa xi e∈e  affected h’s parents                                                                            xs     phase construct tables                                                        lemma   posterior probability pqe computed  algorithm constructs cpt variables xa ﬂat                                                        bayesian network replacing variables  network let paaxa denote abstracted parents xa                                                                                                   abstractions xa computed  compute pxa  vapasxa  ∧ paaxa                                                                          replacing  xa constructed partitions  each value va xa each assignment pasxa                                                                      partx  following property   paaxa following cases                case xa abstracted abstracted parents    ∀xk ∀yj ∈ childrenxk ∀v ∈ partpayj                                     ∧  discussed section   pa      vs       ∀v ∈ pyjpayj   pyjpayj    paaxa  inherited default distribution xa                                                        proof sketch summing values equivalent  parent context ∈ zp ≤  ∃y ∈ zp                                                                                          summing partition values   ≤  zp set parent contexts                                                                  default distribution deﬁned                           j           case abstracted variable                            pxk  vpaxk ×   ylpa yl                                              let  denote assignment pa   ∧ pa    ∈                                                                            val xk                      j  discussed phase va  − − −                                                                     px   vpax  ×   pa                                                                                                       pck − − pcm                                                               v∈partxk  v∈v                 discussed section  compute pck need  probability distribution super classes ck  true distribute product inner  immediate subclasses parent context discussed most sum rhs equality leaving                                                                                                  section  treat each classes simple term v∈v xk pa xk  equal pa xk   variable probability distribution class  equal  immediate subclasses parent context computed                            j  way described case                                                                                                     px   vpaxk ×   ylpa yl    evidence observed hierarchical variable trans                                                                     v∈partx                   lated corresponding abstract variable ha bf                        evidence eh disjunction abstract straightforward incorporate evidence query  values false observation   proof                                       domain size variables independent lemma  algorithm flatbayes partitions values  size hierarchies depends classes hierarchical variables bh children                                                                                 hierarchy exceptional respect relevant satisﬁes equation   children bh running time construct bf depends                                                        proof sketch let partxk denote abstraction  depth number exceptional classes af                                                ter constructing bf answer query bf using main hierarchical variable xk computed flatbayes xk  standard probabilistic inference algorithm example denotes abstraction xkifxk observed flatbayes                                                                         ∈        variable elimination algorithm zhang poole  removes set xk  values                                                        false flatbayes constructs conditional probability tables  stochastic simulation                                                                                                   variables xk ﬂat bayesian network using “inheritance”    correctness flat bayesian network             following cases                                                                                                                       case xk abstracted parents                                                                                         ∧  let hierarchical bayesian network discrete discussed phase xk pa xk   vs  random variables  xxn want         ∈                                                               pa  xk       pa xk  inherited                             qe       ⊆                        swer probabilistic query                fault distribution parent context ∈ zp ≤             query variables                                             denotes              observed     ∃y ∈ zp ≤   set ⊆ domaine ∈ evidence ∀   ∈               ∧                                                                       xk pa xk       vs   pa  xk        bh                                                                recursively prune variable chil pdxkpa xk  vs ∧ implies equation   dren observed queried geiger et al                                                            case xk abstracted  pearl                                                                                                                                       discussed phase compute xk pa xk                                                           ∧                                ∧ ∈                vs   pa xk      need conditional distribution               pqe ∈                                       ∈ treex                              ∈                  classes         immediate subclasses                                                        treat class cj cj ∈ treexk simple variable    variables irrelevant query pruned flatbayes proof follows case
