                Self-Adjusting Ring Modules (SARMs) for Flexible Gait Pattern Generation

                                              Manfred Hild‚Ä†, Frank Pasemann‚Ä°
                     ‚Ä† Institut fur¬® Informatik, Humboldt-Universitat¬® zu Berlin, hild@informatik.hu-berlin.de
                    ‚Ä° Fraunhofer Institut AIS, Sankt Augustin, Germany, frank.pasemann@ais.fraunhofer.de


                                Abstract                                                            
                                                                                               sr
                                                                                W  =(1+)              ,
                Using the principle of homeostasis, we derive a                   2           ‚àírs
                learning rule for a speciÔ¨Åc recurrent neural network where
                structure, the so-called Self-Adjusting Ring Mod-
                ule (SARM). Several of these Ring Modules can be                     s =cos(2œÄœÜ),
                plugged together to drive segmented artiÔ¨Åcial or-                    r =sin(2œÄœÜ),
                ganisms, for example centipede-like robots. Con-
                trolling robots of variable morphologies by SARMs and
                has major advantages over using Central Pattern                       0 ‚â§ œÜ ‚â§ 1/2,
                Generators (CPGs). SARMs are able to immedi-                          0 <.
                ately reconÔ¨Ågure themselves after reassembly of
                the robot‚Äôs morphology. In addition, there is no  Here s stands for the neurons‚Äô recurrent self-connections,
                need to decide on a singular place for the robot‚Äôs and r for the ring-connections between the neurons. If we
                control processor, since SARMs represent inher-   choose    1 and thus compensate for the damping prop-
                ently distributed control structures.             erty of the transfer function tanh, the two neurons approx-
                                                                  imately oscillate with frequency f0 = œÜfs, relative to the
                                                                  update or sampling frequency fs of the network [Pasemann
            1  Introduction                                       et al., 2003]. Since the two neurons produce almost sine
                                                                  waves that differ in phase by œÄ/2, it is possible to gener-
            In order for an organism to move, it is necessary that its limbs
                                                                  ate a sine wave and other waveforms of the same frequency,
            and its body itself move in a coordinated manner. A special
                                                                  but with arbitrary amplitude and phase, just using a weighted
            case of coordination is found in segmented organisms like
                                                                  sum of the two neurons‚Äô output signals [Hornik et al., 1989;
            centipedes, where similar parts of the body move in the same
                                                                  Cybenko, 1989].
            way, but phase-shifted. If we want to implement an artiÔ¨Åcial
            organism that moves, i.e. an autonomous robot, we can use 2.1 A Simple Ring Module
            a central pattern generator (CPG) to drive the motor joints
                                                                  We can extend the SO(2)-Oscillator to the more general form
            and thus select one of the well documented architectures from
                                                                  of a ring oscillator by introducing more neurons [Pasemann,
            the literature [Golubitsky et al., 1998]. But when a modular
                                                                  1995]. Using m neurons (m ‚â• 2), the weights can be written
            structure that can be assembled during runtime is asked for,
                                                                  as the following m√óm-matrix
            it is unclear where a CPG should be located, so a distributed
                                                                                        ‚éõ                 ‚éû
            approach will better Ô¨Åt the requirements.                                      sr
              In the following sections we introduce a concept of dis-                  ‚éú      .    .     ‚éü
                                                                                        ‚éú       ..  ..    ‚éü
            tributed control for the generation of locomotion, based on a Vm  =(wi,j)=‚éù                   ‚é† ,
            single neural building block, the Self-Adjusting Ring Module                            sr
            (SARM).                                                                        ‚àírs
                                                                  where again s stands for the self-connections, r for the ring-
            2  Two Neurons Form an SO(2)-Oscillator               connections, and all other entries are zero. For the ring to
                                                                  oscillate we choose the condition
            Using a discrete time, fully connected recurrent neural net-        
            
            work with two neurons, no bias terms, and tanh as transfer             
            function, the only parameters to specify are the weights which             wi‚àí1,i  wm,1 < 0,
            form a 2√ó2-matrix W2. This matrix is based on a rotation             i=2...m
            matrix [Thompson and Steward, 2002], i.e an element of the which for n ‚â• 1 and m =2n is fulÔ¨Ålled by the following
            unitary group SO(2) and has the form                  alternative arrangement of weights:

                                                            IJCAI-07
                                                               848                                                                  frequency. The proportion ratio depends on the number of
                     ‚éõ                    ‚éû
                        sr                                        neurons. This is exactly what we will need to implement a
                     ‚éú      s  ‚àír         ‚éü                       ring module that is able to self-adjust its weights in order to
                     ‚éú                    ‚éü
                     ‚éú         .    .     ‚éü               n       maintain a certain frequency and amplitude.
               U2n = ‚éú          ..   ..   ‚éü ,Œ≤=(‚àí1)        .
                     ‚éù                    ‚é†
                                    sr                            3   Introducing the Principle of Homeostasis
                        Œ≤r              s
                                                                  A central tenet of modern physiology is homeostasis [Der and
                                                                  Pantzer, 1999]. It describes the principle, that every living
            Clearly we have W2 = V2  = U2, but for n>1   always   organism tries to settle down to a healthy internal state af-
            V2n = U2n.Ifn  is odd, then Œ≤ = ‚àí1, therefore U2n can ter it has been disturbed. This desired state is also called an
            be implemented as n identical copies of the following ring equilibrium. We deÔ¨Åne the ring module to have reached its
            module:                                               equilibrium, if it oscillates with target frequency f0 and tar-
                                                                  get amplitude A0. The phase shift will not be of concern
                                                                  here. In order to apply homeostatic mechanisms to the ring
                                                                  module, we Ô¨Årst have to introduce an appropriate measure for
                                                                  the equilibrium [Urzelai and Floreano, 2001].
                                                                  3.1  Discrete Sampled Sine Waves
                                                                  If we sample one full period of a sine wave at N discrete time
                                                                  steps we can study the following two sums:
                                                                                             
                                                                              1 N‚àí1      2œÄk   
                                                                  S  (A, N)=        A sin        ,
                                                                   A          N            N    
                                                                                 k=0
                                                                                                               
                                                                              1 N‚àí1      2œÄ(k +1)            2œÄk  
                      Figure 1: Structure of a Ring Module        S  (A, N)=        A sin            ‚àí A sin        .
                                                                    f         N               N                N   
                                                                                 k=0

            The modules have a switch at each end which connects the The Ô¨Årst sum SA(A, N) calculates the average amplitude of
            two outputs as long as no other module is plugged in, thus the rectiÔ¨Åed signal and can easily be approximated by:
            single modules oscillate stand-alone. When modules are
                                                                             SA(A, N) ‚âà  lim  SA(A, N)
            plugged together, their switches open up, so that the former                N‚Üí‚àû
            two rings unite to one. For even n one needs to introduce                       
                                                                                         1    2œÄ
            a negation at some position in the ring, e.g. by means of a               =         |A sin x| dx
            simple switch.                                                               2œÄ  0
              Interesting applications of those modules emerge, if they                  2
                                                                                      =    ¬∑ A.
            have motor joints included, which are driven by a linear com-                œÄ
            bination of the modules‚Äô internal neurons. Flipping of one
                                                                  Thus, a sine wave of peak amplitude A results in an aver-
            ring module within a chain of modules changes the phase re-                     2A/œÄ
            lationships of all modules.                           age absolute neural activity of , independent of the fre-
                                                                  quency. For N>3  the second sum Sf (A, N) can be approx-
            2.2  Varying Frequency and Amplitude                  imated by
                                                                                                                 
            The mapping s =cos(2œÄœÜ),r =sin(2œÄœÜ)  no longer holds                N/4‚àí1                              
                                       U                                      4              2œÄ(k +1)            2œÄk  
            for the ring oscillators of type 2n, because the additional Sf (A, N) ‚âà    A sin            ‚àí A sin       
            neurons introduce a delay which in turn considerably lowers      N                    N                N
                                                                                  k=0        
            the frequency. At the same time the amplitude rises, since       4A      2œÄN/4
            there are more self-connections present which boost up the     =     sin
                                                                              N         N
            energy of the whole system.
                                                          s                  4A
              There does not exist a simple formula for calculating and    ‚âà    .
            r as a function of œÜ, but if the desired frequency is rela-       N
            tively low compared to the network‚Äôs update frequency, i.e. The approximation error
            for small œÜ, we Ô¨Ånd that:
                                                                                        4A
                            s =cos(2œÄœÜ) ‚âà 1,                                 E (A, N)=      ‚àí S (A, N) ‚â• 0
                                                                              f          N     f
                            r =sin(2œÄœÜ) ‚âà 2œÄœÜ.
                                                                  is zero if N is a multiple of four. In general, the relative error
            In other words, the weights of the self-connections always is below 3% for N>10, and below 1% for N>18. Alto-
            stay close to 1, mainly controlling the level of energy Ô¨Çow in gether, assuming a constant amplitude, the average variation
            the system and therefore the amplitude, whereas the weights of neural activity is reciprocally proportional to the oscilla-
            of the ring-connections are approximately proportional to the tion period.

                                                            IJCAI-07
                                                               8493.2  The Learning Rules                                 In an analogous manner we get a learning rule for the
                                                      weights of the ring-connections, which stabilizes the oscil-
Having deÔ¨Åned an equilibrium condition, we now need some
                                                      lation frequency:
example sets for weights of stable oscillating ring networks.
As a starting point, we assume a network update frequency r(t +1)=r(t)+rŒ¥(t),
  f   =50                                                                                         
of s       Hz, which corresponds to the timing of stan-                Œîr       4A
dard servo motors. Choosing an oscillation frequency of     r (t)=Œµ         f     0 f ‚àí|œÉ(t) ‚àí œÉÀÜ(t)| ,
                                                             Œ¥      r ŒîS f   0  f   0
f0 =1Hz as moderate speed for a walking machine, we have                f s       s
œÜ = f0/fs =1/50.
                                                      where r(t) is the weight at time t, œÉ(t) and œÉÀÜ(t) are the out-
  The larger the amplitude, the larger the distortions of the puts of the neurons after and before the r-weighted connec-
sine wave, due to the non-linearity of tanh, so using A0 =
                                                      tion, respective, Œµr is the normalized learning rate, and the
0.4 as target amplitude is a good choice. Varying the number
              n ‚àà{1, 2,...,6}     U                   rest as deÔ¨Åned above. Again, this learning rule can also be
of ring modules               with 2n as correspond-  written in a simple form as
ing weight matrix, we get the following results by numerical
simulation:                                                        rŒ¥(t)=Œ∑ (Œº ‚àí|œÉ(t) ‚àí œÉÀÜ(t)|) ,
                                                                               Œ∑    Œº
         2n     s2n      r2n     s2n + r2n            with pre-calculated constants and . Note, that despite the
                                                           ‚àíœÉÀÜ(t)                               œÉÀÜ(t)
         2     1.036    0.132      1.168              term      , both formulas are identical. Clearly, must
         4     0.905    0.187      1.092              be zero in the Ô¨Årst learning rule, since there is only one neuron
         6     0.814    0.260      1.074              involved with a self-connection.
         8     0.721    0.345      1.066                Since rŒ¥(t) controls the oscillation frequency, but depends
         10    0.642    0.420      1.062              on A0 and f0 at the same time, this learning rule will only
         12    0.550    0.510      1.060              work properly combined with the learning rule for the self-
                                                      connections. Care has to be taken with the choice of Œµs
                                                      and Œµr, because too high a value will deform the waveform‚Äôs
               Table 1: Weight Settings               shape and cause uncontrolled interactions between the two
                                                      learning rules. Good parameter choices are given at the end.
  If we start with three coupled ring modules and then add
one module, the amplitude grows by ŒîA =0.2 from 0.4 to 3.3 Diffusion Processes
0.6. In order to compensate for this effect, we have to adjust If we assemble some ring modules with well-tuned parame-
the self-coupling weights by s8 ‚àí s6 = ‚àí0.093.Ifweleave ters and then switch them on, the learning rules reliably adjust
out one module, the weights have to be adjusted accordingly oscillation frequency and amplitude within a few oscillation
by s4 ‚àí s6 =+0.091, so the average absolute adjustment is periods. This will work equally well for a single module or
Œîs =0.092. Putting this together, we end up with a simple up to six and more modules.
learning rule for the self-coupling weights, which stabilizes Now, if we separate some modules and reassemble them
the amplitude:                                        all during runtime, something special may happen. Since
         s(t +1)=s(t)+s   (t),                        the separated modules go on oscillating and adjusting their
                         Œ¥                          weights independently from each other, we have an unpre-
                     Œîsf0   2                         dictable distribution of weight values and neural activities at
           sŒ¥(t)=Œµs          A0 ‚àí|œÉ(t)|  ,
                    ŒîAfs    œÄ                         the time we reconnect the modules. The modules then end
                                                      up with an unequal weight distribution. Frequency and am-
where s(t) is the weight and œÉ(t) the neuron‚Äôs output at time plitude will be well preserved by the learning rules, but the
t, A0 and f0 are target amplitude and frequency, and Œîs, ŒîA, relative phase shift between the modules on one side, and be-
and fs are deÔ¨Åned as above. Œµs is the normalized learning tween the two neurons within one module on the other side
rate, i.e. Œµs =1.0 means, that after changing the number will no longer be the same. In order to compensate for this,
of connected ring modules, the target amplitude A0 will be we introduce two independent diffusion processes, one for
reached again after the next full oscillation period. each weight pair s, s and r, r within a module, as follows:
                                                f
  Two things should be noted: Ô¨Årstly, the appearance of 0                  s(t)+s(t)
in the learning rule is just part of the learning rate‚Äôs normal-     s¬Ø(t)=          ,
ization and not essential for the proper amplitude regulation.                 2
Secondly, since all parameters are known in advance, the for-    s(t +1)=Œ¥ss¬Ø(t)+(1‚àí   Œ¥s) s(t),
                                                                                          
mula can easily be implemented as                                s (t +1)=Œ¥ss¬Ø(t)+(1‚àí  Œ¥s) s (t),

               sŒ¥(t)=Œ∑  (Œº ‚àí|œÉ(t)|) ,                 and similarly for the ring-connections:
                         Œ∑    Œº            A   ŒîA                          r(t)+r(t)
with pre-calculated constants and , according to 0, ,                r¬Ø(t)=          ,
f0, fs, Œµs, and Œîs. Thus, only a multiplication, an addition,                  2
and a sign Ô¨Çip is needed. Because of the computationally         r(t +1)=Œ¥rr¬Ø(t)+(1‚àí   Œ¥r) r(t),
low cost, this learning rule can run even on simplest 8 bit-
                                                                r(t +1)=Œ¥   r¬Ø(t)+(1‚àí Œ¥ ) r(t).
microprocessors [Hikawa, 2003].                                             r           r

                                                IJCAI-07
                                                   850The diffusion processes have to be applied immediately after     Parameter             Symbol    Value
the learning rule‚Äôs weight update. Generally it is sufÔ¨Åcient to Target Amplitude         A0       0.4
use small values for Œ¥s and Œ¥r, i.e. 0 ‚â§ Œ¥s,Œ¥r  1.           Target Frequency           f0       1Hz
  When implemented on a simple 8 bit-microprocessor, as   Network Update Frequency       fs      50Hz
mentioned above, only additions are needed, since a division Learning Rate Self-Connections Œµs    1.0
by two can be implemented as a right shift. The same is true Learning Rate Ring-Connections Œµr    5.0
for smart choices of Œ¥s and Œ¥r.                           Diffusion Self-Connections     Œ¥s       0.05
                                                          Diffusion Ring-Connections     Œ¥r       0.1
4  Results and Discussion
To illustrate the effect of the homeostatic learning rules and      Table 2: Parameter Settings
diffusion processes, we simulate hot plugging and unplug-
ging of one to Ô¨Åve continuously operating SARMs, Ô¨Årst with
                                                      depends on the amplitude, whereas the amplitude controlling
Ô¨Åxed weights, then with homeostatic control of the weights.
                                                      adjustment of the self-connections is frequency independent.
For the Ô¨Årst simulation we set s =0.814, r =0.260, and
                                                      Table 2 shows which parameter settings have been proven to
start with three concatenated SARMs. The result can be seen
                                                      be robust. Using these settings we get the following system
in the following Ô¨Ågure:
                                                      behavior:


      1.5
                                           o                1.5
                                           s                                                     o
                                           r                                                     s
                                                                                                 r

      1
                                                             1


      0.5
                                                            0.5
    neural  output
                                                           neural  output


      0
                                                             0


     -0.5
       0    500 1000 1500 2000 2500 3000 3500 4000          -0.5
                         time steps                           0   500  1000 1500 2000 2500 3000 3500 4000
                                                                                time steps

   Figure 2: Neural Output When Using Fixed Weights
                                                        Figure 3: Neural Output of Self-Adjusting Ring Modules

As expected, the three ring modules oscillate with amplitude
A0 =0.4  and frequency ratio f0/fs =1/50, which corre- Clearly the SARMs now Ô¨Ånd back to their equilibrium, after
sponds to an output frequency of 1.0Hz, assuming 50 time being disturbed by hot reassembly. As can be seen, Ô¨Årst the
steps per second. After 10 seconds (at time step 500) two ad- amplitude is back to 0.4 after a few periods, whereas the fre-
ditional SARMs are plugged in. In consequence, the ampli- quency settles down afterwards (see Figure 3, time steps 500
tude slightly increases and the frequency considerably lowers to 700, 1600 to 2000, and 2500 to 3000). Three Ô¨Åndings are
down from 1.0Hz to 0.6Hz. After further 20 seconds (at time to be mentioned in comparison to the simulation with Ô¨Åxed
step 1500) four of the Ô¨Åve SARMs are removed and almost weights:
immediately the oscillation completely breaks down. 20 sec-
                                                        ‚Ä¢ Depending on the number of active SARMs, all weights
onds later again two SARMs are added (at time step 2500),
                                                          target their optimal value as listed in Table 1. This impli-
but the system is not able to recover from zero to oscillation.
                                                          cates, that each SARM in principle is able to derive the
Theoretically oscillation should restart, but due to the Ô¨Ånite
                                                          exact number of attached SARMs ‚Äì without dedicated
accuracy (even) of double precision numbers this is practi-
                                                          communication and regardless of their distance. The
cally never the case.
                                                          starting weights s =0.814 and r =0.260 are reached
  We now repeat the whole sequence of plugging and un-
                                                          again, once the starting number of SARMs is restored.
plugging, but with learning rules and diffusion processes
                                                          Loosely spoken, each part of the body statically feels
switched on. In order to have comparable conditions, we
                                                          the rest of the body and is dynamically aware of mor-
use appropriate parameters for target amplitude, target fre-
                                                          phological changes to the whole body.
quency, and network update frequency. As pointed out ear-
lier, it is crucial to quickly reach a stable amplitude, since ‚Ä¢ The oscillation never breaks down (see time steps 1500
the frequency controlling adjustment of the ring-connections to 1700). More loosely spoken and in analogy to physi-

                                                IJCAI-07
                                                   851    ology it can be stated, that homeostasis prevents the (ar- tive behavior in new environments. Evolutionary Com-
    tiÔ¨Åcial) organism from death.                        putation, 9(4):495‚Äì524, 2001.
  ‚Ä¢ Close inspection of the slow varying self-connections re-
    veals, that the target frequency shines through slightly
    (can be best seen shortly after time step 2500). This in-
    dicates an optimal setting of the self-connection‚Äôs learn-
    ing rate. A higher rate would lead to destabilization,
    whereas lower rates would prolongate reaction time.
  Despite these more analytical and philosophical reÔ¨Çec-
tions, the Self-Adjusting Ring Modules can practically be
built in hardware and used to make artiÔ¨Åcial creatures move.
An actuated modular body construction system as described
in [RafÔ¨Çe, 2004] forms an optimal application. It then is a
good idea to have the modules equipped with a switch which
introduces a negation before one ring-connection, as nec-
essary for an even number of interconnected ring modules.
Now, this switch can also be used to turn off the oscillation
of the whole network and settle down into a conÔ¨Åguration of
constant neural output signals. Different steady output con-
Ô¨Ågurations are possible, just by switching on the negation at
different modules.

References
[Cybenko, 1989] G. Cybenko. Approximation by superpo-
  sition of a sigmoidal function. Mathematics of Control,
  Signal and Systems, 2:303‚Äì314, 1989.
[Der and Pantzer, 1999] R. Der and T. Pantzer. Emergent
  robot behavior from the principle of homeokinesis. Pro-
  ceedings of the 1st International Khepera Workshop, 1999.
[Golubitsky et al., 1998] M. Golubitsky, I. Stewart, P.-L.
  Buono, and J. J. Collins. A modular network for legged
  locomotion. Physica D, 105:56‚Äì72, 1998.
[Hikawa, 2003] H. Hikawa.  A  digital hardware pulse-
  mode neuron with piecewise linear activation function.
  IEEE  Transactions on Neural Networks, 14(5):1028‚Äì
  1037, 2003.
[Hornik et al., 1989] K. Hornik, M. Stinchcombe, and
  H. White. Multilayer feedforward networks are universal
  approximators. Neural Networks, 2:359‚Äì366, 1989.
[Pasemann et al., 2003] F. Pasemann, M. Hild, and K. Za-
  hedi.  SO(2)-networks as neural oscillators. Proc. of
  Int. Work-Conf. on ArtiÔ¨Åcial and Natural Neural Networks
  (IWANN), 2003.
[Pasemann, 1995] F. Pasemann. Characterization of peri-
  odic attractors in neural ring networks. Neural Networks,
  8:421‚Äì429, 1995.
[RafÔ¨Çe, 2004] H. S. RafÔ¨Çe. Topobo: A 3-D constructive as-
  sembly system with kinetic memory. Master‚Äôs thesis, Pro-
  gram in Media Arts and Sciences, MIT, 2004.
[Thompson and Steward, 2002] J. M. T. Thompson and
  H. B. Steward. Nonlinear Dynamics and Chaos. John
  Wiley & Sons, Ltd, 2002.
[Urzelai and Floreano, 2001] J. Urzelai and D. Floreano.
  Evolution of adaptive synapses: Robots with fast adap-

                                                IJCAI-07
                                                   852